<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>êµ­ì–´ ê³¼ì œ ìƒì„±ê¸° v6.0 (ë³´ì•ˆ/ì•ˆì •ì„± ê°•í™”)</title>
    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; padding: 20px; background: #f0f2f5; line-height: 1.6; }
        .box { max-width: 800px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h2 { border-left: 5px solid #2196f3; padding-left: 15px; color: #333; margin-bottom: 25px; }
        label { display: block; margin-top: 15px; font-weight: bold; color: #444; }
        input, textarea { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        textarea { height: 80px; resize: none; }
        #genBtn { width: 100%; padding: 15px; background: #2196f3; color: white; border: none; border-radius: 10px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 25px; }
        #output { width: 100%; height: 350px; margin-top: 20px; font-family: 'Consolas', monospace; background: #2d3436; color: #dfe6e9; padding: 15px; border-radius: 8px; font-size: 11px; }
    </style>
</head>
<body>
<div class="box">
    <h2>ğŸš€ êµ­ì–´ ê³¼ì œ ìƒì„±ê¸° v6.0</h2>
    <p style="color:#2e7d32; font-size:0.9rem;">âœ… ì „ë¬¸ê°€ ê²€í†  ì™„ë£Œ: ë³´ì•ˆ ë° ì•ˆì •ì„± íŒ¨ì¹˜ ì ìš©ë¨</p>
    
    <label>ê³¼ì œ ì œëª©</label><input type="text" id="title" value="1ì›” 3ì£¼ì°¨ ì£¼ê°„ì§€">
    <label>ğŸ“¢ í•™ìƒ ê³µì§€ì‚¬í•­</label><textarea id="noticeMsg">ì œì¶œ í›„ ì¹´í†¡ ì „ì†¡ì„ ë§ˆì³ì•¼ í•´ì„¤ì§€ê°€ ê³µê°œë©ë‹ˆë‹¤.</textarea>
    <label>ì „ì²´ ì •ë‹µ (ìˆ«ìë§Œ)</label><textarea id="answers" placeholder="ì˜ˆ: 311454..."></textarea>
    <label>âœ… í™œì„±í™” ë¬¸í•­</label><input type="text" id="activeRange" placeholder="ì˜ˆ: 1-15, 30-45">
    <label>ì‹œí—˜ì§€ ë§í¬</label><input type="text" id="testLink">
    <label>í•´ì„¤ì§€ ë§í¬</label><input type="text" id="ansLink">
    
    <button type="button" id="genBtn" onclick="generateCode()">âœ¨ ë³´ì•ˆ ê°•í™” HTML ì½”ë“œ ìƒì„±</button>
    <textarea id="output" readonly onclick="this.select(); document.execCommand('copy');" placeholder="ìƒì„±ëœ ì½”ë“œê°€ ì—¬ê¸°ì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤."></textarea>
</div>

<script>
function parseRange(str) {
    const activeNums = new Set();
    if(!str) return [];
    str.split(',').forEach(part => {
        const range = part.trim().split('-');
        if (range.length === 2) { for (let i = parseInt(range[0]); i <= parseInt(range[1]); i++) activeNums.add(i); }
        else { const num = parseInt(range[0]); if (!isNaN(num)) activeNums.add(num); }
    });
    return Array.from(activeNums).sort((a, b) => a - b);
}

function generateCode() {
    const titleVal = document.getElementById('title').value;
    const noticeVal = (document.getElementById('noticeMsg').value || "ì œì¶œ ì™„ë£Œ ì‹œ ê²°ê³¼ ê³µê°œ").replace(/\n/g, '<br>');
    const ansArray = document.getElementById('answers').value.replace(/[^1-5]/g, '').split('').map(Number);
    const activeQuestions = parseRange(document.getElementById('activeRange').value);
    const testLink = document.getElementById('testLink').value || "#";
    const ansLink = document.getElementById('ansLink').value || "#";
    const kakaoKey = "de4c158b009fb05f7f51d2243447511b"; //

    if(ansArray.length === 0) return alert("ì •ë‹µì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!");

    let c = '<!DOCTYPE html>\n<html lang="ko">\n<head>\n<meta charset="UTF-8">\n<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">\n';
    c += '<title>' + titleVal + '</title>\n<script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"><\/script>\n';
    c += '<style>\nbody{font-family:-apple-system,sans-serif;background:#f0f2f5;padding:15px;margin:0}.container{max-width:600px;margin:0 auto;background:#fff;padding:25px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,0.1)}\n';
    c += '.btn-kakao{display:block;width:100%;text-align:center;background:#fee500;color:#3c1e1e;border:none;padding:15px;border-radius:10px;font-weight:bold;font-size:1.1rem;cursor:pointer;margin:20px 0;display:none;text-decoration:none}\n';
    c += '.q-item{margin-bottom:15px;display:flex;align-items:center;justify-content:space-between}.omr-label{width:35px;height:35px;border-radius:50%;border:2px solid #ddd;display:flex;align-items:center;justify-content:center;cursor:pointer}\n';
    c += '.omr-input:checked+.omr-label{background:#2196f3;border-color:#2196f3;color:white}#overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:9999;flex-direction:column;align-items:center;justify-content:center;text-align:center}\n';
    c += '</style></head><body><div id="overlay"></div><div class="container"><h2>' + titleVal + '</h2>';
    c += '<div id="questionContainer"></div><button id="submitBtn" onclick="processSubmission()" style="width:100%;padding:15px;background:#ff6b6b;color:white;border:none;border-radius:10px;font-weight:bold;cursor:pointer;">ğŸ“ ë‹µì•ˆ ì œì¶œí•˜ê¸°</button>';
    c += '<button id="kakaoBtn" class="btn-kakao" onclick="openKakao()">ğŸŸ¡ ì¹´í†¡ìœ¼ë¡œ ê²°ê³¼ ì „ì†¡</button><div id="resultArea" style="display:none;margin-top:20px;text-align:center;"></div></div>';
    c += '<script>\n';
    c += '// [Security Notice] This file contains a Kakao JS Key. Avoid sharing this HTML publically outside your students.\n';
    c += 'try { if(!window.Kakao.isInitialized()){ window.Kakao.init("' + kakaoKey + '"); } } catch(e){}\n';
    c += 'const correctAnswers=[' + ansArray.join(',') + '];const activeQuestions=[' + activeQuestions.join(',') + '];';
    c += 'const ANSWER_LINK="' + ansLink + '";let finalWrongCount=0;let finalShareText="";\n';
    
    c += '// window.onload ëŒ€ì‹  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì‚¬ìš© (ì•ˆì •ì„± ê°•í™”)\n';
    c += 'window.addEventListener("load", function(){\n';
    c += '  if(location.protocol === "file:") alert("âš ï¸ ë¡œì»¬ì—ì„œ ì‹¤í–‰í•˜ë©´ ì¹´í†¡ ì „ì†¡ì´ ì‹¤íŒ¨í•©ë‹ˆë‹¤. ë°˜ë“œì‹œ ì˜¨ë¼ì¸ ì£¼ì†Œì—ì„œ ì—´ì–´ì£¼ì„¸ìš”.");\n';
    c += '  let h="";for(let i=1;i<=correctAnswers.length;i++){\n';
    c += '    if(activeQuestions.includes(i)){\n';
    c += '      h+=\'<div class="q-item"><span>\'+i+\'ë²ˆ</span><div style="display:flex;gap:5px">\';\n';
    c += '      for(let j=1;j<=5;j++) h+=\'<input type="radio" name="q\'+i+\'" id="q\'+i+\'_\'+j+\'" value="\'+j+\'" style="display:none" class="omr-input"><label for="q\'+i+\'_\'+j+\'" class="omr-label">\'+j+\'</label>\';\n';
    c += '      h+=\'</div></div>\';\n';
    c += '    }\n';
    c += '  }document.getElementById("questionContainer").innerHTML=h;\n';
    c += '});\n';

    c += 'function processSubmission(){\n';
    c += '  const a=prompt("í•™ì› ì´ë¦„"), n=prompt("í•™ìƒ ì´ë¦„"); if(!a||!n)return;\n';
    c += '  let w=0; activeQuestions.forEach(i=>{\n';
    c += '    const sel=document.querySelector(\'input[name="q\'+i+\'"]:checked\');\n';
    c += '    if(!sel||parseInt(sel.value)!==correctAnswers[i-1])w++;\n';
    c += '  }); finalWrongCount=w;\n';
    c += '  finalShareText="[' + titleVal + ']\\ní•™ì›: "+a+"\\ní•™ìƒ: "+n+"\\ní‹€ë¦° ê°œìˆ˜: "+w+"ê°œ";\n';
    c += '  document.getElementById("submitBtn").style.display="none";document.getElementById("kakaoBtn").style.display="block"; alert("ë‹µì•ˆì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ì¹´í†¡ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.");\n';
    c += '}\n';

    c += 'function openKakao(){\n';
    c += '  if(!finalShareText) return alert("ë¨¼ì € ë‹µì•ˆì„ ì œì¶œí•´ ì£¼ì„¸ìš”.");\n';
    c += '  const officialDomain = "https://saenarachild-crypto.github.io"; // ë„ë©”ì¸ ê³ ì • (4019 ë°©ì§€)\n';
    c += '  window.Kakao.Share.sendDefault({ objectType: "text", text: finalShareText, link: { mobileWebUrl: officialDomain, webUrl: officialDomain } });\n';
    c += '  setTimeout(function(){\n';
    c += '    const o=document.getElementById("overlay"); o.style.display="flex";\n';
    c += '    o.innerHTML=\'<div style="background:white;padding:30px;border-radius:15px;"><p>ì„ ìƒë‹˜ê»˜ ì „ì†¡ì„ ì™„ë£Œí–ˆë‚˜ìš”?</p><button onclick="confirmFinish()" style="width:100%;padding:10px;background:#fee500;border:none;border-radius:8px;font-weight:bold;cursor:pointer;">ë„¤, ì™„ë£Œí–ˆìŠµë‹ˆë‹¤</button></div>\';\n';
    c += '  }, 2000);\n';
    c += '}\n';

    c += 'function confirmFinish(){\n';
    c += '  document.getElementById("overlay").style.display="none";\n';
    c += '  const r=document.getElementById("resultArea"); r.style.display="block";\n';
    c += '  r.innerHTML="<h3>ê³¼ì œ ê²°ê³¼</h3><p>ì˜¤ë‹µ: "+finalWrongCount+"ê°œ</p><a href=\'"+ANSWER_LINK+"\' target=\'_blank\' style=\'display:block;padding:12px;background:#4caf50;color:white;text-decoration:none;border-radius:8px;font-weight:bold;\'>ğŸ“˜ ì •ë‹µ ë° í•´ì„¤ì§€ ë³´ê¸°</a>";\n';
    c += '  document.getElementById("kakaoBtn").style.display="none";\n';
    c += '}\n';
    c += '<\/script></body></html>';

    document.getElementById('output').value = c;
    alert("v6.0 ë³´ì•ˆ ê°•í™” ì½”ë“œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ë³µì‚¬í•´ì„œ ì‚¬ìš©í•˜ì„¸ìš”.");
}
</script>
</body>
</html>