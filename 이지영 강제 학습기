<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ì´ì§€ì˜ êµ­ì˜ìˆ˜">
    
    <title>ì´ì§€ì˜ì˜ ê°•ìš” êµ­ì˜ìˆ˜ - ì² ê¶Œ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    
    <!-- í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://cdn.jsdelivr.net/npm/pretendard@1.3.9/dist/web/static/pretendard.css');
        
        :root {
            --sat: env(safe-area-inset-top);
            --sab: env(safe-area-inset-bottom);
        }

        body { 
            font-family: 'Pretendard', sans-serif; 
            -webkit-tap-highlight-color: transparent; 
            background-color: #F8FAFC; 
            color: #0F172A;
            margin: 0; padding: 0;
            height: 100vh;
            overflow: hidden;
        }

        .app-container { height: 100vh; display: flex; flex-direction: column; background-color: #F8FAFC; }
        .progress-bar { transition: width 1.2s cubic-bezier(0.65, 0, 0.35, 1); }
        .animate-pop { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { 0% { transform: scale(0.95); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        .lockdown-screen {
            position: fixed; inset: 0; z-index: 9999;
            background: linear-gradient(to bottom, #9f1239, #4c0519);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: white; text-align: center; padding: 2rem;
        }

        .focus-check-overlay {
            position: fixed; inset: 0; z-index: 10000;
            background: rgba(15, 23, 42, 0.98); backdrop-filter: blur(15px);
            display: flex; align-items: center; justify-content: center; padding: 1.5rem;
        }

        .subject-card { transition: all 0.2s ease; border: 1px solid #E2E8F0; cursor: pointer; }
        .subject-card:active { transform: scale(0.97); background-color: #F1F5F9; }
        .safe-bottom { padding-bottom: calc(var(--sab) + 1.5rem); }
        .passage-text { line-height: 1.8; text-align: justify; word-break: keep-all; font-size: 0.95rem; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        const Icon = ({ name, size = 24, className = "" }) => {
            const LucideIcon = window.lucide.icons[name];
            return LucideIcon ? <LucideIcon size={size} className={className} /> : null;
        };

        const App = () => {
            const apiKey = "AIzaSyAOZyXDCabd7DdK-fTguQxxZdVSh-xl_Is"; 
            const todayStr = new Date().toLocaleDateString();

            // --- ìƒíƒœ ê´€ë¦¬ ---
            const [tab, setTab] = useState('home');
            const [isStarted, setIsStarted] = useState(() => localStorage.getItem('jy_final_started') === 'true');
            const [points, setPoints] = useState(() => Number(localStorage.getItem('jy_final_pts')) || 0);
            const [streak, setStreak] = useState(() => Number(localStorage.getItem('jy_final_strk')) || 0);
            const [startDate, setStartDate] = useState(() => localStorage.getItem('jy_final_start') || new Date().toISOString().split('T')[0]);
            
            const [engDone, setEngDone] = useState(() => localStorage.getItem('jy_final_eng_d') === todayStr);
            const [korDone, setKorDone] = useState(() => localStorage.getItem('jy_final_kor_d') === todayStr);
            const [mathDone, setMathDone] = useState(() => localStorage.getItem('jy_final_math_d') === todayStr);

            const [attempts, setAttempts] = useState(() => JSON.parse(localStorage.getItem('jy_final_try')) || {});
            const [penaltyEnd, setPenaltyEnd] = useState(0);
            const [timeLeft, setTimeLeft] = useState(0);
            const [showFocusCheck, setShowFocusCheck] = useState(false);
            const [focusTimeLeft, setFocusTimeLeft] = useState(15);

            const [studyData, setStudyData] = useState(() => JSON.parse(localStorage.getItem('jy_final_data')) || { eng: {}, math: {}, kor: { passages: [] } });
            const [quiz, setQuiz] = useState({ active: false, type: '', idx: 0, subIdx: 0, input: '', feed: null });

            const mathCurriculum = useMemo(() => [
                "ì´ë“±ë³€ì‚¼ê°í˜•ì˜ ì„±ì§ˆ", "ì´ë“±ë³€ì‚¼ê°í˜• ì¡°ê±´", "ì§ê°ì‚¼ê°í˜• í•©ë™", "ê°ì˜ ì´ë“±ë¶„ì„ ", "ì‚¼ê°í˜• ì™¸ì‹¬", "ì‚¼ê°í˜• ë‚´ì‹¬", "ì‚¼ê°í˜• ë³µìŠµ",
                "í‰í–‰ì‚¬ë³€í˜• ì„±ì§ˆ", "ëŒ€ê°ì„  ì„±ì§ˆ", "í‰í–‰ì‚¬ë³€í˜• ì¡°ê±´", "ì—¬ëŸ¬ ì‚¬ê°í˜•(1)", "ì—¬ëŸ¬ ì‚¬ê°í˜•(2)", "ì‚¬ê°í˜• ê´€ê³„", "í‰í–‰ì„  ë„“ì´", "ì‚¬ê°í˜• ë³µìŠµ",
                "ë„í˜•ì˜ ë‹®ìŒ", "ì‚¼ê°í˜• ë‹®ìŒ", "ì‚¼ê°í˜• í‰í–‰ì„ ", "ì¤‘ì  ì—°ê²° ì„ ë¶„", "ë¬´ê²Œì¤‘ì‹¬", "ë¶€í”¼ ë¹„", "í”¼íƒ€ê³ ë¼ìŠ¤", "í”¼íƒ€ê³ ë¼ìŠ¤ ì‘ìš©", "ë‹®ìŒ ë³µìŠµ",
                "ê²½ìš°ì˜ ìˆ˜", "ì¼ë ¬ ì„¸ìš°ê¸°", "í™•ë¥  ì„±ì§ˆ", "í™•ë¥  ê³„ì‚°", "ì—°ì† í™•ë¥ ", "ìµœì¢… ëª¨ì˜ê³ ì‚¬"
            ], []);

            const currentDayNum = useMemo(() => {
                const start = new Date(startDate);
                const today = new Date();
                today.setHours(0,0,0,0);
                const diff = Math.floor((today - start) / (1000 * 60 * 60 * 24)) + 1;
                return Math.min(30, Math.max(1, diff));
            }, [startDate]);

            // ë°ì´í„° ì˜êµ¬ ì €ì¥
            useEffect(() => {
                localStorage.setItem('jy_final_pts', points);
                localStorage.setItem('jy_final_strk', streak);
                localStorage.setItem('jy_final_start', startDate);
                localStorage.setItem('jy_final_started', isStarted);
                localStorage.setItem('jy_final_eng_d', engDone ? todayStr : "");
                localStorage.setItem('jy_final_kor_d', korDone ? todayStr : "");
                localStorage.setItem('jy_final_math_d', mathDone ? todayStr : "");
                localStorage.setItem('jy_final_data', JSON.stringify(studyData));
                localStorage.setItem('jy_final_try', JSON.stringify(attempts));
            }, [points, streak, engDone, korDone, mathDone, studyData, attempts, isStarted, startDate, todayStr]);

            // í˜ë„í‹° íƒ€ì´ë¨¸ (ì˜¤ë‹µ ì‹œ 1ë¶„, ê²€ë¬¸ ì‹¤íŒ¨ ì‹œ 5ë¶„)
            useEffect(() => {
                const timer = setInterval(() => {
                    const now = Date.now();
                    if (penaltyEnd > now) setTimeLeft(Math.ceil((penaltyEnd - now) / 1000));
                    else setTimeLeft(0);
                }, 1000);
                return () => clearInterval(timer);
            }, [penaltyEnd]);

            // ì§‘ì¤‘ë ¥ ì²´í¬ íƒ€ì´ë¨¸ (15ì´ˆ)
            useEffect(() => {
                let it;
                if (showFocusCheck) {
                    setFocusTimeLeft(15);
                    it = setInterval(() => {
                        setFocusTimeLeft(p => {
                            if (p <= 1) {
                                setPenaltyEnd(Date.now() + 300000); // 5ë¶„ í˜ë„í‹°
                                setShowFocusCheck(false);
                                return 0;
                            }
                            return p - 1;
                        });
                    }, 1000);
                }
                return () => clearInterval(it);
            }, [showFocusCheck]);

            // ë¶ˆì‹œ ê²€ë¬¸ íŠ¸ë¦¬ê±° (í•™ìŠµ ì¤‘ ëœë¤ 5-10ë¶„)
            useEffect(() => {
                if (isStarted && !quiz.active) {
                    const checkInterval = setInterval(() => {
                        if (Math.random() < 0.2) setShowFocusCheck(true);
                    }, 480000); 
                    return () => clearInterval(checkInterval);
                }
            }, [isStarted, quiz.active]);

            // AI ì½˜í…ì¸  ë¡œë“œ
            const fetchStudyData = useCallback(async (force = false) => {
                if (!apiKey) return;
                const lastFetch = localStorage.getItem('jy_final_fetch');
                if (!force && lastFetch === todayStr && studyData.kor.passages?.length === 3) return;

                setLoading(true);
                try {
                    const mathT = mathCurriculum[currentDayNum - 1];
                    const prompt = `ì—„ê²©í•œ ê´€ë¦¬ì ì´ì§€ì˜ ëª¨ë“œ: 1. êµ­ì–´ ê³ ë‚œë„ ì§€ë¬¸ 3ê°œì™€ ê° 5ì§€ì„ ë‹¤ ë¬¸ì œ 2ê°œ. 2. ì˜ì–´ ê³ ë‚œë„ ë‹¨ì–´ 10ê°œ, ì´ë¥¼ í™œìš©í•œ ê¸´ ì§€ë¬¸, í•´ì„ ë¬¸ì œ, ë¬¸ë²• 5ì§€ì„ ë‹¤ 1ê°œ. 3. ìˆ˜í•™ "${mathT}" ì‹¬í™” 5ì§€ì„ ë‹¤ 3ë¬¸ì œ. JSONìœ¼ë¡œë§Œ ë‹µë³€.`;
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }], generationConfig: { responseMimeType: "application/json" } })
                    });
                    const data = await res.json();
                    setStudyData(JSON.parse(data.candidates[0].content.parts[0].text));
                    localStorage.setItem('jy_final_fetch', todayStr);
                } catch (e) { console.error(e); }
                setLoading(false);
            }, [currentDayNum, mathCurriculum, studyData, todayStr]);

            useEffect(() => { if (isStarted) fetchStudyData(); }, [isStarted]);

            // ì¹´ì¹´ì˜¤í†¡ ì—°ë™ ë¡œì§
            const sendKakao = (msg) => {
                const el = document.createElement("textarea");
                el.value = msg; document.body.appendChild(el); el.select();
                document.execCommand("copy"); document.body.removeChild(el);
                const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                if (isMobile) window.location.href = "kakaotalk://";
                alert(`âœ… ë‚´ìš©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì¹´í†¡ ì±„íŒ…ë°©(ì—„ë§ˆ)ì„ ì—´ì–´ 'ë¶™ì—¬ë„£ê¸°' í•˜ì„¸ìš”.`);
            };

            const handlePlayAndStart = () => {
                setIsStarted(true);
                const msg = `ğŸš© [í•™ìŠµ ì‹œì‘ ë³´ê³ ]\nì´ì§€ì˜ ë‹˜ì˜ ì§€ë„ í•˜ì— êµ­ì˜ìˆ˜ í†µí•© í•™ìŠµì„ ì§€ê¸ˆ ì´ ìˆœê°„ ì‹œì‘í•©ë‹ˆë‹¤.\n\nğŸ“… ë‚ ì§œ: ${todayStr}\nëª©í‘œ: êµ­ì–´ 3ì§€ë¬¸ ë¶„ì„, ì˜ì–´ í†µí•© ë¯¸ì…˜, ìˆ˜í•™ Day ${currentDayNum}\nì™„ë£Œ ì‹œê¹Œì§€ ì ˆëŒ€ ë”´ì§“í•˜ì§€ ì•Šê² ìŠµë‹ˆë‹¤.`;
                sendKakao(msg);
            };

            const handleFinalReport = () => {
                const totalTry = Object.values(attempts).reduce((a, b) => a + b, 0);
                const report = `ğŸš¨ [ì´ì§€ì˜ì˜ ê°•ìš” êµ­ì˜ìˆ˜ ì¼ì¼ ë³´ê³ ] ğŸš¨\n\nğŸ“… ${todayStr}\nğŸ”¥ ì—°ì† í•™ìŠµ: ${streak}ì¼ì°¨\n\nâœ… ì™„ë£Œ ê²°ê³¼:\n - êµ­ì–´: 3ì§€ë¬¸ ë¶„ì„ ì™„ìˆ˜\n - ì˜ì–´: ì–´íœ˜/í•´ì„/ì–´ë²• ì™„ìˆ˜\n - ìˆ˜í•™: Day ${currentDayNum} ì™„ìˆ˜\n\nğŸ¯ ì´ ë¬¸ì œ ë„ì „ íšŸìˆ˜: ${totalTry}íšŒ\n(ì˜¤ë‹µ ì‹œ 1ë¶„ ëŒ€ê¸°í•˜ë©° ìŠ¤ìŠ¤ë¡œ ë‹µì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.)\n\nì„±ì‹¤íˆ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤. í™•ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤!`;
                sendKakao(report);
            };

            const handleAnswer = (val) => {
                if (timeLeft > 0 || quiz.feed) return;
                const key = `${quiz.type}_${quiz.idx}_${quiz.subIdx}`;
                setAttempts(p => ({ ...p, [key]: (p[key] || 0) + 1 }));

                let ok = false;
                if (quiz.type === 'VOCA') {
                    const ans = studyData.eng.words[quiz.idx].meaning;
                    ok = ans.split(',').some(m => m.trim() === quiz.input.trim() || (m.includes(quiz.input.trim()) && quiz.input.length >= 2));
                } else if (quiz.type === 'ENG_TRANS') ok = quiz.input.length > 25;
                else if (quiz.type === 'ENG_GRAM') ok = val === studyData.eng.grammar_q.a;
                else if (quiz.type === 'MATH') ok = val === studyData.math.questions[quiz.idx].a;
                else if (quiz.type === 'KOR') ok = val === studyData.kor.passages[quiz.idx].qs[quiz.subIdx].a;

                if (ok) {
                    setQuiz(p => ({ ...p, feed: 'correct' }));
                    setTimeout(() => moveStep(), 1200);
                } else {
                    setQuiz(p => ({ ...p, feed: 'wrong' }));
                    setPenaltyEnd(Date.now() + 60000); 
                    setTimeout(() => setQuiz(p => ({ ...p, feed: null, input: '' })), 2000);
                }
            };

            const moveStep = () => {
                setQuiz(p => {
                    let n = { ...p, feed: null, input: '', idx: p.idx, subIdx: p.subIdx };
                    if (p.type === 'VOCA') {
                        if (p.idx < 9) n.idx++; else { n.type = 'ENG_TRANS'; n.idx = 0; }
                    } else if (p.type === 'ENG_TRANS') n.type = 'ENG_GRAM';
                    else if (p.type === 'ENG_GRAM') { n.active = false; setEngDone(true); }
                    else if (p.type === 'MATH') {
                        if (p.idx < 2) n.idx++; else { n.active = false; setMathDone(true); }
                    } else if (p.type === 'KOR') {
                        if (p.subIdx < 1) n.subIdx++;
                        else if (p.idx < 2) { n.idx++; n.subIdx = 0; }
                        else { n.active = false; setKorDone(true); }
                    }
                    return n;
                });
            };

            return (
                <div className="app-container overflow-hidden">
                    {/* Lockdown Overlay */}
                    {timeLeft > 0 && (
                        <div className="lockdown-screen animate-pop">
                            <Icon name="Clock" size={80} />
                            <h2 className="text-4xl font-black mb-4 uppercase italic">Lockdown</h2>
                            <p className="text-lg font-bold mb-10 opacity-90 px-10 leading-tight text-center">
                                {timeLeft > 60 ? "ì§‘ì¤‘ë ¥ ê²€ë¬¸ ì‘ë‹µ ì‹¤íŒ¨ë¡œ ì¸í•œ íŠ¹ë³„ í˜ë„í‹°(5ë¶„) ì§„í–‰ ì¤‘" : "ì˜¤ë‹µì…ë‹ˆë‹¤. ì •ë‹µì€ ë¹„ê³µê°œì´ë‹ˆ ìŠ¤ìŠ¤ë¡œ ë¶„ì„í•˜ì„¸ìš”."}
                            </p>
                            <div className="text-9xl font-black font-mono tracking-tighter">{timeLeft}s</div>
                        </div>
                    )}

                    {/* Focus Check */}
                    {showFocusCheck && (
                        <div className="focus-check-overlay">
                            <div className="bg-white p-10 rounded-[3.5rem] text-center space-y-8 shadow-2xl animate-pop border-t-[10px] border-indigo-600 w-full max-w-sm relative overflow-hidden">
                                <div className="absolute top-0 left-0 h-1.5 bg-rose-500 transition-all duration-1000" style={{ width: `${(focusTimeLeft/15)*100}%` }}></div>
                                <Icon name="Fingerprint" className="mx-auto text-indigo-600" size={48} />
                                <div className="space-y-2 text-slate-800">
                                    <h3 className="text-2xl font-black">ì§‘ì¤‘ë ¥ ê²€ë¬¸!</h3>
                                    <p className="text-sm font-medium opacity-60">ê´€ë¦¬ì(ì—„ë§ˆ)ì˜ ì„±í•¨ì€? ({focusTimeLeft}s)</p>
                                </div>
                                <div className="grid grid-cols-2 gap-3">
                                    {['ì´ì§€ì˜', 'ê¹€ì§€ì˜', 'ë°•ì§€ì˜', 'ìµœì§€ì˜'].sort().map(n => (
                                        <button key={n} onClick={() => n === 'ì´ì§€ì˜' ? setShowFocusCheck(false) : alert("ì§‘ì¤‘í•˜ì„¸ìš”!")} className="p-5 bg-slate-50 rounded-[2rem] font-black text-slate-700 active:bg-indigo-600 active:text-white transition-all">{n}</button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    <header className="bg-slate-900 text-white p-6 pt-12 pb-8 rounded-b-[3.5rem] shadow-2xl sticky top-0 z-50 safe-top flex-shrink-0">
                        <div className="flex justify-between items-start">
                            <div className="text-left"><span className="text-indigo-400 text-[10px] font-black tracking-[0.4em] uppercase block">Oversight Mode</span><h1 className="text-2xl font-black tracking-tighter">ì´ì§€ì˜ì˜ ê°•ìš” êµ­ì˜ìˆ˜</h1></div>
                            <div className="bg-orange-500/20 px-3 py-1.5 rounded-full border border-orange-500/30 flex items-center gap-2"><Icon name="Flame" size={16} className="text-orange-500" /><span className="text-xs font-black">{streak}D</span></div>
                        </div>
                    </header>

                    <main className="flex-1 overflow-y-auto no-scrollbar p-6">
                        {!isStarted ? (
                            <div className="flex flex-col items-center justify-center py-20 space-y-12 animate-pop text-center">
                                <button onClick={handlePlayAndStart} className="w-32 h-32 bg-white rounded-full flex items-center justify-center shadow-2xl border-4 border-indigo-50 active:scale-90 transition-all"><Icon name="Play" size={56} className="text-indigo-600 ml-2" /></button>
                                <div className="space-y-4 px-4 text-slate-800"><h2 className="text-3xl font-black tracking-tight leading-tight">í•™ìŠµì„ ì‹œì‘í•©ë‹ˆë‹¤</h2><p className="text-sm text-slate-400 font-bold italic px-8 leading-relaxed">ë²„íŠ¼ í´ë¦­ ì‹œ ì—„ë§ˆì—ê²Œ ì‹œì‘ ë³´ê³ ê°€ ì „ì†¡ë˜ë©° ë¯¸ì…˜ì´ í•´ì œë©ë‹ˆë‹¤.</p></div>
                            </div>
                        ) : quiz.active ? (
                            <div className="animate-pop h-full flex flex-col">
                                <div className="bg-white p-8 rounded-[3.5rem] shadow-2xl border border-indigo-50 flex-1 relative overflow-hidden flex flex-col min-h-[500px]">
                                    <div className="absolute top-0 left-0 w-full h-2 bg-indigo-600/10"><div className="h-full bg-indigo-600 transition-all duration-1000" style={{ width: `${((quiz.idx+1)/10)*100}%` }}></div></div>
                                    <div className="flex justify-between items-center mb-10 pt-4"><span className="text-[10px] font-black text-slate-300 uppercase tracking-widest">{quiz.type} PHASE</span><div className="bg-slate-50 px-3 py-1 rounded-full text-[10px] font-black text-slate-400 shadow-inner">Attempts: {attempts[`${quiz.type}_${quiz.idx}_${quiz.subIdx}`] || 0}</div></div>
                                    {quiz.type === 'VOCA' ? (
                                        <div className="flex-1 flex flex-col items-center justify-center space-y-10">
                                            <h2 className="text-7xl font-black text-slate-900 tracking-tighter text-center leading-none">{studyData.eng.words[quiz.idx]?.word}</h2>
                                            <button onClick={() => { window.speechSynthesis.cancel(); const u = new SpeechSynthesisUtterance(studyData.eng.words[quiz.idx]?.word); u.lang='en-US'; window.speechSynthesis.speak(u); }} className="w-16 h-16 bg-indigo-50 text-indigo-600 rounded-full flex items-center justify-center active:bg-indigo-100 transition-all"><Icon name="Volume2" /></button>
                                            <input type="text" value={quiz.input} onChange={e => setQuiz(p => ({ ...p, input: e.target.value }))} onKeyPress={e => e.key === 'Enter' && handleAnswer()} className="w-full border-b-4 border-slate-100 p-6 text-center text-3xl outline-none focus:border-indigo-500 bg-transparent font-black" placeholder="ëœ» ì…ë ¥" autoFocus />
                                        </div>
                                    ) : quiz.type === 'ENG_TRANS' ? (
                                        <div className="flex-1 flex flex-col space-y-6">
                                            <div className="bg-indigo-50/50 p-7 rounded-[2rem] text-sm font-bold text-slate-800 leading-relaxed italic border border-indigo-100 shadow-inner">"{studyData.eng.paragraph}"</div>
                                            <h3 className="font-black text-slate-800 text-sm tracking-tight text-center leading-none">ì „ì²´ ì§€ë¬¸ ì •ë°€ í•´ì„ (25ì ì´ìƒ)</h3>
                                            <textarea value={quiz.input} onChange={e => setQuiz(p => ({ ...p, input: e.target.value }))} className="flex-1 border-2 border-slate-100 p-6 rounded-[2rem] text-sm focus:border-indigo-500 bg-slate-50 font-medium leading-relaxed resize-none shadow-inner" />
                                            <button onClick={() => handleAnswer()} className="w-full bg-indigo-600 text-white py-5 rounded-[2rem] font-black text-lg shadow-xl active:scale-95 transition-all">í•´ì„ ì œì¶œ</button>
                                        </div>
                                    ) : (
                                        <div className="flex-1 flex flex-col space-y-6 overflow-y-auto no-scrollbar pb-6">
                                            <h2 className="text-lg font-bold text-slate-900 leading-relaxed p-6 bg-slate-50 rounded-[2rem] border border-slate-100 shadow-inner text-center">
                                                {(quiz.type === 'MATH' ? studyData.math.questions : (quiz.type === 'ENG_GRAM' ? [studyData.eng.grammar_q] : studyData.kor.passages[quiz.idx].qs))[quiz.type === 'KOR' ? quiz.subIdx : quiz.idx]?.q}
                                            </h2>
                                            <div className="grid gap-3">
                                                {(quiz.type === 'MATH' ? studyData.math.questions : (quiz.type === 'ENG_GRAM' ? [studyData.eng.grammar_q] : studyData.kor.passages[quiz.idx].qs))[quiz.type === 'KOR' ? quiz.subIdx : quiz.idx]?.o.map((opt, oidx) => (
                                                    <button key={oidx} onClick={() => handleAnswer(oidx)} className={`w-full p-5 rounded-[1.8rem] text-left font-bold text-sm flex items-center group transition-all ${quiz.feed === 'correct' && oidx === (quiz.type === 'MATH' ? studyData.math.questions[quiz.idx].a : (quiz.type === 'ENG_GRAM' ? studyData.eng.grammar_q.a : studyData.kor.passages[quiz.idx].qs[quiz.subIdx].a)) ? 'bg-emerald-500 text-white shadow-xl scale-[1.03]' : 'bg-white text-slate-700 hover:bg-slate-50 border-slate-100 shadow-sm'}`} disabled={!!quiz.feed}>
                                                        <span className="w-8 h-8 flex items-center justify-center bg-slate-100 rounded-full text-[10px] font-black mr-4 text-slate-400 group-hover:bg-indigo-100 transition-colors">{(oidx+1)}</span>
                                                        <span className="flex-1 leading-tight">{opt}</span>
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                    {quiz.feed === 'correct' && <div className="absolute inset-0 z-10 bg-emerald-500 text-white flex items-center justify-center font-black text-6xl animate-pop tracking-tighter uppercase">Passed</div>}
                                    {quiz.feed === 'wrong' && <div className="absolute inset-0 z-10 bg-rose-500 text-white flex items-center justify-center font-black text-6xl animate-pop tracking-tighter uppercase">Failed</div>}
                                </div>
                            </div>
                        ) : (
                            <div className="space-y-6 animate-pop pb-10">
                                {tab === 'home' && (
                                    <>
                                        <div className="bg-white p-12 rounded-[4rem] shadow-sm border border-slate-200 text-center relative overflow-hidden shadow-xl shadow-indigo-100/20">
                                           <p className="text-[11px] font-black text-slate-400 uppercase tracking-[0.4em] mb-4">Obligatory Integrity</p>
                                           <h2 className="text-7xl font-black text-slate-900 mb-8 tracking-tighter leading-none">{Math.round(((engDone?1:0) + (korDone?1:0) + (mathDone?1:0))/3*100)}%</h2>
                                           <div className="w-full h-4 bg-slate-100 rounded-full overflow-hidden mb-6 shadow-inner"><div className="h-full bg-indigo-600 progress-bar shadow-2xl shadow-indigo-200/50" style={{ width: `${((engDone?1:0) + (korDone?1:0) + (mathDone?1:0))/3*100}%` }}></div></div>
                                           <p className="text-[12px] font-bold text-indigo-500 uppercase tracking-widest leading-none">"ì‹¤ë ¥ì€ ê°•ìš”ëœ ì‹œê°„ì—ì„œ ë‚˜ì˜¨ë‹¤."</p>
                                        </div>
                                        <section className="space-y-4">
                                            {[
                                                { t: 'KOR', l: 'êµ­ì–´: 3ì§€ë¬¸ ì›ë¬¸ ì •ë°€ ë¶„ì„', d: korDone, i: "Book" },
                                                { t: 'ENG', l: 'ì˜ì–´: í†µí•© í•™ìŠµ ì±Œë¦°ì§€', d: engDone, i: "Pen" },
                                                { t: 'MATH', l: `ìˆ˜í•™: ë³µìŠµ ${currentDayNum}ì¼ì°¨`, d: mathDone, i: "Calculator" }
                                            ].map(s => (
                                                <div key={s.t} onClick={() => setTab('planner')} className={`p-8 rounded-[3rem] shadow-sm border transition-all subject-card flex items-center justify-between ${s.d ? 'bg-emerald-50 border-emerald-100 opacity-60' : 'bg-white border-slate-100 hover:border-indigo-200 shadow-xl shadow-slate-200/40'}`}>
                                                    <div className="flex items-center gap-6">
                                                        <div className={`w-16 h-16 rounded-[1.8rem] flex items-center justify-center text-2xl ${s.d ? 'bg-emerald-500 text-white shadow-lg' : 'bg-slate-100 text-slate-500 shadow-inner'}`}><Icon name={s.i} /></div>
                                                        <div className="text-left font-black leading-none"><p className="text-lg text-slate-800 mb-2">{s.l}</p><p className="text-[10px] text-slate-400 uppercase tracking-[0.2em]">{s.d ? 'Validated' : 'Pending Action'}</p></div>
                                                    </div>
                                                    {s.d ? <Icon name="Check" className="text-emerald-500" /> : <Icon name="Chevron" className="text-slate-300" />}
                                                </div>
                                            ))}
                                        </section>
                                        <button onClick={handleFinalReport} className="w-full bg-slate-900 text-white py-7 rounded-[3rem] font-black text-xl shadow-2xl flex items-center justify-center gap-4 active:scale-95 transition-all mt-8 border-b-8 border-slate-950">ì—„ë§ˆì—ê²Œ ìµœì¢… ë³´ê³  (ì¹´í†¡)</button>
                                    </>
                                )}

                                {tab === 'planner' && (
                                    <div className="space-y-12 pb-12 text-left animate-pop">
                                        <header className="flex justify-between items-end px-2">
                                            <div><h2 className="text-3xl font-black text-slate-900 tracking-tighter italic leading-none">ê°•ìš” í”Œë˜ë„ˆ</h2><p className="text-sm text-slate-400 font-bold mt-2">ì›ë¬¸ ì •ë… ë° ì‹¤ì „ 5ì§€ì„ ë‹¤ í…ŒìŠ¤íŠ¸</p></div>
                                            <button onClick={() => fetchStudyData(true)} className="text-slate-300 p-3 hover:bg-white rounded-2xl transition-all shadow-sm"><Icon name="RotateCcw" /></button>
                                        </header>
                                        {loading ? <div className="text-center py-40 animate-pulse text-indigo-600 font-black text-lg">ë°ì´í„° ë¶„ì„ ì¤‘...</div> : (
                                            <div className="space-y-12 animate-pop">
                                                <div className="bg-white rounded-[3.5rem] shadow-xl border border-slate-100 overflow-hidden shadow-slate-200/50">
                                                    <div className="bg-amber-500 p-10 text-white flex justify-between items-center shadow-2xl">
                                                       <h3 className="font-black text-2xl tracking-tight leading-tight italic">êµ­ì–´: 3ì§€ë¬¸ ë¶„ì„</h3>
                                                       {!korDone && <button onClick={() => setQuiz({active:true, type:'KOR', idx:0, subIdx:0, score:0, input:'', feed:null})} className="bg-white text-amber-600 px-8 py-3 rounded-full text-sm font-black shadow-2xl active:scale-95 transition-all">START</button>}
                                                    </div>
                                                    <div className="p-10 space-y-10">
                                                        {studyData.kor.passages?.map((p, i) => (
                                                            <div key={i} className="space-y-5 text-left">
                                                                <div className="flex items-center gap-4 font-black text-lg text-slate-800"><span className="w-10 h-10 bg-amber-50 text-amber-600 rounded-2xl flex items-center justify-center shadow-inner">0{i+1}</span>{p.title}</div>
                                                                <div className="bg-slate-50 p-8 rounded-[3rem] text-[14px] text-slate-600 passage-content h-72 overflow-y-auto no-scrollbar border border-slate-100 shadow-inner font-medium text-justify">{p.text}</div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                                <div className="bg-rose-500 p-12 rounded-[4rem] text-white flex justify-between items-center shadow-2xl shadow-rose-900/10">
                                                   <div className="space-y-4">
                                                      <span className="text-[11px] font-black bg-white/20 px-3 py-1 rounded-full uppercase tracking-widest block w-fit font-mono">Mathematics</span>
                                                      <h3 className="text-3xl font-black tracking-tighter leading-tight italic font-black">Day {currentDayNum}<br/><span className="text-lg opacity-90 font-bold leading-tight block mt-2 underline decoration-white/30 underline-offset-8">{mathCurriculum[currentDayNum-1]}</span></h3>
                                                   </div>
                                                   {!mathDone && <button onClick={() => setQuiz({active:true, type:'MATH', idx:0, subIdx:0, score:0, input:'', feed:null})} className="bg-white text-rose-600 p-6 rounded-full shadow-[0_10px_30px_rgba(255,255,255,0.4)] active:scale-90 transition-all border-8 border-rose-400"><Icon name="Chevron" size={40} /></button>}
                                                </div>
                                                <div className="bg-indigo-600 p-12 rounded-[4rem] text-white flex justify-between items-center shadow-2xl shadow-indigo-900/10">
                                                   <div className="space-y-4">
                                                      <span className="text-[11px] font-black bg-white/20 px-3 py-1 rounded-full uppercase tracking-widest block w-fit font-mono font-black">English Mastery</span>
                                                      <h3 className="text-3xl font-black tracking-tighter leading-none italic">ì–´íœ˜ë í†µí•© ë¯¸ì…˜</h3>
                                                   </div>
                                                   {!engDone && <button onClick={() => setQuiz({active:true, type:'VOCA', idx:0, subIdx:0, score:0, input:'', feed:null})} className="bg-white text-indigo-600 p-6 rounded-full shadow-[0_10px_30px_rgba(255,255,255,0.4)] active:scale-90 transition-all border-8 border-indigo-400"><Icon name="Chevron" size={40} /></button>}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {tab === 'admin' && (
                                    <div className="space-y-10 animate-pop text-left">
                                        <header className="px-2"><h2 className="text-3xl font-black text-slate-900 tracking-tighter leading-none text-left italic">Admin Control</h2><p className="text-[11px] text-slate-400 font-black uppercase tracking-[0.2em] mt-2 leading-none text-left">Precision Oversight by Lee Jiyoung</p></header>
                                        <div className="bg-slate-900 p-12 rounded-[4rem] text-white shadow-2xl relative overflow-hidden shadow-slate-900/40 text-left">
                                            <div className="relative z-10 flex justify-between items-end">
                                                <div><p className="text-[11px] font-black text-indigo-400 uppercase tracking-[0.4em] mb-4">Total Integrity Score</p><h3 className="text-6xl font-black tracking-tighter mb-2 leading-none">{points}P</h3><p className="text-[12px] opacity-60 font-bold">ê°•ìš”ëœ ì‹œìŠ¤í…œ ëˆ„ì  ì™„ìˆ˜ ì„±ê³¼</p></div>
                                                <Icon name="Shield" size={80} className="text-indigo-500 opacity-40 mb-3" />
                                            </div>
                                        </div>
                                        <section className="bg-white p-12 rounded-[4rem] shadow-sm border border-slate-100 space-y-12 text-left">
                                            <div className="flex items-center gap-5 border-b border-slate-50 pb-10"><Icon name="Shield" className="text-indigo-600" size={32} /><h3 className="font-black text-slate-800 text-xl tracking-tight leading-none">í•™ìŠµ ì •ì±… ë° ì§„ë„ ê´€ë¦¬</h3></div>
                                            <div className="space-y-5 text-left">
                                                <label className="text-[12px] font-black text-slate-400 uppercase tracking-[0.4em] px-2">ìˆ˜í•™ ë³µìŠµ ì‹œì‘ì¼ ì„¤ì •</label>
                                                <div className="relative">
                                                    <div className="absolute left-7 top-1/2 -translate-y-1/2 text-slate-300 font-black"><Icon name="Clock" size={24} /></div>
                                                    <input type="date" value={startDate} onChange={e => setStartDate(e.target.value)} className="w-full p-7 pl-20 rounded-[3rem] bg-slate-50 border-none font-black text-slate-700 focus:ring-4 focus:ring-indigo-100 outline-none shadow-inner text-lg" />
                                                </div>
                                            </div>
                                        </section>
                                    </div>
                                )}
                            </div>
                        )}
                    </main>

                    {/* Navigation */}
                    {!quiz.active && isStarted && (
                        <nav className="flex-shrink-0 bg-white/98 backdrop-blur-2xl border-t border-slate-100 p-6 pb-14 flex justify-around shadow-[0_-30px_80px_rgba(0,0,0,0.15)] rounded-t-[5rem] safe-bottom">
                            <button onClick={() => setTab('home')} className={`flex flex-col items-center gap-2 px-10 py-4 rounded-[2.5rem] transition-all duration-500 ${tab === 'home' ? 'text-indigo-600 bg-indigo-50 font-black scale-110 shadow-lg shadow-indigo-200/50' : 'text-slate-300'}`}><Icons.Calendar size={32} /><span className="text-[11px] font-black uppercase tracking-widest leading-none">Status</span></button>
                            <button onClick={() => setTab('planner')} className={`flex flex-col items-center gap-3 px-10 py-4 rounded-[2.5rem] transition-all duration-500 ${tab === 'planner' ? 'text-indigo-600 bg-indigo-50 font-black scale-110 shadow-lg shadow-indigo-100' : 'text-slate-300'}`}><Icons.Book size={32} /><span className="text-[11px] font-black uppercase tracking-widest leading-none">Study</span></button>
                            <button onClick={() => setTab('admin')} className={`flex flex-col items-center gap-3 px-10 py-4 rounded-[2.5rem] transition-all duration-500 ${tab === 'admin' ? 'text-indigo-600 bg-indigo-50 font-black scale-110 shadow-lg shadow-indigo-100' : 'text-slate-300'}`}><Icons.Shield size={32} /><span className="text-[11px] font-black uppercase tracking-widest leading-none">Control</span></button>
                        </nav>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

