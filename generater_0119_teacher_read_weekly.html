<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê³¼ì œ í˜ì´ì§€ ìƒì„±ê¸° v4.3 (ìµœì¢…ë³¸)</title>
    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; padding: 20px; background: #f0f2f5; line-height: 1.6; }
        .box { max-width: 800px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h2 { border-left: 5px solid #2196f3; padding-left: 15px; color: #333; margin-bottom: 25px; }
        label { display: block; margin-top: 15px; font-weight: bold; color: #444; }
        input, textarea { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        textarea { height: 100px; resize: none; }
        #genBtn { width: 100%; padding: 15px; background: #2196f3; color: white; border: none; border-radius: 10px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 25px; }
        #output { width: 100%; height: 350px; margin-top: 20px; font-family: 'Consolas', monospace; background: #2d3436; color: #dfe6e9; padding: 15px; border-radius: 8px; font-size: 11px; }
        .section-title { background: #e3f2fd; padding: 10px; border-radius: 5px; margin-top: 20px; font-weight: bold; color: #1976d2; }
    </style>
</head>
<body>
<div class="box">
    <h2>ğŸš€ ê³¼ì œ í˜ì´ì§€ ìƒì„±ê¸° v4.3</h2>
    <div class="section-title">ğŸ“… ê³¼ì œ ì„¤ì •</div>
    <label>ê³¼ì œ ì œëª©</label><input type="text" id="title" value="1ì›” 3ì£¼ì°¨ ê³¼ì œ">
    <label>ğŸ“¢ í•™ìƒ ê³µì§€ì‚¬í•­</label><textarea id="noticeMsg">ì¹´í†¡ ì „ì†¡ ì™„ë£Œ ì‹œ ê²°ê³¼ê°€ ê³µê°œë©ë‹ˆë‹¤.</textarea>
    <label>ì „ì²´ ì •ë‹µ ë²ˆí˜¸ (ìˆ«ìë§Œ)</label><textarea id="answers" placeholder="ì˜ˆ: 311454..."></textarea>
    <label>âœ… í™œì„±í™”í•  ë¬¸í•­ ë²ˆí˜¸</label><input type="text" id="activeRange" placeholder="ì˜ˆ: 6-13, 30-39">
    <label>ì‹œí—˜ì§€ PDF ë§í¬</label><input type="text" id="testLink">
    <label>í•´ì„¤ì§€ PDF ë§í¬</label><input type="text" id="ansLink">
    <label>ìµœëŒ€ ë„ì „ íšŸìˆ˜ / ëŒ€ê¸° ì‹œê°„(ë¶„)</label>
    <div style="display:flex; gap:10px;"><input type="number" id="maxAttempts" value="5"> <input type="number" id="cooldown" value="5"></div>
    <button type="button" id="genBtn" onclick="generateCode()">âœ¨ ë§ì¶¤í˜• HTML ì½”ë“œ ìƒì„±í•˜ê¸°</button>
    <textarea id="output" readonly onclick="this.select(); document.execCommand('copy'); alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');" placeholder="ìƒì„±ëœ ì½”ë“œê°€ ì—¬ê¸°ì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤."></textarea>
</div>

<script>
function parseRange(str) {
    const activeNums = new Set();
    if(!str) return [];
    str.split(',').forEach(part => {
        const range = part.trim().split('-');
        if (range.length === 2) { for (let i = parseInt(range[0]); i <= parseInt(range[1]); i++) activeNums.add(i); }
        else { const num = parseInt(range[0]); if (!isNaN(num)) activeNums.add(num); }
    });
    return Array.from(activeNums).sort((a, b) => a - b);
}

function generateCode() {
    const titleVal = document.getElementById('title').value;
    const noticeVal = (document.getElementById('noticeMsg').value || "ì „ì†¡ ì™„ë£Œ ì‹œ ê²°ê³¼ ê³µê°œ").replace(/\n/g, '<br>');
    const ansArray = document.getElementById('answers').value.replace(/[^1-5]/g, '').split('').map(Number);
    const activeQuestions = parseRange(document.getElementById('activeRange').value);
    const testLink = document.getElementById('testLink').value || "#";
    const ansLink = document.getElementById('ansLink').value || "#";
    const maxAt = document.getElementById('maxAttempts').value || 5;
    const cool = document.getElementById('cooldown').value || 5;
    const kakaoKey = "de4c158b009fb05f7f51d2243447511b"; //

    if(ansArray.length === 0) return alert("ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”!");

    let c = '<!DOCTYPE html>\n<html lang="ko">\n<head>\n<meta charset="UTF-8">\n<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">\n';
    c += '<title>' + titleVal + '</title>\n<script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"><\/script>\n';
    c += '<style>\nbody{font-family:-apple-system,sans-serif;background:#f0f2f5;padding:15px;margin:0}.container{max-width:600px;margin:0 auto;background:#fff;padding:25px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,0.1)}\n';
    c += '.header{text-align:center;margin-bottom:20px;border-bottom:2px solid #f0f0f0;padding-bottom:15px}.notice-box{background:#fff3e0;border:1px solid #ffe0b2;padding:15px;border-radius:8px;margin-bottom:20px;font-size:0.95rem;line-height:1.5;color:#5d4037}\n';
    c += '.link-btn{display:block;width:100%;text-align:center;padding:12px;border-radius:8px;text-decoration:none;font-weight:bold;margin-bottom:10px;box-sizing:border-box}.btn-test{background:#607d8b;color:white}.btn-ans{background:#4caf50;color:white;margin-top:15px}\n';
    c += '.btn-kakao{display:block;width:100%;text-align:center;background:#fee500;color:#3c1e1e;border:none;padding:15px;border-radius:10px;font-weight:bold;font-size:1.1rem;cursor:pointer;margin:20px 0;display:none;text-decoration:none}\n';
    c += '.q-item{margin-bottom:15px;padding-bottom:10px;border-bottom:1px solid #eee;display:flex;align-items:center;justify-content:space-between}.skipped-item{background:#f5f5f5;opacity:0.5;pointer-events:none}.q-num{font-weight:bold;color:#2196f3;width:60px}\n';
    c += '.omr-group{display:flex;gap:8px;flex:1;justify-content:space-around}.omr-input{display:none}.omr-label{width:35px;height:35px;border-radius:50%;border:2px solid #ddd;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#999;cursor:pointer}\n';
    c += '.omr-input:checked+.omr-label{background:#2196f3;border-color:#2196f3;color:white}.btn-submit{display:block;width:100%;padding:15px;background:#ff6b6b;color:white;border:none;border-radius:10px;font-weight:bold;font-size:1.1rem;cursor:pointer;margin-top:20px}.btn-submit:disabled{background:#ccc!important}\n';
    c += '.result-box{display:none;margin-top:25px;padding:20px;border-radius:10px;text-align:center;background:#e3f2fd}input[type=text]{width:100%;padding:10px;margin-top:5px;border:1px solid #ccc;border-radius:5px;box-sizing:border-box}#overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:9999;flex-direction:column;align-items:center;justify-content:center;text-align:center}#timerMsg{text-align:center;color:#d32f2f;font-weight:bold;margin:10px 0;display:none}\n';
    c += '</style></head><body><div id="overlay"></div><div class="container"><div class="header"><h2>' + titleVal + '</h2></div>';
    c += '<a href="' + testLink + '" class="link-btn btn-test" target="_blank">ğŸ“„ ì‹œí—˜ì§€ ë³´ëŸ¬ê°€ê¸°</a><div class="notice-box">ğŸ“¢ <b>í•„ë…</b>: ' + noticeVal + '</div>';
    c += '<div style="margin-bottom:20px;background:#fafafa;padding:15px;border-radius:8px;"><label>ğŸ« í•™ì› ì´ë¦„</label><input type="text" id="academySelect" placeholder="í•™ì›ëª… ì…ë ¥"><label>ğŸ‘¤ í•™ìƒ ì´ë¦„</label><input type="text" id="studentName" placeholder="ë³¸ì¸ ì´ë¦„ ì…ë ¥"></div>';
    c += '<div id="questionContainer"></div><div id="timerMsg">â³ ëŒ€ê¸° ì‹œê°„ì´ ë‚¨ì•˜ìŠµë‹ˆë‹¤.</div><button id="submitBtn" class="btn-submit" onclick="processSubmission()">ğŸ“ ë‹µì•ˆ ì œì¶œí•˜ê¸°</button>';
    c += '<button id="kakaoBtn" class="btn-kakao" onclick="openKakao()">ğŸŸ¡ ì¹´í†¡ìœ¼ë¡œ ê²°ê³¼ ì „ì†¡</button><div id="resultArea" class="result-box"></div></div>';
    c += '<script>\n';
    c += 'try { if(!window.Kakao.isInitialized()){ window.Kakao.init("' + kakaoKey + '"); } } catch(e){}\n';
    c += 'const SCRIPT_URL="https://script.google.com/macros/s/AKfycbyE8PE7KjrTiBVljInx24PqPBoFbQ5ga4oWqhMg90UFXjFvrmB0YWhNVreRCWYyeq8/exec";';
    c += 'const correctAnswers=[' + ansArray.join(',') + '];const activeQuestions=[' + activeQuestions.join(',') + '];';
    c += 'const ANSWER_LINK="' + ansLink + '";const MAX_ATTEMPTS=' + maxAt + ';const COOLDOWN_MINUTES=' + cool + ';';
    c += 'const STORAGE_KEY="test_' + titleVal.replace(/\s/g,'') + '";let attempt=0;let lastTime=0;let finalWrongCount=0;let finalShareText="";\n';
    c += 'window.onload=function(){let h="";for(let i=1;i<=correctAnswers.length;i++){let a=activeQuestions.includes(i);h+=\'<div class="q-item \'+(a?\'\':\'skipped-item\')+\'"><span class="q-num">\'+i+\'ë²ˆ\'+(a?\'\':\' (ì œì™¸)\')+\'</span><div class="omr-group">\';';
    c += 'if(a)for(let j=1;j<=5;j++)h+=\'<input type="radio" name="q\'+i+\'" id="q\'+i+\'_\'+j+\'" value="\'+j+\'" class="omr-input"><label for="q\'+i+\'_\'+j+\'" class="omr-label">\'+j+\'</label>\';h+=\'</div></div>\';}document.getElementById("questionContainer").innerHTML=h;loadStatus();};\n';
    c += 'function loadStatus(){const s=localStorage.getItem(STORAGE_KEY);if(s){const d=JSON.parse(s);attempt=d.attempt||0;lastTime=d.lastTime||0;const diff=(Date.now()-lastTime)/1000;if(attempt>=MAX_ATTEMPTS)disableSubmit("ğŸš« ê¸°íšŒ ì†Œì§„");else if(diff<COOLDOWN_MINUTES*60)startCooldown(Math.ceil(COOLDOWN_MINUTES*60-diff));}}\n';
    c += 'function processSubmission(){const n=document.getElementById("studentName").value.trim();const a=document.getElementById("academySelect").value.trim();if(!a||!n)return alert("ì •ë³´ ì…ë ¥ í•„ìˆ˜!");for(let i of activeQuestions)if(!document.querySelector(\'input[name="q\'+i+\'"]:checked\')) return alert(i+"ë²ˆ ë§ˆí‚¹ í•„ìˆ˜!");';
    c += 'let w=0;for(let i of activeQuestions){if(parseInt(document.querySelector(\'input[name="q\'+i+\'"]:checked\').value)!==correctAnswers[i-1])w++;}finalWrongCount=w;';
    c += 'finalShareText="[' + titleVal + ']\\ní•™ì›: "+a+"\\ní•™ìƒ: "+n+"\\ní‹€ë¦° ê°œìˆ˜: "+w+"ê°œ";';
    c += 'document.getElementById("submitBtn").style.display="none";document.getElementById("kakaoBtn").style.display="block";alert("ë‹µì•ˆ ì €ì¥ë¨! ì¹´í†¡ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.");}\n';
    c += 'function openKakao(){';
    c += 'window.Kakao.Share.sendDefault({ objectType: "text", text: finalShareText, link: { mobileWebUrl: location.href, webUrl: location.href } });';
    c += 'setTimeout(function(){const o=document.getElementById("overlay");o.style.display="flex";o.innerHTML=\'<div style="background:white;padding:30px;border-radius:15px;margin:20px;width:85%;max-width:350px;"><p style="font-weight:bold;color:#d32f2f;">âš ï¸ ì „ì†¡ í™•ì¸ ì¤‘ (10ì´ˆ)</p><p style="font-size:0.85rem;color:#666;">ì¹´í†¡ì—ì„œ ì„ ìƒë‹˜ ì´ë¦„ì„ ëˆŒëŸ¬ ì „ì†¡ í›„ ëŒì•„ì˜¤ì„¸ìš”.</p><div id="waitTimer" style="font-size:1.5rem;font-weight:bold;margin:15px 0;">10</div><button id="realFinishBtn" disabled onclick="confirmFinish()" style="background:#fee500;border:none;padding:12px;width:100%;border-radius:8px;font-weight:bold;cursor:not-allowed;">ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</button></div>\';';
    c += 'let r=10;const it=setInterval(function(){r--;document.getElementById("waitTimer").innerText=r;if(r<=0){clearInterval(it);const b=document.getElementById("realFinishBtn");b.disabled=false;b.innerText="ë„¤, ì „ì†¡ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤";b.style.background="#fee500";b.style.cursor="pointer";}},1000);},1500);}\n';
    c += 'function confirmFinish(){const a=document.getElementById("academySelect").value.trim();const n=document.getElementById("studentName").value.trim();attempt++;lastTime=Date.now();localStorage.setItem(STORAGE_KEY,JSON.stringify({attempt:attempt,lastTime:lastTime}));';
    c += 'const p=new URLSearchParams({title:"' + titleVal + '",academy:a,name:n,score:activeQuestions.length-finalWrongCount,total:activeQuestions.length,wrongCount:finalWrongCount,attempt:attempt,timestamp:new Date().toLocaleString()});fetch(SCRIPT_URL+"?"+p.toString(),{mode:"no-cors"});';
    c += 'document.getElementById("overlay").style.display="none";const r=document.getElementById("resultArea");r.style.display="block";r.innerHTML="<h3>ì±„ì  ì™„ë£Œ</h3><p>ì´ <b>"+finalWrongCount+"</b>ê°œ í‹€ë ¸ìŠµë‹ˆë‹¤.</p>";';
    c += 'if(finalWrongCount===0||attempt>=MAX_ATTEMPTS){r.innerHTML+=\'<a href="\' + ANSWER_LINK + \'" class="link-btn btn-ans" target="_blank">ğŸ“˜ í•´ì„¤ì§€ ë³´ê¸°</a>\';disableSubmit(attempt>=MAX_ATTEMPTS?"ğŸš« ê¸°íšŒ ì†Œì§„":"âœ… í†µê³¼");}';
    c += 'else{r.innerHTML+="<p>ì˜¤ë‹µì´ ìˆìŠµë‹ˆë‹¤. "+COOLDOWN_MINUTES+"ë¶„ í›„ ì¬ë„ì „ ê°€ëŠ¥.</p>";startCooldown(COOLDOWN_MINUTES * 60);}document.getElementById("kakaoBtn").style.display="none";document.getElementById("submitBtn").style.display="block";}\n';
    c += 'function startCooldown(s){const b=document.getElementById("submitBtn");const m=document.getElementById("timerMsg");b.disabled=true;m.style.display="block";let r=s;const t=setInterval(function(){r--;if(r<=0){clearInterval(t);b.disabled=false;b.innerText="ğŸ“ ë‹¤ì‹œ ì œì¶œí•˜ê¸°";m.style.display="none";}else{b.innerText="â³ ëŒ€ê¸° ("+r+"ì´ˆ)";}},1000);}\n';
    c += 'function disableSubmit(t){const b=document.getElementById("submitBtn");b.disabled=true;b.innerText=t;b.style.display="block";}\n<\/script></body></html>';

    document.getElementById('output').value = c;
    alert("ì½”ë“œ ìƒì„± ì™„ë£Œ! ë²„íŠ¼ í™œì„±í™” ë¬¸ì œê°€ ì™„ë²½íˆ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.");
}
</script>
</body>
</html>