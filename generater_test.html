<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <title>1êµì‹œ ê¹€í˜„ì„ êµ­ì–´</title>
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --p: #6c5ce7; --bg: #f8f9fc; --border: #e2e8f0; }
        body { background: var(--bg); font-family: 'Pretendard', sans-serif; margin: 0; padding: 20px; color: #2d3436; -webkit-tap-highlight-color: transparent; }
        .container { max-width: 650px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.03); }
        
        /* ğŸšª ëŒ€ë¬¸(Intro) ìŠ¤íƒ€ì¼ */
        #introPage { text-align: center; padding: 20px 0; }
        .intro-notice { background: #fff9f0; border: 2px dashed #ffcc80; border-radius: 20px; padding: 25px; margin: 25px 0; text-align: left; }
        .start-btn { width: 100%; padding: 22px; background: var(--p); color: white; border: none; border-radius: 20px; font-size: 1.25em; font-weight: 800; cursor: pointer; transition: 0.3s; }

        /* ğŸ“ ì‹œí—˜ì§€(Exam) ìŠ¤íƒ€ì¼ */
        #examPage { display: none; } 
        .notice-box { background: #fff3e0; padding: 15px; border-radius: 12px; margin-bottom: 20px; font-size: 0.9rem; color: #5d4037; line-height: 1.6; border: 1px solid #ffcc80; }
        .subject-selector { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .sub-btn { padding: 15px; border: 2px solid #eee; border-radius: 12px; background: #fff; font-weight: bold; cursor: pointer; }
        .sub-btn.active { border-color: var(--p); background: #f0edff; color: var(--p); }
        .q-card { border: 1px solid var(--border); border-radius: 20px; padding: 20px; margin-bottom: 15px; background: #fff; }
        .options { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        .opt-input { position: absolute; opacity: 0; }
        .opt-label { height: 50px; display: flex; align-items: center; justify-content: center; border: 1px solid var(--border); border-radius: 12px; cursor: pointer; font-weight: 700; background: #fff; }
        .opt-input:checked + .opt-label { background: var(--p); color: white; border-color: var(--p); }
        #timer { font-weight: bold; color: #ff6b6b; text-align: right; margin-bottom: 10px; }
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 99; align-items: center; justify-content: center; }
        input, select { padding: 12px; border: 1px solid #ddd; border-radius: 10px; width: 100%; box-sizing: border-box; outline: none; }
        .main-action-btn { width: 100%; padding: 20px; border: none; border-radius: 15px; font-weight: bold; margin-top: 20px; cursor: pointer; font-size: 1.1rem; }
    </style>
</head>
<body>

<div id="overlay"></div>

<div class="container">
    <div id="introPage">
        <img src="https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpg" style="width:140px; border-radius:25px;">
        <h1 style="margin-top:20px;">1êµì‹œ ê¹€í˜„ì„ êµ­ì–´</h1>
        <div class="intro-notice">
            <h3 style="margin-top:0;">ğŸ“¢ ì´ë²ˆ ì£¼ í•„ìˆ˜ ê³µì§€</h3>
            <p id="mainNotice">ğŸ—“ï¸ 2ì›” 5ì¼(ëª©) ì €ë… 11ì‹œê¹Œì§€ ì œì¶œ ê¸°í•œ ì—°ì¥!<br>ë³¸ì¸ì˜ ì„ íƒ ê³¼ëª©(ì–¸ë§¤/í™”ì‘)ì„ í™•ì¸ í›„ ì œì¶œí•´ ì£¼ì„¸ìš”.</p>
        </div>
        <button class="start-btn" onclick="startApp()">í™•ì¸í–ˆìŠµë‹ˆë‹¤. ê³¼ì œ ì‹œì‘!</button>
    </div>

    <div id="examPage">
        <h2 style="text-align:center" id="examTitle">1ì›” 4ì£¼ì°¨ ë§ˆì¹¨ë‚´ ëª¨ì˜ê³ ì‚¬</h2>
        <div id="timer">â± <span id="timeText">--ë¶„ --ì´ˆ ë‚¨ìŒ</span></div>

        <div class="subject-selector">
            <button id="btn_unm" class="sub-btn active" onclick="setSubject('unm')">ì–¸ì–´ì™€ ë§¤ì²´</button>
            <button id="btn_hwj" class="sub-btn" onclick="setSubject('hwj')">í™”ë²•ê³¼ ì‘ë¬¸</button>
        </div>

        <div class="notice-box" id="noticeArea">
            <b>[ê³µì§€]</b> ğŸ—“ï¸ 2ì›” 5ì¼(ëª©) ì €ë… 11ì‹œê¹Œì§€ ì œì¶œ ê¸°í•œ ì—°ì¥!<br>ğŸ¯ ë„ì „ ê¸°íšŒ: ì´ 3íšŒ / â³ ëŒ€ê¸° ì‹œê°„: 3ë¶„
        </div>

        <div id="limitMsg" style="display:none;color:#d63031;font-weight:bold;text-align:center;margin-bottom:20px;padding:15px;background:#fab1a0;border-radius:12px"></div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:15px">
            <input type="text" id="cN" placeholder="í•™ì›ëª…">
            <input type="text" id="sN" placeholder="í•™ìƒ ì´ë¦„" oninput="checkLimit()">
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:15px">
            <select id="sD" onchange="checkLimit()"><option value="">ì œì¶œì¼ ì„ íƒ</option></select>
            <a id="paperLink" href="https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQBjfJMvXZ1eR4bwRIANPL0PAUWatLhOUaNFgjkhdgM5ZZk?e=mukaiA" target="_blank" style="display:flex;align-items:center;justify-content:center;background:#eee;color:#333;text-decoration:none;border-radius:10px;font-weight:bold;font-size:0.8rem">ğŸ“„ ë¬¸ì œì§€</a>
        </div>

        <div id="qC"></div>

        <button id="subBtn" class="main-action-btn" onclick="submit()" style="background:#ff6b6b;color:white;">ğŸ“ ë‹µì•ˆ ì œì¶œí•˜ê¸°</button>
        <button id="kakaoBtn" class="main-action-btn" onclick="share()" style="display:none;background:#fee500;color:#3c1e1e;">ğŸŸ¡ ì¹´í†¡ìœ¼ë¡œ ì œì¶œ í™•ì¸</button>
        
        <div id="resArea" style="display:none;margin-top:20px"></div>
    </div>
</div>

<script>
let timeLeft, timerInterval = null, w=0, att=0, isBlocked=false, resT="", isPerfect=false, wrongListStr="", currentSubject="unm";

const TASKS_CONFIG = {
    title: "1ì›” 4ì£¼ì°¨ ë§ˆì¹¨ë‚´ ëª¨ì˜ê³ ì‚¬",
    startDay: "2026-01-31",
    endDay: "2026-02-05", 
    maxT: 3,
    waitMin: 3,
    ansLink: "https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQCK9MI5n_S6QqCLlRx5z5HCAYVgehHzhRklEoECQySh4vY?e=uJg5No",
    hwPrefix: "HW_1ì›”4ì£¼ì°¨ë§ˆì¹¨ë‚´ëª¨ì˜ê³ ì‚¬_",
    gasUrl: "https://script.google.com/macros/s/AKfycbzkA0CC8GAhcdAP16fzq32ufyTIYolZ8TyeuSjW5FAsG0M3vPcYQOIaSKIOOYKYgtDc/exec"
};

const answers = {
    unm: [0, ..."554141434513334515355353353513454231253123255".split("").map(Number)],
    hwj: [0, ..."554141434513334515355353353513454212522215231".split("").map(Number)]
};

let masterAnswers = answers.unm;
const totalQ = 45;

try { if(!Kakao.isInitialized()){Kakao.init("f81d5eae0eaaf6fa2d0bdccbe6916001");} } catch(e){console.error(e);}

function startApp() {
    document.getElementById('introPage').style.display = 'none';
    document.getElementById('examPage').style.display = 'block';
    window.scrollTo(0,0);
    initPage();
}

function setSubject(sub){
    currentSubject = sub;
    masterAnswers = answers[sub];
    document.getElementById("btn_unm").className = "sub-btn" + (sub==='unm'?' active':'');
    document.getElementById("btn_hwj").className = "sub-btn" + (sub==='hwj'?' active':'');
    checkLimit();
}

function initPage(){
    const sel=document.getElementById("sD"); sel.innerHTML = '<option value="">ì œì¶œì¼ ì„ íƒ</option>';
    const end=new Date(TASKS_CONFIG.endDay);
    let loopDate = new Date(TASKS_CONFIG.startDay);
    while(loopDate <= end){ 
        let s=loopDate.toISOString().split('T')[0];
        let opt=document.createElement("option"); opt.value=s; opt.innerText=s; sel.appendChild(opt);
        loopDate.setDate(loopDate.getDate()+1);
    }
    let h=""; for(let n=1; n<=totalQ; n++){
        h+="<div class='q-card'><div style='font-weight:bold;margin-bottom:15px;'>"+n+"ë²ˆ</div><div class='options'>";
        for(let j=1;j<=5;j++){ h+="<input type='radio' name='q"+n+"' id='q"+n+"_"+j+"' value='"+j+"' class='opt-input'><label for='q"+n+"_"+j+"' class='opt-label'>"+j+"</label>"; }
        h+="</div></div>";
    } document.getElementById("qC").innerHTML=h; checkDateLimit();
}

function submit(){
    if(isBlocked) return;
    const cN=document.getElementById("cN").value, sN=document.getElementById("sN").value.trim().replace(/\s/g,""), sD=document.getElementById("sD").value;
    if(!cN||!sN||!sD){alert("í•™ì›ëª…, ì´ë¦„, ì œì¶œì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return;}
    
    w=0; let d=[];
    for(let i=1; i<=totalQ; i++){
        let s=document.querySelector("input[name='q"+i+"']:checked");
        let v=s?parseInt(s.value):0;
        // masterAnswersëŠ” [0, ...] í˜•ì‹ì´ë¯€ë¡œ ì¸ë±ìŠ¤ iê°€ ê³§ ë¬¸í•­ ë²ˆí˜¸
        if(v !== masterAnswers[i]){ w++; d.push(i); }
    }
    
    isPerfect=(w===0); wrongListStr=d.join(","); 
    const subName = currentSubject==='unm'?'ì–¸ì–´ì™€ ë§¤ì²´':'í™”ë²•ê³¼ ì‘ë¬¸';
    const hwId = TASKS_CONFIG.hwPrefix + currentSubject;
    const key="att_"+sN+"_"+hwId; 
    att=parseInt(localStorage.getItem(key)||0)+1; 
    
    localStorage.setItem(key,att); 
    if(isPerfect) localStorage.setItem("perf_"+sN+"_"+hwId,"true");

    resT="["+TASKS_CONFIG.title+" "+subName+"]\n"+sN+"("+att+"íšŒì°¨) ì œì¶œ ì™„ë£Œ";
    alert("ì¹´í†¡ ì „ì†¡ í›„ [ì™„ë£Œ] ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼ ìµœì¢… ì±„ì ë©ë‹ˆë‹¤!");
    document.getElementById("subBtn").style.display="none";
    document.getElementById("kakaoBtn").style.display="block";

    fetch(TASKS_CONFIG.gasUrl,{method:"POST",mode:"no-cors",body:JSON.stringify({exam:TASKS_CONFIG.title+" "+subName,name:sN,class:cN,attempt:att,wrongCount:w,wrongList:wrongListStr})});
}

function checkDateLimit(){ 
    const now=new Date(); 
    const eDate=new Date(TASKS_CONFIG.endDay); eDate.setHours(23,59,59,999); 
    const msg=document.getElementById("limitMsg");
    if(now > eDate){ isBlocked=true; document.getElementById("subBtn").style.display="none"; msg.style.display="block"; msg.innerText="ğŸš« ì œì¶œ ê¸°í•œì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤."; }
}

function checkLimit(){
    const sN=document.getElementById("sN").value.trim().replace(/\s/g,"");
    if(sN.length<2) return;
    const hwId = TASKS_CONFIG.hwPrefix + currentSubject;
    if(localStorage.getItem("perf_"+sN+"_"+hwId)=="true"){ showFinalResult("ë°±ì  ë‹¬ì„±!"); return; }
    att=parseInt(localStorage.getItem("att_"+sN+"_"+hwId)||0);
    if(att>=TASKS_CONFIG.maxT){ document.getElementById("subBtn").style.display="none"; document.getElementById("limitMsg").style.display="block"; document.getElementById("limitMsg").innerText="ğŸš« ëª¨ë“  ê¸°íšŒë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤."; showFinalResult("ê¸°íšŒ ì†Œì§„"); }
}

function startWaitTimer(){
    if(timerInterval) clearInterval(timerInterval);
    timeLeft = TASKS_CONFIG.waitMin * 60;
    const btn=document.getElementById("subBtn"); btn.disabled=true; btn.style.opacity="0.5";
    timerInterval = setInterval(()=>{
        if(timeLeft<=0){ clearInterval(timerInterval); btn.disabled=false; btn.style.opacity="1"; document.getElementById("timeText").innerText="ì…ë ¥ ê°€ëŠ¥"; return; }
        timeLeft--;
        const m=Math.floor(timeLeft/60), s=timeLeft%60;
        document.getElementById("timeText").innerText="ì¬ë„ì „ ëŒ€ê¸°: "+m+"ë¶„ "+(s<10?"0"+s:s)+"ì´ˆ";
    }, 1000);
}

function done(){
    document.getElementById("overlay").style.display="none";
    document.getElementById("kakaoBtn").style.display="none";
    if(isPerfect){showFinalResult("ë°±ì  ë‹¬ì„±!"); return;}
    if(att >= TASKS_CONFIG.maxT){showFinalResult("ê¸°íšŒ ì†Œì§„"); return;}
    alert("ğŸ“Š "+att+"íšŒì°¨ ê²°ê³¼: ì˜¤ë‹µ "+w+"ê°œ");
    document.querySelectorAll(".opt-input").forEach(rb=>rb.checked=false);
    document.getElementById("subBtn").style.display="block";
    startWaitTimer();
}

function showFinalResult(msg){
    const r=document.getElementById("resArea");
    r.style.display="block";
    r.innerHTML="<div style='padding:25px;background:#eeebff;border-radius:15px;text-align:center'><h3>ğŸ "+msg+"</h3><a href='"+TASKS_CONFIG.ansLink+"' target='_blank' style='display:block;padding:15px;background:var(--p);color:white;text-decoration:none;border-radius:10px;font-weight:bold'>ğŸ“˜ í•´ì„¤ì§€ ë³´ê¸°</a></div>";
    document.getElementById("subBtn").style.display="none";
}

function share(){
    Kakao.Share.sendDefault({ objectType: "text", text: resT, link: { mobileWebUrl: window.location.href, webUrl: window.location.href } });
    setTimeout(()=>{const o=document.getElementById("overlay"); o.style.display="flex"; o.innerHTML="<div style='background:white;padding:30px;border-radius:20px;text-align:center;width:80%;max-width:300px'><p>ì¹´í†¡ ì „ì†¡ì„ ì™„ë£Œí•˜ì…¨ë‚˜ìš”?</p><button onclick='done()' style='width:100%;padding:12px;background:#fee500;border:none;border-radius:10px;font-weight:bold;cursor:pointer'>ë„¤, ì™„ë£Œí–ˆìŠµë‹ˆë‹¤</button></div>";},1500);
}
</script>
</body>
</html>