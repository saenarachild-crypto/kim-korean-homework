<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>1êµì‹œ êµ­ì–´ í†µí•© ìƒì„±ê¸° v69.2 (Final Feedback)</title>
    <style>
        body { font-family: 'Pretendard', sans-serif; background: #f0f2f5; padding: 20px; color: #2d3436; }
        .gen-box { background: #fff; max-width: 950px; margin: 0 auto; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        h2 { color: #6c5ce7; border-bottom: 2px solid #6c5ce7; padding-bottom: 10px; margin-top: 0; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.85em; color: #444; }
        input, textarea, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 0.9em; }
        textarea { height: 60px; resize: none; }
        .section-title { background: #f8f9fa; padding: 10px; border-left: 5px solid #6c5ce7; font-weight: bold; margin: 20px 0 15px 0; font-size: 0.95em; }
        button { width: 100%; padding: 18px; background: #6c5ce7; color: white; border: none; border-radius: 12px; font-size: 1.1em; font-weight: bold; cursor: pointer; margin-top: 20px; transition: 0.2s; }
        #outputCode { width: 100%; height: 350px; margin-top: 25px; display: none; font-family: 'Consolas', monospace; font-size: 0.8em; background: #2d3436; color: #dfe6e9; padding: 15px; border-radius: 10px; }
    </style>
</head>
<body>

<div class="gen-box">
    <h2>ğŸš€ v69.2 í†µí•© ìƒì„±ê¸° (ì˜¤ë‹µ í”¼ë“œë°± ë¡œì§ ì •ë°€í™”)</h2>
    
    <div class="section-title">1. ê¸°ë³¸ ì •ë³´ ì„¤ì •</div>
    <div class="grid">
        <div><label>ê³¼ì œ ëŒ€ë¶„ë¥˜</label>
            <select id="category">
                <option value="ì£¼ê°„ ê³¼ì œ">ì£¼ê°„ ê³¼ì œ</option>
                <option value="ìˆ˜ì—… ìë£Œ">ìˆ˜ì—… ìë£Œ</option>
                <option value="ë§ˆì¹¨ë‚´ ëª¨ì˜ê³ ì‚¬">ë§ˆì¹¨ë‚´ ëª¨ì˜ê³ ì‚¬</option>
                <option value="ê¸°íƒ€ ì‹œí—˜">ê¸°íƒ€ ì‹œí—˜</option>
            </select>
        </div>
        <div><label>ìƒì„¸ ëª…ì¹­</label><input type="text" id="subTitle" placeholder="ì˜ˆ: ë…ì„œ 3íšŒì°¨"></div>
    </div>
    <div class="grid">
        <div><label>ì‹œì‘ ë‚ ì§œ</label><input type="date" id="startDay"></div>
        <div><label>ì¢…ë£Œ ë‚ ì§œ(ê¸°í•œ)</label><input type="date" id="endDay"></div>
    </div>

    <div class="section-title">2. ë¬¸í•­ ë° ì‘ì‹œ ì„¤ì •</div>
    <div class="grid">
        <div><label>ì´ ë¬¸í•­ ìˆ˜</label><input type="number" id="totalQ" value="45"></div>
        <div><label>ì œì™¸ ë¬¸í•­ (ë²ˆí˜¸ë§Œ ì½¤ë§ˆ êµ¬ë¶„)</label><input type="text" id="excludeQ" placeholder="ì˜ˆ: 38,39"></div>
    </div>
    <div class="grid">
        <div><label>ë„ì „ íšŸìˆ˜</label><input type="number" id="maxT" value="3"></div>
        <div><label>ì¬ì‘ì‹œ ëŒ€ê¸°(ë¶„)</label><input type="number" id="waitMin" value="1"></div>
    </div>

    <div class="section-title">3. ë¬¸ì œì§€ ë° ì •ë‹µ ì„¤ì • (íƒ€ì… Bê°€ ì—†ìœ¼ë©´ ë¹„ìš°ì„¸ìš”)</div>
    <div class="grid">
        <div><label>ğŸ“„ ë¬¸ì œì§€ ë§í¬ (íƒ€ì… A: ë…ì„œ/ì–¸ë§¤)</label><input type="text" id="pdfA"></div>
        <div><label>ğŸ“„ ë¬¸ì œì§€ ë§í¬ (íƒ€ì… B: ë¬¸í•™/í™”ì‘)</label><input type="text" id="pdfB"></div>
    </div>
    <div class="grid">
        <div><label>âœ… ì •ë‹µ (íƒ€ì… A)</label><textarea id="ansA" placeholder="ìˆ«ìë§Œ ë‚˜ì—´"></textarea></div>
        <div><label>âœ… ì •ë‹µ (íƒ€ì… B)</label><textarea id="ansB" placeholder="ìˆ«ìë§Œ ë‚˜ì—´"></textarea></div>
    </div>
    <div style="margin-bottom:15px;"><label>ğŸ“– ê³µí†µ í•´ì„¤ì§€ ë§í¬</label><input type="text" id="ansLink"></div>

    <div class="section-title">4. í•™ìƒ ê³µì§€</div>
    <textarea id="notice" placeholder="í•™ìƒë“¤ì—ê²Œ ë³´ì—¬ì¤„ ë©”ì‹œì§€"></textarea>

    <button onclick="generate()">âœ¨ ì „ì²´ ì½”ë“œ ìƒì„± (v69.2 ë¡œì§ ì ìš©)</button>
    <textarea id="outputCode" readonly></textarea>
</div>

<script>
function generate() {
    const today = new Date().toLocaleDateString();
    const cat = document.getElementById('category').value;
    const sub = document.getElementById('subTitle').value;
    const isDual = document.getElementById('ansB').value.trim().length > 0;
    const gasFixed = "https://script.google.com/macros/s/AKfycbzkA0CC8GAhcdAP16fzq32ufyTIYolZ8TyeuSjW5FAsG0M3vPcYQOIaSKIOOYKYgtDc/exec";

    const d = {
        title: cat + " " + sub, gas: gasFixed,
        start: document.getElementById('startDay').value, end: document.getElementById('endDay').value,
        total: document.getElementById('totalQ').value, exclude: document.getElementById('excludeQ').value,
        maxT: document.getElementById('maxT').value, wait: document.getElementById('waitMin').value,
        pdfA: document.getElementById('pdfA').value, pdfB: document.getElementById('pdfB').value,
        ansLink: document.getElementById('ansLink').value,
        ansA: document.getElementById('ansA').value, ansB: document.getElementById('ansB').value,
        msg: document.getElementById('notice').value.replace(/\n/g, '<br>')
    };

    const finalHTML = `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <title>1êµì‹œ ê¹€í˜„ì„ êµ­ì–´</title>
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"><\/script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --p: #6c5ce7; --bg: #f8f9fc; --border: #e2e8f0; }
        body { background: var(--bg); font-family: 'Pretendard', sans-serif; margin: 0; padding: 20px; color: #2d3436; -webkit-tap-highlight-color: transparent; }
        .container { max-width: 650px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.03); }
        #introPage { text-align: center; padding: 20px 0; }
        .intro-notice { background: #fff9f0; border: 2px dashed #ffcc80; border-radius: 20px; padding: 25px; margin: 25px 0; text-align: left; }
        .start-btn { width: 100%; padding: 22px; background: var(--p); color: white; border: none; border-radius: 20px; font-size: 1.25em; font-weight: 800; cursor: pointer; }
        #examPage { display: none; }
        .subject-selector { display: ${isDual ? 'grid' : 'none'}; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .sub-btn { padding: 15px; border: 2px solid #eee; border-radius: 12px; background: #fff; font-weight: bold; cursor: pointer; }
        .sub-btn.active { border-color: var(--p); background: #f0edff; color: var(--p); }
        .q-card { border: 1px solid var(--border); border-radius: 20px; padding: 20px; margin-bottom: 15px; background: #fff; }
        .ans-row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        input[type="radio"] { position: absolute; opacity: 0; }
        label { height: 50px; display: flex; align-items: center; justify-content: center; border: 1px solid var(--border); border-radius: 12px; cursor: pointer; font-weight: 700; background: #fff; }
        input[type="radio"]:checked + label { background: var(--p); color: white; border-color: var(--p); }
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 999; align-items: center; justify-content: center; }
        .main-btn { width: 100%; padding: 20px; border: none; border-radius: 15px; font-weight: bold; margin-top: 20px; cursor: pointer; font-size: 1.1rem; }
    </style>
</head>
<body>
<div id="overlay"></div>
<div class="container">
    <div id="introPage">
        <img src="https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpg" style="width:140px; border-radius:25px;">
        <h1>1êµì‹œ ê¹€í˜„ì„ êµ­ì–´</h1>
        <div class="intro-notice"><h3>ğŸ“¢ í•„ìˆ˜ ê³µì§€</h3><p>${d.msg}</p></div>
        <button class="start-btn" onclick="startApp()">í™•ì¸í–ˆìŠµë‹ˆë‹¤. ê³¼ì œ ì‹œì‘!</button>
    </div>
    <div id="examPage">
        <h2 style="text-align:center">${d.title}</h2>
        <div id="timer" style="text-align:right; font-weight:bold; color:#ff6b6b; margin-bottom:10px;">â± <span id="timeText">ìƒíƒœ í™•ì¸ ì¤‘</span></div>
        <div class="subject-selector">
            <button id="btn_A" class="sub-btn active" onclick="setSubject('A')">${cat === 'ë§ˆì¹¨ë‚´ ëª¨ì˜ê³ ì‚¬' ? 'ì–¸ì–´ì™€ ë§¤ì²´' : 'ë…ì„œ/íƒ€ì…A'}</button>
            <button id="btn_B" class="sub-btn" onclick="setSubject('B')">${cat === 'ë§ˆì¹¨ë‚´ ëª¨ì˜ê³ ì‚¬' ? 'í™”ë²•ê³¼ ì‘ë¬¸' : 'ë¬¸í•™/íƒ€ì…B'}</button>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:15px">
            <input type="text" id="cN" placeholder="í•™ì›ëª…">
            <input type="text" id="sN" placeholder="í•™ìƒ ì´ë¦„">
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:15px">
            <select id="sD"></select>
            <a id="paperLink" href="${d.pdfA}" target="_blank" style="display:flex;align-items:center;justify-content:center;background:#eee;color:#333;text-decoration:none;border-radius:10px;font-weight:bold;font-size:0.8rem">ğŸ“„ ë¬¸ì œì§€ ë³´ê¸°</a>
        </div>
        <div id="qC"></div>
        <button id="subBtn" class="main-btn" onclick="submit()" style="background:#ff6b6b;color:white;">ğŸ“ ë‹µì•ˆ ì œì¶œí•˜ê¸°</button>
        <button id="kakaoBtn" class="main-btn" onclick="share()" style="display:none;background:#fee500;color:#3c1e1e;">ğŸŸ¡ ì¹´í†¡ìœ¼ë¡œ ì œì¶œ í™•ì¸</button>
        <div id="resArea" style="display:none;margin-top:20px"></div>
    </div>
</div>
<script>
    const C = { title: "${d.title}", start: "${d.start}", end: "${d.end}", max: ${d.maxT}, wait: ${d.wait}, gas: "${d.gas}", ansL: "${d.ansLink}", prefix: "HW_${d.title}_" };
    const PDFS = { A: "${d.pdfA}", B: "${d.pdfB}" };
    const ANS = { A: [0, ..."${d.ansA}".split("").map(Number)], B: [0, ..."${d.ansB}".split("").map(Number)] };
    const EXCLUDE = [${d.exclude}];
    let curSub = "A", wCount=0, wList=[], att=0, isPerf=false, resT="";

    try { Kakao.init('f81d5eae0eaaf6fa2d0bdccbe6916001'); } catch(e){}

    function startApp() { document.getElementById('introPage').style.display='none'; document.getElementById('examPage').style.display='block'; window.scrollTo(0,0); init(); }
    function setSubject(s) { 
        curSub = s; document.getElementById("btn_A").className = "sub-btn"+(s==='A'?' active':'');
        document.getElementById("btn_B").className = "sub-btn"+(s==='B'?' active':'');
        document.getElementById("paperLink").href = PDFS[s];
        renderQ();
    }
    function init() {
        const sel=document.getElementById("sD"); sel.innerHTML="";
        let loop=new Date(C.start); while(loop <= new Date(C.end)) {
            let s=loop.toISOString().split('T')[0];
            let o=document.createElement("option"); o.value=s; o.innerText=s; sel.appendChild(o);
            loop.setDate(loop.getDate()+1);
        }
        renderQ(); setInterval(updateStatus, 1000);
    }
    function renderQ() {
        let h=""; for(let i=1; i<=${d.total}; i++) {
            if(EXCLUDE.includes(i)) continue;
            h+='<div class="q-card"><b>'+i+'ë²ˆ</b><div class="ans-row">';
            for(let j=1; j<=5; j++) h+='<input type="radio" name="q'+i+'" id="q'+i+'_'+j+'" value="'+j+'"><label for="q'+i+'_'+j+'">'+j+'</label>';
            h+='</div></div>';
        } document.getElementById("qC").innerHTML=h;
    }
    function submit() {
        const cN=document.getElementById("cN").value, sN=document.getElementById("sN").value.trim().replace(/\\s/g,""), sD=document.getElementById("sD").value;
        if(!cN||!sN||!sD) return alert("í•„ìˆ˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        wCount=0; wList=[];
        for(let i=1; i<=${d.total}; i++) {
            if(EXCLUDE.includes(i)) continue;
            let s=document.querySelector('input[name="q'+i+'"]:checked');
            if((s?parseInt(s.value):0) !== ANS[curSub][i]) { wCount++; wList.push(i); }
        }
        isPerf=(wCount===0); const key="att_"+sN+"_"+C.prefix+curSub; att=parseInt(localStorage.getItem(key)||0)+1;
        localStorage.setItem(key, att);
        resT="["+C.title+"] "+sN+"("+att+"íšŒ) ì œì¶œ ì™„ë£Œ";
        document.getElementById("subBtn").style.display="none"; document.getElementById("kakaoBtn").style.display="block";
        fetch(C.gas,{method:"POST",mode:"no-cors",body:JSON.stringify({exam:C.title+"_"+curSub,name:sN,class:cN,attempt:att,wrongCount:wCount,wrongList:wList.join(",")})});
    }
    function share() {
        Kakao.Share.sendDefault({ objectType:"text", text:resT, link:{ mobileWebUrl:window.location.href, webUrl:window.location.href } });
        setTimeout(()=>{
            const o=document.getElementById("overlay"); o.style.display="flex";
            o.innerHTML="<div style='background:white;padding:30px;border-radius:20px;text-align:center;width:80%;max-width:300px'><p>ì¹´í†¡ ì „ì†¡ì„ ì™„ë£Œí•˜ì…¨ë‚˜ìš”?</p><button onclick='done()' style='padding:12px;background:#fee500;border:none;border-radius:10px;font-weight:bold;width:100%;cursor:pointer'>ë„¤, ì™„ë£Œí–ˆìŠµë‹ˆë‹¤</button></div>";
        },1500);
    }
    function done() {
        document.getElementById("overlay").style.display="none"; document.getElementById("kakaoBtn").style.display="none";
        const rArea = document.getElementById("resArea"); rArea.style.display="block";
        
        let feedbackContent = "";
        if (isPerf) {
            feedbackContent = "ğŸ‰ ë§Œì ì…ë‹ˆë‹¤! ì™„ë²½í•˜ê²Œ í•´ê²°í–ˆìŠµë‹ˆë‹¤.";
        } else {
            // ğŸ“ íšŒì°¨ë³„ í”¼ë“œë°± ë¡œì§ (1íšŒì°¨: ê°œìˆ˜ë§Œ / 2íšŒì°¨: ë²ˆí˜¸ê¹Œì§€)
            if (att === 1) {
                feedbackContent = "ğŸ“Š 1íšŒì°¨ ê²°ê³¼: <b>ì˜¤ë‹µ " + wCount + "ê°œ</b><br><small>ì–´ë–¤ ë¬¸í•­ì´ í‹€ë ¸ëŠ”ì§€ ìŠ¤ìŠ¤ë¡œ ë‹¤ì‹œ í•œë²ˆ ì°¾ì•„ë³´ì„¸ìš”!</small>";
            } else {
                feedbackContent = "ğŸ“Š " + att + "íšŒì°¨ ê²°ê³¼: <b>ì˜¤ë‹µ " + wCount + "ê°œ</b><br><b>ì˜¤ë‹µ ë¬¸í•­: " + wList.join(", ") + "</b>";
            }
        }

        rArea.innerHTML = \`
            <div style="padding:25px;background:#eeebff;border-radius:15px;text-align:center">
                <h3>ì±„ì  ê²°ê³¼</h3>
                <p>\${feedbackContent}</p>
                \${(att >= 3 || isPerf) ? \`<a href="\${C.ansL}" target="_blank" style="display:block;padding:15px;background:#6c5ce7;color:white;text-decoration:none;border-radius:10px;font-weight:bold;margin-top:10px;">ğŸ“˜ í•´ì„¤ì§€ ë³´ê¸°</a>\` : ''}
            </div>
            \${(!isPerf && att < C.max) ? \`<button onclick="location.reload()" style="width:100%;padding:15px;background:#eee;border:none;border-radius:10px;margin-top:10px;cursor:pointer;">ğŸ”„ ë‹¤ì‹œ ë„ì „í•˜ê¸° (\${att}/\${C.max})</button>\` : ''}
        \`;
    }
    function updateStatus() {
        const sN=document.getElementById("sN").value.trim(); if(!sN) return;
        const now=new Date().getTime(); const end=new Date(C.end); end.setHours(23,59,59,999);
        const disk=document.getElementById("timeText");
        if(now > end.getTime()){ disk.innerText="ê¸°í•œ ë§ˆê°"; document.getElementById("subBtn").disabled=true; }
        else { disk.innerText="ì œì¶œ ê°€ëŠ¥"; document.getElementById("subBtn").disabled=false; }
    }
<\/script>
</body>
</html>`;
    document.getElementById('outputCode').value = finalHTML;
    document.getElementById('outputCode').style.display = 'block';
    alert("v69.2 í†µí•© ì½”ë“œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!");
}
</script>
</body>
</html>