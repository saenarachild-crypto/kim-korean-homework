<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <title>êµ­ì–´ ê³¼ì œ ìƒì„±ê¸° v14.1</title>
    <style>
        :root { --p: #6c5ce7; --p-light: #a29bfe; --bg: #f9f9fb; }
        body { font-family: 'Apple SD Gothic Neo', sans-serif; background: var(--bg); padding: 20px; color: #2d3436; }
        .box { max-width: 850px; margin: 0 auto; background: #fff; padding: 40px; border-radius: 25px; box-shadow: 0 20px 40px rgba(108, 92, 231, 0.1); border: 1px solid #eeebff; }
        h2 { color: var(--p); display: flex; align-items: center; gap: 12px; margin-bottom: 20px; }
        .info-badge { display: inline-block; background: #f0edff; color: var(--p); padding: 8px 15px; border-radius: 10px; font-size: 0.85rem; font-weight: bold; margin-bottom: 20px; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        label { display: block; margin-top: 10px; font-weight: bold; font-size: 0.9rem; color: #636e72; }
        input, textarea { width: 100%; padding: 14px; margin-top: 8px; border: 2px solid #edf2f7; border-radius: 12px; box-sizing: border-box; outline: none; }
        #genBtn { grid-column: span 2; padding: 20px; background: linear-gradient(135deg, var(--p), var(--p-light)); color: white; border: none; border-radius: 15px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 30px; box-shadow: 0 8px 20px rgba(108, 92, 231, 0.3); }
        #output { grid-column: span 2; width: 100%; height: 250px; margin-top: 25px; font-family: 'Consolas', monospace; background: #2d3436; color: #dfe6e9; padding: 15px; border-radius: 12px; font-size: 11px; border: none; cursor: pointer; }
    </style>
</head>
<body>
<div class="box">
    <h2>ğŸ¯ êµ­ì–´ ê³¼ì œ ìƒì„±ê¸° v14.1</h2>
    <div class="info-badge">âœ… í•™ìƒìš© í˜ì´ì§€ ìƒì„± ëª¨ë“œ (ì¹´í†¡ 4011 ì—ëŸ¬ ë°©ì§€í˜•)</div>
    
    <div class="form-grid">
        <div><label>ê³¼ì œ íšŒì°¨ (ex. 1ì›” 3ì£¼ì°¨)</label><input type="text" id="weekTitle" value="1ì›” 3ì£¼ì°¨"></div>
        <div><label>ê³¼ì œ ëŒ€ì œëª© (ex. ì£¼ê°„ì§€ ê³ 2 ë¬¸í•™)</label><input type="text" id="mainTitle" value="ì£¼ê°„ì§€ ê³ 2 ë¬¸í•™"></div>
        <div style="grid-column:span 2;"><label>ì „ì²´ ì •ë‹µ (ìˆ«ìë§Œ ì—°ì† ì…ë ¥)</label><textarea id="answers" rows="3" placeholder="ì˜ˆ: 311454..."></textarea></div>
        <div><label>í™œì„±í™” ë²”ìœ„</label><input type="text" id="activeRange" placeholder="ì˜ˆ: 1-15"></div>
        <div><label>í•´ì„¤ì§€ ë§í¬</label><input type="text" id="ansLink" placeholder="https://..."></div>
        <button id="genBtn" onclick="generateStudentCode()">ğŸ”® í•™ìƒìš© ë‹µì•ˆ ì œì¶œ í˜ì´ì§€ ì½”ë“œ ìƒì„±</button>
        <textarea id="output" readonly onclick="this.select(); document.execCommand('copy'); alert('í•™ìƒìš© í˜ì´ì§€ ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');" placeholder="ì—¬ê¸°ì— ìƒì„±ëœ ì½”ë“œê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤."></textarea>
    </div>
</div>

<script>
// [ìµœì¢… ì¸ì¦ ë°ì´í„°] ì„ ìƒë‹˜ì˜ JavaScript í‚¤ì™€ ë„ë©”ì¸
const S_URL = "https://script.google.com/macros/s/AKfycbwtzD2n-5ksERWy2iqE1dB4g36RfWfpP0DhvutxJcYTOSZP8u-xvLHUNZcFgMNkjbF1/exec";
const K_KEY = "f81d5eae0eaaf6fa2d0bdccbe6916001"; 
const DOMAIN = "https://saenarachild-crypto.github.io"; 

function parseRange(str, total) {
    const activeNums = new Set();
    if(!str) { for(let i=1; i<=total; i++) activeNums.add(i); return Array.from(activeNums); }
    str.split(',').forEach(part => {
        const range = part.trim().split('-');
        if (range.length === 2) { for (let i = parseInt(range[0]); i <= parseInt(range[1]); i++) activeNums.add(i); }
        else { const num = parseInt(range[0]); if (!isNaN(num)) activeNums.add(num); }
    });
    return Array.from(activeNums).sort((a, b) => a - b);
}

function generateStudentCode() {
    const week = document.getElementById('weekTitle').value;
    const title = document.getElementById('mainTitle').value;
    const ansArray = document.getElementById('answers').value.replace(/[^1-5]/g, '').split('').map(Number);
    const activeQs = parseRange(document.getElementById('activeRange').value, ansArray.length);
    const ansL = document.getElementById('ansLink').value || "#";

    let c = '<!DOCTYPE html>\n<html lang="ko">\n<head>\n<meta charset="UTF-8">\n<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">\n';
    c += '<title>' + week + ' ê³¼ì œ</title>\n<script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"><\/script>\n';
    c += '<style>\n:root{--p:#6c5ce7;--bg:#f0f2f5}body{font-family:-apple-system,sans-serif;background:var(--bg);padding:15px;margin:0}.container{max-width:600px;margin:0 auto;background:#fff;padding:25px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,0.1)}.notice-box{background:#fff3e0;border:1px solid #ffe0b2;padding:15px;border-radius:8px;margin-bottom:20px;font-size:0.95rem;line-height:1.5;color:#5d4037}.q-item{margin-bottom:15px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #f9f9f9;padding-bottom:10px}.omr-label{width:35px;height:35px;border-radius:50%;border:2px solid #ddd;display:flex;align-items:center;justify-content:center;cursor:pointer}.omr-input:checked+.omr-label{background:var(--p);border-color:var(--p);color:white}#overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:9999;flex-direction:column;align-items:center;justify-content:center}\n</style></head><body><div id="overlay"></div><div class="container"><h2>' + week + '</h2><div class="notice-box">ğŸ“¢ ' + title + '<br>- ì¹´í†¡ ì „ì†¡ ì™„ë£Œ ì‹œ í‹€ë¦° ê°œìˆ˜ê°€ ê³µê°œë©ë‹ˆë‹¤.<br>- ì •ë³´ë¥¼ ì •í™•íˆ ì…ë ¥í•´ì•¼ ê¸°ë¡ì´ ì¸ì •ë©ë‹ˆë‹¤.</div>';
    c += '<input type="text" id="cN" placeholder="í•™ì›/ë°˜ (ì˜ˆ: í‰ì¼A)" style="width:100%;padding:10px;margin-bottom:10px;box-sizing:border-box;"><input type="text" id="sN" placeholder="ì´ë¦„" style="width:100%;padding:10px;margin-bottom:20px;box-sizing:border-box;">';
    c += '<div id="qC"></div><button id="subBtn" onclick="submit()" style="width:100%;padding:15px;background:#ff6b6b;color:white;border:none;border-radius:10px;font-weight:bold;cursor:pointer;margin-top:20px;">ğŸ“ ë‹µì•ˆ ì œì¶œí•˜ê¸°</button><button id="kakaoBtn" onclick="share()" style="display:none;width:100%;text-align:center;background:#fee500;color:#3c1e1e;border:none;padding:15px;border-radius:10px;font-weight:bold;cursor:pointer;margin:20px 0;text-decoration:none">ğŸŸ¡ ì¹´í†¡ìœ¼ë¡œ ê²°ê³¼ ì „ì†¡</button><div id="resArea" style="display:none;text-align:center;margin-top:20px;"></div></div>';
    c += '<script>\n';
    c += 'try{if(!Kakao.isInitialized())Kakao.init("' + K_KEY + '");}catch(e){}\n';
    c += 'const correct=[' + ansArray.join(',') + '], active=[' + activeQs.join(',') + '], sUrl="' + S_URL + '", domain="' + DOMAIN + '"; let resT="", w=0;\n';
    c += 'window.onload=function(){let h="";active.forEach(n=>{\n';
    c += '  h+=\'<div class="q-item"><span>\'+n+\'ë²ˆ</span><div style="display:flex;gap:5px">\';\n';
    c += '  for(let j=1;j<=5;j++) h+=\'<input type="radio" name="q\'+n+\'" id="q\'+n+\'_\'+j+\'" value="\'+j+\'" style="display:none" class="omr-input"><label for="q\'+n+\'_\'+j+\'" class="omr-label">\'+j+\'</label>\';\n';
    c += '  h+=\'</div></div>\';});document.getElementById("qC").innerHTML=h;};\n';
    c += 'function submit(){\n';
    c += '  const cN=document.getElementById("cN").value, sN=document.getElementById("sN").value; if(!cN||!sN)return;\n';
    c += '  w=0; let d=[]; active.forEach(n=>{const sel=document.querySelector(\'input[name="q\'+n+\'"]:checked\'); if(!sel||parseInt(sel.value)!==correct[n-1]){w++; d.push(n);}});\n';
    c += '  resT="[' + week + ']\\ní•™ì›: "+cN+"\\ní•™ìƒ: "+sN+"\\ní‹€ë¦° ê°œìˆ˜: "+w+"ê°œ";\n';
    c += '  fetch(sUrl,{method:"POST",mode:"no-cors",body:JSON.stringify({exam:"' + week + '",class:cN,name:sN,wrongCount:w,wrongList:d.join(",")})});\n';
    c += '  document.getElementById("subBtn").style.display="none"; document.getElementById("kakaoBtn").style.display="block"; alert("ì €ì¥ ì™„ë£Œ! ì¹´í†¡ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.");\n}\n';
    c += 'function share(){\n';
    c += '  Kakao.Share.sendDefault({objectType:"text",text:resT,link:{mobileWebUrl:domain,webUrl:domain}});\n';
    c += '  setTimeout(function(){const o=document.getElementById("overlay");o.style.display="flex";o.innerHTML=\'<div style="background:white;padding:30px;border-radius:15px;text-align:center;"><p>ì „ì†¡ ì™„ë£Œ í›„ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p><button onclick="done()" style="width:100%;padding:10px;background:#fee500;border:none;border-radius:8px;font-weight:bold;cursor:pointer;">ë„¤, ì™„ë£Œí–ˆìŠµë‹ˆë‹¤</button></div>\';},1500);\n}\n';
    c += 'function done(){\n';
    c += '  document.getElementById("overlay").style.display="none"; const r=document.getElementById("resArea"); r.style.display="block";\n';
    c += '  r.innerHTML="<h3>ê²°ê³¼: "+w+"ê°œ í‹€ë¦¼</h3><a href=\'' + ansL + '\' target=\'_blank\' style=\'display:block;padding:12px;background:#4caf50;color:white;text-decoration:none;border-radius:8px;font-weight:bold;\'>ğŸ“˜ í•´ì„¤ì§€ ë³´ê¸°</a>"; document.getElementById("kakaoBtn").style.display="none";\n}\n';
    c += '<\/script></body></html>';

    document.getElementById('output').value = c;
}
</script>
</body>
</html>