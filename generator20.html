<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµ­ì–´ ê³¼ì œ ìƒì„±ê¸° v12.0</title>
    <style>
        :root { --p: #6c5ce7; --p-light: #a29bfe; --bg: #f9f9fb; }
        body { font-family: 'Apple SD Gothic Neo', sans-serif; background: var(--bg); padding: 20px; color: #2d3436; line-height: 1.5; }
        .box { max-width: 850px; margin: 0 auto; background: #fff; padding: 40px; border-radius: 25px; box-shadow: 0 20px 40px rgba(108, 92, 231, 0.1); border: 1px solid #eeebff; }
        h2 { color: var(--p); display: flex; align-items: center; gap: 12px; margin-bottom: 20px; }
        .info-text { background: #f0edff; padding: 15px; border-radius: 12px; font-size: 0.85rem; color: var(--p); margin-bottom: 25px; font-weight: 500; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        label { display: block; margin-top: 10px; font-weight: bold; font-size: 0.9rem; color: #636e72; }
        input, textarea { width: 100%; padding: 14px; margin-top: 8px; border: 2px solid #edf2f7; border-radius: 12px; box-sizing: border-box; outline: none; transition: 0.3s; font-family: inherit; }
        input:focus { border-color: var(--p-light); background: #fcfcff; }
        .full { grid-column: span 2; }
        #genBtn { grid-column: span 2; padding: 20px; background: linear-gradient(135deg, var(--p), var(--p-light)); color: white; border: none; border-radius: 15px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 30px; box-shadow: 0 8px 20px rgba(108, 92, 231, 0.3); transition: 0.2s; }
        #genBtn:active { transform: scale(0.98); }
        #output { grid-column: span 2; width: 100%; height: 250px; margin-top: 25px; font-family: 'Consolas', monospace; background: #2d3436; color: #dfe6e9; padding: 15px; border-radius: 12px; font-size: 11px; border: none; overflow-y: scroll; cursor: pointer; }
    </style>
</head>
<body>
<div class="box">
    <h2>ğŸ¯ êµ­ì–´ ê³¼ì œ ì‹œìŠ¤í…œ v12.0</h2>
    <div class="info-text">âœ… êµ¬ê¸€ ì‹œíŠ¸ ì›¹ ì•± ì—°ê²° ì™„ë£Œ: ë°ì´í„°ê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ê¸°ë¡ë˜ëŠ” ëª¨ë“œì…ë‹ˆë‹¤.</div>
    
    <div class="form-grid">
        <div><label>ê³¼ì œ íšŒì°¨ (ex. 1ì›” 3ì£¼ì°¨)</label><input type="text" id="weekTitle" value="1ì›” 3ì£¼ì°¨"></div>
        <div><label>ê³¼ì œ ëŒ€ì œëª© (ex. ì£¼ê°„ì§€ ê³ 2 ë¬¸í•™)</label><input type="text" id="mainTitle" value="ì£¼ê°„ì§€ ê³ 2 ë¬¸í•™"></div>
        <div class="full"><label>ì „ì²´ ì •ë‹µ (ìˆ«ìë§Œ ì—°ì† ì…ë ¥)</label><textarea id="answers" rows="3" placeholder="ì˜ˆ: 311454..."></textarea></div>
        <div><label>í™œì„±í™” ë¬¸í•­ ë²”ìœ„</label><input type="text" id="activeRange" placeholder="ì˜ˆ: 1-15 (ë¹„ì›Œë‘ë©´ ì „ì²´)"></div>
        <div><label>í•´ì„¤ì§€ PDF ë§í¬</label><input type="text" id="ansLink" placeholder="https://..."></div>
        <button id="genBtn" onclick="generateCode()">ğŸ”® í”„ë¦¬ë¯¸ì—„ ê³¼ì œ í˜ì´ì§€ ì½”ë“œ ìƒì„±</button>
        <textarea id="output" readonly onclick="this.select(); document.execCommand('copy'); alert('ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ê¹ƒí—ˆë¸Œì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.');" placeholder="ì—¬ê¸°ì— ìƒì„±ëœ ì½”ë“œê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤."></textarea>
    </div>
</div>

<script>
const S_URL = "https://script.google.com/macros/s/AKfycbwtzD2n-5ksERWy2iqE1dB4g36RfWfpP0DhvutxJcYTOSZP8u-xvLHUNZcFgMNkjbF1/exec";
const K_KEY = "f81d5eae0eaaf6fa2d0bdccbe6916001";

function parseRange(str, total) {
    const activeNums = new Set();
    if(!str) { for(let i=1; i<=total; i++) activeNums.add(i); return Array.from(activeNums); }
    str.split(',').forEach(part => {
        const range = part.trim().split('-');
        if (range.length === 2) { for (let i = parseInt(range[0]); i <= parseInt(range[1]); i++) activeNums.add(i); }
        else { const num = parseInt(range[0]); if (!isNaN(num)) activeNums.add(num); }
    });
    return Array.from(activeNums).sort((a, b) => a - b);
}

function generateCode() {
    const week = document.getElementById('weekTitle').value;
    const title = document.getElementById('mainTitle').value;
    const ansArray = document.getElementById('answers').value.replace(/[^1-5]/g, '').split('').map(Number);
    const activeQs = parseRange(document.getElementById('activeRange').value, ansArray.length);
    const ansL = document.getElementById('ansLink').value || "#";

    let c = '<!DOCTYPE html>\n<html lang="ko">\n<head>\n<meta charset="UTF-8">\n<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">\n';
    c += '<title>' + week + ' ê³¼ì œ</title>\n<script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"><\/script>\n';
    c += '<style>\n';
    c += ':root{--p:#6c5ce7;--bg:#f8f9fc}body{font-family:-apple-system,sans-serif;background:var(--bg);margin:0;padding:15px}.container{max-width:500px;margin:0 auto;background:#fff;padding:30px;border-radius:30px;box-shadow:0 15px 35px rgba(0,0,0,0.05)}.header{text-align:center;margin-bottom:25px}.badge{display:inline-block;padding:5px 12px;background:#eeebff;color:var(--p);border-radius:10px;font-size:0.8rem;font-weight:bold;margin-bottom:10px}.q-card{background:#fff;border:1px solid #eee;border-radius:20px;padding:20px;margin-bottom:15px}.q-num{font-weight:bold;margin-bottom:12px;font-size:1.1rem}.options{display:flex;justify-content:space-between;gap:8px}.opt-input{display:none}.opt-label{flex:1;height:45px;border:1.5px solid #eee;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:bold;cursor:pointer;transition:0.2s}.opt-input:checked+.opt-label{background:var(--p);border-color:var(--p);color:#fff;box-shadow:0 5px 12px rgba(108, 92, 231, 0.3)}.btn{width:100%;padding:18px;border-radius:15px;border:none;font-weight:bold;font-size:1.1rem;cursor:pointer;margin-top:15px}#subBtn{background:var(--p);color:#fff}#kakaoBtn{background:#fee500;color:#3c1e1e;display:none}.input-group{margin-bottom:15px}.input-group input{width:100%;padding:12px;border:1.5px solid #eee;border-radius:10px;box-sizing:border-box}#overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:99;align-items:center;justify-content:center}';
    c += '</style></head><body><div id="overlay"></div><div class="container"><div class="header"><span class="badge">' + week + '</span><h2>' + title + '</h2></div>';
    c += '<div class="input-group"><input type="text" id="className" placeholder="í•™ì›/ë°˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"></div>';
    c += '<div class="input-group"><input type="text" id="studentName" placeholder="í•™ìƒ ì„±í•¨ì„ ì…ë ¥í•˜ì„¸ìš”"></div>';
    c += '<div id="qContainer"></div><button id="subBtn" class="btn" onclick="submit()">ğŸ“ ë‹µì•ˆ ì œì¶œ ë° ê¸°ë¡</button><button id="kakaoBtn" class="btn" onclick="share()">ğŸŸ¡ ì¹´í†¡ìœ¼ë¡œ ì„±ì  ë³´ê³ </button><div id="resArea" style="display:none;margin-top:25px;text-align:center"></div></div>';
    
    c += '<script>\n';
    c += 'try{if(!Kakao.isInitialized())Kakao.init("' + K_KEY + '");}catch(e){}\n';
    c += 'const correct=[' + ansArray.join(',') + '], active=[' + activeQs.join(',') + '], sUrl="' + S_URL + '", ansL="' + ansL + '"; let resT="", w=0;';
    
    c += 'window.addEventListener("load", function(){\n';
    c += '  let h=""; active.forEach(n=>{\n';
    c += '    h+=\'<div class="q-card"><div class="q-num">\'+n+\'ë²ˆ</div><div class="options">\';\n';
    c += '    for(let j=1;j<=5;j++) h+=\'<input type="radio" name="q\'+n+\'" id="q\'+n+\'_\'+j+\'" value="\'+j+\'" class="opt-input"><label for="q\'+n+\'_\'+j+\'" class="opt-label">\'+j+\'</label>\';\n';
    c += '    h+=\'</div></div>\';\n';
    c += '  }); document.getElementById("qContainer").innerHTML=h;\n';
    c += '});\n';

    c += 'function submit(){\n';
    c += '  const cN=document.getElementById("className").value, sN=document.getElementById("studentName").value;\n';
    c += '  if(!cN||!sN){alert("ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");return;}\n';
    c += '  const storageKey = "att_" + "' + week + '" + "_" + sN; let att = parseInt(localStorage.getItem(storageKey)||0)+1; localStorage.setItem(storageKey, att);\n';
    c += '  w=0; let d=[]; active.forEach(i=>{const sel=document.querySelector(\'input[name="q\'+i+\'"]:checked\'); const v=sel?parseInt(sel.value):0; if(v!==correct[i-1]){w++; d.push(i);}});\n';
    c += '  resT = "â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n[ ' + week + ' ì„±ì  ë³´ê³  ]\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”\\nâ— ê³¼ì œëª…: ' + title + '\\nâ— ì†Œì†: "+cN+"\\nâ— ì„±í•¨: "+sN+"\\nâ— ë„ì „: "+att+"íšŒì°¨\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”\\nğŸ“Š ê²°ê³¼: ì˜¤ë‹µ "+w+"ê°œ\\nğŸ“ ì˜¤ë‹µë²ˆí˜¸: "+(d.join(", ")||"ì—†ìŒ")+"\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”";\n';
    c += '  fetch(sUrl, {method:"POST", mode:"no-cors", body:JSON.stringify({exam:"' + week + '", class:cN, name:sN, attempt:att, wrongCount:w, wrongList:d.join(",")}) });\n';
    c += '  alert("ì„±ì ì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì¹´í†¡ ì „ì†¡ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.");\n';
    c += '  document.getElementById("subBtn").style.display="none"; document.getElementById("kakaoBtn").style.display="block";\n';
    c += '}\n';

    c += 'function share(){\n';
    c += '  Kakao.Share.sendDefault({objectType:"text", text:resT, link:{mobileWebUrl:location.href, webUrl:location.href}});\n';
    c += '  setTimeout(function(){ document.getElementById("overlay").style.display="flex"; document.getElementById("overlay").innerHTML=\'<div style="background:#fff;padding:30px;border-radius:20px;text-align:center;width:80%"><p style="font-weight:bold">ì „ì†¡ì„ ì™„ë£Œí•˜ì…¨ë‚˜ìš”?</p><button onclick="done()" style="width:100%;padding:15px;background:#fee500;border:none;border-radius:12px;font-weight:bold">ë„¤, ì™„ë£Œí–ˆìŠµë‹ˆë‹¤</button></div>\'; }, 2000);\n';
    c += '}\n';

    c += 'function done(){\n';
    c += '  document.getElementById("overlay").style.display="none"; document.getElementById("kakaoBtn").style.display="none";\n';
    c += '  const r=document.getElementById("resArea"); r.style.display="block";\n';
    c += '  r.innerHTML="<div style=\'padding:25px;background:#eeebff;border-radius:20px\'><h3 style=\'color:var(--p)\'>ğŸŠ ìµœì¢… ì œì¶œ ì™„ë£Œ</h3><div style=\'font-size:1.8rem;font-weight:bold;margin:10px 0\'>ì˜¤ë‹µ "+w+"ê°œ</div><a href=\'"+ansL+"\' target=\'_blank\' style=\'display:inline-block;padding:15px 30px;background:var(--p);color:#fff;text-decoration:none;border-radius:12px;font-weight:bold\'>ğŸ“˜ í•´ì„¤ì§€ ë³´ê¸°</a></div>";\n';
    c += '}\n';
    c += '<\/script></body></html>';

    document.getElementById('output').value = c;
}
</script>
</body>
</html>