<<<<<<< HEAD
<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Íµ≠Ïñ¥ Î¨∏Ï†úÏßÄ ÏÉùÏÑ±Í∏∞</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;500;700&family=Noto+Sans+KR:wght@400;500;700;900&display=swap');

    :root {
      --bg: #f7f4ef;
      --paper: #fdfbf7;
      --ink: #1c1a17;
      --ink2: #4a4640;
      --rule: #ddd8ce;
      --ac: #2c5f8a;
      --ac2: #e8f0f8;
      --ok: #1e6b3a;
      --ok2: #e6f4ec;
      --ng: #8b1f2f;
      --ng2: #fdeaec;
      --rv: #e8f4ec
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0
    }

    html {
      scroll-behavior: smooth
    }

    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: var(--bg);
      color: var(--ink);
      min-height: 100vh
    }

    .hd {
      height: 54px;
      background: var(--ac);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 28px;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 8px rgba(0, 0, 0, .15)
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #fff;
      font-weight: 800;
      font-size: 15px;
      letter-spacing: -.02em
    }

    .logo-dot {
      width: 8px;
      height: 8px;
      background: #7dd3fc;
      border-radius: 50%
    }

    .hd-r {
      display: flex;
      align-items: center;
      gap: 10px
    }

    #pill {
      display: none;
      background: rgba(255, 255, 255, .18);
      border: 1px solid rgba(255, 255, 255, .4);
      border-radius: 20px;
      padding: 4px 14px;
      font-size: 13px;
      font-weight: 700;
      color: #fff
    }

    #newbtn {
      display: none;
      background: rgba(255, 255, 255, .15);
      border: 1px solid rgba(255, 255, 255, .4);
      color: #fff;
      padding: 5px 13px;
      border-radius: 6px;
      font-size: 12px;
      font-family: inherit;
      cursor: pointer;
      transition: .2s
    }

    #newbtn:hover {
      background: rgba(255, 255, 255, .28)
    }

    #pg-setup,
    #pg-proc,
    #pg-quiz {
      display: none
    }

    #pg-setup.on {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: calc(100vh - 54px);
      padding: 48px 20px 72px
    }

    #pg-proc.on {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: calc(100vh - 54px);
      gap: 20px
    }

    #pg-quiz.on {
      display: block;
      max-width: 860px;
      margin: 0 auto;
      padding: 36px 22px 100px
    }

    .setup-wrap {
      width: 100%;
      max-width: 480px
    }

    .setup-title {
      font-size: 30px;
      font-weight: 900;
      letter-spacing: -.04em;
      line-height: 1.25;
      color: var(--ink);
      margin-bottom: 8px
    }

    .setup-title span {
      color: var(--ac)
    }

    .setup-sub {
      font-size: 14px;
      color: var(--ink2);
      line-height: 1.7;
      margin-bottom: 32px
    }

    .card {
      background: var(--paper);
      border: 1px solid var(--rule);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 12px rgba(0, 0, 0, .06)
    }

    .sec {
      padding: 20px 22px;
      border-bottom: 1px solid var(--rule)
    }

    .sec:last-of-type {
      border-bottom: none
    }

    .lbl {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: .1em;
      color: var(--ink2);
      text-transform: uppercase;
      margin-bottom: 9px;
      display: flex;
      align-items: center;
      gap: 5px
    }

    .ki-wrap {
      position: relative
    }

    .ki {
      width: 100%;
      background: #fff;
      border: 1.5px solid var(--rule);
      border-radius: 8px;
      padding: 10px 13px;
      font-family: inherit;
      font-size: 13px;
      color: var(--ink);
      letter-spacing: .04em;
      transition: .2s
    }

    .ki:focus {
      outline: none;
      border-color: var(--ac)
    }

    .ki::placeholder {
      color: #bbb;
      letter-spacing: 0
    }

    .ki-hint {
      font-size: 11px;
      color: var(--ink2);
      margin-top: 7px;
      line-height: 1.5
    }

    .ki-hint a {
      color: var(--ac);
      text-decoration: none
    }

    .drop {
      border: 2px dashed var(--rule);
      border-radius: 10px;
      padding: 30px 20px;
      text-align: center;
      cursor: pointer;
      transition: .25s;
      position: relative;
      overflow: hidden;
      background: #f9f7f3
    }

    .drop:hover,
    .drop.over {
      border-color: var(--ac);
      background: var(--ac2);
      transform: translateY(-1px)
    }

    .drop input[type=file] {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
      font-size: 0
    }

    .drop-ico {
      font-size: 32px;
      margin-bottom: 8px;
      display: block
    }

    .drop h3 {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 4px
    }

    .drop p {
      font-size: 12px;
      color: var(--ink2)
    }

    #chosen {
      font-size: 12px;
      color: var(--ok);
      margin-top: 7px;
      font-weight: 700
    }

    .go {
      width: 100%;
      padding: 14px;
      background: var(--ac);
      border: none;
      color: #fff;
      font-family: inherit;
      font-size: 15px;
      font-weight: 800;
      cursor: pointer;
      transition: .2s
    }

    .go:hover {
      opacity: .9
    }

    .go:disabled {
      opacity: .3;
      cursor: not-allowed
    }

    .tags {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 18px;
      flex-wrap: wrap
    }

    .tag {
      background: var(--paper);
      border: 1px solid var(--rule);
      border-radius: 20px;
      padding: 4px 13px;
      font-size: 11px;
      color: var(--ink2)
    }

    .pc {
      background: var(--paper);
      border: 1px solid var(--rule);
      border-radius: 14px;
      padding: 40px 48px;
      text-align: center;
      width: 440px;
      max-width: 90vw;
      box-shadow: 0 2px 16px rgba(0, 0, 0, .06)
    }

    .spin {
      width: 48px;
      height: 48px;
      border: 3px solid var(--rule);
      border-top-color: var(--ac);
      border-radius: 50%;
      animation: spin .85s linear infinite;
      margin: 0 auto 20px
    }

    @keyframes spin {
      to {
        transform: rotate(360deg)
      }
    }

    .pt {
      font-size: 16px;
      font-weight: 800;
      margin-bottom: 4px
    }

    .pf2 {
      font-size: 12px;
      color: var(--ink2);
      margin-bottom: 20px;
      word-break: break-all
    }

    .steps {
      display: flex;
      flex-direction: column;
      gap: 8px;
      text-align: left
    }

    .step {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
      color: var(--ink2);
      padding: 8px 11px;
      border-radius: 7px;
      transition: .3s
    }

    .step.on {
      color: var(--ac);
      background: var(--ac2);
      font-weight: 600
    }

    .step.dn {
      color: var(--ok)
    }

    .sic {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--rule);
      color: var(--ink2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: 700;
      flex-shrink: 0;
      transition: .3s
    }

    .step.on .sic {
      background: var(--ac);
      color: #fff
    }

    .step.dn .sic {
      background: var(--ok);
      color: #fff
    }

    /* Ïû¨ÏãúÎèÑ ÏïåÎ¶º */
    .retry-notice {
      margin-top: 12px;
      padding: 10px 14px;
      background: #fff8e6;
      border: 1px solid #f0c040;
      border-radius: 8px;
      font-size: 12px;
      color: #7a5f00;
      line-height: 1.5;
      display: none
    }

    .retry-notice.on {
      display: block;
      animation: fd .3s ease
    }

    .ebox {
      background: var(--ng2);
      border: 1px solid rgba(139, 31, 47, .25);
      border-radius: 10px;
      padding: 18px 22px;
      font-size: 13px;
      color: var(--ng);
      max-width: 440px;
      width: 90vw;
      text-align: left;
      line-height: 1.65;
      white-space: pre-wrap
    }

    .ebox strong {
      display: block;
      margin-bottom: 6px;
      font-size: 14px
    }

    .bkbtn {
      margin-top: 12px;
      background: var(--ng);
      color: #fff;
      border: none;
      padding: 7px 18px;
      border-radius: 6px;
      font-family: inherit;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer
    }

    .pbox {
      background: var(--paper);
      border: 1px solid var(--rule);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 32px;
      box-shadow: 0 1px 6px rgba(0, 0, 0, .05)
    }

    .phd {
      background: var(--ac);
      padding: 12px 26px;
      display: flex;
      align-items: center;
      justify-content: space-between
    }

    .pbadge {
      color: #fff;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: .1em
    }

    .pmeta {
      font-size: 12px;
      color: rgba(255, 255, 255, .75)
    }

    .pbody {
      padding: 28px 32px;
      font-family: 'Noto Serif KR', serif;
      font-size: 15.5px;
      line-height: 2.1;
      color: var(--ink);
      white-space: pre-wrap;
      word-break: keep-all
    }

    .qhd {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: .12em;
      color: var(--ink2);
      text-transform: uppercase;
      margin-bottom: 14px
    }

    .qc {
      background: var(--paper);
      border: 1px solid var(--rule);
      border-radius: 10px;
      margin-bottom: 16px;
      overflow: hidden;
      transition: box-shadow .25s, border-color .25s;
      box-shadow: 0 1px 4px rgba(0, 0, 0, .04)
    }

    .qc:hover {
      box-shadow: 0 4px 16px rgba(0, 0, 0, .08)
    }

    .qc.ok {
      border-color: #7ecb99
    }

    .qc.ng {
      border-color: #e8909a
    }

    .qt {
      padding: 16px 22px 0;
      display: flex;
      gap: 12px;
      align-items: flex-start
    }

    .qn {
      flex-shrink: 0;
      width: 28px;
      height: 28px;
      border-radius: 7px;
      background: var(--rule);
      color: var(--ink2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 13px;
      transition: .25s;
      margin-top: 2px
    }

    .qc.ok .qn {
      background: var(--ok);
      color: #fff
    }

    .qc.ng .qn {
      background: var(--ng);
      color: #fff
    }

    .qcode {
      font-size: 10px;
      color: var(--ink2);
      letter-spacing: .04em;
      margin-bottom: 4px
    }

    .qstem {
      font-family: 'Noto Serif KR', serif;
      font-size: 15px;
      line-height: 1.8;
      font-weight: 500;
      word-break: keep-all
    }

    .bogi {
      margin: 12px 22px 0;
      background: #f5f2ec;
      border: 1px solid var(--rule);
      border-radius: 8px;
      padding: 14px 16px;
      font-family: 'Noto Serif KR', serif;
      font-size: 14px;
      line-height: 1.85;
      word-break: keep-all
    }

    .bogitl {
      font-size: 10px;
      font-weight: 700;
      letter-spacing: .1em;
      color: var(--ink2);
      margin-bottom: 8px;
      font-family: 'Noto Sans KR', sans-serif
    }

    .chs {
      padding: 12px 22px 18px;
      display: flex;
      flex-direction: column;
      gap: 7px
    }

    .ch {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 14px;
      border: 1.5px solid var(--rule);
      border-radius: 8px;
      background: #fff;
      cursor: pointer;
      font-family: 'Noto Serif KR', serif;
      font-size: 14px;
      line-height: 1.7;
      color: var(--ink);
      text-align: left;
      width: 100%;
      transition: all .14s ease;
      word-break: keep-all
    }

    .ch:hover:not(:disabled) {
      border-color: var(--ac);
      background: var(--ac2);
      transform: translateX(3px)
    }

    .ch:disabled {
      cursor: default
    }

    .cc {
      flex-shrink: 0;
      width: 21px;
      height: 21px;
      border-radius: 50%;
      border: 1.5px solid var(--rule);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 700;
      font-family: 'Noto Sans KR', sans-serif;
      margin-top: 2px;
      transition: .14s;
      color: var(--ink2)
    }

    .ch:hover:not(:disabled) .cc {
      border-color: var(--ac);
      color: var(--ac)
    }

    .ch.isok {
      border-color: #7ecb99;
      background: var(--ok2);
      animation: pop .3s ease
    }

    .ch.isok .cc {
      background: var(--ok);
      border-color: var(--ok);
      color: #fff
    }

    .ch.isng {
      border-color: #e8909a;
      background: var(--ng2);
      animation: shk .35s ease
    }

    .ch.isng .cc {
      background: var(--ng);
      border-color: var(--ng);
      color: #fff
    }

    .ch.rv {
      border-color: #7ecb99;
      background: var(--rv);
      opacity: .8
    }

    .ch.rv .cc {
      background: var(--ok);
      border-color: var(--ok);
      color: #fff
    }

    .ch:disabled:not(.isok):not(.isng):not(.rv) {
      opacity: .45
    }

    @keyframes pop {
      0% {
        transform: scale(.98)
      }

      50% {
        transform: scale(1.015)
      }

      100% {
        transform: scale(1)
      }
    }

    @keyframes shk {

      0%,
      100% {
        transform: translateX(0)
      }

      25% {
        transform: translateX(-5px)
      }

      75% {
        transform: translateX(5px)
      }
    }

    .exp {
      margin: 0 22px 16px;
      padding: 11px 14px;
      border-radius: 7px;
      font-size: 13px;
      line-height: 1.65;
      display: none;
      word-break: keep-all
    }

    .exp.ok {
      background: var(--ok2);
      color: var(--ok);
      border-left: 3px solid var(--ok)
    }

    .exp.ng {
      background: var(--ng2);
      color: var(--ng);
      border-left: 3px solid var(--ng)
    }

    .exp.on {
      display: block;
      animation: fd .3s ease
    }

    @keyframes fd {
      from {
        opacity: 0;
        transform: translateY(4px)
      }

      to {
        opacity: 1;
        transform: none
      }
    }

    .fin {
      background: var(--paper);
      border: 1px solid var(--rule);
      border-radius: 14px;
      padding: 40px;
      text-align: center;
      margin-top: 32px;
      display: none;
      box-shadow: 0 2px 12px rgba(0, 0, 0, .06)
    }

    .fin.on {
      display: block;
      animation: fd .5s ease
    }

    .fbig {
      font-size: 68px;
      font-weight: 900;
      letter-spacing: -.04em;
      line-height: 1;
      color: var(--ac);
      margin-bottom: 10px
    }

    .fmsg {
      font-size: 16px;
      font-weight: 800;
      margin-bottom: 5px
    }

    .fsub {
      font-size: 13px;
      color: var(--ink2)
    }

    .pr {
      height: 5px;
      background: var(--rule);
      border-radius: 3px;
      margin-top: 22px;
      overflow: hidden
    }

    .pfill {
      height: 100%;
      background: var(--ac);
      border-radius: 3px;
      width: 0;
      transition: width 1s ease
    }

    .fnew {
      display: inline-block;
      margin-top: 22px;
      background: var(--ac);
      color: #fff;
      padding: 10px 26px;
      border-radius: 8px;
      font-family: inherit;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      border: none;
      transition: .2s
    }

    .fnew:hover {
      opacity: .88;
      transform: translateY(-1px)
    }
  </style>
</head>

<body>
  <header class="hd">
    <div class="logo">
      <div class="logo-dot"></div>Íµ≠Ïñ¥ ÎîîÏßÄÌÑ∏ Î¨∏Ï†úÏßÄ ÏÉùÏÑ±Í∏∞
    </div>
    <div class="hd-r">
      <div id="pill">0 / 0</div>
      <button id="newbtn" onclick="goSetup()">ÏÉà PDF Ïò¨Î¶¨Í∏∞</button>
    </div>
  </header>

  <!-- SETUP -->
  <div id="pg-setup" class="on">
    <div class="setup-wrap">
      <div class="setup-title">PDF Ìïú Ïû•ÏúºÎ°ú<br><span>Î¨∏Ï†úÏßÄ ÏôÑÏÑ±</span></div>
      <div class="setup-sub">Î°úÏª¨ AI Î™®Îç∏(Ollama)Ïù¥ ÏßÄÎ¨∏Í≥º Î¨∏Ìï≠ÏùÑ ÏûêÎèô Î∂ÑÏÑùÌï©ÎãàÎã§.<br>ÌÖçÏä§Ìä∏ PDFÎ•º ÏßÄÏõêÌï©ÎãàÎã§.</div>
      <div class="card">
        <div class="sec" id="ollama-status-sec">
          <div class="lbl">üöÄ Î°úÏª¨ AI Î™®Îç∏ ÏÑ§Ï†ï</div>
          <div class="ki-wrap" style="margin-bottom: 10px;">
            <input class="ki" id="modelName" type="text" placeholder="Î™®Îç∏ Ïù¥Î¶Ñ (Ïòà: gemma3:4b, llama3)" value="gemma3:4b">
          </div>
          <div class="ki-hint">
            Ïª¥Ìì®ÌÑ∞Ïóê <a href="https://ollama.com/" target="_blank">Ollama</a>Í∞Ä ÏÑ§ÏπòÎêòÏñ¥ Ïã§Ìñâ Ï§ëÏù¥Ïñ¥Ïïº Ìï©ÎãàÎã§.<br>
            <span id="conn-status" style="color:var(--ink2); font-weight:bold; margin-top: 5px; display:inline-block;">ÔøΩ
              Ollama Ïó∞Í≤∞ ÌôïÏù∏ Ï§ë...</span>
          </div>
        </div>
        <div class="sec">
          <div class="lbl">üìë ÏãúÌóòÏßÄ PDF</div>
          <div class="drop" id="dz">
            <input type="file" id="fi" accept=".pdf" onchange="pickFile(this.files[0])">
            <span class="drop-ico">üìë</span>
            <h3>PDFÎ•º ÎÅåÏñ¥Îã§ ÎÜìÍ±∞ÎÇò ÌÅ¥Î¶≠</h3>
            <p>ÌÖçÏä§Ìä∏ PDF Î∞è Ïù¥ÎØ∏ÏßÄ PDF ÏßÄÏõê (Î°úÏª¨ AI Î≥¥Ìò∏)</p>
            <div id="chosen"></div>
          </div>
        </div>
        <button class="go" id="gobtn" onclick="start()" disabled>‚ú® Î¨∏Ï†úÏßÄ ÏÉùÏÑ± ÏãúÏûë</button>
      </div>
      <div class="tags">
        <span class="tag">‚úÖ ÌÖçÏä§Ìä∏/Ïù¥ÎØ∏ÏßÄ PDF ÏßÄÏõê</span>
        <span class="tag">‚úÖ Ïä§Ï∫îÎ≥∏ ÏûêÎèô Ïù∏Ïãù(OCR)</span>
        <span class="tag">‚úÖ Îç∞Ïù¥ÌÑ∞ Î≥¥Ìò∏ 100%</span>
      </div>
    </div>
  </div>

  <!-- PROCESSING -->
  <div id="pg-proc">
    <div class="pc">
      <div class="spin" id="spin"></div>
      <div class="pt" id="pt">Î∂ÑÏÑù Ï§ë...</div>
      <div class="pf2" id="pf2"></div>
      <div class="steps">
        <div class="step on" id="s1">
          <div class="sic">1</div><span>PDF ÌÖçÏä§Ìä∏ Ï∂îÏ∂ú Ï§ë (Ïä§Ï∫îÎ≥∏ÏùÄ OCR Ïù∏Ïãù)</span>
        </div>
        <div class="step" id="s2">
          <div class="sic">2</div><span>Î°úÏª¨ AI Î∂ÑÏÑù (Ïò§Îûò Í±∏Î¶¥ Ïàò ÏûàÏäµÎãàÎã§)</span>
        </div>
        <div class="step" id="s3">
          <div class="sic">3</div><span>Ï†ïÎãµ¬∑Ìï¥ÏÑ§ Ï†ïÎ¶¨</span>
        </div>
        <div class="step" id="s4">
          <div class="sic">4</div><span>Î¨∏Ï†úÏßÄ Î†åÎçîÎßÅ</span>
        </div>
      </div>
      <div class="retry-notice" id="retryNotice"></div>
    </div>
    <div id="eb" style="display:none"></div>
  </div>

  <!-- QUIZ -->
  <div id="pg-quiz"></div>

  <script>
    var pdfFile = null, quizData = null, answered = {}, score = 0, PDFJS = null, TesseractJS = null;
    var ollamaConnected = false;

    // ‚îÄ‚îÄ Ollama Ïó∞Í≤∞ ÌôïÏù∏ ‚îÄ‚îÄ
    async function checkOllama() {
      try {
        var res = await fetch('http://localhost:11434/api/tags');
        if (res.ok) {
          document.getElementById('conn-status').innerHTML = '‚úÖ Ollama Ïó∞Í≤∞ ÏÑ±Í≥µ';
          document.getElementById('conn-status').style.color = 'var(--ok)';
          ollamaConnected = true;
          chk();
        } else {
          throw new Error();
        }
      } catch (e) {
        document.getElementById('conn-status').innerHTML = '‚ùå Ollama Ïó∞Í≤∞ Ïã§Ìå®. OllamaÎ•º Ïã§ÌñâÌï¥ Ï£ºÏÑ∏Ïöî.';
        document.getElementById('conn-status').style.color = 'var(--ng)';
        ollamaConnected = false;
        chk();
      }
    }

    // ÏµúÏ¥à 1Ìöå Ï≤¥ÌÅ¨
    checkOllama();

    // ‚îÄ‚îÄ ÌååÏùº ‚îÄ‚îÄ
    function pickFile(f) { if (!f || f.type !== 'application/pdf') return; pdfFile = f; document.getElementById('chosen').textContent = '‚úì ' + f.name; chk() }
    function chk() {
      var isModelInputReady = document.getElementById('modelName').value.trim() !== '';
      document.getElementById('gobtn').disabled = !(pdfFile && isModelInputReady); // allow start even if connection check failed cross origin
    }
    var dz = document.getElementById('dz');
    dz.addEventListener('dragover', function (e) { e.preventDefault(); dz.classList.add('over') });
    dz.addEventListener('dragleave', function () { dz.classList.remove('over') });
    dz.addEventListener('drop', function (e) { e.preventDefault(); dz.classList.remove('over'); var f = e.dataTransfer.files[0]; if (f && f.type === 'application/pdf') { document.getElementById('fi').files = e.dataTransfer.files; pickFile(f) } });

    document.getElementById('modelName').addEventListener('input', chk);

    // ‚îÄ‚îÄ ÌôîÎ©¥ ‚îÄ‚îÄ
    function showPage(id) { ['pg-setup', 'pg-proc', 'pg-quiz'].forEach(function (p) { document.getElementById(p).classList.toggle('on', p === id) }) }
    function sOn(n) { var e = document.getElementById('s' + n); if (e) e.classList.add('on') }
    function sDn(n) { var e = document.getElementById('s' + n); if (!e) return; e.classList.remove('on'); e.classList.add('dn'); e.querySelector('.sic').textContent = '‚úì' }
    function sLbl(n, t) { var e = document.getElementById('s' + n); if (e) e.querySelector('span').textContent = t }
    function showErr(msg) { document.getElementById('spin').style.display = 'none'; document.getElementById('pt').textContent = 'Ïò§Î•ò Î∞úÏÉù'; var b = document.getElementById('eb'); b.innerHTML = '<div class="ebox"><strong>‚ö†Ô∏è Ïò§Î•ò</strong>' + esc(msg) + '<br><button class="bkbtn" onclick="goSetup()">‚Üê ÎèåÏïÑÍ∞ÄÍ∏∞</button></div>'; b.style.display = 'block' }
    function showRetry(msg) { var n = document.getElementById('retryNotice'); n.textContent = msg; n.classList.add('on') }
    function hideRetry() { document.getElementById('retryNotice').classList.remove('on') }

    // ‚îÄ‚îÄ PDF.js ‚îÄ‚îÄ
    function loadPdfJs() {
      return new Promise(function (res, rej) {
        if (window.pdfjsLib) { PDFJS = window.pdfjsLib; return res() }
        var urls = ['https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js', 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.4.120/build/pdf.min.js'];
        var i = 0;
        function next() {
          if (i >= urls.length) return rej(new Error('PDF.jsÎ•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.\nÏù∏ÌÑ∞ÎÑ∑ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏Ìï¥ Ï£ºÏÑ∏Ïöî.'));
          var s = document.createElement('script'); s.src = urls[i++];
          s.onload = function () { PDFJS = window.pdfjsLib; try { PDFJS.GlobalWorkerOptions.workerSrc = '' } catch (e) { } res() };
          s.onerror = function () { s.remove(); next() };
          document.head.appendChild(s);
        }
        next();
      });
    }

    // ‚îÄ‚îÄ Tesseract.js ‚îÄ‚îÄ
    function loadTesseract() {
      return new Promise(function (res, rej) {
        if (window.Tesseract) { TesseractJS = window.Tesseract; return res() }
        var s = document.createElement('script');
        s.src = 'https://cdn.jsdelivr.net/npm/tesseract.js@5.0.4/dist/tesseract.min.js';
        s.onload = function () { TesseractJS = window.Tesseract; res() };
        s.onerror = function () { s.remove(); rej(new Error('Tesseract.jsÎ•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.')) };
        document.head.appendChild(s);
      });
    }

    async function tryExtractText(pdf) {
      var lines = [];
      var totalTextLength = 0;
      for (var p = 1; p <= pdf.numPages; p++) {
        var page = await pdf.getPage(p); var ct = await page.getTextContent();
        var lastY = null, row = [];
        for (var j = 0; j < ct.items.length; j++) {
          var it = ct.items[j]; var y = it.transform[5];
          if (lastY !== null && Math.abs(y - lastY) > 2) {
            var lineStr = row.join('');
            lines.push(lineStr);
            totalTextLength += lineStr.length;
            row = [];
          }
          row.push(it.str); lastY = y;
        }
        if (row.length) {
          var lineStr = row.join('');
          lines.push(lineStr);
          totalTextLength += lineStr.length;
        }
        lines.push('');
      }

      // ÌÖçÏä§Ìä∏Í∞Ä Í±∞Ïùò ÏóÜÏúºÎ©¥ Ïù¥ÎØ∏ÏßÄ PDFÎ°ú Í∞ÑÏ£ºÌïòÍ≥† OCR Ïã§Ìñâ
      if (totalTextLength < 80) {
        sLbl(1, 'Ïä§Ï∫î Ïù¥ÎØ∏ÏßÄ Í∞êÏßÄÎê®. OCR ÏóîÏßÑ Î°úÎìú Ï§ë...');
        await loadTesseract();

        var worker = await TesseractJS.createWorker('kor');
        lines = [];

        for (var p = 1; p <= pdf.numPages; p++) {
          sLbl(1, `Ïù¥ÎØ∏ÏßÄ ÌÖçÏä§Ìä∏ Ï∂îÏ∂ú Ï§ë... ÌéòÏù¥ÏßÄ (${p} / ${pdf.numPages})`);

          var page = await pdf.getPage(p);
          var viewport = page.getViewport({ scale: 2.0 }); // Í≥†Ìï¥ÏÉÅÎèÑÎ°ú Î†åÎçîÎßÅ
          var canvas = document.createElement('canvas');
          var ctx = canvas.getContext('2d');
          canvas.height = viewport.height;
          canvas.width = viewport.width;

          await page.render({ canvasContext: ctx, viewport: viewport }).promise;

          var result = await worker.recognize(canvas);
          lines.push(result.data.text);
          lines.push('');
        }

        await worker.terminate();
      }

      return lines.join('\n').replace(/\n{3,}/g, '\n\n').trim();
    }

    // ‚îÄ‚îÄ Ollama API ÌÜµÏã† ‚îÄ‚îÄ
    var JSON_SCHEMA = 'ÏùëÎãµ ÌòïÏãù (ÏàúÏàò JSON, ÏΩîÎìúÎ∏îÎ°ù ÏóÜÏù¥):\n'
      + '{"title":"ÏßÄÎ¨∏ Ï£ºÏ†úÏñ¥","subject":"Í≥ºÌïôÍ∏∞Ïà†|Ïù∏Î¨∏|ÏÇ¨Ìöå|Î¨∏Ìïô Ï§ë ÌïòÎÇò","range":"[01~05] ÌòïÌÉú",'
      + '"passage":"ÏßÄÎ¨∏ Î≥∏Î¨∏Îßå (Îã®ÎùΩÍµ¨Î∂Ñ \\n\\n, Î¨∏Ìï≠¬∑ÏÑ†ÌÉùÏßÄ¬∑Í∞ÅÏ£º Ï†úÏô∏)",'
      + '"questions":[{"id":1,"code":"[26002-0172]","stem":"Î∞úÎ¨∏ Ï†ÑÏ≤¥","has_bogi":false,"bogi":"",'
      + '"choices":["ÏÑ†ÌÉùÏßÄ1","ÏÑ†ÌÉùÏßÄ2","ÏÑ†ÌÉùÏßÄ3","ÏÑ†ÌÉùÏßÄ4","ÏÑ†ÌÉùÏßÄ5"],"correct":3,"explanation":"Ï†ïÎãµ Ïù¥Ïú† 2~3Î¨∏Ïû•"}]}\n\n'
      + 'Í∑úÏπô: choices Î∞òÎìúÏãú 5Í∞ú(Î≤àÌò∏Í∏∞Ìò∏ Ï†úÏô∏). correctÎäî 1~5 Ï†ïÏàò. "Ï†ÅÏ†àÌïòÏßÄ ÏïäÏùÄ Í≤É" Ïú†Ìòï=Ïã§Ï†ú ÌãÄÎ¶∞ ÏÑ†ÌÉùÏßÄ Î≤àÌò∏. ÏΩîÎìúÎ∏îÎ°ù ÏóÜÏù¥ JSONÎßå Î∞òÌôòÌï¥.';

    async function callOllama(promptText) {
      var model = document.getElementById('modelName').value.trim();

      var resp;
      try {
        resp = await fetch('http://localhost:11434/api/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            model: model,
            prompt: promptText,
            stream: false,
            options: {
              temperature: 0.1
            },
            format: "json"
          })
        });
      } catch (e) {
        throw new Error('Ollama ÏÑúÎ≤Ñ(localhost:11434)Ïóê Ïó∞Í≤∞Ìï† Ïàò ÏóÜÏäµÎãàÎã§. Î∞±Í∑∏ÎùºÏö¥ÎìúÏóêÏÑú OllamaÍ∞Ä Ïã§Ìñâ Ï§ëÏù∏ÏßÄ ÌôïÏù∏Ìï¥ Ï£ºÏÑ∏Ïöî. CORS Î¨∏Ï†úÏùº ÏàòÎèÑ ÏûàÏäµÎãàÎã§.\n(' + e.message + ')');
      }

      if (!resp.ok) {
        var j = {}; try { j = await resp.json() } catch (e) { }
        throw new Error('Ollama Ïò§Î•ò (' + resp.status + '): ' + (j.error || resp.statusText));
      }

      var d = await resp.json();
      var raw = ''; try { raw = d.response.trim() } catch (e) { }
      var clean = raw.replace(/^```json\s*/i, '').replace(/^```\s*/i, '').replace(/```\s*$/i, '').trim();
      try { return JSON.parse(clean) }
      catch (e) {
        var m = clean.match(/\{[\s\S]*\}/);
        if (m) { try { return JSON.parse(m[0]) } catch (e2) { } }
        throw new Error('AI ÏùëÎãµ ÌååÏã± Ïã§Ìå®.\n\nÏõêÎ≥∏ ÏùëÎãµ (Ï≤òÏùå 300Ïûê):\n' + raw.slice(0, 300));
      }
    }

    // ‚îÄ‚îÄ Î©îÏù∏ ÌùêÎ¶Ñ ‚îÄ‚îÄ
    async function start() {
      var modelName = document.getElementById('modelName').value.trim();
      if (!pdfFile || !modelName) return;
      showPage('pg-proc');
      document.getElementById('pf2').textContent = pdfFile.name;
      answered = {}; score = 0;

      try {
        sLbl(1, 'PDF.js Î°úÎìú Ï§ë‚Ä¶');
        await loadPdfJs();
        sLbl(1, 'PDF ÌååÏã± Ï§ë‚Ä¶');
        var buf = await pdfFile.arrayBuffer();
        var pdf = await PDFJS.getDocument({ data: buf }).promise;
        sLbl(1, 'PDF Î°úÎìú ÏôÑÎ£å (' + pdf.numPages + 'ÌéòÏù¥ÏßÄ)');
        sDn(1);

        sOn(2);
        var txt = await tryExtractText(pdf);
        var ptext = '';

        if (txt.length < 80) {
          throw new Error('ÌÖçÏä§Ìä∏Î•º Ï∂îÏ∂úÌï† Ïàò ÏóÜÏäµÎãàÎã§. Î¨∏ÏÑúÍ∞Ä ÎπÑÏñ¥ÏûàÍ±∞ÎÇò ÏßÄÏõêÎêòÏßÄ ÏïäÎäî ÌòïÏãùÏûÖÎãàÎã§.');
        } else {
          ptext = 'Îã§ÏùåÏùÄ ÌïúÍµ≠ Íµ≠Ïñ¥ ÏãúÌóòÏßÄ ÌÖçÏä§Ìä∏ÏûÖÎãàÎã§. ÏßÄÎ¨∏Í≥º Î¨∏Ìï≠ÏùÑ Î∂ÑÏÑùÌï¥ÏÑú ÏïÑÎûò ÏöîÏ≤≠Îêú JSON ÌòïÏãùÏúºÎ°ú ÏôÑÎ≤ΩÌïòÍ≤å Ï†ïÎ¶¨Ìï¥ÏÑú ÏùëÎãµÌïòÏÑ∏Ïöî. Îã§Î•∏ ÏÑ§Î™ÖÏùÄ ÌïòÏßÄ ÎßêÍ≥† JSONÎßå Ï∂úÎ†•ÌïòÏÑ∏Ïöî.\n\nÌÖçÏä§Ìä∏:\n---\n' + txt.slice(0, 25000) + '\n---\n\n' + JSON_SCHEMA;
          sLbl(2, 'Î°úÏª¨ Î™®Îç∏(' + modelName + ') ÏÉùÏÑ± Ï§ë‚Ä¶ ÏÑ±Îä•Ïóê Îî∞Îùº Ïàò Î∂ÑÏù¥ Í±∏Î¶¥ Ïàò ÏûàÏäµÎãàÎã§.');
        }

        quizData = await callOllama(ptext);

        if (!quizData || !quizData.questions || !quizData.questions.length)
          throw new Error('Î¨∏Ìï≠ÏùÑ Ï∞æÏßÄ Î™ªÌñàÏäµÎãàÎã§.\nÍµ≠Ïñ¥ ÏãúÌóòÏßÄ PDFÏù∏ÏßÄ ÌôïÏù∏Ìï¥ Ï£ºÏÑ∏Ïöî. ÌòπÏùÄ Î™®Îç∏Ïùò Ï∂úÎ†•Ïù¥ Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏïòÏùÑ Ïàò ÏûàÏäµÎãàÎã§.');
        sLbl(2, 'Î∂ÑÏÑù ÏôÑÎ£å ¬∑ Î¨∏Ìï≠ ' + quizData.questions.length + 'Í∞ú');
        sDn(2);

        sOn(3); await sleep(300); sDn(3);
        sOn(4); renderQuiz(quizData); await sleep(200); sDn(4); await sleep(200);

        showPage('pg-quiz');
        document.getElementById('pill').style.display = 'flex';
        document.getElementById('newbtn').style.display = 'inline-block';
        updPill();

      } catch (err) { console.error(err); showErr(err.message || String(err)) }
    }

    // ‚îÄ‚îÄ Î†åÎçîÎßÅ ‚îÄ‚îÄ
    function renderQuiz(d) {
      var qs = d.questions || []; var nums = ['‚ë†', '‚ë°', '‚ë¢', '‚ë£', '‚ë§'];
      var h = '<div class="pbox"><div class="phd"><span class="pbadge">ÏßÄ Î¨∏</span><span class="pmeta">' + esc(d.range || '') + ' ' + esc(d.title || '') + ' ¬∑ ' + esc(d.subject || '') + '</span></div><div class="pbody">' + esc(d.passage || '') + '</div></div><div class="qhd">‚Äî Î¨∏ Ìï≠ ‚Äî</div>';
      for (var i = 0; i < qs.length; i++) {
        var q = qs[i]; var chs = '';
        for (var j = 0; j < (q.choices || []).length; j++) {
          chs += '<button class="ch" id="c-' + q.id + '-' + (j + 1) + '" onclick="ans(' + q.id + ',' + (j + 1) + ',' + q.correct + ')">'
            + '<span class="cc">' + nums[j] + '</span><span>' + esc(q.choices[j]) + '</span></button>';
        }
        var bogi = q.has_bogi && q.bogi ? '<div class="bogi"><div class="bogitl">‚óÄ Î≥¥ Í∏∞ ‚ñ∂</div>' + esc(q.bogi) + '</div>' : '';
        h += '<div class="qc" id="qc-' + q.id + '"><div class="qt"><div class="qn" id="qn-' + q.id + '">' + q.id + '</div>'
          + '<div>' + (q.code ? '<div class="qcode">' + esc(q.code) + '</div>' : '') + '<div class="qstem">' + esc(q.stem) + '</div></div></div>'
          + bogi + '<div class="chs" id="chs-' + q.id + '">' + chs + '</div><div class="exp" id="ex-' + q.id + '"></div></div>';
      }
      h += '<div class="fin" id="fin"><div class="fbig" id="fb"></div><div class="fmsg" id="fm"></div><div class="fsub" id="fs"></div><div class="pr"><div class="pfill" id="pf"></div></div><button class="fnew" onclick="goSetup()">üìÑ ÏÉà PDF Ïò¨Î¶¨Í∏∞</button></div>';
      document.getElementById('pg-quiz').innerHTML = h;
    }

    // ‚îÄ‚îÄ Ï±ÑÏ†ê ‚îÄ‚îÄ
    function ans(qid, chosen, correct) {
      if (answered[qid] !== undefined) return;
      answered[qid] = chosen; var ok = chosen === correct; if (ok) score++;
      document.querySelectorAll('#chs-' + qid + ' .ch').forEach(function (b, i) {
        b.disabled = true; var n = i + 1;
        if (n === chosen) b.classList.add(ok ? 'isok' : 'isng');
        if (!ok && n === correct) b.classList.add('rv');
      });
      document.getElementById('qc-' + qid).classList.add(ok ? 'ok' : 'ng');
      var q = quizData.questions.filter(function (x) { return x.id === qid })[0];
      var ex = document.getElementById('ex-' + qid);
      ex.textContent = (ok ? '‚úì Ï†ïÎãµ!  ' : '‚úó Ïò§Îãµ.  ') + (q && q.explanation || '');
      ex.className = 'exp ' + (ok ? 'ok' : 'ng') + ' on';
      updPill();
      if (Object.keys(answered).length === quizData.questions.length) setTimeout(showFin, 700);
    }
    function updPill() { document.getElementById('pill').textContent = score + ' / ' + Object.keys(answered).length }
    function showFin() {
      var total = quizData.questions.length, pct = score / total;
      var msgs = [['Îã§Ïãú ÎèÑÏ†ÑÌï¥Ïöî! üí™', 'ÌãÄÎ¶∞ Î¨∏Ìï≠ÏùÑ Íº≠ Î≥µÏäµÌï¥ Î≥¥ÏÑ∏Ïöî.'], ['Ï°∞Í∏à Îçî ÌûòÎÇ¥Ïöî! üìö', 'ÏßÄÎ¨∏ÏùÑ Îã§Ïãú ÍººÍººÌûà ÏùΩÏñ¥Î≥¥ÏÑ∏Ïöî.'], ['Î∞ò Ïù¥ÏÉÅ ÎßûÏïòÏñ¥Ïöî! üå±', 'Íæ∏Ï§ÄÌûà Ïó∞ÏäµÌïòÎ©¥ Í∏àÎ∞© Ïò¨ÎùºÏöî.'], ['ÏûòÌñàÏñ¥Ïöî! ‚≠ê', 'ÌãÄÎ¶∞ Î∂ÄÎ∂ÑÎßå ÏßëÏ§ëÌïòÎ©¥ ÏôÑÎ≤ΩÌï¥Ïöî.'], ['ÌõåÎ•≠Ìï¥Ïöî! üéØ', 'Í±∞Ïùò Îã§ ÎßûÏ∑ÑÎÑ§Ïöî!'], ['ÎßåÏ†ê! üèÜ', 'ÏôÑÎ≤ΩÌïú Ïù¥Ìï¥ÏûÖÎãàÎã§. ÏàòÎä• ÌååÏù¥ÌåÖ!']];
      var idx = Math.min(Math.round(pct * (msgs.length - 1)), msgs.length - 1);
      document.getElementById('fb').textContent = score + ' / ' + total;
      document.getElementById('fm').textContent = msgs[idx][0];
      document.getElementById('fs').textContent = msgs[idx][1];
      document.getElementById('fin').classList.add('on');
      setTimeout(function () { document.getElementById('pf').style.width = (pct * 100) + '%' }, 300);
      document.getElementById('fin').scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    // ‚îÄ‚îÄ Ï¥àÍ∏∞Ìôî ‚îÄ‚îÄ
    function goSetup() {
      showPage('pg-setup');
      document.getElementById('pill').style.display = 'none';
      document.getElementById('newbtn').style.display = 'none';
      document.getElementById('spin').style.display = 'block';
      document.getElementById('eb').style.display = 'none';
      document.getElementById('retryNotice').classList.remove('on');
      document.getElementById('pt').textContent = 'Î∂ÑÏÑù Ï§ë...';
      document.getElementById('pf2').textContent = '';
      var lbls = ['PDF ÌÖçÏä§Ìä∏ Ï∂îÏ∂ú Ï§ë', 'Î°úÏª¨ AI Î∂ÑÏÑù (Ïò§Îûò Í±∏Î¶¥ Ïàò ÏûàÏäµÎãàÎã§)', 'Ï†ïÎãµ¬∑Ìï¥ÏÑ§ Ï†ïÎ¶¨', 'Î¨∏Ï†úÏßÄ Î†åÎçîÎßÅ'];
      for (var i = 1; i <= 4; i++) { var el = document.getElementById('s' + i); el.className = 'step' + (i === 1 ? ' on' : ''); el.querySelector('.sic').textContent = i; el.querySelector('span').textContent = lbls[i - 1] }
      quizData = null; answered = {}; score = 0; pdfFile = null;
      document.getElementById('fi').value = ''; document.getElementById('chosen').textContent = '';
      chk();
      checkOllama();
    }
    function esc(s) { return String(s || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/\n/g, '<br>') }
    function sleep(ms) { return new Promise(function (r) { setTimeout(r, ms) }) }
  </script>
</body>

=======
<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Íµ≠Ïñ¥ Î¨∏Ï†úÏßÄ ÏÉùÏÑ±Í∏∞</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;500;700&family=Noto+Sans+KR:wght@400;500;700;900&display=swap');

    :root {
      --bg: #f7f4ef;
      --paper: #fdfbf7;
      --ink: #1c1a17;
      --ink2: #4a4640;
      --rule: #ddd8ce;
      --ac: #2c5f8a;
      --ac2: #e8f0f8;
      --ok: #1e6b3a;
      --ok2: #e6f4ec;
      --ng: #8b1f2f;
      --ng2: #fdeaec;
      --rv: #e8f4ec
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0
    }

    html {
      scroll-behavior: smooth
    }

    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: var(--bg);
      color: var(--ink);
      min-height: 100vh
    }

    .hd {
      height: 54px;
      background: var(--ac);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 28px;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 8px rgba(0, 0, 0, .15)
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #fff;
      font-weight: 800;
      font-size: 15px;
      letter-spacing: -.02em
    }

    .logo-dot {
      width: 8px;
      height: 8px;
      background: #7dd3fc;
      border-radius: 50%
    }

    .hd-r {
      display: flex;
      align-items: center;
      gap: 10px
    }

    #pill {
      display: none;
      background: rgba(255, 255, 255, .18);
      border: 1px solid rgba(255, 255, 255, .4);
      border-radius: 20px;
      padding: 4px 14px;
      font-size: 13px;
      font-weight: 700;
      color: #fff
    }

    #newbtn {
      display: none;
      background: rgba(255, 255, 255, .15);
      border: 1px solid rgba(255, 255, 255, .4);
      color: #fff;
      padding: 5px 13px;
      border-radius: 6px;
      font-size: 12px;
      font-family: inherit;
      cursor: pointer;
      transition: .2s
    }

    #newbtn:hover {
      background: rgba(255, 255, 255, .28)
    }

    #pg-setup,
    #pg-proc,
    #pg-quiz {
      display: none
    }

    #pg-setup.on {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: calc(100vh - 54px);
      padding: 48px 20px 72px
    }

    #pg-proc.on {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: calc(100vh - 54px);
      gap: 20px
    }

    #pg-quiz.on {
      display: block;
      max-width: 860px;
      margin: 0 auto;
      padding: 36px 22px 100px
    }

    .setup-wrap {
      width: 100%;
      max-width: 480px
    }

    .setup-title {
      font-size: 30px;
      font-weight: 900;
      letter-spacing: -.04em;
      line-height: 1.25;
      color: var(--ink);
      margin-bottom: 8px
    }

    .setup-title span {
      color: var(--ac)
    }

    .setup-sub {
      font-size: 14px;
      color: var(--ink2);
      line-height: 1.7;
      margin-bottom: 32px
    }

    .card {
      background: var(--paper);
      border: 1px solid var(--rule);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 12px rgba(0, 0, 0, .06)
    }

    .sec {
      padding: 20px 22px;
      border-bottom: 1px solid var(--rule)
    }

    .sec:last-of-type {
      border-bottom: none
    }

    .lbl {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: .1em;
      color: var(--ink2);
      text-transform: uppercase;
      margin-bottom: 9px;
      display: flex;
      align-items: center;
      gap: 5px
    }

    .ki-wrap {
      position: relative
    }

    .ki {
      width: 100%;
      background: #fff;
      border: 1.5px solid var(--rule);
      border-radius: 8px;
      padding: 10px 13px;
      font-family: inherit;
      font-size: 13px;
      color: var(--ink);
      letter-spacing: .04em;
      transition: .2s
    }

    .ki:focus {
      outline: none;
      border-color: var(--ac)
    }

    .ki::placeholder {
      color: #bbb;
      letter-spacing: 0
    }

    .ki-hint {
      font-size: 11px;
      color: var(--ink2);
      margin-top: 7px;
      line-height: 1.5
    }

    .ki-hint a {
      color: var(--ac);
      text-decoration: none
    }

    .drop {
      border: 2px dashed var(--rule);
      border-radius: 10px;
      padding: 30px 20px;
      text-align: center;
      cursor: pointer;
      transition: .25s;
      position: relative;
      overflow: hidden;
      background: #f9f7f3
    }

    .drop:hover,
    .drop.over {
      border-color: var(--ac);
      background: var(--ac2);
      transform: translateY(-1px)
    }

    .drop input[type=file] {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
      font-size: 0
    }

    .drop-ico {
      font-size: 32px;
      margin-bottom: 8px;
      display: block
    }

    .drop h3 {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 4px
    }

    .drop p {
      font-size: 12px;
      color: var(--ink2)
    }

    #chosen {
      font-size: 12px;
      color: var(--ok);
      margin-top: 7px;
      font-weight: 700
    }

    .go {
      width: 100%;
      padding: 14px;
      background: var(--ac);
      border: none;
      color: #fff;
      font-family: inherit;
      font-size: 15px;
      font-weight: 800;
      cursor: pointer;
      transition: .2s
    }

    .go:hover {
      opacity: .9
    }

    .go:disabled {
      opacity: .3;
      cursor: not-allowed
    }

    .tags {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 18px;
      flex-wrap: wrap
    }

    .tag {
      background: var(--paper);
      border: 1px solid var(--rule);
      border-radius: 20px;
      padding: 4px 13px;
      font-size: 11px;
      color: var(--ink2)
    }

    .pc {
      background: var(--paper);
      border: 1px solid var(--rule);
      border-radius: 14px;
      padding: 40px 48px;
      text-align: center;
      width: 440px;
      max-width: 90vw;
      box-shadow: 0 2px 16px rgba(0, 0, 0, .06)
    }

    .spin {
      width: 48px;
      height: 48px;
      border: 3px solid var(--rule);
      border-top-color: var(--ac);
      border-radius: 50%;
      animation: spin .85s linear infinite;
      margin: 0 auto 20px
    }

    @keyframes spin {
      to {
        transform: rotate(360deg)
      }
    }

    .pt {
      font-size: 16px;
      font-weight: 800;
      margin-bottom: 4px
    }

    .pf2 {
      font-size: 12px;
      color: var(--ink2);
      margin-bottom: 20px;
      word-break: break-all
    }

    .steps {
      display: flex;
      flex-direction: column;
      gap: 8px;
      text-align: left
    }

    .step {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
      color: var(--ink2);
      padding: 8px 11px;
      border-radius: 7px;
      transition: .3s
    }

    .step.on {
      color: var(--ac);
      background: var(--ac2);
      font-weight: 600
    }

    .step.dn {
      color: var(--ok)
    }

    .sic {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--rule);
      color: var(--ink2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: 700;
      flex-shrink: 0;
      transition: .3s
    }

    .step.on .sic {
      background: var(--ac);
      color: #fff
    }

    .step.dn .sic {
      background: var(--ok);
      color: #fff
    }

    /* Ïû¨ÏãúÎèÑ ÏïåÎ¶º */
    .retry-notice {
      margin-top: 12px;
      padding: 10px 14px;
      background: #fff8e6;
      border: 1px solid #f0c040;
      border-radius: 8px;
      font-size: 12px;
      color: #7a5f00;
      line-height: 1.5;
      display: none
    }

    .retry-notice.on {
      display: block;
      animation: fd .3s ease
    }

    .ebox {
      background: var(--ng2);
      border: 1px solid rgba(139, 31, 47, .25);
      border-radius: 10px;
      padding: 18px 22px;
      font-size: 13px;
      color: var(--ng);
      max-width: 440px;
      width: 90vw;
      text-align: left;
      line-height: 1.65;
      white-space: pre-wrap
    }

    .ebox strong {
      display: block;
      margin-bottom: 6px;
      font-size: 14px
    }

    .bkbtn {
      margin-top: 12px;
      background: var(--ng);
      color: #fff;
      border: none;
      padding: 7px 18px;
      border-radius: 6px;
      font-family: inherit;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer
    }

    .pbox {
      background: var(--paper);
      border: 1px solid var(--rule);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 32px;
      box-shadow: 0 1px 6px rgba(0, 0, 0, .05)
    }

    .phd {
      background: var(--ac);
      padding: 12px 26px;
      display: flex;
      align-items: center;
      justify-content: space-between
    }

    .pbadge {
      color: #fff;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: .1em
    }

    .pmeta {
      font-size: 12px;
      color: rgba(255, 255, 255, .75)
    }

    .pbody {
      padding: 28px 32px;
      font-family: 'Noto Serif KR', serif;
      font-size: 15.5px;
      line-height: 2.1;
      color: var(--ink);
      white-space: pre-wrap;
      word-break: keep-all
    }

    .qhd {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: .12em;
      color: var(--ink2);
      text-transform: uppercase;
      margin-bottom: 14px
    }

    .qc {
      background: var(--paper);
      border: 1px solid var(--rule);
      border-radius: 10px;
      margin-bottom: 16px;
      overflow: hidden;
      transition: box-shadow .25s, border-color .25s;
      box-shadow: 0 1px 4px rgba(0, 0, 0, .04)
    }

    .qc:hover {
      box-shadow: 0 4px 16px rgba(0, 0, 0, .08)
    }

    .qc.ok {
      border-color: #7ecb99
    }

    .qc.ng {
      border-color: #e8909a
    }

    .qt {
      padding: 16px 22px 0;
      display: flex;
      gap: 12px;
      align-items: flex-start
    }

    .qn {
      flex-shrink: 0;
      width: 28px;
      height: 28px;
      border-radius: 7px;
      background: var(--rule);
      color: var(--ink2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 13px;
      transition: .25s;
      margin-top: 2px
    }

    .qc.ok .qn {
      background: var(--ok);
      color: #fff
    }

    .qc.ng .qn {
      background: var(--ng);
      color: #fff
    }

    .qcode {
      font-size: 10px;
      color: var(--ink2);
      letter-spacing: .04em;
      margin-bottom: 4px
    }

    .qstem {
      font-family: 'Noto Serif KR', serif;
      font-size: 15px;
      line-height: 1.8;
      font-weight: 500;
      word-break: keep-all
    }

    .bogi {
      margin: 12px 22px 0;
      background: #f5f2ec;
      border: 1px solid var(--rule);
      border-radius: 8px;
      padding: 14px 16px;
      font-family: 'Noto Serif KR', serif;
      font-size: 14px;
      line-height: 1.85;
      word-break: keep-all
    }

    .bogitl {
      font-size: 10px;
      font-weight: 700;
      letter-spacing: .1em;
      color: var(--ink2);
      margin-bottom: 8px;
      font-family: 'Noto Sans KR', sans-serif
    }

    .chs {
      padding: 12px 22px 18px;
      display: flex;
      flex-direction: column;
      gap: 7px
    }

    .ch {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 14px;
      border: 1.5px solid var(--rule);
      border-radius: 8px;
      background: #fff;
      cursor: pointer;
      font-family: 'Noto Serif KR', serif;
      font-size: 14px;
      line-height: 1.7;
      color: var(--ink);
      text-align: left;
      width: 100%;
      transition: all .14s ease;
      word-break: keep-all
    }

    .ch:hover:not(:disabled) {
      border-color: var(--ac);
      background: var(--ac2);
      transform: translateX(3px)
    }

    .ch:disabled {
      cursor: default
    }

    .cc {
      flex-shrink: 0;
      width: 21px;
      height: 21px;
      border-radius: 50%;
      border: 1.5px solid var(--rule);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 700;
      font-family: 'Noto Sans KR', sans-serif;
      margin-top: 2px;
      transition: .14s;
      color: var(--ink2)
    }

    .ch:hover:not(:disabled) .cc {
      border-color: var(--ac);
      color: var(--ac)
    }

    .ch.isok {
      border-color: #7ecb99;
      background: var(--ok2);
      animation: pop .3s ease
    }

    .ch.isok .cc {
      background: var(--ok);
      border-color: var(--ok);
      color: #fff
    }

    .ch.isng {
      border-color: #e8909a;
      background: var(--ng2);
      animation: shk .35s ease
    }

    .ch.isng .cc {
      background: var(--ng);
      border-color: var(--ng);
      color: #fff
    }

    .ch.rv {
      border-color: #7ecb99;
      background: var(--rv);
      opacity: .8
    }

    .ch.rv .cc {
      background: var(--ok);
      border-color: var(--ok);
      color: #fff
    }

    .ch:disabled:not(.isok):not(.isng):not(.rv) {
      opacity: .45
    }

    @keyframes pop {
      0% {
        transform: scale(.98)
      }

      50% {
        transform: scale(1.015)
      }

      100% {
        transform: scale(1)
      }
    }

    @keyframes shk {

      0%,
      100% {
        transform: translateX(0)
      }

      25% {
        transform: translateX(-5px)
      }

      75% {
        transform: translateX(5px)
      }
    }

    .exp {
      margin: 0 22px 16px;
      padding: 11px 14px;
      border-radius: 7px;
      font-size: 13px;
      line-height: 1.65;
      display: none;
      word-break: keep-all
    }

    .exp.ok {
      background: var(--ok2);
      color: var(--ok);
      border-left: 3px solid var(--ok)
    }

    .exp.ng {
      background: var(--ng2);
      color: var(--ng);
      border-left: 3px solid var(--ng)
    }

    .exp.on {
      display: block;
      animation: fd .3s ease
    }

    @keyframes fd {
      from {
        opacity: 0;
        transform: translateY(4px)
      }

      to {
        opacity: 1;
        transform: none
      }
    }

    .fin {
      background: var(--paper);
      border: 1px solid var(--rule);
      border-radius: 14px;
      padding: 40px;
      text-align: center;
      margin-top: 32px;
      display: none;
      box-shadow: 0 2px 12px rgba(0, 0, 0, .06)
    }

    .fin.on {
      display: block;
      animation: fd .5s ease
    }

    .fbig {
      font-size: 68px;
      font-weight: 900;
      letter-spacing: -.04em;
      line-height: 1;
      color: var(--ac);
      margin-bottom: 10px
    }

    .fmsg {
      font-size: 16px;
      font-weight: 800;
      margin-bottom: 5px
    }

    .fsub {
      font-size: 13px;
      color: var(--ink2)
    }

    .pr {
      height: 5px;
      background: var(--rule);
      border-radius: 3px;
      margin-top: 22px;
      overflow: hidden
    }

    .pfill {
      height: 100%;
      background: var(--ac);
      border-radius: 3px;
      width: 0;
      transition: width 1s ease
    }

    .fnew {
      display: inline-block;
      margin-top: 22px;
      background: var(--ac);
      color: #fff;
      padding: 10px 26px;
      border-radius: 8px;
      font-family: inherit;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      border: none;
      transition: .2s
    }

    .fnew:hover {
      opacity: .88;
      transform: translateY(-1px)
    }
  </style>
</head>

<body>
  <header class="hd">
    <div class="logo">
      <div class="logo-dot"></div>Íµ≠Ïñ¥ ÎîîÏßÄÌÑ∏ Î¨∏Ï†úÏßÄ ÏÉùÏÑ±Í∏∞
    </div>
    <div class="hd-r">
      <div id="pill">0 / 0</div>
      <button id="newbtn" onclick="goSetup()">ÏÉà PDF Ïò¨Î¶¨Í∏∞</button>
    </div>
  </header>

  <!-- SETUP -->
  <div id="pg-setup" class="on">
    <div class="setup-wrap">
      <div class="setup-title">PDF Ìïú Ïû•ÏúºÎ°ú<br><span>Î¨∏Ï†úÏßÄ ÏôÑÏÑ±</span></div>
      <div class="setup-sub">Î°úÏª¨ AI Î™®Îç∏(Ollama)Ïù¥ ÏßÄÎ¨∏Í≥º Î¨∏Ìï≠ÏùÑ ÏûêÎèô Î∂ÑÏÑùÌï©ÎãàÎã§.<br>ÌÖçÏä§Ìä∏ PDFÎ•º ÏßÄÏõêÌï©ÎãàÎã§.</div>
      <div class="card">
        <div class="sec" id="ollama-status-sec">
          <div class="lbl">üöÄ Î°úÏª¨ AI Î™®Îç∏ ÏÑ§Ï†ï</div>
          <div class="ki-wrap" style="margin-bottom: 10px;">
            <input class="ki" id="modelName" type="text" placeholder="Î™®Îç∏ Ïù¥Î¶Ñ (Ïòà: gemma3:4b, llama3)" value="gemma3:4b">
          </div>
          <div class="ki-hint">
            Ïª¥Ìì®ÌÑ∞Ïóê <a href="https://ollama.com/" target="_blank">Ollama</a>Í∞Ä ÏÑ§ÏπòÎêòÏñ¥ Ïã§Ìñâ Ï§ëÏù¥Ïñ¥Ïïº Ìï©ÎãàÎã§.<br>
            <span id="conn-status" style="color:var(--ink2); font-weight:bold; margin-top: 5px; display:inline-block;">ÔøΩ
              Ollama Ïó∞Í≤∞ ÌôïÏù∏ Ï§ë...</span>
          </div>
        </div>
        <div class="sec">
          <div class="lbl">üìë ÏãúÌóòÏßÄ PDF</div>
          <div class="drop" id="dz">
            <input type="file" id="fi" accept=".pdf" onchange="pickFile(this.files[0])">
            <span class="drop-ico">üìë</span>
            <h3>PDFÎ•º ÎÅåÏñ¥Îã§ ÎÜìÍ±∞ÎÇò ÌÅ¥Î¶≠</h3>
            <p>ÌÖçÏä§Ìä∏ PDF Ï†ÑÏö© (Î°úÏª¨ AI Î≥¥Ìò∏)</p>
            <div id="chosen"></div>
          </div>
        </div>
        <button class="go" id="gobtn" onclick="start()" disabled>‚ú® Î¨∏Ï†úÏßÄ ÏÉùÏÑ± ÏãúÏûë</button>
      </div>
      <div class="tags">
        <span class="tag">‚úÖ ÌÖçÏä§Ìä∏ PDF Ï†ÑÏö©</span>
        <span class="tag">‚úÖ Î°úÏª¨ ÏôÑÏ†Ñ Î¨¥Î£å</span>
        <span class="tag">‚úÖ Îç∞Ïù¥ÌÑ∞ Î≥¥Ìò∏ 100%</span>
      </div>
    </div>
  </div>

  <!-- PROCESSING -->
  <div id="pg-proc">
    <div class="pc">
      <div class="spin" id="spin"></div>
      <div class="pt" id="pt">Î∂ÑÏÑù Ï§ë...</div>
      <div class="pf2" id="pf2"></div>
      <div class="steps">
        <div class="step on" id="s1">
          <div class="sic">1</div><span>PDF ÌÖçÏä§Ìä∏ Ï∂îÏ∂ú Ï§ë</span>
        </div>
        <div class="step" id="s2">
          <div class="sic">2</div><span>Î°úÏª¨ AI Î∂ÑÏÑù (Ïò§Îûò Í±∏Î¶¥ Ïàò ÏûàÏäµÎãàÎã§)</span>
        </div>
        <div class="step" id="s3">
          <div class="sic">3</div><span>Ï†ïÎãµ¬∑Ìï¥ÏÑ§ Ï†ïÎ¶¨</span>
        </div>
        <div class="step" id="s4">
          <div class="sic">4</div><span>Î¨∏Ï†úÏßÄ Î†åÎçîÎßÅ</span>
        </div>
      </div>
      <div class="retry-notice" id="retryNotice"></div>
    </div>
    <div id="eb" style="display:none"></div>
  </div>

  <!-- QUIZ -->
  <div id="pg-quiz"></div>

  <script>
    var pdfFile = null, quizData = null, answered = {}, score = 0, PDFJS = null;
    var ollamaConnected = false;

    // ‚îÄ‚îÄ Ollama Ïó∞Í≤∞ ÌôïÏù∏ ‚îÄ‚îÄ
    async function checkOllama() {
      try {
        var res = await fetch('http://localhost:11434/api/tags');
        if (res.ok) {
          document.getElementById('conn-status').innerHTML = '‚úÖ Ollama Ïó∞Í≤∞ ÏÑ±Í≥µ';
          document.getElementById('conn-status').style.color = 'var(--ok)';
          ollamaConnected = true;
          chk();
        } else {
          throw new Error();
        }
      } catch (e) {
        document.getElementById('conn-status').innerHTML = '‚ùå Ollama Ïó∞Í≤∞ Ïã§Ìå®. OllamaÎ•º Ïã§ÌñâÌï¥ Ï£ºÏÑ∏Ïöî.';
        document.getElementById('conn-status').style.color = 'var(--ng)';
        ollamaConnected = false;
        chk();
      }
    }

    // ÏµúÏ¥à 1Ìöå Ï≤¥ÌÅ¨
    checkOllama();

    // ‚îÄ‚îÄ ÌååÏùº ‚îÄ‚îÄ
    function pickFile(f) { if (!f || f.type !== 'application/pdf') return; pdfFile = f; document.getElementById('chosen').textContent = '‚úì ' + f.name; chk() }
    function chk() {
      var isModelInputReady = document.getElementById('modelName').value.trim() !== '';
      document.getElementById('gobtn').disabled = !(pdfFile && isModelInputReady); // allow start even if connection check failed cross origin
    }
    var dz = document.getElementById('dz');
    dz.addEventListener('dragover', function (e) { e.preventDefault(); dz.classList.add('over') });
    dz.addEventListener('dragleave', function () { dz.classList.remove('over') });
    dz.addEventListener('drop', function (e) { e.preventDefault(); dz.classList.remove('over'); var f = e.dataTransfer.files[0]; if (f && f.type === 'application/pdf') { document.getElementById('fi').files = e.dataTransfer.files; pickFile(f) } });

    document.getElementById('modelName').addEventListener('input', chk);

    // ‚îÄ‚îÄ ÌôîÎ©¥ ‚îÄ‚îÄ
    function showPage(id) { ['pg-setup', 'pg-proc', 'pg-quiz'].forEach(function (p) { document.getElementById(p).classList.toggle('on', p === id) }) }
    function sOn(n) { var e = document.getElementById('s' + n); if (e) e.classList.add('on') }
    function sDn(n) { var e = document.getElementById('s' + n); if (!e) return; e.classList.remove('on'); e.classList.add('dn'); e.querySelector('.sic').textContent = '‚úì' }
    function sLbl(n, t) { var e = document.getElementById('s' + n); if (e) e.querySelector('span').textContent = t }
    function showErr(msg) { document.getElementById('spin').style.display = 'none'; document.getElementById('pt').textContent = 'Ïò§Î•ò Î∞úÏÉù'; var b = document.getElementById('eb'); b.innerHTML = '<div class="ebox"><strong>‚ö†Ô∏è Ïò§Î•ò</strong>' + esc(msg) + '<br><button class="bkbtn" onclick="goSetup()">‚Üê ÎèåÏïÑÍ∞ÄÍ∏∞</button></div>'; b.style.display = 'block' }
    function showRetry(msg) { var n = document.getElementById('retryNotice'); n.textContent = msg; n.classList.add('on') }
    function hideRetry() { document.getElementById('retryNotice').classList.remove('on') }

    // ‚îÄ‚îÄ PDF.js ‚îÄ‚îÄ
    function loadPdfJs() {
      return new Promise(function (res, rej) {
        if (window.pdfjsLib) { PDFJS = window.pdfjsLib; return res() }
        var urls = ['https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js', 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.4.120/build/pdf.min.js'];
        var i = 0;
        function next() {
          if (i >= urls.length) return rej(new Error('PDF.jsÎ•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.\nÏù∏ÌÑ∞ÎÑ∑ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏Ìï¥ Ï£ºÏÑ∏Ïöî.'));
          var s = document.createElement('script'); s.src = urls[i++];
          s.onload = function () { PDFJS = window.pdfjsLib; try { PDFJS.GlobalWorkerOptions.workerSrc = '' } catch (e) { } res() };
          s.onerror = function () { s.remove(); next() };
          document.head.appendChild(s);
        }
        next();
      });
    }

    async function tryExtractText(pdf) {
      var lines = [];
      for (var p = 1; p <= pdf.numPages; p++) {
        var page = await pdf.getPage(p); var ct = await page.getTextContent();
        var lastY = null, row = [];
        for (var j = 0; j < ct.items.length; j++) {
          var it = ct.items[j]; var y = it.transform[5];
          if (lastY !== null && Math.abs(y - lastY) > 2) { lines.push(row.join('')); row = [] }
          row.push(it.str); lastY = y;
        }
        if (row.length) lines.push(row.join('')); lines.push('');
      }
      return lines.join('\n').replace(/\n{3,}/g, '\n\n').trim();
    }

    // ‚îÄ‚îÄ Ollama API ÌÜµÏã† ‚îÄ‚îÄ
    var JSON_SCHEMA = 'ÏùëÎãµ ÌòïÏãù (ÏàúÏàò JSON, ÏΩîÎìúÎ∏îÎ°ù ÏóÜÏù¥):\n'
      + '{"title":"ÏßÄÎ¨∏ Ï£ºÏ†úÏñ¥","subject":"Í≥ºÌïôÍ∏∞Ïà†|Ïù∏Î¨∏|ÏÇ¨Ìöå|Î¨∏Ìïô Ï§ë ÌïòÎÇò","range":"[01~05] ÌòïÌÉú",'
      + '"passage":"ÏßÄÎ¨∏ Î≥∏Î¨∏Îßå (Îã®ÎùΩÍµ¨Î∂Ñ \\n\\n, Î¨∏Ìï≠¬∑ÏÑ†ÌÉùÏßÄ¬∑Í∞ÅÏ£º Ï†úÏô∏)",'
      + '"questions":[{"id":1,"code":"[26002-0172]","stem":"Î∞úÎ¨∏ Ï†ÑÏ≤¥","has_bogi":false,"bogi":"",'
      + '"choices":["ÏÑ†ÌÉùÏßÄ1","ÏÑ†ÌÉùÏßÄ2","ÏÑ†ÌÉùÏßÄ3","ÏÑ†ÌÉùÏßÄ4","ÏÑ†ÌÉùÏßÄ5"],"correct":3,"explanation":"Ï†ïÎãµ Ïù¥Ïú† 2~3Î¨∏Ïû•"}]}\n\n'
      + 'Í∑úÏπô: choices Î∞òÎìúÏãú 5Í∞ú(Î≤àÌò∏Í∏∞Ìò∏ Ï†úÏô∏). correctÎäî 1~5 Ï†ïÏàò. "Ï†ÅÏ†àÌïòÏßÄ ÏïäÏùÄ Í≤É" Ïú†Ìòï=Ïã§Ï†ú ÌãÄÎ¶∞ ÏÑ†ÌÉùÏßÄ Î≤àÌò∏. ÏΩîÎìúÎ∏îÎ°ù ÏóÜÏù¥ JSONÎßå Î∞òÌôòÌï¥.';

    async function callOllama(promptText) {
      var model = document.getElementById('modelName').value.trim();

      var resp;
      try {
        resp = await fetch('http://localhost:11434/api/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            model: model,
            prompt: promptText,
            stream: false,
            options: {
              temperature: 0.1
            },
            format: "json"
          })
        });
      } catch (e) {
        throw new Error('Ollama ÏÑúÎ≤Ñ(localhost:11434)Ïóê Ïó∞Í≤∞Ìï† Ïàò ÏóÜÏäµÎãàÎã§. Î∞±Í∑∏ÎùºÏö¥ÎìúÏóêÏÑú OllamaÍ∞Ä Ïã§Ìñâ Ï§ëÏù∏ÏßÄ ÌôïÏù∏Ìï¥ Ï£ºÏÑ∏Ïöî. CORS Î¨∏Ï†úÏùº ÏàòÎèÑ ÏûàÏäµÎãàÎã§.\n(' + e.message + ')');
      }

      if (!resp.ok) {
        var j = {}; try { j = await resp.json() } catch (e) { }
        throw new Error('Ollama Ïò§Î•ò (' + resp.status + '): ' + (j.error || resp.statusText));
      }

      var d = await resp.json();
      var raw = ''; try { raw = d.response.trim() } catch (e) { }
      var clean = raw.replace(/^```json\s*/i, '').replace(/^```\s*/i, '').replace(/```\s*$/i, '').trim();
      try { return JSON.parse(clean) }
      catch (e) {
        var m = clean.match(/\{[\s\S]*\}/);
        if (m) { try { return JSON.parse(m[0]) } catch (e2) { } }
        throw new Error('AI ÏùëÎãµ ÌååÏã± Ïã§Ìå®.\n\nÏõêÎ≥∏ ÏùëÎãµ (Ï≤òÏùå 300Ïûê):\n' + raw.slice(0, 300));
      }
    }

    // ‚îÄ‚îÄ Î©îÏù∏ ÌùêÎ¶Ñ ‚îÄ‚îÄ
    async function start() {
      var modelName = document.getElementById('modelName').value.trim();
      if (!pdfFile || !modelName) return;
      showPage('pg-proc');
      document.getElementById('pf2').textContent = pdfFile.name;
      answered = {}; score = 0;

      try {
        sLbl(1, 'PDF.js Î°úÎìú Ï§ë‚Ä¶');
        await loadPdfJs();
        sLbl(1, 'PDF ÌååÏã± Ï§ë‚Ä¶');
        var buf = await pdfFile.arrayBuffer();
        var pdf = await PDFJS.getDocument({ data: buf }).promise;
        sLbl(1, 'PDF Î°úÎìú ÏôÑÎ£å (' + pdf.numPages + 'ÌéòÏù¥ÏßÄ)');
        sDn(1);

        sOn(2);
        var txt = await tryExtractText(pdf);
        var ptext = '';

        if (txt.length < 80) {
          throw new Error('Ïä§Ï∫î Ïù¥ÎØ∏ÏßÄ PDFÎäî Î°úÏª¨ Íµ¨Îèô Î≤ÑÏ†ÑÏóêÏÑú ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§ (ÌÖçÏä§Ìä∏ Ï∂îÏ∂ú Ïã§Ìå®). ÌÖçÏä§Ìä∏Í∞Ä Î≥µÏÇ¨ÎêòÎäî PDFÎ•º ÏÇ¨Ïö©Ìï¥ Ï£ºÏÑ∏Ïöî.');
        } else {
          ptext = 'Îã§ÏùåÏùÄ ÌïúÍµ≠ Íµ≠Ïñ¥ ÏãúÌóòÏßÄ ÌÖçÏä§Ìä∏ÏûÖÎãàÎã§. ÏßÄÎ¨∏Í≥º Î¨∏Ìï≠ÏùÑ Î∂ÑÏÑùÌï¥ÏÑú ÏïÑÎûò ÏöîÏ≤≠Îêú JSON ÌòïÏãùÏúºÎ°ú ÏôÑÎ≤ΩÌïòÍ≤å Ï†ïÎ¶¨Ìï¥ÏÑú ÏùëÎãµÌïòÏÑ∏Ïöî. Îã§Î•∏ ÏÑ§Î™ÖÏùÄ ÌïòÏßÄ ÎßêÍ≥† JSONÎßå Ï∂úÎ†•ÌïòÏÑ∏Ïöî.\n\nÌÖçÏä§Ìä∏:\n---\n' + txt.slice(0, 25000) + '\n---\n\n' + JSON_SCHEMA;
          sLbl(2, 'Î°úÏª¨ Î™®Îç∏(' + modelName + ') ÏÉùÏÑ± Ï§ë‚Ä¶ ÏÑ±Îä•Ïóê Îî∞Îùº Ïàò Î∂ÑÏù¥ Í±∏Î¶¥ Ïàò ÏûàÏäµÎãàÎã§.');
        }

        quizData = await callOllama(ptext);

        if (!quizData || !quizData.questions || !quizData.questions.length)
          throw new Error('Î¨∏Ìï≠ÏùÑ Ï∞æÏßÄ Î™ªÌñàÏäµÎãàÎã§.\nÍµ≠Ïñ¥ ÏãúÌóòÏßÄ PDFÏù∏ÏßÄ ÌôïÏù∏Ìï¥ Ï£ºÏÑ∏Ïöî. ÌòπÏùÄ Î™®Îç∏Ïùò Ï∂úÎ†•Ïù¥ Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏïòÏùÑ Ïàò ÏûàÏäµÎãàÎã§.');
        sLbl(2, 'Î∂ÑÏÑù ÏôÑÎ£å ¬∑ Î¨∏Ìï≠ ' + quizData.questions.length + 'Í∞ú');
        sDn(2);

        sOn(3); await sleep(300); sDn(3);
        sOn(4); renderQuiz(quizData); await sleep(200); sDn(4); await sleep(200);

        showPage('pg-quiz');
        document.getElementById('pill').style.display = 'flex';
        document.getElementById('newbtn').style.display = 'inline-block';
        updPill();

      } catch (err) { console.error(err); showErr(err.message || String(err)) }
    }

    // ‚îÄ‚îÄ Î†åÎçîÎßÅ ‚îÄ‚îÄ
    function renderQuiz(d) {
      var qs = d.questions || []; var nums = ['‚ë†', '‚ë°', '‚ë¢', '‚ë£', '‚ë§'];
      var h = '<div class="pbox"><div class="phd"><span class="pbadge">ÏßÄ Î¨∏</span><span class="pmeta">' + esc(d.range || '') + ' ' + esc(d.title || '') + ' ¬∑ ' + esc(d.subject || '') + '</span></div><div class="pbody">' + esc(d.passage || '') + '</div></div><div class="qhd">‚Äî Î¨∏ Ìï≠ ‚Äî</div>';
      for (var i = 0; i < qs.length; i++) {
        var q = qs[i]; var chs = '';
        for (var j = 0; j < (q.choices || []).length; j++) {
          chs += '<button class="ch" id="c-' + q.id + '-' + (j + 1) + '" onclick="ans(' + q.id + ',' + (j + 1) + ',' + q.correct + ')">'
            + '<span class="cc">' + nums[j] + '</span><span>' + esc(q.choices[j]) + '</span></button>';
        }
        var bogi = q.has_bogi && q.bogi ? '<div class="bogi"><div class="bogitl">‚óÄ Î≥¥ Í∏∞ ‚ñ∂</div>' + esc(q.bogi) + '</div>' : '';
        h += '<div class="qc" id="qc-' + q.id + '"><div class="qt"><div class="qn" id="qn-' + q.id + '">' + q.id + '</div>'
          + '<div>' + (q.code ? '<div class="qcode">' + esc(q.code) + '</div>' : '') + '<div class="qstem">' + esc(q.stem) + '</div></div></div>'
          + bogi + '<div class="chs" id="chs-' + q.id + '">' + chs + '</div><div class="exp" id="ex-' + q.id + '"></div></div>';
      }
      h += '<div class="fin" id="fin"><div class="fbig" id="fb"></div><div class="fmsg" id="fm"></div><div class="fsub" id="fs"></div><div class="pr"><div class="pfill" id="pf"></div></div><button class="fnew" onclick="goSetup()">üìÑ ÏÉà PDF Ïò¨Î¶¨Í∏∞</button></div>';
      document.getElementById('pg-quiz').innerHTML = h;
    }

    // ‚îÄ‚îÄ Ï±ÑÏ†ê ‚îÄ‚îÄ
    function ans(qid, chosen, correct) {
      if (answered[qid] !== undefined) return;
      answered[qid] = chosen; var ok = chosen === correct; if (ok) score++;
      document.querySelectorAll('#chs-' + qid + ' .ch').forEach(function (b, i) {
        b.disabled = true; var n = i + 1;
        if (n === chosen) b.classList.add(ok ? 'isok' : 'isng');
        if (!ok && n === correct) b.classList.add('rv');
      });
      document.getElementById('qc-' + qid).classList.add(ok ? 'ok' : 'ng');
      var q = quizData.questions.filter(function (x) { return x.id === qid })[0];
      var ex = document.getElementById('ex-' + qid);
      ex.textContent = (ok ? '‚úì Ï†ïÎãµ!  ' : '‚úó Ïò§Îãµ.  ') + (q && q.explanation || '');
      ex.className = 'exp ' + (ok ? 'ok' : 'ng') + ' on';
      updPill();
      if (Object.keys(answered).length === quizData.questions.length) setTimeout(showFin, 700);
    }
    function updPill() { document.getElementById('pill').textContent = score + ' / ' + Object.keys(answered).length }
    function showFin() {
      var total = quizData.questions.length, pct = score / total;
      var msgs = [['Îã§Ïãú ÎèÑÏ†ÑÌï¥Ïöî! üí™', 'ÌãÄÎ¶∞ Î¨∏Ìï≠ÏùÑ Íº≠ Î≥µÏäµÌï¥ Î≥¥ÏÑ∏Ïöî.'], ['Ï°∞Í∏à Îçî ÌûòÎÇ¥Ïöî! üìö', 'ÏßÄÎ¨∏ÏùÑ Îã§Ïãú ÍººÍººÌûà ÏùΩÏñ¥Î≥¥ÏÑ∏Ïöî.'], ['Î∞ò Ïù¥ÏÉÅ ÎßûÏïòÏñ¥Ïöî! üå±', 'Íæ∏Ï§ÄÌûà Ïó∞ÏäµÌïòÎ©¥ Í∏àÎ∞© Ïò¨ÎùºÏöî.'], ['ÏûòÌñàÏñ¥Ïöî! ‚≠ê', 'ÌãÄÎ¶∞ Î∂ÄÎ∂ÑÎßå ÏßëÏ§ëÌïòÎ©¥ ÏôÑÎ≤ΩÌï¥Ïöî.'], ['ÌõåÎ•≠Ìï¥Ïöî! üéØ', 'Í±∞Ïùò Îã§ ÎßûÏ∑ÑÎÑ§Ïöî!'], ['ÎßåÏ†ê! üèÜ', 'ÏôÑÎ≤ΩÌïú Ïù¥Ìï¥ÏûÖÎãàÎã§. ÏàòÎä• ÌååÏù¥ÌåÖ!']];
      var idx = Math.min(Math.round(pct * (msgs.length - 1)), msgs.length - 1);
      document.getElementById('fb').textContent = score + ' / ' + total;
      document.getElementById('fm').textContent = msgs[idx][0];
      document.getElementById('fs').textContent = msgs[idx][1];
      document.getElementById('fin').classList.add('on');
      setTimeout(function () { document.getElementById('pf').style.width = (pct * 100) + '%' }, 300);
      document.getElementById('fin').scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    // ‚îÄ‚îÄ Ï¥àÍ∏∞Ìôî ‚îÄ‚îÄ
    function goSetup() {
      showPage('pg-setup');
      document.getElementById('pill').style.display = 'none';
      document.getElementById('newbtn').style.display = 'none';
      document.getElementById('spin').style.display = 'block';
      document.getElementById('eb').style.display = 'none';
      document.getElementById('retryNotice').classList.remove('on');
      document.getElementById('pt').textContent = 'Î∂ÑÏÑù Ï§ë...';
      document.getElementById('pf2').textContent = '';
      var lbls = ['PDF ÌÖçÏä§Ìä∏ Ï∂îÏ∂ú Ï§ë', 'Î°úÏª¨ AI Î∂ÑÏÑù (Ïò§Îûò Í±∏Î¶¥ Ïàò ÏûàÏäµÎãàÎã§)', 'Ï†ïÎãµ¬∑Ìï¥ÏÑ§ Ï†ïÎ¶¨', 'Î¨∏Ï†úÏßÄ Î†åÎçîÎßÅ'];
      for (var i = 1; i <= 4; i++) { var el = document.getElementById('s' + i); el.className = 'step' + (i === 1 ? ' on' : ''); el.querySelector('.sic').textContent = i; el.querySelector('span').textContent = lbls[i - 1] }
      quizData = null; answered = {}; score = 0; pdfFile = null;
      document.getElementById('fi').value = ''; document.getElementById('chosen').textContent = '';
      chk();
      checkOllama();
    }
    function esc(s) { return String(s || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/\n/g, '<br>') }
    function sleep(ms) { return new Promise(function (r) { setTimeout(r, ms) }) }
  </script>
</body>

>>>>>>> fd976e7b57bb3fc92d2dd25445875d1242d1c53d
</html>