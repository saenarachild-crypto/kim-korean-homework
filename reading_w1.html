<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>1ì›” 1ì£¼ì°¨ ê³¼ì œ [ë…ì„œ]</title>
    <style>
        body{font-family:-apple-system,sans-serif;background:#f0f2f5;padding:15px;margin:0}
        .container{max-width:700px;margin:0 auto;background:#fff;padding:20px;border-radius:15px;box-shadow:0 2px 10px rgba(0,0,0,0.05)}
        .header-info{background:#f8f9fa;padding:15px;border-radius:10px;margin-bottom:20px;border:1px solid #e9ecef}
        .notice-box{background:#fff8e1;border:1px solid #ffe0b2;padding:15px;border-radius:8px;margin-bottom:20px;color:#5d4037;font-size:0.95rem;line-height:1.5}
        .input-group{margin-bottom:10px} .input-group label{display:block;margin-bottom:5px;font-weight:bold;color:#555} .input-group input{width:100%;padding:10px;border:1px solid #ccc;border-radius:5px}
        .question-item{padding:15px 0;border-bottom:1px solid #eee} .question-number{font-weight:bold;color:#2196f3;margin-bottom:10px;display:block}
        .options{display:flex;justify-content:space-between;max-width:300px;margin:0 auto} 
        .options label{display:flex;justify-content:center;align-items:center;width:45px;height:45px;border:2px solid #e0e0e0;border-radius:50%;font-weight:bold;color:#777;cursor:pointer} 
        .options input{display:none} .options input:checked+label{background:#2196f3;color:#fff;border-color:#2196f3}
        .btn-submit{display:block;width:100%;padding:15px;background:#2c3e50;color:#fff;border:none;border-radius:10px;font-weight:bold;font-size:1.1rem;margin-top:20px;cursor:pointer; transition: background 0.3s;}
        .btn-submit:disabled{background:#cfd8dc; color:#90a4ae; cursor:not-allowed;}
        .timer-msg { text-align: center; color: #d32f2f; font-weight: bold; margin-top: 10px; font-size: 0.9rem; display: none; }
        .result-section{display:none;margin-top:20px} .result-box{padding:20px;background:#e3f2fd;border-radius:10px;text-align:center;margin-top:20px} 
        .wrong-answer{background:#ffebee;border-radius:5px} .wrong-answer .question-number{color:#d32f2f}
        .skipped-item { background: #fafafa; opacity: 0.5; pointer-events: none; }
        .skipped-item .question-number { text-decoration: line-through; color: #aaa; }
        .skipped-msg { color: #d32f2f; font-weight: bold; font-size: 0.8rem; margin-left: 5px; display: inline-block; }
        
        /* ë§í¬ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-file { display: block; width: 100%; padding: 12px; background: #546e7a; color: white; text-align: center; text-decoration: none; border-radius: 8px; font-weight: bold; margin-bottom: 20px; box-sizing: border-box; }
    </style>
</head>
<body>
<div class="container">
    <h2 style="text-align:center; margin-top:0;">1ì›” 1ì£¼ì°¨ ê³¼ì œ [ë…ì„œ]</h2>
    <div class="notice-box">ğŸ“¢ <b>ì•ˆë‚´:</b><br>1. <b>í•™ìŠµ ì œì™¸ ë¬¸í•­</b>ì€ ì…ë ¥ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.<br>2. ì œì¶œ í›„ <b>30ë¶„ê°„</b> ì¬ì œì¶œì´ ì ê¹ë‹ˆë‹¤.<br>3. <b>4íšŒì°¨ ì‹œë„</b>ë¶€í„° ì˜¤ë‹µ ë²ˆí˜¸ê°€ ê³µê°œë©ë‹ˆë‹¤.</div>
    
    <a href="https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQAIYWBZgMIwS77MZq3A52QaAWNiPgGzGx1bGhMOHCqNxB8?e=MLTOlg" target="_blank" class="btn-file">ğŸ“„ ì‹œí—˜ì§€(ë¬¸ì œ) ë³´ëŸ¬ê°€ê¸° (Click)</a>
    
    <div class="header-info">
        <div class="input-group">
            <label>í•™ìƒ ì´ë¦„</label>
            <input type="text" id="studentName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
        </div>
        <div class="input-group">
            <label>ê³¼ì œëª…</label>
            <input type="text" value="1ì›” 1ì£¼ì°¨ ê³¼ì œ [ë…ì„œ]" readonly>
        </div>
    </div>

    <div id="qList"></div>
    <button class="btn-submit" id="submitBtn" onclick="submitAnswers()">ë‹µì•ˆ ì œì¶œí•˜ê¸°</button>
    <div id="timerMsg" class="timer-msg">â³ ë‹¤ìŒ ì‹œë„ê¹Œì§€ 30ë¶„ ë‚¨ì•˜ìŠµë‹ˆë‹¤.</div>
    
    <div id="resultSection" class="result-section">
        <div class="result-box">
            <div id="resultText"></div>
        </div>
    </div>
</div>

<script>
    const answers = [2,5,4,3,1, 3,2,1,4,3, 4,2,3,4,1, 5,1,4,2,2, 1,1,3,2,1, 2,1,2,4,3, 1,4,2,1,2, 4,1,3,2];
    const skipList = [1,2,3,4,5, 16,17,18,19,20,21, 26,27,28,29, 37,38,39];
    const scriptUrl = "https://script.google.com/macros/s/AKfycbyM-8CmijrbV5PmgSebU_AP_lztEHlyNdXq7cRyfratLdj2y0BP9inAZJyING1oZiIt/exec";
    
    const STORAGE_KEY = "kim_korean_reading_v1"; 
    const COOLDOWN_MINUTES = 30;

    let attempt = 0;
    const totalQ = answers.length;

    window.onload = function(){
        const c = document.getElementById("qList");
        for(let i=1; i<=totalQ; i++){
            let isSkip = skipList.includes(i);
            let extraClass = isSkip ? "skipped-item" : "";
            let skipLabel = isSkip ? '<span class="skipped-msg">(í•™ìŠµ ì œì™¸)</span>' : "";
            let h = '<div class="question-item '+extraClass+'" id="qBox'+i+'"><span class="question-number">'+i+'ë²ˆ</span>'+skipLabel+'<div class="options">';
            for(let j=1; j<=5; j++){
                h += '<input type="radio" name="q'+i+'" id="q'+i+'_'+j+'" value="'+j+'"><label for="q'+i+'_'+j+'">'+j+'</label>';
            }
            h += '</div></div>';
            c.innerHTML += h;
        }
        loadStatus();
    };

    function loadStatus() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if(saved) {
            const data = JSON.parse(saved);
            attempt = data.attempt || 0;
            if(data.name) document.getElementById("studentName").value = data.name;
            if(data.lastSubmitTime) {
                const passed = (new Date().getTime() - data.lastSubmitTime) / 1000 / 60;
                if(passed < COOLDOWN_MINUTES) lockSubmit(COOLDOWN_MINUTES - passed);
            }
        }
    }

    function lockSubmit(remainMinutes) {
        const btn = document.getElementById("submitBtn");
        const msg = document.getElementById("timerMsg");
        btn.disabled = true;
        btn.innerText = "â³ ì œì¶œ ëŒ€ê¸° ì¤‘...";
        msg.style.display = "block";
        msg.innerText = "â³ ë‹¤ìŒ ì œì¶œê¹Œì§€ " + Math.ceil(remainMinutes) + "ë¶„ ë‚¨ì•˜ìŠµë‹ˆë‹¤.";
        setTimeout(() => {
            if(remainMinutes > 1) lockSubmit(remainMinutes - 1);
            else { btn.disabled = false; btn.innerText = "ë‹µì•ˆ ì œì¶œí•˜ê¸°"; msg.style.display = "none"; }
        }, 60000); 
    }

    function submitAnswers(){
        const name = document.getElementById("studentName").value;
        if(!name) return alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        const btn = document.getElementById("submitBtn");
        btn.disabled = true;
        btn.innerText = "â³ ì±„ì  ë° ì €ì¥ ì¤‘...";

        attempt++;
        let wrong = 0;
        let wrongList = [];
        for(let i=1; i<=totalQ; i++){
            if(skipList.includes(i)) continue;
            const r = document.querySelector('input[name="q'+i+'"]:checked');
            if(!r || r.value != answers[i-1]){ wrong++; wrongList.push(i+"ë²ˆ"); }
        }
        
        const now = new Date().getTime();
        localStorage.setItem(STORAGE_KEY, JSON.stringify({ name: name, attempt: attempt, lastSubmitTime: now }));

        const data = { name: name, title: "1ì›” 1ì£¼ì°¨ ê³¼ì œ [ë…ì„œ]", wrongCount: wrong, wrongList: wrongList.join(", ") };
        fetch(scriptUrl, { method: "POST", mode: "no-cors", headers: { "Content-Type": "application/json" }, body: JSON.stringify(data) })
        .then(() => { showResult(wrong, name); lockSubmit(COOLDOWN_MINUTES); })
        .catch(err => { showResult(wrong, name); lockSubmit(COOLDOWN_MINUTES); });
    }

    function showResult(wrong, name){
        document.getElementById("resultSection").style.display = "block";
        document.getElementById("resultSection").scrollIntoView({behavior:"smooth"});
        const txt = document.getElementById("resultText");
        let msg = "<h3>"+name+" í•™ìƒ (" + attempt + "íšŒì°¨ ì œì¶œ)</h3>";
        
        if(wrong === 0) msg += "<h3 style='color:green'>ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ë§Œì ì…ë‹ˆë‹¤!</h3>";
        else {
            msg += "<br><b>" + wrong + "ê°œ</b> í‹€ë ¸ìŠµë‹ˆë‹¤.<br>";
            if(attempt < 4) msg += "<br><span style='color:#e65100; font-weight:bold;'>ğŸ”’ ì˜¤ë‹µ ë¬¸í•­ì€ 4ë²ˆì§¸ ì‹œë„ë¶€í„° ê³µê°œë©ë‹ˆë‹¤.</span><br>(í˜„ì¬ " + attempt + "ë²ˆì§¸ ì‹œë„ / 30ë¶„ í›„ ì¬ì‹œë„ ê°€ëŠ¥)";
            else {
                msg += "<br><span style='color:#d32f2f; font-weight:bold;'>ğŸ”“ í‹€ë¦° ë¬¸í•­:</span><br>" + ((wrongList.length>0)? wrongList.join(", ") : "ì—†ìŒ");
                for(let i=1; i<=totalQ; i++){
                    if(skipList.includes(i)) continue;
                    const r = document.querySelector('input[name="q'+i+'"]:checked');
                    const box = document.getElementById("qBox"+i);
                    box.classList.remove("wrong-answer");
                    if(!r || r.value != answers[i-1]) box.classList.add("wrong-answer");
                }
            }
        }
        txt.innerHTML = msg;
    }
</script>
</body>
</html>