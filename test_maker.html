<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¼ì¼ í…ŒìŠ¤íŠ¸ ìƒì„±ê¸° V2</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f4f6f8; padding: 20px; max-width: 800px; margin: 0 auto; }
        .card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { margin-top: 0; color: #2c3e50; text-align: center; }
        .input-group { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; color: #555; }
        input[type="text"], input[type="number"] { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
        .help-text { font-size: 0.85rem; color: #888; margin-top: 5px; }
        
        button { width: 100%; padding: 15px; background: #2196f3; color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background: #1976d2; }
        
        textarea { width: 100%; height: 300px; margin-top: 20px; padding: 15px; border: 2px solid #ccc; border-radius: 8px; font-family: monospace; font-size: 0.9rem; display: none; }
        .copy-btn { background: #4caf50; margin-top: 10px; display: none; }
        .copy-btn:hover { background: #388e3c; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ› ï¸ ì¼ì¼ í…ŒìŠ¤íŠ¸ ìƒì„±ê¸° V2</h2>
    
    <div class="input-group">
        <label>1. ì‹œí—˜ ì œëª© (ìˆ˜ì—…ëª…)</label>
        <input type="text" id="title" placeholder="ì˜ˆ: í™”ì‘ ì‹¬í™”ë°˜ 3íšŒì°¨ í…ŒìŠ¤íŠ¸">
    </div>

    <div class="input-group">
        <label>2. ì •ë‹µ ì…ë ¥ (ìˆ«ìë§Œ ì—°ì†ìœ¼ë¡œ)</label>
        <input type="text" id="answers" placeholder="ì˜ˆ: 12345 (5ë¬¸ì œì¸ ê²½ìš°)">
    </div>

    <div class="input-group">
        <label>3. í†µê³¼ ê¸°ì¤€ (ëª‡ ê°œ í‹€ë¦° ê²ƒê¹Œì§€ ë´ì¤„ê¹Œìš”?)</label>
        <input type="number" id="cutline" value="0" placeholder="0">
        <div class="help-text">â€» 0ì´ë©´ 'ë‹¤ ë§ì•„ì•¼ í†µê³¼'</div>
    </div>

    <div class="input-group">
        <label>4. ì¬ë„ì „ ëŒ€ê¸° ì‹œê°„ (ë¶„ ë‹¨ìœ„)</label>
        <input type="number" id="cooldown" value="0" placeholder="0">
        <div class="help-text">â€» 0ì´ë©´ 'ëŒ€ê¸° ì—†ìŒ(ë°”ë¡œ ì¬ë„ì „)', 0.5ë©´ '30ì´ˆ'</div>
    </div>

    <div class="input-group">
        <label>5. ìµœëŒ€ ë„ì „ íšŸìˆ˜ (ê¸°íšŒ)</label>
        <input type="number" id="maxAttempts" value="0" placeholder="0">
        <div class="help-text">â€» 0ì´ë©´ 'ë¬´ì œí•œ', 3ì´ë©´ '3ë²ˆ ì•ˆì— í†µê³¼ ëª»í•˜ë©´ ì„ ìƒë‹˜ í˜¸ì¶œ'</div>
    </div>

    <button onclick="generateCode()">ì½”ë“œ ìƒì„±í•˜ê¸° âœ¨</button>
    
    <textarea id="resultCode" readonly></textarea>
    <button id="copyBtn" class="copy-btn" onclick="copyCode()">ì½”ë“œ ë³µì‚¬í•˜ê¸° ğŸ“‹</button>
</div>

<script>
    function generateCode() {
        const title = document.getElementById('title').value;
        const answersStr = document.getElementById('answers').value.trim();
        const cutline = document.getElementById('cutline').value;
        const cooldown = document.getElementById('cooldown').value || 0;
        const maxAttempts = document.getElementById('maxAttempts').value || 0;

        if(!title || !answersStr) {
            alert("ì œëª©ê³¼ ì •ë‹µì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            return;
        }

        const answersArr = answersStr.split('').map(Number);
        if(answersArr.some(isNaN)) {
            alert("ì •ë‹µì—ëŠ” ìˆ«ìë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            return;
        }

        // ê³ ìœ  ID ìƒì„± (ìºì‹œ ê¼¬ì„ ë°©ì§€)
        const uniqueId = "daily_test_" + Date.now();

        const template = `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>${title}</title>
    <style>
        body{font-family:-apple-system,sans-serif;background:#f0f2f5;padding:15px;margin:0}
        .container{max-width:600px;margin:0 auto;background:#fff;padding:25px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,0.1)}
        .title { text-align: center; color: #333; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #666; font-size: 0.9rem; margin-bottom: 20px; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-weight: bold; margin-bottom: 5px; color: #444; }
        .input-group input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
        .q-list { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-bottom: 20px; }
        .q-item { text-align: center; }
        .q-num { font-size: 0.8rem; color: #888; margin-bottom: 3px; display: block; }
        .q-input { width: 100%; padding: 10px; text-align: center; border: 1px solid #ccc; border-radius: 5px; font-size: 1.1rem; font-weight: bold; box-sizing: border-box; }
        .btn-submit { display: block; width: 100%; padding: 15px; background: #2c3e50; color: #fff; border: none; border-radius: 10px; font-weight: bold; font-size: 1.2rem; cursor: pointer; }
        .btn-submit:disabled { background: #cfd8dc; color: #90a4ae; cursor: not-allowed; }
        .result-box { display: none; margin-top: 25px; padding: 20px; border-radius: 10px; text-align: center; }
        .pass { background: #e8f5e9; border: 2px solid #4caf50; color: #2e7d32; }
        .fail { background: #ffebee; border: 2px solid #ef5350; color: #c62828; }
        .timer-msg { text-align: center; color: #d32f2f; font-weight: bold; margin-top: 10px; display: none; }
    </style>
</head>
<body>
<div class="container">
    <h2 class="title">${title}</h2>
    <p class="subtitle">ì´ ${answersArr.length}ë¬¸í•­ / ${cutline}ê°œê¹Œì§€ í†µê³¼</p>
    <div class="input-group">
        <label>ì´ë¦„</label>
        <input type="text" id="studentName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
    </div>
    <div id="questionContainer" class="q-list"></div>
    <button id="submitBtn" class="btn-submit" onclick="checkAnswers()">ì±„ì í•˜ê¸°</button>
    <div id="timerMsg" class="timer-msg"></div>
    <div id="resultArea" class="result-box"></div>
</div>
<script>
    const correctAnswers = [${answersArr.join(', ')}];
    const passCriteria = ${cutline};
    const COOLDOWN_MINUTES = ${cooldown};
    const MAX_ATTEMPTS = ${maxAttempts};
    const STORAGE_KEY = "${uniqueId}";
    
    let attempt = 0;
    const totalQ = correctAnswers.length;

    window.onload = function() {
        // ë¬¸ì œ ìƒì„±
        const container = document.getElementById("questionContainer");
        let html = "";
        for(let i=1; i<=totalQ; i++) {
            html += '<div class="q-item"><span class="q-num">'+i+'ë²ˆ</span><input type="tel" class="q-input" id="a'+i+'" maxlength="1"></div>';
        }
        container.innerHTML = html;
        loadStatus();
    };

    function loadStatus() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if(saved) {
            const data = JSON.parse(saved);
            attempt = data.attempt || 0;
            if(data.name) document.getElementById("studentName").value = data.name;
            
            // ë„ì „ íšŸìˆ˜ ì´ˆê³¼ ì²´í¬
            if(MAX_ATTEMPTS > 0 && attempt >= MAX_ATTEMPTS) {
                disableForever();
                return;
            }

            // ëŒ€ê¸° ì‹œê°„ ì²´í¬
            if(COOLDOWN_MINUTES > 0 && data.lastSubmitTime) {
                const passed = (new Date().getTime() - data.lastSubmitTime) / 1000 / 60;
                if(passed < COOLDOWN_MINUTES) lockSubmit(COOLDOWN_MINUTES - passed);
            }
        }
    }

    function checkAnswers() {
        const name = document.getElementById("studentName").value;
        if(!name) return alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        
        attempt++;
        let wrongCount = 0;
        let wrongList = [];
        
        for(let i=0; i<totalQ; i++) {
            const userVal = document.getElementById('a'+(i+1)).value;
            if(!userVal || parseInt(userVal) !== correctAnswers[i]) {
                wrongCount++;
                wrongList.push((i+1) + "ë²ˆ");
                document.getElementById('a'+(i+1)).style.backgroundColor = "#ffebee";
            } else {
                document.getElementById('a'+(i+1)).style.backgroundColor = "#fff";
            }
        }

        // ì €ì¥
        const now = new Date().getTime();
        localStorage.setItem(STORAGE_KEY, JSON.stringify({ name: name, attempt: attempt, lastSubmitTime: now }));

        const resultDiv = document.getElementById("resultArea");
        resultDiv.style.display = "block";

        if(wrongCount <= passCriteria) {
            // í†µê³¼
            resultDiv.className = "result-box pass";
            resultDiv.innerHTML = "<h2>ğŸ‰ í†µê³¼!</h2><p><b>"+name+"</b> í•™ìƒ<br>í•˜ì›í•˜ì…”ë„ ì¢‹ìŠµë‹ˆë‹¤! ğŸ‘‹</p>";
            document.getElementById("submitBtn").style.display = "none"; // ë²„íŠ¼ ìˆ¨ê¹€
        } else {
            // ì‹¤íŒ¨
            let msg = "<div style='font-weight:bold;font-size:1.2rem'>ğŸ˜± "+wrongCount+"ê°œ í‹€ë ¸ì–´ìš”!</div>";
            msg += "<div style='margin-top:10px;font-size:0.9rem'><b>ì˜¤ë‹µ:</b><br>"+wrongList.join(", ")+"</div>";
            
            // ìµœëŒ€ íšŸìˆ˜ ì²´í¬
            if(MAX_ATTEMPTS > 0) {
                const remain = MAX_ATTEMPTS - attempt;
                if(remain <= 0) {
                    disableForever();
                    msg += "<br><b style='color:red'>ğŸš« ë„ì „ íšŸìˆ˜ ì´ˆê³¼! ì„ ìƒë‹˜ê»˜ ë¬¸ì˜í•˜ì„¸ìš”.</b>";
                } else {
                    msg += "<br>(ë‚¨ì€ ê¸°íšŒ: "+remain+"ë²ˆ)";
                    if(COOLDOWN_MINUTES > 0) lockSubmit(COOLDOWN_MINUTES);
                }
            } else {
                // ë¬´ì œí•œì¸ ê²½ìš° ëŒ€ê¸° ì‹œê°„ë§Œ ì²´í¬
                if(COOLDOWN_MINUTES > 0) lockSubmit(COOLDOWN_MINUTES);
            }
            
            resultDiv.className = "result-box fail";
            resultDiv.innerHTML = msg;
        }
    }

    function lockSubmit(remainMinutes) {
        const btn = document.getElementById("submitBtn");
        const msg = document.getElementById("timerMsg");
        btn.disabled = true;
        msg.style.display = "block";
        
        let seconds = Math.ceil(remainMinutes * 60);
        
        const interval = setInterval(() => {
            seconds--;
            if(seconds <= 0) {
                clearInterval(interval);
                btn.disabled = false;
                btn.innerText = "ì±„ì í•˜ê¸°";
                msg.style.display = "none";
            } else {
                btn.innerText = "â³ ëŒ€ê¸° ì¤‘ (" + Math.ceil(seconds) + "ì´ˆ)";
                msg.innerText = "â³ " + Math.ceil(seconds) + "ì´ˆ ë’¤ì— ë‹¤ì‹œ ì±„ì í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
            }
        }, 1000);
    }

    function disableForever() {
        const btn = document.getElementById("submitBtn");
        btn.disabled = true;
        btn.innerText = "ğŸš« ì œì¶œ ë¶ˆê°€";
        const msg = document.getElementById("timerMsg");
        msg.style.display = "block";
        msg.innerHTML = "<b style='color:red'>ë” ì´ìƒ ë„ì „í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>ì„ ìƒë‹˜ê»˜ í™•ì¸ì„ ë°›ìœ¼ì„¸ìš”.</b>";
    }
<\/script>
</body>
</html>`;

        document.getElementById('resultCode').value = template;
        document.getElementById('resultCode').style.display = "block";
        document.getElementById('copyBtn').style.display = "block";
    }

    function copyCode() {
        const copyText = document.getElementById("resultCode");
        copyText.select();
        document.execCommand("copy");
        alert("ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
    }
</script>
</body>
</html>