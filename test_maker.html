<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¼ì¼ í…ŒìŠ¤íŠ¸ ìƒì„±ê¸° V5 (ì „ëµì  í”¼ë“œë°±)</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f4f6f8; padding: 20px; max-width: 800px; margin: 0 auto; }
        .card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { margin-top: 0; color: #2c3e50; text-align: center; }
        .input-group { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; color: #555; }
        input[type="text"], input[type="number"] { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.3s; color: white; }
        .btn-gen { background: #2196f3; } .btn-gen:hover { background: #1976d2; }
        .btn-down { background: #4caf50; display: none; } .btn-down:hover { background: #388e3c; }
        
        textarea { width: 100%; height: 200px; margin-top: 20px; padding: 15px; border: 2px solid #ccc; border-radius: 8px; font-family: monospace; font-size: 0.9rem; display: none; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ­ ì¼ì¼ í…ŒìŠ¤íŠ¸ ê³µì¥ (V5)</h2>
    
    <div class="input-group">
        <label>1. ì‹œí—˜ ì œëª©</label>
        <input type="text" id="title" placeholder="ì˜ˆ: 1ì›” 13ì¼ ë¹„ë¬¸í•™ í…ŒìŠ¤íŠ¸">
    </div>

    <div class="input-group">
        <label>2. ì •ë‹µ (ìˆ«ìë§Œ ì—°ì† ì…ë ¥)</label>
        <input type="text" id="answers" placeholder="ì˜ˆ: 12345">
    </div>

    <div class="input-group">
        <label>3. í†µê³¼ ê¸°ì¤€ (í‹€ë ¤ë„ ë˜ëŠ” ê°œìˆ˜)</label>
        <input type="number" id="cutline" value="0">
    </div>

    <div class="input-group">
        <label>4. ì¬ë„ì „ ëŒ€ê¸° (ë¶„)</label>
        <input type="number" id="cooldown" value="0">
    </div>

    <div class="input-group">
        <label>5. ìµœëŒ€ ë„ì „ íšŸìˆ˜ (ì˜ˆ: 3)</label>
        <input type="number" id="maxAttempts" value="3">
    </div>

    <div class="btn-group">
        <button class="btn-gen" onclick="generateCode()">1. ì½”ë“œ ìƒì„±í•˜ê¸°</button>
        <button id="downloadBtn" class="btn-down" onclick="downloadFile()">2. íŒŒì¼ë¡œ ì €ì¥í•˜ê¸° (Click)</button>
    </div>
    
    <textarea id="resultCode" readonly></textarea>
</div>

<script>
    function generateCode() {
        const title = document.getElementById('title').value;
        const answersStr = document.getElementById('answers').value.trim();
        const cutline = document.getElementById('cutline').value;
        const cooldown = document.getElementById('cooldown').value || 0;
        const maxAttempts = document.getElementById('maxAttempts').value || 0;

        if(!title || !answersStr) { alert("ì œëª©ê³¼ ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”!"); return; }
        const answersArr = answersStr.split('').map(Number);
        if(answersArr.some(isNaN)) { alert("ì •ë‹µì€ ìˆ«ìë§Œ!"); return; }

        const uniqueId = "daily_" + Date.now();
        const template = `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>${title}</title>
    <style>
        body{font-family:-apple-system,sans-serif;background:#f0f2f5;padding:15px;margin:0}
        .container{max-width:600px;margin:0 auto;background:#fff;padding:25px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,0.1)}
        .title { text-align: center; color: #333; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #666; font-size: 0.9rem; margin-bottom: 20px; }
        
        .q-item { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee; display: flex; align-items: center; justify-content: space-between; }
        .q-num { font-weight: bold; color: #2196f3; width: 40px; }
        .omr-group { display: flex; gap: 8px; flex: 1; justify-content: space-around; }
        .omr-input { display: none; }
        .omr-label { width: 35px; height: 35px; border-radius: 50%; border: 2px solid #ddd; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #999; cursor: pointer; transition: 0.2s; }
        .omr-input:checked + .omr-label { background: #2196f3; border-color: #2196f3; color: white; }
        
        /* ì˜¤ë‹µ í‘œì‹œ (ì¡°ê±´ë¶€) */
        .show-wrong .wrong-row .omr-input:checked + .omr-label { background: #ef5350; border-color: #ef5350; }
        .show-wrong .wrong-row .q-num { color: #d32f2f; }

        .btn-submit { display: block; width: 100%; padding: 15px; background: #fee500; color: #3c1e1e; border: none; border-radius: 10px; font-weight: bold; font-size: 1.1rem; cursor: pointer; margin-top:20px; }
        .btn-submit:hover { background: #fdd835; }
        .btn-submit:disabled { background: #cfd8dc; color: #90a4ae; cursor: not-allowed; }
        
        .result-box { display: none; margin-top: 25px; padding: 20px; border-radius: 10px; text-align: center; background: #e3f2fd; }
        .pass { background: #e8f5e9; border: 2px solid #4caf50; color: #2e7d32; }
        .fail { background: #ffebee; border: 2px solid #ef5350; color: #c62828; }
        .timer-msg { text-align: center; color: #d32f2f; font-weight: bold; margin-top: 10px; display: none; }
    </style>
</head>
<body>
<div class="container">
    <h2 class="title">${title}</h2>
    <p class="subtitle">ì´ ${answersArr.length}ë¬¸í•­ / ${cutline}ê°œê¹Œì§€ í†µê³¼</p>
    
    <div style="margin-bottom:20px; background:#fafafa; padding:15px; border-radius:8px;">
        <label style="font-weight:bold">í•™ìƒ ì´ë¦„</label>
        <input type="text" id="studentName" style="width:100%;padding:10px;margin-top:5px;border:1px solid #ccc;border-radius:5px" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
    </div>

    <div id="questionContainer"></div>

    <button id="submitBtn" class="btn-submit" onclick="checkAnswers()">ğŸŸ¡ ì±„ì í•˜ê³  ì„ ìƒë‹˜ê»˜ ì¹´í†¡ ë³´ë‚´ê¸°</button>
    <div id="timerMsg" class="timer-msg"></div>
    <div id="resultArea" class="result-box"></div>
</div>

<script>
    const correctAnswers = [${answersArr.join(', ')}];
    const passCriteria = ${cutline};
    const COOLDOWN_MINUTES = ${cooldown};
    const MAX_ATTEMPTS = ${maxAttempts};
    const STORAGE_KEY = "${uniqueId}";
    let attempt = 0; 
    const totalQ = correctAnswers.length;

    window.onload = function() {
        let html = "";
        for(let i=1; i<=totalQ; i++) {
            html += '<div class="q-item" id="qRow'+i+'"><span class="q-num">'+i+'ë²ˆ</span><div class="omr-group">';
            for(let j=1; j<=5; j++) {
                html += '<input type="radio" name="q'+i+'" id="q'+i+'_'+j+'" value="'+j+'" class="omr-input"><label for="q'+i+'_'+j+'" class="omr-label">'+j+'</label>';
            }
            html += '</div></div>';
        }
        document.getElementById("questionContainer").innerHTML = html;
        loadStatus();
    };

    function loadStatus() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if(saved) {
            const data = JSON.parse(saved);
            attempt = data.attempt || 0;
            if(data.name) document.getElementById("studentName").value = data.name;
            if(MAX_ATTEMPTS > 0 && attempt >= MAX_ATTEMPTS) { disableForever(); return; }
            if(COOLDOWN_MINUTES > 0 && data.lastSubmitTime) {
                const passed = (new Date().getTime() - data.lastSubmitTime)/1000/60;
                if(passed < COOLDOWN_MINUTES) lockSubmit(COOLDOWN_MINUTES - passed);
            }
        }
    }

    function checkAnswers() {
        const name = document.getElementById("studentName").value;
        if(!name) return alert("ì´ë¦„ì„ ê¼­ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        for(let i=1; i<=totalQ; i++) if(!document.querySelector('input[name="q'+i+'"]:checked')) return alert(i + "ë²ˆ ë¬¸ì œë¥¼ ì•„ì§ ì•ˆ í’€ì—ˆìŠµë‹ˆë‹¤!");

        attempt++;
        let wrongCount = 0; 
        let wrongList = [];
        
        // ì±„ì 
        const container = document.getElementById("questionContainer");
        container.classList.remove("show-wrong"); // ì¼ë‹¨ ìˆ¨ê¹€

        for(let i=0; i<totalQ; i++) {
            const userVal = document.querySelector('input[name="q'+(i+1)+'"]:checked').value;
            const row = document.getElementById('qRow'+(i+1));
            row.classList.remove("wrong-row");
            if(parseInt(userVal) !== correctAnswers[i]) {
                wrongCount++; 
                wrongList.push((i+1)+"ë²ˆ");
                row.classList.add("wrong-row");
            } 
        }

        // ì €ì¥
        localStorage.setItem(STORAGE_KEY, JSON.stringify({ name: name, attempt: attempt, lastSubmitTime: new Date().getTime() }));

        const isPass = wrongCount <= passCriteria;
        const resultText = isPass ? "í†µê³¼! ğŸ‰" : "ì¬ì‹œí—˜ ğŸ˜±";
        
        // [ì„ ìƒë‹˜ìš©] ì¹´í†¡: í•­ìƒ ì˜¤ë‹µ ë¬¸í•­ í¬í•¨
        const kakaoMsg = "[ì¼ì¼í…ŒìŠ¤íŠ¸ ê²°ê³¼ Report]\\n\\ní•™ìƒ: " + name + " (" + attempt + "ì°¨ ì‹œë„)\\ní‹€ë¦° ê°œìˆ˜: " + wrongCount + "ê°œ\\ní‹€ë¦° ë¬¸í•­: " + (wrongList.length ? wrongList.join(", ") : "ì—†ìŒ") + "\\nê²°ê³¼: " + resultText;
        location.href = "kakaotalk://send?text=" + encodeURIComponent(kakaoMsg);

        // [í•™ìƒìš©] ê²°ê³¼ í™”ë©´