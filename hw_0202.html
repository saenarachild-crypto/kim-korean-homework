<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2월 2회차 주간 과제 - 김현석 국어</title>
    <meta property="og:title" content="김현석 국어 - 2월 2회차 주간 과제">
    <link rel="stylesheet" href="https://kim-korean.netlify.app/style.css">
</head>
<body>
    <div class="container">
        <h2>2월 2회차 주간 과제 (독서/문학)</h2>
        <div id="status-bar">기한: ~다음 주 화요일 24:00 (제출 3회 제한, 대기 3분)</div>
        
        <form id="quiz-form">
            <div class="info-input">
                <input type="text" id="student-id" placeholder="학번 (예: 10101)" required>
                <input type="text" id="student-name" placeholder="이름" required>
            </div>

            <div class="tab-menu">
                <button type="button" class="tab-btn active" onclick="switchTab('reading')">독서</button>
                <button type="button" class="tab-btn" onclick="switchTab('literature')">문학</button>
            </div>

            <div id="reading-section" class="quiz-section">
                <h3 class="section-title">독서 (지정 문항 외 입력 불가)</h3>
                <div id="reading-grid" class="quiz-grid"></div>
            </div>

            <div id="literature-section" class="quiz-section" style="display:none;">
                <h3 class="section-title">문학 (1~31번)</h3>
                <div id="literature-grid" class="quiz-grid"></div>
            </div>

            <button type="submit" id="submit-btn">제출 및 채점하기</button>
        </form>
    </div>

    <script>
        // 정답 데이터 적용
        const ansR = "414434455141123354353134123451513".split("");
        const ansL = "1342344245242425251244231412445".split("");
        
        // 독서 활성화 번호 (5-8, 13-30)
        const activeR = [5,6,7,8, 13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30];

        // 그리드 초기화
        function init() {
            const rGrid = document.getElementById('reading-grid');
            const lGrid = document.getElementById('literature-grid');

            for (let i = 1; i <= 33; i++) {
                const isAct = activeR.includes(i);
                rGrid.innerHTML += `
                    <div class="quiz-item ${isAct ? '' : 'disabled'}">
                        <span class="q-num">${i}</span>
                        <div class="options" data-type="R" data-q="${i}">
                            ${[1,2,3,4,5].map(n => `<button type="button" class="opt" data-val="${n}" ${isAct ? '' : 'disabled'}>${n}</button>`).join('')}
                        </div>
                    </div>`;
            }

            for (let i = 1; i <= 31; i++) {
                lGrid.innerHTML += `
                    <div class="quiz-item">
                        <span class="q-num">${i}</span>
                        <div class="options" data-type="L" data-q="${i}">
                            ${[1,2,3,4,5].map(n => `<button type="button" class="opt" data-val="${n}">${n}</button>`).join('')}
                        </div>
                    </div>`;
            }
        }

        function switchTab(type) {
            document.querySelectorAll('.quiz-section').forEach(s => s.style.display = 'none');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(type + '-section').style.display = 'block';
            event.currentTarget.classList.add('active');
        }

        document.addEventListener('click', e => {
            if (e.target.classList.contains('opt') && !e.target.disabled) {
                e.target.parentElement.querySelectorAll('.opt').forEach(o => o.classList.remove('selected'));
                e.target.classList.add('selected');
            }
        });

        document.getElementById('quiz-form').onsubmit = async (e) => {
            e.preventDefault();
            const id = document.getElementById('student-id').value;
            const name = document.getElementById('student-name').value;

            // 제한 로직
            const last = localStorage.getItem(`ts_${id}`);
            const cnt = parseInt(localStorage.getItem(`cn_${id}`) || 0);
            if (cnt >= 3) return alert("최대 제출 횟수(3회) 초과!");
            if (last && (Date.now() - last < 180000)) return alert("제출 후 3분이 지나야 재제출 가능합니다.");

            let rW = [], lW = [];
            activeR.forEach(num => {
                const sel = document.querySelector(`.options[data-type="R"][data-q="${num}"] .selected`);
                if (!sel || sel.dataset.val !== ansR[num-1]) rW.push(num);
            });
            for(let i=1; i<=31; i++) {
                const sel = document.querySelector(`.options[data-type="L"][data-q="${i}"] .selected`);
                if (!sel || sel.dataset.val !== ansL[i-1]) lW.push(i);
            }

            const totalQ = activeR.length + 31;
            const score = Math.round(((totalQ - (rW.length + lW.length)) / totalQ) * 100);

            // 구글 앱스크립트 주소 고정 사용
            await fetch("https://script.google.com/macros/s/AKfycbyM-8CmijrbV5PmgSebU_AP_lztEHlyNdXq7cRyfratLdj2y0BP9inAZJyING1oZiIt/exec", {
                method: 'POST', mode: 'no-cors',
                body: JSON.stringify({ title: "2월 2회차", id, name, score, wrong: `R:${rW.join(",")}/L:${lW.join(",")}` })
            });

            localStorage.setItem(`ts_${id}`, Date.now());
            localStorage.setItem(`cn_${id}`, cnt + 1);
            alert(`${name} 학생 제출 완료! (${score}점)`);
        };

        init();
    </script>
</body>
</html>