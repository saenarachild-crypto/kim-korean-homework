<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ê°„ ê³¼ì œ ìƒì„±ê¸° V13.1 (ê°ê´€ì‹í˜•)</title>
    <script>
        // ì„ ìƒë‹˜ì˜ êµ¬ê¸€ ì—‘ì…€ ì£¼ì†Œ (ê¸°ì¡´ test_makerì™€ ë™ì¼) 
        const MY_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwUKboETdm3mXl2PgJiL1EzbyWEijF4juH4u_xry0oDKZLsPYeHkS4V1wlrP-0R5Sk/exec"; [cite: 5]
    </script>
    <style>
        /* ë°”íƒ•ìƒ‰ì„ íŒŒë€ìƒ‰ ê³„ì—´ë¡œ ë³€ê²½ */
        body { font-family: -apple-system, sans-serif; background: #e3f2fd; padding: 20px; max-width: 800px; margin: 0 auto; }
        /* í…Œë‘ë¦¬ í¬ì¸íŠ¸ë¥¼ íŒŒë€ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
        .card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-top: 5px solid #2196f3; }
        h2 { margin-top: 0; color: #1976d2; text-align: center; }
        .input-group { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; color: #555; }
        input[type="text"], input[type="number"], textarea { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
        textarea { height: 80px; resize: vertical; }
        .help-text { font-size: 0.85rem; color: #888; margin-top: 5px; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        button { flex: 1; padding: 15px; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.3s; color: white; min-width: 150px; }
        /* ë²„íŠ¼ ìƒ‰ìƒì„ íŒŒë€ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
        .btn-gen { background: #2196f3; } .btn-gen:hover { background: #1976d2; }
        .btn-down { background: #636e72; } .btn-down:hover { background: #2d3436; }
        
        #resultCode { width: 100%; height: 150px; margin-top: 20px; padding: 15px; border: 2px solid #ccc; border-radius: 8px; font-family: monospace; font-size: 0.9rem; display: none; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ“˜ ì£¼ê°„ ê³¼ì œ ê³µì¥ (V13.1 í†µí•©í˜•)</h2>
    
    <div class="input-group">
        <label>1. ê³¼ì œ ì œëª©</label>
        <input type="text" id="title" placeholder="ì˜ˆ: 1ì›” 2ì£¼ì°¨ ì£¼ê°„ ê³¼ì œ [ë…ì„œ]">
    </div>

    <div class="input-group">
        <label>2. ê³µì§€ì‚¬í•­</label>
        <textarea id="notice" placeholder="ì˜ˆ: ìƒë‹¨ ë²„íŠ¼ì„ ëˆŒëŸ¬ ê³¼ì œë¬¼ì„ ë³´ê³  í‘¸ì„¸ìš”."></textarea>
    </div>

    <div class="input-group">
        <label>3. ê³¼ì œë¬¼ ë§í¬ (íŒŒì¼ëª… ë˜ëŠ” URL)</label>
        <input type="text" id="testLink" placeholder="ì˜ˆ: homework.pdf ë˜ëŠ” https://...">
        <div class="help-text">â€» ê°™ì€ í´ë” íŒŒì¼ì´ë©´ íŒŒì¼ëª…ë§Œ, ì•„ë‹ˆë©´ ì£¼ì†Œ ì „ì²´ ì…ë ¥</div>
    </div>

    <div class="input-group">
        <label>4. ì •ë‹µ ë° í•´ì„¤ì§€ ë§í¬ (í†µê³¼ ì‹œ ê³µê°œ)</label>
        <input type="text" id="answerLink" placeholder="ì˜ˆ: answer.pdf ë˜ëŠ” https://...">
    </div>

    <div class="input-group">
        <label>5. ì •ë‹µ ì…ë ¥ (ìˆ«ìë§Œ ì—°ì† ì…ë ¥)</label>
        <input type="text" id="answers" placeholder="ì˜ˆ: 12345">
    </div>

    <div class="input-group">
        <label>6. ì„¤ì • (í†µê³¼ê¸°ì¤€ / ëŒ€ê¸°ë¶„ / ê¸°íšŒ)</label>
        <div style="display:flex; gap:10px;">
            <input type="number" id="cutline" value="0" placeholder="ì˜¤ë‹µí—ˆìš©">
            <input type="number" id="cooldown" value="0" placeholder="ëŒ€ê¸°(ë¶„)">
            <input type="number" id="maxAttempts" value="3" placeholder="ê¸°íšŒ(íšŒ)">
        </div>
    </div>

    <div class="btn-group">
        <button class="btn-gen" onclick="generateCode()">1. ì½”ë“œ ìƒì„±í•˜ê¸°</button>
        <button id="downloadBtn" class="btn-down" onclick="downloadFile()" style="display:none;">2. íŒŒì¼ë¡œ ì €ì¥í•˜ê¸°</button>
    </div>
    
    <textarea id="resultCode" readonly></textarea>
</div>

<script>
    // ê¸°ì¡´ test_maker.htmlì˜ ëª¨ë“  ë¡œì§ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤ 
    function generateCode() {
        const title = document.getElementById('title').value; 
        const notice = document.getElementById('notice').value.replace(/\n/g, '<br>'); 
        const testLink = document.getElementById('testLink').value.trim(); 
        const answerLink = document.getElementById('answerLink').value.trim(); 
        const answersStr = document.getElementById('answers').value.trim(); 
        const cutline = document.getElementById('cutline').value || 0; 
        const cooldown = document.getElementById('cooldown').value || 0; 
        const maxAttempts = document.getElementById('maxAttempts').value || 3; 

        if(!title || !answersStr) { alert("ì œëª©ê³¼ ì •ë‹µì€ í•„ìˆ˜ì…ë‹ˆë‹¤!"); return; } 

        const cleanAnswers = answersStr.replace(/[^0-9]/g, ""); 
        const answersArr = cleanAnswers.split('').map(Number); 
        const uniqueId = "weekly_" + Date.now(); 

        const template = `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>\${title}</title>
    <style>
        body{font-family:-apple-system,sans-serif;background:#f0f2f5;padding:15px;margin:0}
        .container{max-width:600px;margin:0 auto;background:#fff;padding:25px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,0.1)}
        .header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #f0f0f0; padding-bottom: 15px; }
        .title { margin: 5px 0; color: #333; }
        .notice-box { background: #e3f2fd; border: 1px solid #bbdefb; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 0.95rem; line-height: 1.5; color: #0d47a1; }
        .link-btn { display: block; width: 100%; text-align: center; padding: 12px; border-radius: 8px; text-decoration: none; font-weight: bold; margin-bottom: 10px; transition: 0.2s; box-sizing: border-box; }
        .btn-test { background: #1976d2; color: white; }
        .btn-ans { background: #4caf50; color: white; margin-top: 15px; }
        .q-item { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee; display: flex; align-items: center; justify-content: space-between; }
        .q-num { font-weight: bold; color: #1976d2; width: 40px; }
        .omr-group { display: flex; gap: 8px; flex: 1; justify-content: space-around; }
        .omr-input { display: none; }
        .omr-label { width: 35px; height: 35px; border-radius: 50%; border: 2px solid #ddd; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #999; cursor: pointer; transition: 0.2s; }
        .omr-input:checked + .omr-label { background: #1976d2; border-color: #1976d2; color: white; }
        .btn-submit { display: block; width: 100%; padding: 15px; background: #2196f3; color: white; border: none; border-radius: 10px; font-weight: bold; font-size: 1.1rem; cursor: pointer; margin-top:20px; }
        .result-box { display: none; margin-top: 25px; padding: 20px; border-radius: 10px; text-align: center; background: #e3f2fd; }
        input[type=text] { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
    </style>
</head>
<body>
<div class="container">
    <div class="header"><h2 class="title">\${title}</h2></div>
    \${testLink ? \`<a href="\${testLink}" class="link-btn btn-test" target="_blank">ğŸ“„ ì£¼ê°„ ê³¼ì œë¬¼ ë³´ê¸° (Click)</a>\` : ''}
    \${notice ? \`<div class="notice-box">ğŸ“¢ <b>ì•ˆë‚´ì‚¬í•­</b><br>\${notice}</div>\` : ''}
    <div style="margin-bottom:20px; background:#fafafa; padding:15px; border-radius:8px;">
        <label style="font-weight:bold; color:#1976d2;">ğŸ« í•™ì› ì´ë¦„ (í•„ìˆ˜)</label>
        <input type="text" id="academySelect" placeholder="ì˜ˆ: ëŸ¬ì…€ë¶„ë‹¹, ì‹œëŒ€ì¸ì¬ (ì •í™•íˆ ì…ë ¥)">
        <label style="font-weight:bold; margin-top:10px; display:block;">ğŸ‘¤ í•™ìƒ ì´ë¦„</label>
        <input type="text" id="studentName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
    </div>
    <div id="questionContainer"></div>
    <button id="submitBtn" class="btn-submit" onclick="checkAnswers()">ğŸ“ ê³¼ì œ ì œì¶œ ë° ì±„ì </button>
    <div id="resultArea" class="result-box"></div>
</div>
<script>
    const SCRIPT_URL = "${MY_SCRIPT_URL}"; [cite: 5]
    const correctAnswers = [\${answersArr.join(', ')}]; [cite: 5]
    const passCriteria = \${cutline}; [cite: 5]
    const ANSWER_LINK = "\${answerLink}"; [cite: 5]
    const totalQ = correctAnswers.length; [cite: 5]

    window.onload = function() {
        let html = "";
        for(let i=1; i<=totalQ; i++) {
            html += '<div class="q-item"><span class="q-num">'+i+'ë²ˆ</span><div class="omr-group">';
            for(let j=1; j<=5; j++) {
                html += '<input type="radio" name="q'+i+'" id="q'+i+'_'+j+'" value="'+j+'" class="omr-input"><label for="q'+i+'_'+j+'" class="omr-label">'+j+'</label>';
            }
            html += '</div></div>';
        }
        document.getElementById("questionContainer").innerHTML = html;
    };

    function checkAnswers() {
        const name = document.getElementById("studentName").value.trim(); [cite: 5]
        const academy = document.getElementById("academySelect").value.trim(); [cite: 5]
        if(!name || !academy) return alert("ì´ë¦„ê³¼ í•™ì›ëª…ì„ ì…ë ¥í•˜ì„¸ìš”!"); [cite: 5]
        
        let wrong = 0; [cite: 5]
        for(let i=1; i<=totalQ; i++) {
            const r = document.querySelector('input[name="q'+i+'"]:checked'); [cite: 5]
            if(!r || parseInt(r.value) !== correctAnswers[i-1]) wrong++; [cite: 5]
        }

        const data = { type: "weekly", title: document.title, academy: academy, name: name, score: totalQ-wrong, total: totalQ, wrongCount: wrong }; [cite: 5]
        fetch(SCRIPT_URL + "?data=" + btoa(unescape(encodeURIComponent(JSON.stringify(data)))), { mode: 'no-cors' }); [cite: 5]

        const res = document.getElementById("resultArea"); [cite: 5]
        res.style.display = "block"; [cite: 5]
        res.innerHTML = "<h3>ğŸ‰ ê³¼ì œ ì œì¶œ ì™„ë£Œ!</h3><p>í‹€ë¦° ê°œìˆ˜: \" + wrong + \"ê°œ</p>"; [cite: 5]
        if(wrong <= passCriteria && ANSWER_LINK) { [cite: 5]
            res.innerHTML += '<a href="' + ANSWER_LINK + '" class="link-btn btn-ans" target="_blank">ğŸ“˜ ì •ë‹µ ë° í•´ì„¤ ë³´ëŸ¬ê°€ê¸°</a>'; [cite: 5]
        }
    }
<\\/script>
</body>
</html>\`;

        document.getElementById('resultCode').value = template; 
        document.getElementById('resultCode').style.display = "block"; 
        document.getElementById('downloadBtn').style.display = "block"; 
        alert("ì½”ë“œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ì•„ë˜ '2. íŒŒì¼ë¡œ ì €ì¥í•˜ê¸°' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.");
    }

    function downloadFile() {
        const content = document.getElementById('resultCode').value; 
        const today = new Date(); 
        const filename = "Weekly_" + String(today.getMonth()+1).padStart(2,'0') + String(today.getDate()).padStart(2,'0') + ".html"; 
        const blob = new Blob([content], { type: 'text/html' }); 
        const link = document.createElement('a'); 
        link.href = URL.createObjectURL(blob); 
        link.download = filename; 
        link.click(); 
    }
</script>
</body>
</html>