<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ê°„ ê³¼ì œ ìƒì„±ê¸° V13.1 (ì—‘ì…€ ì—°ë™í˜•)</title>
    <script>
        // ğŸš¨ ì„ ìƒë‹˜ì˜ êµ¬ê¸€ ìŠ¤í¬ë¦½íŠ¸ ì£¼ì†Œ (ìë™ìœ¼ë¡œ ì‹¬ì–´ë“œë ¸ìŠµë‹ˆë‹¤!)
        const MY_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwUKboETdm3mXl2PgJiL1EzbyWEijF4juH4u_xry0oDKZLsPYeHkS4V1wlrP-0R5Sk/exec";
    </script>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f4f4f9; padding: 20px; display: flex; justify-content: center; }
        .container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 600px; border-top: 5px solid #4a90e2; }
        h2 { text-align: center; color: #333; margin-bottom: 20px; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        textarea { height: 100px; resize: vertical; }
        .btn-group { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        button { flex: 1; padding: 15px; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.3s; color: white; min-width: 150px; }
        .btn-gen { background: #4a90e2; } .btn-gen:hover { background: #357abd; }
        .btn-down { background: #28a745; } .btn-down:hover { background: #218838; }
        #resultCode { width: 100%; height: 150px; margin-top: 20px; padding: 15px; border: 2px solid #ccc; border-radius: 8px; font-family: monospace; font-size: 0.9rem; display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h2>ğŸ“… ì£¼ê°„ ê³¼ì œ ê³µì¥ (V13.1 í†µí•©í˜•)</h2>
        
        <div class="input-group">
            <label>1. ê³¼ì œ ì œëª© (ì—‘ì…€ ì œëª©ê³¼ ë˜‘ê°™ì´!)</label>
            <input type="text" id="assignTitle" placeholder="ì˜ˆ: 1ì›” 2ì£¼ì°¨ ê³¼ì œ">
        </div>

        <div class="input-group">
            <label>2. ì§€ë¬¸ / ë³´ê¸° (ë‚´ìš© ì…ë ¥)</label>
            <textarea id="passage" placeholder="ì§€ë¬¸ì´ë‚˜ <ë³´ê¸°> ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
        </div>

        <div class="input-group">
            <label>3. ë¬¸ì œ ë‚´ìš©</label>
            <textarea id="questions" placeholder="1. ë¬¸ì œ ë‚´ìš©...&#10;2. ë¬¸ì œ ë‚´ìš©..." style="height: 150px;"></textarea>
        </div>

        <div class="btn-group">
            <button class="btn-gen" onclick="generateCode()">1. ì½”ë“œ ìƒì„±í•˜ê¸°</button>
            <button id="downloadBtn" class="btn-down" onclick="downloadFile()" style="display:none;">2. íŒŒì¼ë¡œ ì €ì¥í•˜ê¸°</button>
        </div>

        <textarea id="resultCode" readonly></textarea>
    </div>

    <script>
        function generateCode() {
            const title = document.getElementById('assignTitle').value.trim();
            const passage = document.getElementById('passage').value.replace(/\n/g, '<br>');
            const questions = document.getElementById('questions').value.replace(/\n/g, '<br>');

            if (!title) { alert("ê³¼ì œ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }

            const template = `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${title}</title>
    <style>
        body{font-family:'Noto Sans KR',sans-serif;background:#f0f2f5;padding:20px;margin:0;line-height:1.6}
        .container{max-width:700px;margin:0 auto;background:#fff;padding:30px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,0.1)}
        h2{text-align:center;color:#333;margin-bottom:20px;border-bottom:2px solid #eee;padding-bottom:15px}
        .content-box{background:#fafafa;padding:20px;border-radius:10px;border:1px solid #eee;margin-bottom:20px}
        .question-box{white-space:pre-line;margin-bottom:20px;font-weight:500;color:#2c3e50}
        input[type=text]{width:100%;padding:12px;margin-top:5px;margin-bottom:15px;border:1px solid #ccc;border-radius:8px;box-sizing:border-box}
        .btn-submit{width:100%;padding:15px;background:#4a90e2;color:white;border:none;border-radius:10px;font-size:1.1rem;font-weight:bold;cursor:pointer;margin-top:20px}
        .btn-submit:hover{background:#357abd}
        .success-msg{display:none;text-align:center;margin-top:20px;padding:20px;background:#e8f5e9;color:#2e7d32;border-radius:10px;font-weight:bold}
        .academy-alert { font-size: 12px; color: #d32f2f; margin-top: -10px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>${title}</h2>
        
        <div style="background:#fff3e0;padding:15px;border-radius:8px;margin-bottom:20px;border:1px solid #ffe0b2;">
            <label style="font-weight:bold;color:#e65100">ğŸ« í•™ì› ì´ë¦„ ì…ë ¥ (í•„ìˆ˜)</label>
            <input type="text" id="academySelect" placeholder="ì˜ˆ: ëŸ¬ì…€ë¶„ë‹¹, ì‹œëŒ€ì¸ì¬ (ì •í™•íˆ ì…ë ¥)">
            <div class="academy-alert">â€» ì„ ìƒë‹˜ì´ ê³µì§€í•œ í•™ì›ëª…ì„ ë„ì–´ì“°ê¸°ê¹Œì§€ ì •í™•í•˜ê²Œ ì…ë ¥í•˜ì„¸ìš”!</div>
            
            <label style="font-weight:bold;display:block;margin-top:10px">ğŸ‘¤ í•™ìƒ ì´ë¦„</label>
            <input type="text" id="studentName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
        </div>

        ${passage ? `<div class="content-box"><strong>[ì§€ë¬¸ / ë³´ê¸°]</strong><br>${passage}</div>` : ''}
        ${questions ? `<div class="question-box">${questions}</div>` : ''}

        <button id="submitBtn" class="btn-submit" onclick="submitHomework()">âœ… ê³¼ì œ í™•ì¸ ë° ì œì¶œí•˜ê¸°</button>
        <div id="successMsg" class="success-msg"></div>
    </div>

    <script>
        const SCRIPT_URL = "${MY_SCRIPT_URL}";

        function submitHomework() {
            const name = document.getElementById("studentName").value.trim();
            const academy = document.getElementById("academySelect").value.trim();

            if(!academy) return alert("í•™ì› ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            if(!name) return alert("í•™ìƒ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");

            // ë²„íŠ¼ ë¹„í™œì„±í™” (ì¤‘ë³µ ì œì¶œ ë°©ì§€)
            const btn = document.getElementById("submitBtn");
            btn.disabled = true;
            btn.innerText = "â³ ì œì¶œ ì¤‘ì…ë‹ˆë‹¤...";

            // ì—‘ì…€ë¡œ ì „ì†¡ ë°ì´í„° ì¤€ë¹„
            const sendData = {
                type: "weekly",  // ì£¼ê°„ ê³¼ì œ íƒ€ì…
                title: document.title,
                academy: academy,
                name: name,
                score: 100, // ê³¼ì œëŠ” ì œì¶œí•˜ë©´ 100ì (ì™„ë£Œ) ì²˜ë¦¬
                total: 1,
                wrongCount: 0
            };

            // ì „ì†¡ (no-cors ëª¨ë“œ)
            const finalUrl = SCRIPT_URL + "?data=" + btoa(unescape(encodeURIComponent(JSON.stringify(sendData))));
            fetch(finalUrl, { mode: 'no-cors' })
                .then(() => {
                    document.getElementById("successMsg").innerHTML = "<h2>ğŸ‰ ì œì¶œ ì™„ë£Œ!</h2><p>ì„ ìƒë‹˜ ì—‘ì…€ì— ì œì¶œ í™•ì¸ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.<br>ìˆ˜ê³ í–ˆì–´ìš”!</p>";
                    document.getElementById("successMsg").style.display = "block";
                    btn.style.display = "none";
                })
                .catch(err => {
                    alert("ì „ì†¡ ì‹¤íŒ¨! ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”.");
                    btn.disabled = false;
                    btn.innerText = "âœ… ê³¼ì œ í™•ì¸ ë° ì œì¶œí•˜ê¸°";
                });
        }
    <\/script>
</body>
</html>`;
            document.getElementById('resultCode').value = template;
            document.getElementById('resultCode').style.display = "block";
            document.getElementById('downloadBtn').style.display = "block";
        }

        function downloadFile() {
            const content = document.getElementById('resultCode').value;
            if(!content) { alert("ë¨¼ì € ì½”ë“œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”!"); return; }
            const today = new Date();
            const filename = "Homework_" + String(today.getMonth()+1).padStart(2,'0') + String(today.getDate()).padStart(2,'0') + ".html";
            const blob = new Blob([content], { type: 'text/html' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
            alert("íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œ ë˜ì—ˆìŠµë‹ˆë‹¤! ("+filename+")");
        }
    </script>
</body>
</html>