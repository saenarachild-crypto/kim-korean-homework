<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>1êµì‹œ ê¹€í˜„ì„ êµ­ì–´ â€“ ìµœì¢…</title>
<link rel="icon" href="https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpeg">
<script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"></script>
<script src="https://www.gstatic.com/charts/loader.js"></script>
<style>
:root{--p:#6c5ce7;--bg:#f8f9fc;--border:#e2e8f0;--accent:#ff7675}
body{background:var(--bg);font-family:Pretendard,system-ui;margin:0;padding:15px;color:#2d3436;-webkit-tap-highlight-color:transparent}
.container{max-width:500px;margin:0 auto;background:#fff;padding:25px;border-radius:30px;box-shadow:0 10px 40px rgba(0,0,0,.03)}
.header-logo{text-align:center;margin-bottom:20px}.header-logo img{width:100%;max-width:300px;border-radius:15px}
.wait-banner{background:#fff200;color:#000;text-align:center;padding:15px;border-radius:15px;font-weight:900;font-size:1.1em;margin-bottom:15px;display:none;border:3px solid #000}
.notice-card{background:#fff9f0;padding:18px;border-radius:20px;border:2px dashed #ffcc80;margin-bottom:20px}.notice-card p{margin:0;font-size:0.95em;line-height:1.6;color:#555}
.input-grid{display:flex;gap:10px;margin-bottom:20px}input{flex:1;padding:15px;border:1px solid var(--border);border-radius:15px;font-size:16px;text-align:center;outline:none}
select{width:100%;padding:12px;border-radius:12px;border:1px solid #c3b9ff;font-weight:700;color:var(--p);background:#fff;margin-bottom:10px}
.pdf-btn,.main-btn{width:100%;padding:18px;border-radius:20px;font-weight:800;border:none;cursor:pointer;box-sizing:border-box}
.pdf-btn{background:#2d3436;color:#fff;margin-bottom:20px;display:block;text-align:center;text-decoration:none}
.main-btn{background:var(--p);color:#fff}.q-card{border:1px solid var(--border);border-radius:20px;padding:20px;margin-bottom:15px;background:#fff}
.ans-row{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}input[type=radio]{display:none}
label{height:45px;border:1px solid var(--border);border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:700;cursor:pointer}
input:checked+label{background:var(--p);color:#fff}
#resultModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:2000;overflow-y:auto;padding:15px;box-sizing:border-box}
.modal-content{background:#fff;border-radius:30px;padding:25px;max-width:500px;margin:20px auto}
#chart_div{width:100%;height:200px;margin:15px 0}.wrong-box{background:#fff0f0;padding:15px;border-radius:12px;color:#c0392b;font-weight:700;margin:15px 0;line-height:1.6;font-size:0.9em;word-break:break-all}
</style>
</head>
<body>
<div class="container">
    <div id="introPage">
        <div class="header-logo"><img src="https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpeg"></div>
        <div class="notice-card"><p>ì‹œí—˜ì§€ë¥¼ ì„ íƒí•˜ê³  ìì •ê¹Œì§€ ì œì¶œí•˜ì„¸ìš”. ë¯¸ì œì¶œ ì‹œ ë¶„ì„ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.</p></div>
        <div class="input-grid"><input id="academy" placeholder="í•™ì›ëª…"><input id="name" placeholder="í•™ìƒ ì´ë¦„"></div>
        <button class="main-btn" onclick="checkServerBeforeStart()">ë³¸ì¸ í™•ì¸ ì™„ë£Œ (ê³¼ì œ ì‹œì‘)</button>
    </div>
    <div id="examPage" style="display:none;">
        <div class="header-logo"><img src="https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpeg"></div>
        <div id="waitDisplay" class="wait-banner"></div>
        <div class="notice-card"><p id="examNotice"></p></div>
        <select id="examSelect" onchange="loadExam()"></select>
        <button class="pdf-btn" onclick="openPdf()">ğŸ“„ ì›ë³¸ ë¬¸ì œì§€ ë³´ê¸°</button>
        <div id="qBox"></div>
        <button class="main-btn" id="submitBtn" onclick="submit()">ì œì¶œ ë° ì„œë²„ ì±„ì </button>
        <button class="main-btn" id="kakaoBtn" onclick="share()" style="display:none;background:#fee500;color:#3c1e1e">ğŸŸ¡ ì¹´í†¡ ì „ì†¡ í›„ ê²°ê³¼ í™•ì¸</button>
        <button class="main-btn" id="reviewBtn" style="display:none;background:#2f3542;" onclick="showLastResult()">ğŸ“Š ìµœì¢… ë¦¬í¬íŠ¸ ë‹¤ì‹œ ë³´ê¸°</button>
    </div>
</div>
<div id="resultModal"><div class="modal-content"><h2 style="text-align:center;">ğŸ“Š ë¦¬í¬íŠ¸</h2><div id="resSummary" style="font-weight:800; margin:20px 0; font-size:1.3em; text-align:center;"></div><div id="historyArea" style="display:none;"><div id="chart_div"></div><p style="font-size:0.8em; color:#666; text-align:center;">* ìœ„ë¡œ ê°ˆìˆ˜ë¡ ì„±ì ì´ ì¢‹ì•„ì§€ëŠ” ê·¸ë˜í”„ì…ë‹ˆë‹¤.</p></div><div id="solArea"></div><button class="main-btn" style="background:#f1f2f6; color:#333; margin-top:20px;" onclick="closeModal()">ê²°ê³¼ì°½ ë‹«ê¸°</button></div></div>

<script>
google.charts.load('current',{packages:['corechart']});
const KAKAO_KEY="f81d5eae0eaaf6fa2d0bdccbe6916001", GAS_URL="https://script.google.com/macros/s/AKfycbxtPu2ZsmP7HOt93FGri3W86YV7i0U-71BbAl9cXclpxZJGTXcSE8ejOwuv8RTdE0bP/exec";
if(!Kakao.isInitialized()) Kakao.init(KAKAO_KEY);

const EXAMS={
  "1ì›” 3íšŒì°¨ ë¬¸í•™":{ id:"2601_03_LIT", wait:1, notice:"ì „ ë¬¸í•­ ëª¨ë‘ í’€ ê²ƒ. ê¸°í•œ: 1/26 ìì •", pdf:"https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQB_NRszigFmTrQISqktkybTAQWFrLd2IPO-oUtUWmZJ6wM?e=SxadQk", all:Array.from({length:31},(_,i)=>i+1), active:Array.from({length:31},(_,i)=>i+1) },
  "1ì›” 3íšŒì°¨ ë…ì„œ":{ id:"2601_03_READING", wait:5, notice:"ì§€ì • ë¬¸í•­ë§Œ í’€ ê²ƒ. ê¸°í•œ: 1/26 ìì •", pdf:"https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQC5xf-Z-XrcRKZRHFK77VR1AR04L4r74w6r8sNvYB7-j5c?e=gzGNQR", all:Array.from({length:42},(_,i)=>i+1), active:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,21,22,23,24,25,26,27,28,29,30,37,38,39] },
  "í•´ì„¤ì§€":{ sol:"https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQC55ZuoL-2GSrdGKtWFXkzyARIkd0dBWnPkWxekrIjZznY?e=Z182ND" }
};
let serverRes=null, waitInt=null;
const sel=document.getElementById("examSelect");
Object.keys(EXAMS).filter(k=>k!=="í•´ì„¤ì§€").forEach(k=>{let o=document.createElement("option");o.text=k;sel.add(o)});

function getUserKey() { return `v76.6_${sel.value}_${document.getElementById('name').value.trim()}`; }

async function checkServerBeforeStart(){
    const name=document.getElementById("name").value.trim(), academy=document.getElementById("academy").value.trim();
    if(!name||!academy) return alert("í•™ì›ëª…/ì´ë¦„ ì…ë ¥!");
    const btn=event.target; btn.disabled=true; btn.innerText="ë™ê¸°í™” ì¤‘...";
    try {
        const res=await fetch(GAS_URL+"?check=true&name="+encodeURIComponent(name)+"&examId="+EXAMS[sel.value].id);
        const data=await res.json();
        if(data.finished){ localStorage.setItem('finished_'+getUserKey(), 'true'); localStorage.setItem('last_res_'+getUserKey(), JSON.stringify(data.lastRes)); }
        document.getElementById("introPage").style.display="none"; document.getElementById("examPage").style.display="block"; loadExam();
    } catch(e){ document.getElementById("introPage").style.display="none"; document.getElementById("examPage").style.display="block"; loadExam(); }
}

function loadExam(){
    const e=EXAMS[sel.value]; document.getElementById("examNotice").innerText=e.notice;
    if(localStorage.getItem('finished_'+getUserKey())==='true'){ lockExam(); return; }
    let h=""; e.all.forEach(n=>{
        const act=e.active.includes(n);
        h+=`<div class="q-card" style="${act?'':'opacity:0.3;pointer-events:none'}"><b>${n}ë²ˆ</b><div class="ans-row">`;
        for(let j=1;j<=5;j++) h+=`<input type=radio name=q${n} id=q${n}_${j} value=${j} ${act?'':'disabled'}><label for=q${n}_${j}>${j}</label>`;
        h+=`</div></div>`;
    });
    document.getElementById("qBox").innerHTML=h; checkGlobalWait();
}

async function submit(){
    const e=EXAMS[sel.value], answers=[];
    e.all.forEach(n=>{ answers.push(document.querySelector(`input[name=q${n}]:checked`)?.value||0); });
    const btn=document.getElementById("submitBtn"); btn.disabled=true; btn.innerText="ì±„ì  ì¤‘...";
    try {
        const res=await fetch(GAS_URL,{method:"POST",body:JSON.stringify({examId:e.id,name:document.getElementById("name").value.trim(),academy:document.getElementById("academy").value.trim(),answers})});
        serverRes=await res.json(); btn.style.display="none"; document.getElementById("kakaoBtn").style.display="block";
    } catch(e){ alert("ì±„ì  ì˜¤ë¥˜ ë°œìƒ. ë°ì´í„° í™•ì¸ í•„ìš”."); btn.disabled=false; btn.innerText="ì œì¶œ ë° ì„œë²„ ì±„ì "; }
}

function share(){
    const name=document.getElementById("name").value, academy=document.getElementById("academy").value, att=serverRes.try||1;
    let msg = att===1 ? `[${academy} ${name} 1íšŒ ë„ì „ ì™„ë£Œ - ìŠ¤ìŠ¤ë¡œë¥¼ ì˜ì‹¬í•˜ë¼. í‹€ë¦° ë¬¸í•­ì„ ì •í™•íˆ ì°¾ì•„ë³´ì.]`
            : att===2 ? `[${academy} ${name} 2íšŒ ë„ì „ ì™„ë£Œ - í‹€ë¦° ë¬¸í•­ì„ ì•Œë ¤ì£¼ë§ˆ. ë°±ì ì„ ê³ ë¯¼í•˜ë¼.]`
            : `[${academy} ${name} 3íšŒ ë„ì „ ì™„ë£Œ - ì™”ë‹¤! ì •ë‹µ ë° í•´ì„¤. ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤. ë³µìŠµë§Œì´ ì‚´ê¸¸ì…ë‹ˆë‹¤.]`;
    const obj={ objectType:"text", text:msg, link:{mobileWebUrl:location.href, webUrl:location.href} };
    if(att>=3) obj.buttons=[{title:"ê²°ê³¼ ë³´ê¸°", link:{mobileWebUrl:location.href+"?viewResult=true", webUrl:location.href+"?viewResult=true"}}];
    
    // ğŸ›¡ï¸ [í•´ê²°] ëª¨ë“  ë¸Œë¼ìš°ì €ì—ì„œ ë§‰í˜ì—†ì´ ì‘ë™í•˜ëŠ” í‘œì¤€ ë°©ì‹
    Kakao.Share.sendDefault(obj);
    setTimeout(()=>{ if(confirm("ì„ ìƒë‹˜ê»˜ ì¹´í†¡ ì „ì†¡ ì™„ë£Œí•˜ì…¨ìŠµë‹ˆê¹Œ?")){ 
        displayResult(); document.getElementById('resultModal').style.display='block';
        if(att<3) localStorage.setItem('wait_until_'+getUserKey(), Date.now()+(EXAMS[sel.value].wait*60000));
        else { localStorage.setItem('finished_'+getUserKey(), 'true'); localStorage.setItem('last_res_'+getUserKey(), JSON.stringify(serverRes)); }
    }}, 1500);
}

function displayResult(){
    const att=serverRes.try||1, count=serverRes.wrongCount||0;
    document.getElementById('resSummary').innerHTML=`í‹€ë¦° ê°œìˆ˜: <span style="color:var(--accent)">${count}ê°œ</span><br>(${att}íšŒì°¨ ì œì¶œ ì™„ë£Œ)`;
    if(att>=3){
        document.getElementById('historyArea').style.display='block';
        document.getElementById('solArea').innerHTML=`<div class="wrong-box">âŒ í‹€ë¦° ë¬¸í•­:<br>${serverRes.wrongs}</div><a href="${EXAMS['í•´ì„¤ì§€'].sol}" class="main-btn" target="_blank" style="display:block;text-align:center;text-decoration:none">ìµœì¢… í•´ì„¤ì§€ í™•ì¸í•˜ê¸°</a>`;
        setTimeout(drawChart, 300);
    } else { document.getElementById('solArea').innerHTML=`<p style="color:blue;text-align:center">${att===1?'2íšŒì°¨ì— í‹€ë¦° ë²ˆí˜¸ê°€ ê³µê°œë©ë‹ˆë‹¤.':'âŒ í‹€ë¦° ë¬¸í•­: '+serverRes.wrongs}</p>`; }
}

function drawChart(){
    const data=new google.visualization.DataTable(); data.addColumn('string','íšŒì°¨'); data.addColumn('number','ì˜¤ë‹µ');
    serverRes.history.forEach((h,i)=>data.addRow([(i+1)+'íšŒ',Number(h.wrongCount)]));
    new google.visualization.LineChart(document.getElementById('chart_div')).draw(data,{legend:'none',colors:['#ff7675'],vAxis:{direction:-1,minValue:0,format:'0'},chartArea:{width:'85%',height:'70%'},pointSize:7});
}

function checkGlobalWait(){ const u=localStorage.getItem('wait_until_'+getUserKey()); if(u && parseInt(u)>Date.now()) startWaitTimer(Math.ceil((parseInt(u)-Date.now())/1000)); }
function startWaitTimer(r){
    const b=document.getElementById('waitDisplay'), q=document.getElementById('qBox'), s=document.getElementById('submitBtn');
    b.style.display='block'; q.style.pointerEvents='none'; s.disabled=true;
    waitInt=setInterval(()=>{
        let m=Math.floor(r/60), sec=r%60; b.innerText=`â³ ëŒ€ê¸° ì¤‘: ${m}:${sec<10?'0'+sec:sec}`;
        if(r--<=0){ clearInterval(waitInt); b.style.display='none'; q.style.pointerEvents='auto'; s.disabled=false; s.innerText="ì œì¶œ ë° ì„œë²„ ì±„ì "; localStorage.removeItem('wait_until_'+getUserKey()); }
    },1000);
}
function lockExam(){ document.getElementById('qBox').innerHTML="<div style='text-align:center;padding:50px;color:#999'>3íšŒì°¨ ì œì¶œ ì™„ë£Œë¡œ ìˆ˜ì • ë¶ˆê°€.</div>"; document.getElementById('submitBtn').style.display='none'; document.getElementById('kakaoBtn').style.display='none'; document.getElementById('reviewBtn').style.display='block'; }
function openPdf(){ window.open(EXAMS[sel.value].pdf) }
function showLastResult(){ const s=JSON.parse(localStorage.getItem('last_res_'+getUserKey())); if(s){serverRes=s; displayResult(); document.getElementById('resultModal').style.display='block';} }
function closeModal(){ document.getElementById('resultModal').style.display='none'; checkGlobalWait(); }
</script>
</body>
</html>