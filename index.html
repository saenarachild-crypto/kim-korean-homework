<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <title>1êµì‹œ ê¹€í˜„ì„ êµ­ì–´</title>
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --p: #6c5ce7; --bg: #f8f9fc; --border: #e2e8f0; }
        body { background: var(--bg); font-family: 'Pretendard', sans-serif; margin: 0; padding: 20px; color: #2d3436; -webkit-tap-highlight-color: transparent; }
        .container { max-width: 650px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.03); }
        .header-logo { text-align: center; margin-bottom: 20px; }
        .header-logo img { width: 85px; border-radius: 15px; }
        
        /* ì‹œí—˜ ì„ íƒ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .selector-box { background: #eeebff; padding: 18px; border-radius: 20px; border: 1.5px solid #d1ccff; margin-bottom: 25px; }
        select { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #c3b9ff; font-size: 1.1em; font-weight: 700; background: #fff; color: var(--p); outline: none; cursor: pointer; }
        
        .notice-box { background: #fff9f0; border-radius: 15px; padding: 20px; margin-bottom: 25px; line-height: 1.7; font-size: 0.95em; border: 1px solid #ffecce; }
        .notice-box b { color: #d35400; font-size: 1.1em; }
        
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        input { width: 100%; padding: 15px; border: 1px solid var(--border); border-radius: 12px; font-size: 1em; box-sizing: border-box; outline: none; }

        .q-card { border: 1px solid var(--border); border-radius: 20px; padding: 20px; margin-bottom: 20px; background: #fff; }
        .q-num { font-weight: 800; font-size: 1.2em; margin-bottom: 15px; display: block; }
        .ans-row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        
        input[type="radio"] { display: none; }
        label { height: 50px; display: flex; align-items: center; justify-content: center; border: 1px solid var(--border); border-radius: 12px; cursor: pointer; font-weight: 700; background: #fff; transition: 0.2s; }
        input[type="radio"]:checked + label { background: var(--p); color: white; border-color: var(--p); box-shadow: 0 4px 12px rgba(108, 92, 231, 0.3); }

        .timer-display { text-align: right; color: #ff7675; font-weight: 800; margin-bottom: 10px; }
        .main-btn { width: 100%; padding: 22px; border: none; border-radius: 20px; font-size: 1.2em; font-weight: 800; cursor: pointer; margin-bottom: 15px; transition: 0.3s; }
        #submitBtn { background: var(--p); color: white; box-shadow: 0 8px 20px rgba(108, 92, 231, 0.3); }
        #submitBtn:disabled { background: #cbd5e0; cursor: not-allowed; box-shadow: none; }
        #kakaoBtn { background: #fee500; color: #3c1e1e; display: none; box-shadow: 0 8px 20px rgba(254, 229, 0, 0.3); }

        #resultCard { display: none; margin-top: 30px; padding: 25px; border-radius: 25px; border: 3px solid var(--p); background: #fcfaff; animation: slideUp 0.5s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <div class="header-logo"><img src="https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpg"></div>
    
    <div class="selector-box">
        <select id="examSelect" onchange="loadExam()"></select>
    </div>

    <div id="examPage">
        <div class="notice-box" id="noticeArea"></div>
        <h2 id="activeTitle" style="text-align:center;"></h2>
        <div id="timerDisplay" class="timer-display">â± ìƒíƒœ í™•ì¸ ì¤‘...</div>
        
        <div class="input-grid">
            <input type="text" id="academyName" placeholder="í•™ì›ëª…">
            <input type="text" id="stuName" placeholder="í•™ìƒ ì´ë¦„">
        </div>

        <div id="questionsContainer"></div>

        <div class="submit-area">
            <button type="button" id="submitBtn" class="main-btn" onclick="processSubmit()">ì œì¶œí•˜ê¸° (ì„±ì  ì „ì†¡)</button>
            <button type="button" id="kakaoBtn" class="main-btn" onclick="shareAndUnlock()">ğŸŸ¡ ì¹´í†¡ ì „ì†¡ í›„ ê²°ê³¼ í™•ì¸</button>
        </div>

        <div id="resultCard">
            <h2 id="resScore" style="margin-top:0; color:var(--p); font-size: 1.6em;"></h2>
            <p id="resFeedback" style="font-weight:700; font-size:1.1em;"></p>
            <div id="resWrongs" style="color:#e74c3c; font-weight:bold; background:#fff0f0; padding:18px; border-radius:15px; margin-top:15px; display:none; word-break: break-all;"></div>
        </div>
    </div>
</div>

<script>
    const TASKS = {
        "1ì›” 3íšŒì°¨ ë¬¸í•™": {
            ans: "1321525524145132442143332454332",
            start: "2026-01-23", end: "2026-01-26",
            msg: "ë§ˆê° ê¸°í•œì„ í™•ì¸í•˜ì„¸ìš”. ì¹´í†¡ ì „ì†¡í•´ì•¼ í‹€ë¦° ê°œìˆ˜ë¥¼ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            max: 3, wait: 1
        },
        "1ì›” 3íšŒì°¨ ë…ì„œ": {
            ans: "153431412344421245255434314314431345415553",
            start: "2026-01-21", end: "2026-01-26",
            msg: "ìˆ˜ì • ë‹µì•ˆì´ í•µì‹¬ì…ë‹ˆë‹¤. ë°±ì ì— ë„ì „í•˜ì„¸ìš”!",
            max: 3, wait: 3
        }
    };

    const GAS_URL = "https://script.google.com/macros/s/AKfycbwtzD2n-5ksERWy2iqE1dB4g36RfWfpP0DhvutxJcYTOSZP8u-xvLHUNZcFgMNkjbF1/exec";
    const KAKAO_KEY = "f81d5eae0eaaf6fa2d0bdccbe6916001";
    let cur = null, curID = "", tid = null;

    if (KAKAO_KEY) Kakao.init(KAKAO_KEY);

    window.onload = () => {
        const sel = document.getElementById("examSelect");
        const keys = Object.keys(TASKS);
        keys.forEach(k => {
            let o = document.createElement("option"); o.value = k; o.innerText = k;
            sel.appendChild(o);
        });
        if(keys.length > 0) {
            sel.value = keys[keys.length - 1];
            loadExam();
        }
    };

    function loadExam() {
        if (tid) clearInterval(tid);
        const key = document.getElementById("examSelect").value;
        cur = TASKS[key]; 
        curID = "HW_V62_" + key.replace(/\s/g, "");
        
        window.latestResult = null;
        document.getElementById('activeTitle').innerText = key;
        document.getElementById('noticeArea').innerHTML = `<b>[ì´ë²ˆ ì£¼ ê³µì§€]</b><br>${cur.msg}<br>ğŸ“… ê¸°í•œ: ${cur.start} ~ ${cur.end}`;
        
        let htmlContent = ""; 
        for(let i=1; i<=cur.ans.length; i++) {
            htmlContent += `
                <div class="q-card">
                    <span class="q-num">${i}ë²ˆ</span>
                    <div class="ans-row">
                        ${[1,2,3,4,5].map(n => `
                            <input type="radio" name="q${i}" value="${n}" id="q${i}_${n}_${curID}">
                            <label for="q${i}_${n}_${curID}">${n}</label>
                        `).join('')}
                    </div>
                </div>`;
        }
        document.getElementById('questionsContainer').innerHTML = htmlContent;
        
        // UI ë¦¬ì…‹
        const kBtn = document.getElementById('kakaoBtn');
        kBtn.style.display = 'none';      
        kBtn.innerText = "ğŸŸ¡ ì¹´í†¡ ì „ì†¡ í›„ ê²°ê³¼ í™•ì¸"; 
        kBtn.style.background = "#fee500"; 
        kBtn.style.color = "#3c1e1e";
        kBtn.onclick = shareAndUnlock;    
        
        document.getElementById('submitBtn').style.display = 'block';     
        document.getElementById('resultCard').style.display = 'none'; 
        
        updateTimerStatus(); 
        tid = setInterval(updateTimerStatus, 1000);
    }

    function updateTimerStatus() {
        const timerDisk = document.getElementById('timerDisplay');
        const subBtn = document.getElementById('submitBtn');
        const lock = localStorage.getItem(curID + '_lock');
        const now = new Date().getTime();
        const currentTries = parseInt(localStorage.getItem(curID + '_tries') || 0);

        if(currentTries >= cur.max) {
            subBtn.disabled = true;
            timerDisk.innerText = "â± ì œì¶œ íšŸìˆ˜ ì´ˆê³¼ (ì‘ì‹œ ë¶ˆê°€)";
            if (tid) { clearInterval(tid); tid = null; }
        } else if(lock && now < lock) {
            subBtn.disabled = true;
            const remain = Math.ceil((lock - now) / 1000);
            timerDisk.innerText = `â± ${remain}ì´ˆ í›„ ë‹¤ì‹œ ì œì¶œ ê°€ëŠ¥`;
        } else {
            subBtn.disabled = false;
            timerDisk.innerText = "â± ì§€ê¸ˆ ì œì¶œ ê°€ëŠ¥";
        }
    }

    async function processSubmit() {
        const name = document.getElementById('stuName').value.trim();
        const academy = document.getElementById('academyName').value.trim();
        if(!name || !academy) return alert("í•™ì›ëª…ê³¼ ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");
        
        const userAns = [];
        for(let i=1; i<=cur.ans.length; i++) {
            const val = document.querySelector(`input[name="q${i}"]:checked`)?.value;
            if(!val) return alert(i + "ë²ˆ ì •ë‹µì„ ì„ íƒí•˜ì„¸ìš”.");
            userAns.push(Number(val));
        }

        const currentTries = parseInt(localStorage.getItem(curID + '_tries') || 0) + 1;
        const master = cur.ans.split("").map(Number);
        let correct = 0, wrongs = [];
        userAns.forEach((v, i) => { v === master[i] ? correct++ : wrongs.push(i+1); });

        window.latestResult = { 
            name, academy, score: Math.round((correct/cur.ans.length)*100), 
            try: currentTries, wrongCount: wrongs.length, wrongs: wrongs.join(", "),
            exam: document.getElementById("examSelect").value
        };

        fetch(GAS_URL, { method: "POST", mode: "no-cors", body: JSON.stringify(window.latestResult) }).catch(e => console.log(e));
        
        localStorage.setItem(curID + '_tries', currentTries);
        localStorage.setItem(curID + '_lock', new Date().getTime() + (cur.wait * 60000));
        
        document.getElementById('submitBtn').style.display = 'none';
        document.getElementById('kakaoBtn').style.display = 'block';
        alert("ì œì¶œ ì™„ë£Œ! ì¹´í†¡ ê³µìœ  í›„ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì ìˆ˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.");
        updateTimerStatus(); 
    }

    function shareAndUnlock() {
        if (!Kakao.isInitialized()) return alert("ì¹´ì¹´ì˜¤ ì¸ì¦ ì˜¤ë¥˜ì…ë‹ˆë‹¤.");
        Kakao.Share.sendDefault({
            objectType: 'feed',
            content: {
                title: `[ê³¼ì œ ì œì¶œ ì™„ë£Œ] ${window.latestResult.exam}`,
                description: `${window.latestResult.name} í•™ìƒ (${window.latestResult.score}ì  / ${window.latestResult.try}íšŒì°¨)`,
                imageUrl: 'https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpg',
                link: { mobileWebUrl: window.location.href, webUrl: window.location.href }
            }
        });

        const kBtn = document.getElementById('kakaoBtn');
        kBtn.innerText = "âœ… ì „ì†¡ ì™„ë£Œ! ì ìˆ˜ í™•ì¸í•˜ê¸°";
        kBtn.style.background = "#2ecc71"; kBtn.style.color = "#fff";
        
        kBtn.onclick = function() {
            const res = window.latestResult;
            const card = document.getElementById('resultCard');
            const wrongArea = document.getElementById('resWrongs');
            card.style.display = 'block';
            document.getElementById('resScore').innerText = `ë‚´ ì ìˆ˜: ${res.score}ì `;
            
            let feedback = `${res.try}íšŒì°¨ ì œì¶œ ì™„ë£Œ. `;
            if(res.try < cur.max - 1) {
                feedback += `ì˜¤ë‹µì€ ì´ ${res.wrongCount}ê°œì…ë‹ˆë‹¤. ë‹¤ì‹œ ê²€í† í•˜ì—¬ ìˆ˜ì • ë‹µì•ˆì„ ì œì¶œí•˜ì„¸ìš”!`;
                wrongArea.style.display = 'none';
            } else if(res.try == cur.max - 1) {
                feedback += `[ë§ˆì§€ë§‰ ì§ì „ íŒíŠ¸] í‹€ë¦° ë²ˆí˜¸ë“¤ì„ í™•ì¸í•˜ê³  ìµœì¢… ë°±ì ì— ë„ì „í•˜ì„¸ìš”!`;
                wrongArea.innerText = `í‹€ë¦° ë¬¸í•­: ${res.wrongs}`;
                wrongArea.style.display = 'block';
            } else {
                feedback += `ìµœì¢… ì œì¶œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê³ ìƒí•˜ì…¨ìŠµë‹ˆë‹¤!`;
                wrongArea.innerText = `ìµœì¢… ì˜¤ë‹µ ë¬¸í•­: ${res.wrongs}`;
                wrongArea.style.display = 'block';
            }
            document.getElementById('resFeedback').innerText = feedback;
            card.scrollIntoView({ behavior: 'smooth' });
            kBtn.style.display = 'none';
        };
    }
</script>
</body>
</html>