<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <title>1êµì‹œ ê¹€í˜„ì„ êµ­ì–´</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpg">
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"></script>
    <style>
        :root { --p: #6c5ce7; --bg: #f8f9fc; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); padding: 15px; margin: 0; -webkit-tap-highlight-color: transparent; }
        .container { max-width: 600px; margin: 0 auto; background: #fff; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .header-logo { text-align: center; margin-bottom: 20px; }
        .header-logo img { width: 85px; border-radius: 15px; }
        .selector-box { background: #eeebff; padding: 12px; border-radius: 12px; margin-bottom: 20px; border: 1.5px solid #d1ccff; }
        select { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; font-size: 15px; background: #fff; outline: none; }
        .notice-box { background: #fff3e0; padding: 15px; border-radius: 12px; margin-bottom: 20px; font-size: 0.9rem; border: 1px solid #ffe0b2; line-height: 1.6; }
        .q-card { background: #fff; border: 1.5px solid #eee; border-radius: 15px; padding: 20px; margin-bottom: 12px; }
        .options { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; position: relative; }
        .opt-input { position: absolute; opacity: 0; width: 0; height: 0; pointer-events: none; }
        .opt-label { height: 45px; border: 1.5px solid #eee; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; color: #636e72; transition: 0.2s; position: relative; z-index: 1; }
        .opt-input:checked + .opt-label { background: var(--p); color: #fff; border-color: var(--p); box-shadow: 0 5px 12px rgba(108,92,231,0.3); }
        .opt-input:disabled + .opt-label { background: #f1f2f6; color: #ccc; border: none; cursor: not-allowed; }
        #timer { font-weight: bold; color: #ff6b6b; text-align: right; margin-bottom: 10px; font-size: 1rem; }
        input { padding: 12px; border: 1px solid #ddd; border-radius: 10px; width: 100%; box-sizing: border-box; margin-bottom: 10px; outline: none; }
        .btn-main { width: 100%; padding: 20px; background: #ff6b6b; color: white; border: none; border-radius: 15px; font-weight: bold; font-size: 1.1rem; cursor: pointer; margin-top: 20px; }
        #kakaoBtn { display: none; width: 100%; background: #fee500; color: #3c1e1e; border: none; padding: 20px; border-radius: 15px; font-weight: bold; cursor: pointer; margin-top: 20px; }
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 999; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
    </style>
</head>
<body>
<div id="overlay"></div>
<div class="container">
    <div class="header-logo"><img src="https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpg"></div>
    
    <div class="selector-box">
        <select id="examSelect" onchange="loadExam()"></select>
    </div>

    <div id="examContent">
        <div id="timer">â± <span id="timeText">ì¬ë„ì „ ëŒ€ê¸° ì—†ìŒ</span></div>
        <div class="notice-box" id="noticeArea"></div>
        <div id="limitMsg" style="display:none; color:red; font-weight:bold; text-align:center; margin-bottom:15px; padding:10px; background:#ffdada; border-radius:10px;"></div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <input type="text" id="cN" placeholder="í•™ì›ëª…">
            <input type="text" id="sN" placeholder="ì´ë¦„" oninput="checkLimit()">
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:15px;">
            <select id="sD" onchange="checkLimit()"><option value="">ì œì¶œì¼ ì„ íƒ</option></select>
            <a id="pdfLink" href="#" target="_blank" style="display:flex; align-items:center; justify-content:center; background:#eee; color:#333; text-decoration:none; border-radius:10px; font-weight:bold; font-size:0.8rem">ğŸ“„ ë¬¸ì œì§€ ë³´ê¸°</a>
        </div>
        <div id="qC"></div>
        <button id="subBtn" onclick="submit()" class="btn-main">ğŸ“ ë‹µì•ˆ ì œì¶œí•˜ê¸°</button>
        <button id="kakaoBtn" onclick="share()">ğŸŸ¡ ì¹´í†¡ìœ¼ë¡œ ì œì¶œ í™•ì¸</button>
        <div id="resArea" style="display:none; margin-top:20px;"></div>
    </div>
</div>

<script>
const TASKS = {
    "1ì›” 3íšŒì°¨ ë…ì„œ": {
        ans: "153431412344421245255434314314431345415553",
        active: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,21,22,23,24,25,26,27,28,29,30,37,38,39],
        start: "2026-01-21", end: "2026-01-26",
        msg: "ì§€ì • ì§€ë¬¸ì˜ ë¬¸ì œë§Œ í‘¸ì„¸ìš”! ìˆ˜ì • ë‹µì•ˆì´ í•µì‹¬ì…ë‹ˆë‹¤.",
        pdf: "https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQC5xf-Z-XrcRKZRHFK77VR1AR04L4r74w6r8sNvYB7-j5c?e=IDTrsu",
        ansPdf: "https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQC55ZuoL-2GSrdGKtWFXkzyARIkd0dBWnPkWxekrIjZznY?e=L3FOKZ",
        max: 3, wait: 3
    },
    "1ì›” 3íšŒì°¨ ë¬¸í•™": {
        ans: "1321525524145132442143332454332",
        active: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],
        start: "2026-01-23", end: "2026-01-26",
        msg: "ìˆ˜ì • ë‹µì•ˆì„ ê¼­ í•˜ì…”ì•¼ í•©ë‹ˆë‹¤.",
        pdf: "https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQB_NRszigFmTrQISqktkybTAQWFrLd2IPO-oUtUWmZJ6wM?e=rFfzXM",
        ansPdf: "https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQC55ZuoL-2GSrdGKtWFXkzyARIkd0dBWnPkWxekrIjZznY?e=V4g4JG",
        max: 3, wait: 1
    }
};

const GAS_URL = "https://script.google.com/macros/s/AKfycbztPu2ZsmP7HOt93FGri3W86YV7i0U-71BbAl9cXclpxZJGTXcSE8ejOwuv8RTdE0bP/exec";
const BASE_URL = window.location.href.split('?')[0];
let cur = null, curID = "", wCount=0, attCount=0, isBlocked=false, resT="", isPerfect=false, wrongListStr="";
try{if(!Kakao.isInitialized()) Kakao.init("f81d5eae0eaaf6fa2d0bdccbe6916001");}catch(e){}

window.onload = function() {
    const params = new URLSearchParams(window.location.search);
    if(params.has("admin_view")) { renderAdmin(params.get("admin_view")); return; }
    
    const sel = document.getElementById("examSelect");
    const taskKeys = Object.keys(TASKS);
    taskKeys.forEach(k => { let o = document.createElement("option"); o.value=k; o.innerText=k; sel.appendChild(o); });
    
    if(taskKeys.length > 0) {
        sel.value = taskKeys[taskKeys.length - 1];
        loadExam();
    }
};

function loadExam() {
    const key = document.getElementById("examSelect").value;
    cur = TASKS[key]; curID = "HW_" + key.replace(/\s/g, "");
    document.getElementById("noticeArea").innerHTML = `<b>[ê³µì§€]</b> ${cur.msg}<br>ğŸ“… ê¸°í•œ: ${cur.start} ~ ${cur.end}`;
    document.getElementById("pdfLink").href = cur.pdf;
    
    const sD = document.getElementById("sD"); sD.innerHTML = '<option value="">ì œì¶œì¼ ì„ íƒ</option>';
    let now = new Date(); now.setHours(0,0,0,0);
    let end = new Date(cur.end); end.setHours(0,0,0,0);
    for(let d=new Date(now); d<=end; d.setDate(d.getDate()+1)){
        let s = d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();
        let o = document.createElement("option"); o.value=s; o.innerText=s; sD.appendChild(o);
    }

    // ğŸ¯ ë¬¸í•­ ë²„íŠ¼ ìƒì„± ë¡œì§ (ì´ ë¶€ë¶„ì´ ë¹ ì ¸ìˆì—ˆìŠµë‹ˆë‹¤!)
    let h = "";
    const totalQ = cur.ans.length;
    for(let n=1; n<=totalQ; n++) {
        let dis = cur.active.includes(n) ? "" : "disabled";
        h += `<div class="q-card"><b>${n}ë²ˆ</b><div class="options">`;
        for(let j=1; j<=5; j++) {
            h += `<input type="radio" name="q${n}" id="q${n}_${j}" value="${j}" class="opt-input" ${dis}><label for="q${n}_${j}" class="opt-label">${j}</label>`;
        }
        h += `</div></div>`;
    }
    document.getElementById("qC").innerHTML = h;
    document.getElementById("resArea").style.display="none";
    document.getElementById("subBtn").style.display="block";
    checkDateLimit();
}

function submit() {
    if(isBlocked) return;
    const sN = document.getElementById("sN").value.trim().replace(/\s/g,""), cN = document.getElementById("cN").value, sD = document.getElementById("sD").value;
    if(!sN || !cN || !sD) return alert("ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");
    wCount = 0; let wrongs = [], mAns = [0, ...cur.ans.split("").map(Number)];
    cur.active.forEach(n => {
        let sel = document.querySelector(`input[name="q${n}"]:checked`);
        if((sel?parseInt(sel.value):0) !== mAns[n]) { wCount++; wrongs.push(n); }
    });
    isPerfect = (wCount === 0); wrongListStr = wrongs.join(",");
    let k = "att_" + sN + "_" + curID;
    attCount = parseInt(localStorage.getItem(k) || 0) + 1;
    localStorage.setItem(k, attCount);
    if(isPerfect) localStorage.setItem("perf_" + sN + "_" + curID, "true");
    resT = `[1êµì‹œ ê¹€í˜„ì„ êµ­ì–´]\n${sN} í•™ìƒ (${document.getElementById("examSelect").value}) ì œì¶œ ì™„ë£Œ`;
    fetch(GAS_URL, { method: "POST", mode: "no-cors", body: JSON.stringify({ exam: document.getElementById("examSelect").value, name: sN, class: cN, attempt: attCount, wrongCount: wCount, wrongList: wrongListStr }) });
    alert("ì¹´í†¡ ì „ì†¡ í›„ [ì™„ë£Œ] ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼ ì ìˆ˜ê°€ ê³µê°œë©ë‹ˆë‹¤!");
    document.getElementById("subBtn").style.display = "none";
    document.getElementById("kakaoBtn").style.display = "block";
}

function share() {
    Kakao.Share.sendDefault({ objectType: "text", text: resT, link: { mobileWebUrl: BASE_URL, webUrl: BASE_URL } });
    setTimeout(() => {
        document.getElementById("overlay").style.display = "flex";
        document.getElementById("overlay").innerHTML = `<div style="background:#fff;padding:30px;border-radius:20px;text-align:center;"><p>ì¹´í†¡ ì „ì†¡ì„ ì™„ë£Œí–ˆë‚˜ìš”?</p><button onclick="done()" style="width:100%;padding:15px;background:#fee500;border:none;border-radius:10px;font-weight:bold;cursor:pointer;">ë„¤, ì™„ë£Œí–ˆìŠµë‹ˆë‹¤</button></div>`;
    }, 1500);
}

function done() {
    document.getElementById("overlay").style.display = "none";
    document.getElementById("kakaoBtn").style.display = "none";
    if(isPerfect) return showFinal("ë°±ì  ë‹¬ì„±!");
    if(attCount >= cur.max) return showFinal("ê¸°íšŒ ì†Œì§„");
    alert(`ğŸ“Š ${attCount}íšŒì°¨ ê²°ê³¼: ì˜¤ë‹µ ${wCount}ê°œ` + (attCount === cur.max - 1 ? `\nğŸ“ íŒíŠ¸: ${wrongListStr}` : ""));
    document.getElementById("subBtn").style.display = "block";
    startWaitTimer();
}

function showFinal(m) {
    document.getElementById("resArea").style.display = "block";
    document.getElementById("resArea").innerHTML = `<div style='padding:25px;background:#eeebff;border-radius:15px;text-align:center'><h3>ğŸ ${m}</h3><p>ê³¼ì œê°€ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤.</p><a href='${cur.ansPdf}' target='_blank' style='display:block;padding:15px;background:var(--p);color:white;text-decoration:none;border-radius:10px;font-weight:bold'>ğŸ“˜ í•´ì„¤ì§€ ë³´ê¸°</a></div>`;
    document.getElementById("subBtn").style.display = "none";
}

function startWaitTimer() {
    let t = cur.wait * 60;
    const btn = document.getElementById("subBtn"); btn.disabled = true; btn.style.opacity = "0.5";
    let inv = setInterval(() => {
        if(t <= 0) { clearInterval(inv); btn.disabled = false; btn.style.opacity = "1"; document.getElementById("timeText").innerText = "ì¬ë„ì „ ê°€ëŠ¥"; return; }
        t--; document.getElementById("timeText").innerText = `ëŒ€ê¸°: ${Math.floor(t/60)}ë¶„ ${t%60}ì´ˆ`;
    }, 1000);
}

function checkDateLimit() {
    let now = new Date(); now.setHours(0,0,0,0);
    let s = new Date(cur.start); let e = new Date(cur.end); e.setHours(23,59,59,999);
    const m = document.getElementById("limitMsg"), b = document.getElementById("subBtn");
    if(now < s || now > e) { isBlocked = true; b.style.display="none"; m.style.display="block"; m.innerText="ğŸš« ì œì¶œ ê¸°ê°„ì´ ì•„ë‹™ë‹ˆë‹¤."; }
    else { isBlocked = false; b.style.display="block"; m.style.display="none"; }
}

function checkLimit() {
    const sN = document.getElementById("sN").value.trim().replace(/\s/g,""); if(sN.length<2) return;
    let k = "att_" + sN + "_" + curID;
    if(localStorage.getItem("perf_" + sN + "_" + curID) === "true") { isBlocked = true; showFinal("ë°±ì  ë‹¬ì„±!"); }
    else if(parseInt(localStorage.getItem(k)||0) >= cur.max) { isBlocked = true; showFinal("ê¸°íšŒ ì†Œì§„"); }
}

function renderAdmin(v) {
    const d = JSON.parse(decodeURIComponent(v));
    document.body.innerHTML = `<div class='container' style='margin-top:50px; text-align:center; border: 3px solid #6c5ce7;'><h2>ğŸ“Š ì„ ìƒë‹˜ í™•ì¸</h2><div class='notice-box' style='text-align:left;'><b>í•™ìƒ:</b> ${d.name}<br><b>íšŒì°¨:</b> ${d.att}íšŒ<br><b>ì˜¤ë‹µ:</b> <span style='color:red'>${d.wrongCount}ê°œ</span><br><b>ë²ˆí˜¸:</b> ${d.wrongList}</div><button onclick='location.href="${BASE_URL}"' style='width:100%;padding:15px;background:#6c5ce7;color:white;border-radius:10px;'>ëŒì•„ê°€ê¸°</button></div>`;
}
</script>
</body>
</html>