<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>1ì›” 3íšŒì°¨ ë¬¸í•™ - êµ­ì–´ ê³¼ì œ ì‹œìŠ¤í…œ</title>
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"></script>
    <style>
        :root { --p: #6c5ce7; --bg: #f8f9fc; --text: #2d3436; --white: #ffffff; --gray: #b2bec3; }
        body { background: var(--bg); font-family: 'Pretendard', sans-serif; margin: 0; padding: 20px; color: var(--text); }
        .container { max-width: 600px; margin: 0 auto; background: var(--white); padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05); }
        .header-bar { background: var(--p); color: white; padding: 12px 20px; border-radius: 12px; margin-bottom: 25px; font-size: 0.85em; display: flex; justify-content: space-between; font-weight: 500; }
        h1, h2 { text-align: center; color: var(--p); }
        #selectorPage, #examPage { display: none; }
        #selectorPage.active, #examPage.active { display: block; }
        .exam-btn { width: 100%; padding: 20px; margin-bottom: 15px; background: #fff; border: 2px solid var(--p); border-radius: 15px; color: var(--p); font-weight: bold; cursor: pointer; transition: 0.2s; }
        .exam-btn:hover { background: var(--p); color: #fff; }
        .info-box { background: #f1f2f6; padding: 15px; border-radius: 12px; margin-bottom: 20px; font-size: 0.85em; }
        .links { display: flex; gap: 10px; margin-bottom: 25px; }
        .links a { flex: 1; text-align: center; padding: 10px; background: #eee; border-radius: 8px; text-decoration: none; color: var(--text); font-size: 0.8em; font-weight: bold; }
        .q-row { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid #f1f2f6; }
        .q-num { width: 45px; font-weight: 800; color: var(--p); }
        .ans-group { display: flex; gap: 8px; flex: 1; justify-content: space-between; }
        input[type="radio"] { display: none; }
        label { flex: 1; height: 38px; display: flex; align-items: center; justify-content: center; border: 1px solid #dfe6e9; border-radius: 10px; cursor: pointer; font-weight: 600; }
        input[type="radio"]:checked + label { background: var(--p); color: white; border-color: var(--p); }
        .btn-area { margin-top: 30px; }
        .main-btn { width: 100%; padding: 18px; border: none; border-radius: 15px; font-size: 1.1em; font-weight: bold; cursor: pointer; margin-bottom: 10px; }
        #submitBtn { background: var(--p); color: white; }
        #submitBtn:disabled { background: var(--gray); cursor: not-allowed; }
        #kakaoBtn { background: #fee500; color: #3c1e1e; display: none; }
        .timer-box { text-align: center; color: #e74c3c; font-weight: bold; height: 24px; margin-bottom: 10px; }
        .result-card { display: none; background: #f8f9fc; padding: 20px; border-radius: 20px; margin-top: 20px; border: 3px solid var(--p); }
        .student-info { margin-bottom: 20px; display: flex; gap: 10px; }
        .student-info input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1em; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-bar">
        <span>ğŸ“‚ ìˆ˜ì • ë‹µì•ˆì„ ê¼­ í•˜ì…”ì•¼ í•©ë‹ˆë‹¤.</span>
        <span>v62.10 Admin-Active</span>
    </div>

    <div id="selectorPage" class="active">
        <h2>ğŸ“ ì‹œí—˜ëª…ì„ ì„ íƒí•˜ì„¸ìš”.</h2>
        <div id="examList"></div>
    </div>

    <div id="examPage">
        <h1 id="activeTitle"></h1>
        <div class="student-info">
            <input type="text" id="stuName" placeholder="ì„±í•¨ ì…ë ¥" required>
            <input type="text" id="stuNum" placeholder="í•™ë²ˆ/ë²ˆí˜¸" required>
        </div>
        <div id="activeInfo" class="info-box"></div>
        <div id="activeLinks" class="links"></div>
        <form id="quizForm">
            <div id="questions"></div>
            <div class="btn-area">
                <div id="timerDisplay" class="timer-box"></div>
                <button type="button" id="submitBtn" class="main-btn" onclick="processSubmit()">ì œì¶œí•˜ê¸° (ì„±ì  ì „ì†¡)</button>
                <button type="button" id="kakaoBtn" class="main-btn" onclick="handleKakaoShare()">ì¹´í†¡ìœ¼ë¡œ ê²°ê³¼ í™•ì¸ ë° ê³µìœ </button>
            </div>
        </form>
        <div id="resultCard" class="result-card">
            <h2 id="resScore" style="margin-top:0"></h2>
            <p id="resFeedback" style="font-size:1.1em;"></p>
            <div id="resWrongs" style="color:#e74c3c; font-weight:bold; background:#fff0f0; padding:10px; border-radius:8px;"></div>
        </div>
    </div>
</div>

<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbwtzD2n-5ksERWy2iqE1dB4g36RfWfpP0DhvutxJcYTOSZP8u-xvLHUNZcFgMNkjbF1/exec";
    const KAKAO_KEY = "YOUR_KAKAO_JS_KEY"; // ì„ ìƒë‹˜ì˜ ì¹´ì¹´ì˜¤ JS í‚¤ë¥¼ ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”

    const EXAMS = [{
        id: "2601_03_LIT",
        title: "1ì›” 3íšŒì°¨ ë¬¸í•™",
        ans: "1321525524145132442143332454332",
        range: "1-31ë²ˆ",
        startDate: "2026-01-23",
        endDate: "2026-01-26",
        waitMin: 1,
        maxTry: 3,
        paper: "https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQB_NRszigFmTrQISqktkybTAQWFrLd2IPO-oUtUWmZJ6wM?e=rFfzXM",
        comment: "https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQC55ZuoL-2GSrdGKtWFXkzyARIkd0dBWnPkWxekrIjZznY?e=V4g4JG"
    }];

    let currentEx = null, tryCount = 0, timerInterval = null;
    try { Kakao.init(KAKAO_KEY); } catch(e) {}

    window.onload = () => {
        const list = document.getElementById('examList');
        const now = new Date();
        EXAMS.filter(ex => now <= new Date(ex.endDate + "T23:59:59")).forEach(ex => {
            const btn = document.createElement('button');
            btn.className = 'exam-btn';
            btn.innerText = ex.title;
            btn.onclick = () => {
                currentEx = ex;
                tryCount = parseInt(localStorage.getItem(ex.id + '_tries') || 0);
                document.getElementById('selectorPage').classList.remove('active');
                document.getElementById('examPage').classList.add('active');
                document.getElementById('activeTitle').innerText = ex.title;
                document.getElementById('activeInfo').innerHTML = `ğŸ“… ê¸°ê°„: ${ex.startDate} ~ ${ex.endDate}<br>ğŸ“ ë²”ìœ„: ${ex.range}`;
                document.getElementById('activeLinks').innerHTML = `<a href="${ex.paper}" target="_blank">ğŸ“„ ë¬¸ì œì§€</a><a href="${ex.comment}" target="_blank">ğŸ”‘ í•´ì„¤ì§€</a>`;
                const qBox = document.getElementById('questions');
                for(let i=1; i<=ex.ans.length; i++){
                    qBox.innerHTML += `<div class="q-row"><div class="q-num">${i}</div><div class="ans-group">${[1,2,3,4,5].map(n => `<input type="radio" name="q${i}" value="${n}" id="q${i}_${n}"><label for="q${i}_${n}">${n}</label>`).join('')}</div></div>`;
                }
                startTimerSystem();
            };
            list.appendChild(btn);
        });
    };

    async function processSubmit() {
        const name = document.getElementById('stuName').value.trim();
        const num = document.getElementById('stuNum').value.trim();
        if(!name || !num) return alert("ì´ë¦„ê³¼ í•™ë²ˆì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.");

        const userAns = [];
        for(let i=1; i<=currentEx.ans.length; i++) {
            const val = document.querySelector(`input[name="q${i}"]:checked`)?.value;
            if(!val) return alert(i + "ë²ˆ ì •ë‹µì„ ì„ íƒí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
            userAns.push(Number(val));
        }

        tryCount++;
        const master = currentEx.ans.split("").map(Number);
        let scoreCount = 0, wrongs = [];
        userAns.forEach((v, i) => { v === master[i] ? scoreCount++ : wrongs.push(i+1); });
        
        const res = {
            id: currentEx.id, title: currentEx.title, name, num,
            score: Math.round((scoreCount/currentEx.ans.length)*100),
            try: tryCount, wrongCount: wrongs.length, wrongs: wrongs.join(", ")
        };
        window.latestResult = res;

        // êµ¬ê¸€ ì‹œíŠ¸ ì „ì†¡
        fetch(GAS_URL, { method: "POST", body: JSON.stringify(res) }).catch(e => console.error(e));

        localStorage.setItem(currentEx.id + '_tries', tryCount);
        localStorage.setItem(currentEx.id + '_lock', new Date().getTime() + (currentEx.waitMin * 60000));
        
        document.getElementById('submitBtn').style.display = 'none';
        document.getElementById('kakaoBtn').style.display = 'block';
        alert("ì„±ì ì´ ì„ ìƒë‹˜ê»˜ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì¹´í†¡ ê³µìœ  í›„ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”!");
        startTimerSystem();
    }

    function handleKakaoShare() {
        const res = window.latestResult;
        try {
            Kakao.Share.sendDefault({
                objectType: 'feed',
                content: {
                    title: `[ì œì¶œì™„ë£Œ] ${currentEx.title}`,
                    description: `${res.name} í•™ìƒ: ${res.score}ì  (${res.try}íšŒì°¨)`,
                    imageUrl: 'https://cdn-icons-png.flaticon.com/512/3407/3407024.png',
                    link: { mobileWebUrl: window.location.href, webUrl: window.location.href },
                },
                buttons: [{ title: 'ê²°ê³¼ í™•ì¸', link: { mobileWebUrl: window.location.href, webUrl: window.location.href } }]
            });
        } catch(e) {}

        document.getElementById('resultCard').style.display = 'block';
        document.getElementById('resScore').innerText = `ì„±ì : ${res.score}ì `;
        
        let feedback = `[${res.try}íšŒì°¨ ì œì¶œ] `;
        if(res.try < currentEx.maxTry - 1) {
            feedback += `ì˜¤ë‹µì€ ${res.wrongCount}ê°œì…ë‹ˆë‹¤. ë‹¤ì‹œ ê²€í† í•´ ë³´ì„¸ìš”.`;
            document.getElementById('resWrongs').style.display = 'none';
        } else if(res.try == currentEx.maxTry - 1) {
            feedback += `ì§‘ì¤‘í•˜ì„¸ìš”! í‹€ë¦° ë²ˆí˜¸ë¥¼ ê³µê°œí•©ë‹ˆë‹¤.`;
            document.getElementById('resWrongs').innerText = `í‹€ë¦° ë²ˆí˜¸: ${res.wrongs}`;
            document.getElementById('resWrongs').style.display = 'block';
        } else {
            feedback += `ìµœì¢… ì œì¶œ ì™„ë£Œ. ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤.`;
            document.getElementById('resWrongs').innerText = `ìµœì¢… ì˜¤ë‹µ: ${res.wrongs}`;
            document.getElementById('resWrongs').style.display = 'block';
        }
        document.getElementById('resFeedback').innerText = feedback;
    }

    function startTimerSystem() {
        if(timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            const lock = localStorage.getItem(currentEx.id + '_lock');
            const now = new Date().getTime();
            const timerDisk = document.getElementById('timerDisplay');
            const subBtn = document.getElementById('submitBtn');

            if(tryCount >= currentEx.maxTry) {
                subBtn.disabled = true;
                timerDisk.innerText = "ì œì¶œ ê¸°íšŒë¥¼ ëª¨ë‘ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.";
                clearInterval(timerInterval);
            } else if(lock && now < lock) {
                subBtn.disabled = true;
                const remain = Math.ceil((lock - now) / 1000);
                timerDisk.innerText = `ì¬ì œì¶œ ëŒ€ê¸°: ${Math.floor(remain/60)}ë¶„ ${remain%60}ì´ˆ`;
            } else {
                subBtn.disabled = false;
                timerDisk.innerText = "";
                if(window.latestResult && document.getElementById('submitBtn').style.display === 'none') {
                    document.getElementById('submitBtn').style.display = 'block';
                    document.getElementById('kakaoBtn').style.display = 'none';
                }
            }
        }, 1000);
    }
</script>
</body>
</html>