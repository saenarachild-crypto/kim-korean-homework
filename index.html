<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <title>1êµì‹œ ê¹€í˜„ì„ êµ­ì–´</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpg">
    <link rel="shortcut icon" href="https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpg">

    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"></script>
    <style>
        :root { --p: #6c5ce7; --bg: #f8f9fc; --card: #ffffff; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); padding: 15px; margin: 0; -webkit-tap-highlight-color: transparent; }
        .container { max-width: 600px; margin: 0 auto; background: var(--card); padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .header-logo { text-align: center; margin-bottom: 20px; }
        .header-logo img { width: 80px; height: auto; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        .selector-box { background: #eeebff; padding: 15px; border-radius: 15px; border: 1.5px solid #d1ccff; margin-bottom: 20px; }
        .selector-label { font-size: 0.85rem; font-weight: bold; color: var(--p); display: block; margin-bottom: 8px; }
        select { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ddd; font-size: 16px; background: white; }

        .notice-box { background: #fff3e0; padding: 15px; border-radius: 12px; margin-bottom: 20px; font-size: 0.9rem; border: 1px solid #ffe0b2; }
        .q-card { background: #fff; border: 1.5px solid #eee; border-radius: 15px; padding: 20px; margin-bottom: 12px; }
        .options { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        .opt-input { position: absolute; opacity: 0; pointer-events: none; }
        .opt-label { height: 45px; border: 1.5px solid #eee; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; color: #636e72; }
        .opt-input:checked + .opt-label { background: var(--p); color: #fff; border-color: var(--p); }
        
        #timer { font-weight: bold; color: #ff6b6b; text-align: right; margin-bottom: 10px; }
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 999; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        input { padding: 12px; border: 1px solid #ddd; border-radius: 10px; width: 100%; box-sizing: border-box; font-size: 16px; margin-bottom: 10px; }
        .btn-main { width: 100%; padding: 20px; background: #ff6b6b; color: white; border: none; border-radius: 15px; font-weight: bold; cursor: pointer; }
        #kakaoBtn { display: none; width: 100%; background: #fee500; color: #3c1e1e; border: none; padding: 20px; border-radius: 15px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
<div id="overlay"></div>
<div class="container">
    <div class="header-logo">
        <img src="https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpg" alt="ê¹€í˜„ì„ êµ­ì–´">
    </div>

    <div class="selector-box">
        <label class="selector-label">ğŸ“‚ ê³¼ì œ ì„ íƒ (ì„ íƒ í›„ í•˜ë‹¨ì— ì‹œí—˜ì§€ê°€ ëœ¹ë‹ˆë‹¤)</label>
        <select id="examSelect" onchange="loadExam()"></select>
    </div>

    <div id="examContent" style="display:none;">
        <div id="timer">â± <span id="timeText">ìƒíƒœ í™•ì¸ ì¤‘...</span></div>
        <div class="notice-box" id="noticeArea"></div>
        <div id="limitMsg" style="display:none;color:red;font-weight:bold;text-align:center;margin-bottom:20px;"></div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
            <input type="text" id="cN" placeholder="í•™ì›ëª…"> 
            <input type="text" id="sN" placeholder="ì´ë¦„" oninput="checkLimit()">
        </div>
        <select id="sD" onchange="checkLimit()" style="margin-bottom:15px;"><option value="">ì œì¶œì¼ ì„ íƒ</option></select>
        <div id="quizContainer"></div>
        <button id="subBtn" onclick="submit()" class="btn-main">ğŸ“ ë‹µì•ˆ ì œì¶œí•˜ê¸°</button>
        <button id="kakaoBtn" onclick="share()">ğŸŸ¡ ì¹´í†¡ìœ¼ë¡œ ì œì¶œ í™•ì¸</button>
        <div id="resArea" style="display:none;margin-top:20px"></div>
    </div>
</div>

<script>
const TASKS = {
    "1ì›” 3íšŒì°¨ ë…ì„œ": {
        ans: "1234512345123451234512345123451", // 31ë¬¸í•­
        range: "1-31", start: "2026-01-21", end: "2026-01-26",
        msg: "ë…ì„œ ê³¼ì œì…ë‹ˆë‹¤. ì˜¤ë‹µì„ ê¼¼ê¼¼íˆ ì²´í¬í•˜ì„¸ìš”!", max: 3, wait: 3
    },
    "1ì›” 4íšŒì°¨ ë¬¸í•™": {
        ans: "543215432154321", // 15ë¬¸í•­
        range: "1-15", start: "2026-01-28", end: "2026-02-02",
        msg: "ë¬¸í•™ ê³¼ì œì…ë‹ˆë‹¤. í‘œí˜„ìƒ íŠ¹ì§•ì„ ì •ë¦¬í•˜ì„¸ìš”.", max: 3, wait: 5
    }
};

const GAS_URL = "https://script.google.com/macros/s/AKfycbztPu2ZsmP7HOt93FGri3W86YV7i0U-71BbAl9cXclpxZJGTXcSE8ejOwuv8RTdE0bP/exec";
const BASE_URL = window.location.href.split('?')[0];

let cur = null, curID = "", wCount=0, attCount=0, isBlocked=false, wrongListStr="";
try { if(!Kakao.isInitialized()) Kakao.init("f81d5eae0eaaf6fa2d0bdccbe6916001"); } catch(e){}

window.onload = function() {
    const params = new URLSearchParams(window.location.search);
    if(params.has("admin_view")) { renderAdmin(params.get("admin_view")); return; }
    const sel = document.getElementById("examSelect");
    sel.innerHTML = '<option value="">ê³¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
    Object.keys(TASKS).forEach(k => { let o = document.createElement("option"); o.value=k; o.innerText=k; sel.appendChild(o); });
};

function loadExam() {
    const key = document.getElementById("examSelect").value;
    if(!key) { document.getElementById("examContent").style.display="none"; return; }
    
    cur = TASKS[key]; curID = "HW_" + key.replace(/\s/g, "");
    document.getElementById("examContent").style.display="block";
    document.getElementById("noticeArea").innerHTML = `<b>[ê³µì§€]</b> ${cur.msg}<br>ğŸ“… ê¸°í•œ: ${cur.start} ~ ${cur.end}`;

    // ë‚ ì§œ ë¡œì§
    const sD = document.getElementById("sD"); sD.innerHTML = '<option value="">ì œì¶œì¼ ì„ íƒ</option>';
    let now = new Date(); now.setHours(0,0,0,0);
    let end = new Date(cur.end); end.setHours(0,0,0,0);
    for(let d=new Date(now); d<=end; d.setDate(d.getDate()+1)){
        let s = d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();
        let o = document.createElement("option"); o.value=s; o.innerText=s; sD.appendChild(o);
    }

    // ğŸ“ ë¬¸í•­ ìƒì„± ë¡œì§ ë³µêµ¬
    let h = "", activeArr = [];
    cur.range.split(',').forEach(p => {
        let r = p.trim().split('-');
        if(r.length===2) for(let i=parseInt(r[0]);i<=parseInt(r[1]);i++) activeArr.push(i);
        else activeArr.push(parseInt(p));
    });
    for(let n=1; n<=cur.ans.length; n++) {
        let dis = activeArr.includes(n) ? "" : "disabled";
        h += `<div class="q-card"><b>${n}ë²ˆ</b><div class="options">`;
        for(let j=1; j<=5; j++) h += `<input type="radio" name="q${n}" id="q${n}_${j}" value="${j}" class="opt-input" ${dis}><label for="q${n}_${j}" class="opt-label">${j}</label>`;
        h += `</div></div>`;
    }
    document.getElementById("quizContainer").innerHTML = h;
    document.getElementById("resArea").style.display="none";
    document.getElementById("subBtn").style.display="block";
    checkDateLimit();
}

function submit() {
    if(isBlocked) return;
    const sN = document.getElementById("sN").value.trim(), cN = document.getElementById("cN").value, sD = document.getElementById("sD").value;
    if(!sN || !cN || !sD) return alert("ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");

    wCount = 0; let wrongs = [], mAns = [0, ...cur.ans.split("").map(Number)];
    let activeArr = [];
    cur.range.split(',').forEach(p => {
        let r = p.trim().split('-');
        if(r.length===2) for(let i=parseInt(r[0]);i<=parseInt(r[1]);i++) activeArr.push(i);
        else activeArr.push(parseInt(p));
    });

    activeArr.forEach(n => {
        let sel = document.querySelector(`input[name="q${n}"]:checked`);
        if((sel?parseInt(sel.value):0) !== mAns[n]) { wCount++; wrongs.push(n); }
    });

    wrongListStr = wrongs.join(", ");
    let k = "att_" + sN + "_" + curID;
    attCount = parseInt(localStorage.getItem(k) || 0) + 1;
    localStorage.setItem(k, attCount);
    if(wCount === 0) localStorage.setItem("perf_" + sN + "_" + curID, "true");

    const examTitle = document.getElementById("examSelect").value;
    fetch(GAS_URL, { method: "POST", mode: "no-cors", body: JSON.stringify({ exam: examTitle, name: sN, class: cN, attempt: attCount, wrongCount: wCount, wrongList: wrongListStr }) });

    alert("ì¹´í†¡ ì œì¶œ í›„ [ì™„ë£Œ] ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼ ì ìˆ˜ê°€ ê³µê°œë©ë‹ˆë‹¤!");
    document.getElementById("subBtn").style.display = "none";
    document.getElementById("kakaoBtn").style.display = "block";
}

function share() {
    const examTitle = document.getElementById("examSelect").value;
    const sN = document.getElementById("sN").value.trim();
    Kakao.Share.sendDefault({ 
        objectType: "text", 
        text: `[1êµì‹œ ê¹€í˜„ì„ êµ­ì–´]\n${sN} í•™ìƒ (${examTitle}) ì œì¶œ ì™„ë£Œ`, 
        link: { mobileWebUrl: BASE_URL, webUrl: BASE_URL } 
    });
    setTimeout(() => {
        document.getElementById("overlay").style.display = "flex";
        document.getElementById("overlay").innerHTML = `<div style="background:#fff;padding:30px;border-radius:20px;text-align:center;"><p>ì¹´í†¡ ì „ì†¡ì„ ì™„ë£Œí–ˆë‚˜ìš”?</p><button onclick="done()" style="width:100%;padding:15px;background:#fee500;border:none;border-radius:10px;font-weight:bold;cursor:pointer;">ë„¤, ì™„ë£Œí–ˆìŠµë‹ˆë‹¤</button></div>`;
    }, 1500);
}

function done() {
    document.getElementById("overlay").style.display = "none";
    document.getElementById("kakaoBtn").style.display = "none";
    if(wCount === 0) return showFinal("ğŸ‰ ë°±ì  ë‹¬ì„±!");
    if(attCount >= cur.max) return showFinal("ğŸš« ëª¨ë“  ê¸°íšŒ ì†Œì§„");

    let msg = `ğŸ“Š ì˜¤ë‹µ ${wCount}ê°œ`;
    if(attCount === cur.max - 1) msg += `\nğŸ“ íŒíŠ¸(ì˜¤ë‹µë²ˆí˜¸): ${wrongListStr}`;
    alert(msg);
    document.getElementById("subBtn").style.display = "block";
    startWaitTimer();
}

function showFinal(m) {
    document.getElementById("resArea").style.display = "block";
    document.getElementById("resArea").innerHTML = `<div style="padding:20px;background:#eeebff;border-radius:15px;text-align:center;"><h3>${m}</h3></div>`;
    document.getElementById("subBtn").style.display = "none";
}

function startWaitTimer() {
    let t = cur.wait * 60;
    const btn = document.getElementById("subBtn"); btn.disabled = true; btn.style.opacity = "0.5";
    let inv = setInterval(() => {
        if(t <= 0) { clearInterval(inv); btn.disabled = false; btn.style.opacity = "1"; document.getElementById("timeText").innerText = "ì¬ë„ì „ ê°€ëŠ¥"; return; }
        t--; document.getElementById("timeText").innerText = `ì¬ë„ì „ ëŒ€ê¸°: ${Math.floor(t/60)}ë¶„ ${t%60}ì´ˆ`;
    }, 1000);
}

function checkDateLimit() {
    let now = new Date(); now.setHours(0,0,0,0);
    let s = new Date(cur.start); let e = new Date(cur.end); e.setHours(23,59,59,999);
    const m = document.getElementById("limitMsg"), b = document.getElementById("subBtn");
    if(now < s || now > e) { isBlocked = true; b.style.display="none"; m.style.display="block"; m.innerText="ğŸš« ì œì¶œ ê¸°ê°„ì´ ì•„ë‹™ë‹ˆë‹¤."; }
    else { isBlocked = false; b.style.display="block"; m.style.display="none"; }
}

function checkLimit() {
    const sN = document.getElementById("sN").value.trim(); if(sN.length<2) return;
    let k = "att_" + sN + "_" + curID;
    if(localStorage.getItem("perf_" + sN + "_" + curID) === "true") { isBlocked = true; showFinal("ì´ë¯¸ ë°±ì ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤!"); }
    else if(parseInt(localStorage.getItem(k)||0) >= cur.max) { isBlocked = true; showFinal("ê¸°íšŒë¥¼ ëª¨ë‘ ì†Œì§„í–ˆìŠµë‹ˆë‹¤."); }
}

function renderAdmin(v) {
    const d = JSON.parse(decodeURIComponent(v));
    document.body.innerHTML = `<div class='container' style='margin-top:50px; text-align:center;'><h2>ğŸ“Š ì„ ìƒë‹˜ í™•ì¸ì°½</h2><div class='notice-box' style='text-align:left;'><b>í•™ìƒ:</b> ${d.name}<br><b>íšŒì°¨:</b> ${d.att}íšŒ<br><b>ì˜¤ë‹µ:</b> <span style='color:red'>${d.wrongCount}ê°œ</span><br><b>ë²ˆí˜¸:</b> ${d.wrongList}</div><button onclick='location.href="${BASE_URL}"' style='width:100%;padding:15px;background:#6c5ce7;color:white;border-radius:10px;'>ëŒì•„ê°€ê¸°</button></div>`;
}
</script>
</body>
</html>