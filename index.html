<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <title>1êµì‹œ ê¹€í˜„ì„ êµ­ì–´</title>
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"></script>
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --p: #6c5ce7; --bg: #f8f9fc; --border: #e2e8f0; }
        body { background: var(--bg); font-family: 'Pretendard', sans-serif; margin: 0; padding: 20px; color: #2d3436; -webkit-tap-highlight-color: transparent; }
        .container { max-width: 650px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.03); }
        
        /* ğŸšª ëŒ€ë¬¸(Intro) ìŠ¤íƒ€ì¼ */
        #introPage { text-align: center; padding: 40px 0; }
        #introPage h1 { font-size: 1.8em; font-weight: 800; color: var(--p); margin-top: 20px; }
        #introPage p { color: #636e72; margin-bottom: 30px; line-height: 1.6; }
        .start-btn { width: 100%; padding: 25px; background: var(--p); color: white; border: none; border-radius: 20px; font-size: 1.3em; font-weight: 800; cursor: pointer; box-shadow: 0 8px 25px rgba(108, 92, 231, 0.3); }

        /* ğŸ“ ì‹œí—˜ì§€(Exam) ìŠ¤íƒ€ì¼ */
        #examPage { display: none; } /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
        .header-logo { text-align: center; margin-bottom: 25px; }
        .header-logo img { width: 130px; height: auto; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .selector-box { background: #eeebff; padding: 18px; border-radius: 20px; border: 1.5px solid #d1ccff; margin-bottom: 25px; }
        select { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #c3b9ff; font-size: 1.1em; font-weight: 700; background: #fff; color: var(--p); outline: none; }
        .notice-box { background: #fff9f0; border-radius: 15px; padding: 20px; margin-bottom: 25px; font-size: 0.95em; border: 1px solid #ffecce; }
        .link-area { display: flex; gap: 10px; margin-bottom: 25px; }
        .link-btn { flex: 1; padding: 12px; text-align: center; background: #f1f3f5; border-radius: 10px; text-decoration: none; color: #495057; font-weight: 700; border: 1px solid #dee2e6; font-size: 0.85em; }
        
        .q-card { border: 1px solid var(--border); border-radius: 20px; padding: 20px; margin-bottom: 20px; background: #fff; }
        .ans-row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        input[type="radio"] { position: absolute; opacity: 0; pointer-events: none; }
        label { height: 50px; display: flex; align-items: center; justify-content: center; border: 1px solid var(--border); border-radius: 12px; cursor: pointer; font-weight: 700; background: #fff; transition: 0.2s; }
        input[type="radio"]:checked + label { background: var(--p); color: white; border-color: var(--p); }
        
        .main-btn { width: 100%; padding: 22px; border: none; border-radius: 20px; font-size: 1.2em; font-weight: 800; cursor: pointer; margin-bottom: 15px; }
        #submitBtn { background: var(--p); color: white; }
        #kakaoBtn { background: #fee500; color: #3c1e1e; display: none; }
        #resultCard { display: none; margin-top: 30px; padding: 25px; border-radius: 25px; border: 3px solid var(--p); background: #fcfaff; }
    </style>
</head>
<body>

<div class="container">
    <div id="introPage">
        <img src="https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpg" style="width:180px; border-radius:30px;">
        <h1>1êµì‹œ ê¹€í˜„ì„ êµ­ì–´</h1>
        <p>ì„ ìƒë‹˜ê³¼ í•¨ê»˜í•˜ëŠ”<br>ì£¼ê°„ ê³¼ì œ ì±„ì  ì‹œìŠ¤í…œì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.</p>
        <button class="start-btn" onclick="startApp()">ê³¼ì œ ì‹œì‘í•˜ê¸°</button>
    </div>

    <div id="examPage">
        <div class="header-logo"><img src="https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpg"></div>
        <div class="selector-box"><select id="examSelect" onchange="loadExam()"></select></div>
        <div class="notice-box" id="noticeArea"></div>
        <div class="link-area" id="linkArea"></div>
        <div id="timerDisplay" style="text-align:right; font-weight:800; color:#ff7675; margin-bottom:10px;">â± ë¡œë”© ì¤‘...</div>
        
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:15px;">
            <input type="text" id="academyName" placeholder="í•™ì›ëª…" style="padding:15px; border-radius:12px; border:1px solid var(--border); outline:none;">
            <input type="text" id="stuName" placeholder="í•™ìƒ ì´ë¦„" style="padding:15px; border-radius:12px; border:1px solid var(--border); outline:none;">
        </div>

        <div id="questionsContainer"></div>

        <button type="button" id="submitBtn" class="main-btn" onclick="processSubmit()">ì œì¶œ ë° ì„œë²„ ì±„ì </button>
        <button type="button" id="kakaoBtn" class="main-btn" onclick="shareAndUnlock()">ğŸŸ¡ ì¹´í†¡ ì „ì†¡ í›„ ê²°ê³¼ í™•ì¸</button>

        <div id="resultCard">
            <h2 id="resScore" style="color:var(--p)"></h2>
            <p id="resFeedback" style="font-weight:700;"></p>
            <div id="resWrongs" style="color:#e74c3c; font-weight:bold; background:#fff0f0; padding:15px; border-radius:12px; display:none; word-break:break-all;"></div>
            <div id="chart_div" style="height:250px; margin-top:20px;"></div>
        </div>
    </div>
</div>

<script>
    google.charts.load('current', {'packages':['corechart']});

    const TASKS = {
        "1ì›” 3íšŒì°¨ ë¬¸í•™": { 
            id: "2601_03_LIT", 
            qCount: 31, 
            deadline: "2026-01-26 23:59:59", 
            msg: "ìˆ˜ì • ë‹µì•ˆì„ ê¼­ í•˜ì…”ì•¼ í•©ë‹ˆë‹¤.",
            pdf: "https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQB_NRszigFmTrQISqktkybTAQWFrLd2IPO-oUtUWmZJ6wM?e=rFfzXM",
            sol: "https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQC55ZuoL-2GSrdGKtWFXkzyARIkd0dBWnPkWxekrIjZznY?e=V4g4JG"
        }
    };

    const GAS_URL = "https://script.google.com/macros/s/AKfycbxcT0dziBtsHKDZEPwzyBySOkZjfl3_B7nSysFX7DlXyDKiAD03zLI3jXI8ZBNbA31C/exec";
    const KAKAO_KEY = "f81d5eae0eaaf6fa2d0bdccbe6916001";
    let cur = null, curID = "", tid = null, serverRes = null;

    if (KAKAO_KEY) Kakao.init(KAKAO_KEY);

    function startApp() {
        document.getElementById('introPage').style.display = 'none';
        document.getElementById('examPage').style.display = 'block';
        initSelector();
    }

    function initSelector() {
        const sel = document.getElementById("examSelect");
        sel.innerHTML = "";
        Object.keys(TASKS).forEach(k => {
            let o = document.createElement("option"); o.value = k; o.innerText = k; sel.appendChild(o);
        });
        sel.value = Object.keys(TASKS).pop();
        loadExam();
    }

    function loadExam() {
        if (tid) clearInterval(tid);
        const key = document.getElementById("examSelect").value;
        cur = TASKS[key]; curID = "HW_V66_" + cur.id;
        
        document.getElementById('noticeArea').innerHTML = `<b>[ê³µì§€]</b> ${cur.msg}<br>ğŸ“… <b>ê¸°í•œ:</b> <span style="color:#e74c3c">${cur.deadline}</span>`;
        document.getElementById('linkArea').innerHTML = `<a href="${cur.pdf}" target="_blank" class="link-btn">ğŸ“„ ë¬¸ì œì§€</a><a href="${cur.sol}" target="_blank" class="link-btn">ğŸ“– í•´ì„¤ì§€</a>`;
        
        let html = "";
        for(let i=1; i<=cur.qCount; i++) {
            html += `<div class="q-card"><span class="q-num">${i}ë²ˆ</span><div class="ans-row">${[1,2,3,4,5].map(n => `<input type="radio" name="q${i}" value="${n}" id="q${i}_${n}_${curID}"><label for="q${i}_${n}_${curID}">${n}</label>`).join('')}</div></div>`;
        }
        document.getElementById('questionsContainer').innerHTML = html;
        document.getElementById('resultCard').style.display = 'none';
        document.getElementById('submitBtn').style.display = 'block';
        document.getElementById('kakaoBtn').style.display = 'none';
        
        updateTimerStatus();
        tid = setInterval(updateTimerStatus, 1000);
    }

    async function processSubmit() {
        if (new Date() > new Date(cur.deadline)) return alert("ì œì¶œ ê¸°í•œì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
        const name = document.getElementById('stuName').value.trim();
        const academy = document.getElementById('academyName').value.trim();
        if(!name || !academy) return alert("ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        const answers = [];
        for(let i=1; i<=cur.qCount; i++) {
            const val = document.querySelector(`input[name="q${i}"]:checked`)?.value;
            if(!val) return alert(i + "ë²ˆ ì •ë‹µì„ ì„ íƒí•˜ì„¸ìš”.");
            answers.push(Number(val));
        }
        document.getElementById('submitBtn').innerText = "ë¶„ì„ ì¤‘...";
        try {
            const response = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ examId: cur.id, examTitle: document.getElementById