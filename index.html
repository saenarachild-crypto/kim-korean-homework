<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>êµ­ì–´ ê³¼ì œ ì‹œìŠ¤í…œ v62.10</title>
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --p: #6c5ce7; --bg: #f8f9fc; --border: #e2e8f0; }
        body { background: var(--bg); font-family: 'Pretendard', sans-serif; margin: 0; padding: 20px; color: #2d3436; }
        .container { max-width: 650px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.03); position: relative; }
        
        /* [1ë‹¨ê³„] ê²Œì´íŠ¸ì›¨ì´ í˜ì´ì§€ */
        #gatewayPage { text-align: center; }
        .exam-select-btn { width: 100%; padding: 25px; margin-bottom: 15px; background: #fff; border: 2px solid var(--p); border-radius: 20px; color: var(--p); font-weight: bold; font-size: 1.1em; cursor: pointer; transition: 0.3s; }
        .exam-select-btn:hover { background: var(--p); color: #fff; }

        /* [2ë‹¨ê³„] ì‹œí—˜ í˜ì´ì§€ */
        #examPage { display: none; }
        h1 { text-align: center; font-size: 1.8em; margin-bottom: 10px; font-weight: 800; }
        .timer-display { text-align: right; color: #ff7675; font-weight: bold; font-size: 1.1em; margin-bottom: 10px; }
        
        /* ê³µì§€ì‚¬í•­ ë°•ìŠ¤ (ì„ ìƒë‹˜ ìš”ì²­ ë¬¸êµ¬ ë°˜ì˜) */
        .notice-box { background: #fff9f0; border-radius: 15px; padding: 20px; margin-bottom: 25px; line-height: 1.7; font-size: 0.95em; border: 1px solid #ffecce; text-align: left; }
        .notice-box b { color: #d35400; font-size: 1.1em; }

        /* ì…ë ¥ í¼ */
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        input, select { width: 100%; padding: 15px; border: 1px solid var(--border); border-radius: 12px; font-size: 1em; box-sizing: border-box; outline: none; }
        
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px; }
        .btn-paper { background: #f1f2f6; border: none; border-radius: 12px; padding: 15px; cursor: pointer; text-decoration: none; color: #4b4b4b; text-align: center; font-size: 0.95em; font-weight: bold; display: flex; align-items: center; justify-content: center; }

        /* ë‹µì•ˆì§€ ì¹´ë“œ */
        .q-card { border: 1px solid var(--border); border-radius: 15px; padding: 20px; margin-bottom: 20px; background: #fff; }
        .q-num { font-weight: 800; font-size: 1.2em; margin-bottom: 15px; display: block; }
        .ans-row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        
        input[type="radio"] { display: none; }
        label { height: 50px; display: flex; align-items: center; justify-content: center; border: 1px solid var(--border); border-radius: 10px; cursor: pointer; font-weight: 700; transition: 0.2s; }
        input[type="radio"]:checked + label { background: var(--p); color: white; border-color: var(--p); }

        /* ë²„íŠ¼ ì˜ì—­ (ë‹µì•ˆì§€ ë§ˆì§€ë§‰ì— ë°°ì¹˜) */
        .submit-area { margin-top: 30px; }
        .main-btn { width: 100%; padding: 20px; border: none; border-radius: 20px; font-size: 1.2em; font-weight: bold; cursor: pointer; transition: 0.3s; }
        #submitBtn { background: var(--p); color: white; box-shadow: 0 8px 20px rgba(108, 92, 231, 0.3); }
        #kakaoBtn { background: #fee500; color: #3c1e1e; display: none; box-shadow: 0 8px 20px rgba(254, 229, 0, 0.3); }
        .main-btn:disabled { background: #cbd5e0; box-shadow: none; cursor: not-allowed; }

        /* ê²°ê³¼ ì¹´ë“œ */
        .result-card { display: none; margin-top: 30px; padding: 25px; border-radius: 20px; border: 3px solid var(--p); background: #fcfaff; animation: slideUp 0.5s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <div id="gatewayPage">
        <div class="notice-box">
            <b>[ì´ë²ˆ ì£¼ ê³µì§€]</b><br>
            ë§ˆê° ê¸°í•œì„ í™•ì¸í•˜ì„¸ìš”. <br>
            ì¹´í†¡ ì „ì†¡í•´ì•¼ í‹€ë¦° ê°œìˆ˜ë¥¼ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>
        <div style="font-weight: 800; margin-bottom: 20px; color: var(--p);">ğŸ“ ì‘ì‹œí•  ê³¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>
        <div id="examList"></div>
    </div>

    <div id="examPage">
        <h1 id="activeTitle"></h1>
        <div id="timerDisplay" class="timer-display">â± ëŒ€ê¸° ì¤‘</div>

        <div class="input-grid">
            <input type="text" id="academyName" placeholder="í•™ì›ëª…">
            <input type="text" id="stuName" placeholder="í•™ìƒ ì´ë¦„">
        </div>
        
        <div class="action-grid">
            <select id="submitDay">
                <option value="">ì œì¶œì¼ ì„ íƒ</option>
                <option value="1ì›”23ì¼">1ì›” 23ì¼</option>
                <option value="1ì›”24ì¼">1ì›” 24ì¼</option>
                <option value="1ì›”25ì¼">1ì›” 25ì¼</option>
                <option value="1ì›”26ì¼">1ì›” 26ì¼</option>
            </select>
            <a id="paperLink" href="#" target="_blank" class="btn-paper">ğŸ“„ ë¬¸ì œì§€ ë³´ê¸°</a>
        </div>

        <form id="quizForm">
            <div id="questionsContainer"></div>
            
            <div class="submit-area">
                <button type="button" id="submitBtn" class="main-btn" onclick="sendData()">ì œì¶œí•˜ê¸° (ì„±ì  ì „ì†¡)</button>
                <button type="button" id="kakaoBtn" class="main-btn" onclick="verifyAndShow()">ì¹´í†¡ ì „ì†¡ í›„ ê²°ê³¼ í™•ì¸</button>
            </div>
        </form>

        <div id="resultCard" class="result-card">
            <h2 id="resScore" style="margin:0 0 10px 0; color:var(--p)"></h2>
            <p id="resFeedback" style="font-weight:600; font-size:1.1em; margin-bottom: 5px;"></p>
            <div id="resWrongs" style="color:#e74c3c; font-weight:bold; background:#fff0f0; padding:15px; border-radius:12px;"></div>
        </div>
    </div>
</div>

<script>
    const CONFIG = {
        gas: "https://script.google.com/macros/s/AKfycbwtzD2n-5ksERWy2iqE1dB4g36RfWfpP0DhvutxJcYTOSZP8u-xvLHUNZcFgMNkjbF1/exec",
        kakaoKey: "YOUR_KAKAO_JS_KEY", // ì„ ìƒë‹˜ í‚¤ ì…ë ¥
        exams: [{
            id: "2601_03_LIT",
            title: "ì£¼ê°„ê³¼ì œ 1ì›” 3íšŒì°¨ ë¬¸í•™",
            ans: "1321525524145132442143332454332",
            paper: "https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQB_NRszigFmTrQISqktkybTAQWFrLd2IPO-oUtUWmZJ6wM?e=rFfzXM",
            endDate: "2026-01-26",
            waitMin: 1,
            maxTry: 3
        }]
    };

    let currentEx = null, tryCount = 0, timerInterval = null;
    try { Kakao.init(CONFIG.kakaoKey); } catch(e) {}

    window.onload = () => {
        const list = document.getElementById('examList');
        CONFIG.exams.forEach(ex => {
            const btn = document.createElement('button');
            btn.className = 'exam-select-btn';
            btn.innerText = ex.title;
            btn.onclick = () => {
                currentEx = ex;
                tryCount = parseInt(localStorage.getItem(ex.id + '_tries') || 0);
                document.getElementById('gatewayPage').style.display = 'none';
                document.getElementById('examPage').style.display = 'block';
                document.getElementById('activeTitle').innerText = ex.title;
                document.getElementById('paperLink').href = ex.paper;
                
                const container = document.getElementById('questionsContainer');
                for(let i=1; i<=ex.ans.length; i++) {
                    container.innerHTML += `<div class="q-card"><span class="q-num">${i}ë²ˆ</span><div class="ans-row">${[1,2,3,4,5].map(n => `<input type="radio" name="q${i}" value="${n}" id="q${i}_${n}"><label for="q${i}_${n}">${n}</label>`).join('')}</div></div>`;
                }
                checkTimer();
            };
            list.appendChild(btn);
        });
    };

    async function sendData() {
        const academy = document.getElementById('academyName').value.trim();
        const name = document.getElementById('stuName').value.trim();
        const day = document.getElementById('submitDay').value;
        if(!academy || !name || !day) return alert("í•™ì›ëª…, ì´ë¦„, ì œì¶œì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        
        const userAns = [];
        for(let i=1; i<=currentEx.ans.length; i++) {
            const val = document.querySelector(`input[name="q${i}"]:checked`)?.value;
            if(!val) return alert(i + "ë²ˆ ì •ë‹µì„ ì„ íƒí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
            userAns.push(Number(val));
        }

        tryCount++;
        const master = currentEx.ans.split("").map(Number);
        let correct = 0, wrongs = [];
        userAns.forEach((v, i) => { v === master[i] ? correct++ : wrongs.push(i+1); });

        window.latestResult = { 
            title: currentEx.title, academy, name, day, 
            score: Math.round((correct/currentEx.ans.length)*100), 
            try: tryCount, wrongCount: wrongs.length, wrongs: wrongs.join(", ") 
        };

        // GAS ì „ì†¡
        fetch(CONFIG.gas, { method: "POST", body: JSON.stringify(window.latestResult) });
        
        localStorage.setItem(currentEx.id + '_tries', tryCount);
        localStorage.setItem(currentEx.id + '_lock', new Date().getTime() + (currentEx.waitMin * 60000));
        
        document.getElementById('submitBtn').style.display = 'none';
        document.getElementById('kakaoBtn').style.display = 'block';
        alert("ì„±ì  ë°ì´í„°ê°€ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ì¹´í†¡ ê³µìœ ë¥¼ ì™„ë£Œí•˜ë©´ ì ìˆ˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
    }

    function verifyAndShow() {
        // ì¹´í†¡ ê³µìœ  ì‹¤í–‰
        Kakao.Share.sendDefault({
            objectType: 'feed',
            content: {
                title: `[ê³¼ì œ ì œì¶œ] ${currentEx.title}`,
                description: `${window.latestResult.name} í•™ìƒ (${window.latestResult.score}ì  / ${window.latestResult.try}íšŒì°¨)`,
                imageUrl: 'https://cdn-icons-png.flaticon.com/512/3407/3407024.png',
                link: { mobileWebUrl: window.location.href, webUrl: window.location.href }
            }
        });

        // ì§€ì¹¨: ì¹´í†¡ ì „ì†¡ ë²„íŠ¼ í´ë¦­ ì‹œ ê²°ê³¼ ë…¸ì¶œ
        const res = window.latestResult;
        document.getElementById('resultCard').style.display = 'block';
        document.getElementById('resScore').innerText = `ë‚´ ì ìˆ˜: ${res.score}ì `;
        
        let feedback = `${res.try}íšŒì°¨ ì œì¶œ ì™„ë£Œ. `;
        if(res.try < currentEx.maxTry - 1) {
            feedback += `í‹€ë¦° ê°œìˆ˜ëŠ” ì´ ${res.wrongCount}ê°œì…ë‹ˆë‹¤. ë‹¤ì‹œ ê²€í† í•´ë³´ì„¸ìš”!`;
            document.getElementById('resWrongs').style.display = 'none';
        } else if(res.try == currentEx.maxTry - 1) {
            feedback += `[ë§ˆì§€ë§‰ ì§ì „ íŒíŠ¸] í‹€ë¦° ë²ˆí˜¸ë“¤ì„ í™•ì¸í•˜ê³  ìˆ˜ì •í•˜ì„¸ìš”.`;
            document.getElementById('resWrongs').innerText = `í‹€ë¦° ë²ˆí˜¸: ${res.wrongs}`;
            document.getElementById('resWrongs').style.display = 'block';
        } else {
            feedback += `ìµœì¢… ì œì¶œì´ ëë‚¬ìŠµë‹ˆë‹¤. ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤.`;
            document.getElementById('resWrongs').innerText = `ìµœì¢… ì˜¤ë‹µ: ${res.wrongs}`;
            document.getElementById('resWrongs').style.display = 'block';
        }
        document.getElementById('resFeedback').innerText = feedback;
        
        // ê²°ê³¼ì°½ìœ¼ë¡œ ìë™ ìŠ¤í¬ë¡¤
        document.getElementById('resultCard').scrollIntoView({ behavior: 'smooth' });
    }

    function checkTimer() {
        if(timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            const lock = localStorage.getItem(currentEx.id + '_lock');
            const now = new Date().getTime();
            const subBtn = document.getElementById('submitBtn');
            const timerDisk = document.getElementById('timerDisplay');

            if(tryCount >= currentEx.maxTry) {
                subBtn.disabled = true;
                timerDisk.innerText = "â± ì œì¶œ íšŸìˆ˜ ì´ˆê³¼";
                clearInterval(timerInterval);
            } else if(lock && now < lock) {
                subBtn.disabled = true;
                const diff = Math.ceil((lock - now) / 1000);
                timerDisk.innerText = `â± ${Math.floor(diff/60)}ë¶„ ${diff%60}ì´ˆ í›„ ì¬ì‘ì‹œ ê°€ëŠ¥`;
            } else {
                subBtn.disabled = false;
                timerDisk.innerText = "â± ì œì¶œ ê°€ëŠ¥";
            }
        }, 1000);
    }
</script>
</body>
</html>