<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <title>1êµì‹œ ê¹€í˜„ì„ êµ­ì–´</title>
    <link rel="apple-touch-icon" href="https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpg">
    <link rel="icon" href="https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpg">
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"></script>
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --p: #6c5ce7; --bg: #f8f9fc; --border: #e2e8f0; --accent: #ff7675; }
        body { background: var(--bg); font-family: 'Pretendard', sans-serif; margin: 0; padding: 15px; color: #2d3436; -webkit-tap-highlight-color: transparent; }
        .container { max-width: 500px; margin: 0 auto; background: #fff; padding: 25px; border-radius: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.03); box-sizing: border-box; }
        #introPage, #examPage { display: none; }
        .show { display: block !important; }
        .header-logo { text-align: center; margin-bottom: 20px; width: 100%; }
        .header-logo img { width: 100%; max-width: 300px; height: auto; object-fit: contain; border-radius: 15px; display: block; margin: 0 auto; }
        .wait-banner { background: #fff200; color: #000; text-align: center; padding: 15px; border-radius: 15px; font-weight: 900; font-size: 1.1em; margin-bottom: 15px; display: none; border: 3px solid #000; }
        .notice-card { background: #fff9f0; padding: 18px; border-radius: 20px; border: 2px dashed #ffcc80; margin-bottom: 20px; }
        .notice-card p { margin: 0; font-size: 0.95em; line-height: 1.6; color: #555; }
        .input-grid { display: flex !important; gap: 10px; margin-bottom: 20px; }
        input[type="text"] { flex: 1; width: 0; padding: 15px 10px; border: 1px solid var(--border); border-radius: 15px; font-size: 16px !important; text-align: center; background: #fdfdff; outline: none; height: 50px; box-sizing: border-box; }
        .selector-box { background: #eeebff; padding: 15px; border-radius: 20px; margin-bottom: 10px; } /* ê°„ê²© ì¡°ì • */
        select { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #c3b9ff; font-weight: 700; color: var(--p); font-size: 1em; outline: none; background: #fff; }
        
        /* ğŸ“„ ë¬¸ì œì§€ ë²„íŠ¼ í¬ê¸° ë° ë””ìì¸ ë³´ì • */
        .pdf-btn { display: block; width: 100%; padding: 18px; background: #2d3436; color: #fff; text-align: center; text-decoration: none; border-radius: 20px; font-weight: 800; font-size: 1.05em; margin-bottom: 20px; box-shadow: 0 8px 15px rgba(0,0,0,0.1); box-sizing: border-box; transition: 0.2s; }
        .pdf-btn:active { transform: scale(0.98); opacity: 0.9; }

        .q-card { border: 1px solid var(--border); border-radius: 20px; padding: 20px; margin-bottom: 15px; background: #fff; }
        .is-waiting { opacity: 0.4 !important; pointer-events: none !important; }
        .ans-row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        input[type="radio"] { position: absolute; opacity: 0; }
        .ans-row label { height: 45px; display: flex; align-items: center; justify-content: center; border: 1px solid var(--border); border-radius: 12px; cursor: pointer; font-weight: 700; background: #fff; }
        input[type="radio"]:checked + label { background: var(--p); color: white; border-color: var(--p); }
        .main-btn { width: 100%; padding: 20px; background: var(--p); color: white; border: none; border-radius: 20px; font-size: 1.1em; font-weight: 800; cursor: pointer; }
        #resultModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 1000; overflow-y: auto; padding: 15px; box-sizing: border-box; }
        .modal-content { background: #fff; border-radius: 30px; padding: 25px; max-width: 500px; margin: 20px auto; }
        #chart_div { width: 100%; height: 200px; margin: 25px 0; }
    </style>
</head>
<body>
<div class="container">
    <div id="introPage" class="show">
        <div class="header-logo"><img src="https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpg"></div>
        <div class="notice-card"><h3>ğŸ“¢ ê³µì§€ì‚¬í•­</h3><p>ì‹œí—˜ì§€ë¥¼ ì„ íƒí•˜ê³  ìì •ê¹Œì§€ ì œì¶œí•˜ì„¸ìš”. ë¯¸ì œì¶œ ì‹œ ë¶„ì„ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.</p></div>
        <div class="input-grid"><input type="text" id="academyName" placeholder="í•™ì›ëª…"><input type="text" id="stuName" placeholder="í•™ìƒ ì´ë¦„"></div>
        <button class="main-btn" onclick="startExam()">ë³¸ì¸ í™•ì¸ ì™„ë£Œ (ê³¼ì œ ì‹œì‘)</button>
    </div>
    <div id="examPage">
        <div class="header-logo"><img src="https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpg"></div>
        <div id="waitDisplay" class="wait-banner">â³ ë‹¤ì‹œ ê³ ë¯¼í•  ì‹œê°„ì…ë‹ˆë‹¤...</div>
        <div class="notice-card"><h3>ğŸ“¢ ì‹œí—˜ì§€ ê³µì§€</h3><p id="examNotice"></p></div>
        <div class="selector-box"><select id="examSelect" onchange="loadExam()"></select></div>
        
        <a id="pdfLink" class="pdf-btn" target="_blank" onclick="openPdf(event)">ğŸ“„ ì›ë³¸ ë¬¸ì œì§€ ë³´ê¸°</a>
        
        <div id="questionsContainer"></div>
        <button id="submitBtn" class="main-btn" onclick="processSubmit()">ì œì¶œ ë° ì„œë²„ ì±„ì </button>
        <button id="kakaoBtn" class="main-btn" onclick="shareAndUnlock()" style="display:none; background:#fee500; color:#3c1e1e;">ğŸŸ¡ ì¹´í†¡ ì „ì†¡ í›„ ê²°ê³¼ í™•ì¸</button>
    </div>
</div>
<div id="resultModal"><div class="modal-content"><h2 style="text-align:center;">ğŸ“Š ë¦¬í¬íŠ¸</h2><div id="resSummary" style="font-weight:800; margin:20px 0; font-size:1.3em; text-align:center;"></div><div id="historyArea" style="display:none;"><div id="chart_div"></div><p style="font-size:0.8em; color:#666; text-align:center;">* ìœ„ë¡œ ê°ˆìˆ˜ë¡ ì˜¤ë‹µì´ ì ì€(ì„±ì ì´ ì¢‹ì€) ê·¸ë˜í”„ì…ë‹ˆë‹¤.</p></div><div id="solArea"></div><button class="main-btn" style="background:#f1f2f6; color:#333; margin-top:20px;" onclick="closeModal()">ê²°ê³¼ì°½ ë‹«ê¸°</button></div></div>

<script>
    google.charts.load('current', {'packages':['corechart']});
    const KAKAO_KEY = "f81d5eae0eaaf6fa2d0bdccbe6916001", GAS_URL = "https://script.google.com/macros/s/AKfycbxcT0dziBtsHKDZEPwzyBySOkZjfl3_B7nSysFX7DlXyDKiAD03zLI3jXI8ZBNbA31C/exec";
    
    const TASKS = {
        "1ì›” 3íšŒì°¨ ë¬¸í•™": { 
            id: "2601_03_LIT", 
            wait: 1, 
            notice: "ì „ ë¬¸í•­ ëª¨ë‘ í’€ì–´ì„œ ì œì¶œí•  ê²ƒ. ì œì¶œ ê¸°í•œ: 1ì›” 26ì¼ ìì •ê¹Œì§€", 
            pdf: "https://saenarachild-crypto.github.io/kim-korean-homework/2601_03_lit.pdf", 
            allNums: Array.from({length: 31}, (_, i) => i + 1), 
            activeNums: Array.from({length: 31}, (_, i) => i + 1), 
            sol: "https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQC55ZuoL-2GSrdGKtWFXkzyARIkd0dBWnPkWxekrIjZznY?e=V4g4JG" 
        },
        "1ì›” 3íšŒì°¨ ë…ì„œ": { 
            id: "2601_03_READING", 
            wait: 5, 
            notice: "ì§€ì • ë¬¸í•­ë§Œ í’€ì–´ì„œ ì œì¶œí•  ê²ƒ. ì œì¶œê¸°í•œ: 1ì›” 26ì¼ ìì •ê¹Œì§€", 
            pdf: "https://saenarachild-crypto.github.io/kim-korean-homework/2601_03_reading.pdf", 
            allNums: Array.from({length: 39}, (_, i) => i + 1), 
            activeNums: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,21,22,23,24,25,26,27,28,29,30,37,38,39], 
            sol: "https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQC55ZuoL-2GSrdGKtWFXkzyARIkd0dBWnPkWxekrIjZznY?e=V4g4JG" 
        }
    };

    let serverRes = null, waitInt = null;
    if (KAKAO_KEY) Kakao.init(KAKAO_KEY);

    window.onload = () => {
        const sel = document.getElementById("examSelect");
        Object.keys(TASKS).forEach(k => { let o = document.createElement("option"); o.value = k; o.innerText = k; sel.appendChild(o); });
        loadExam();
        checkGlobalWait(); 
    };

    function openPdf(e) {
        e.preventDefault();
        const key = document.getElementById("examSelect").value;
        window.open(TASKS[key].pdf, '_blank'); // ì„ íƒëœ ì‹œí—˜ì§€ PDF ì¦‰ì‹œ ì—´ê¸°
    }

    function checkGlobalWait() {
        const until = localStorage.getItem('wait_until');
        if (until && parseInt(until) > Date.now()) {
            startWaitTimer(Math.ceil((parseInt(until) - Date.now()) / 1000));
        }
    }

    function startExam() {
        if(!document.getElementById('stuName').value.trim()) return alert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.");
        document.getElementById('introPage').classList.remove('show');
        document.getElementById('examPage').classList.add('show');
    }

    function loadExam() {
        const key = document.getElementById("examSelect").value;
        const cur = TASKS[key];
        document.getElementById('examNotice').innerText = cur.notice;
        
        let html = "";
        cur.allNums.forEach(n => {
            const active = cur.activeNums.includes(n);
            html += `<div class="q-card ${active ? '' : 'is-waiting'}"><b>${n}ë²ˆ</b><div class="ans-row">${[1,2,3,4,5].map(v => `<input type="radio" name="q${n}" value="${v}" id="q${n}_${v}" ${active ? '' : 'disabled'}><label for="q${n}_${v}">${v}</label>`).join('')}</div></div>`;
        });
        document.getElementById('questionsContainer').innerHTML = html;
        checkGlobalWait();
    }

    async function processSubmit() {
        const cur = TASKS[document.getElementById("examSelect").value];
        const answers = [];
        cur.activeNums.forEach(n => { const v = document.querySelector(`input[name="q${n}"]:checked`)?.value; answers.push(v ? Number(v) : 0); });
        const btn = document.getElementById('submitBtn'); btn.disabled = true; btn.innerText = "ì±„ì  ì¤‘...";
        try {
            const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ examId: cur.id, examTitle: document.getElementById("examSelect").value, name: document.getElementById('stuName').value.trim(), academy: document.getElementById('academyName').value.trim(), answers, displayNums: cur.activeNums }) });
            serverRes = await res.json();
            btn.style.display = 'none'; document.getElementById('kakaoBtn').style.display = 'block';
        } catch(e) { alert("ì˜¤ë¥˜"); btn.disabled = false; }
    }

    function shareAndUnlock() {
        const bustUrl = 'https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpg?v=' + new Date().getTime();
        Kakao.Share.sendDefault({
            objectType: 'feed',
            content: {
                title: `[${document.getElementById("academyName").value}] ${document.getElementById("examSelect").value}`,
                description: `${document.getElementById("stuName").value} í•™ìƒ (${serverRes.try}íšŒì°¨) ì œì¶œ ì™„ë£Œ`,
                imageUrl: bustUrl, imageWidth: 200, imageHeight: 200,
                link: { mobileWebUrl: window.location.href, webUrl: window.location.href }
            }
        });

        setTimeout(() => {
            if(confirm("ì£¼ì˜: ì„ ìƒë‹˜ ì±„íŒ…ë°©ìœ¼ë¡œ ì „ì†¡ì„ ì™„ë£Œí•˜ì…¨ìŠµë‹ˆê¹Œ?\n(ë¯¸ì „ì†¡ ì‹œ ë¬´íš¨ ì²˜ë¦¬ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)")) {
                document.getElementById('resultModal').style.display = 'block';
                document.getElementById('resSummary').innerHTML = `ì˜¤ë‹µ ê°œìˆ˜: <span style="color:var(--accent)">${serverRes.wrongCount}ê°œ</span><br><span style="font-size:0.7em; color:#999;">(${serverRes.try}íšŒì°¨ ì œì¶œ ì™„ë£Œ)</span>`;
                
                if(serverRes.try < 3) {
                    const waitMin = TASKS[document.getElementById("examSelect").value].wait;
                    localStorage.setItem('wait_until', Date.now() + (waitMin * 60 * 1000));
                }

                if(serverRes.try >= 3) {
                    document.getElementById('historyArea').style.display = 'block';
                    document.getElementById('solArea').innerHTML = `
                        <div style="background:#fff0f0; padding:15px; border-radius:12px; color:#c0392b; font-weight:700; margin:15px 0; line-height:1.6; font-size:0.9em;">âŒ ì˜¤ë‹µ ë²ˆí˜¸:<br>${serverRes.wrongs}</div>
                        <a href="${TASKS[document.getElementById("examSelect").value].sol}" class="main-btn" target="_blank" style="display:block; text-decoration:none; text-align:center;">ìµœì¢… í•´ì„¤ì§€ í™•ì¸í•˜ê¸°</a>`;
                    setTimeout(drawChart, 300);
                } else {
                    document.getElementById('historyArea').style.display = 'none';
                    document.getElementById('solArea').innerHTML = `<p style="color:blue; text-align:center; margin-top:15px;">3íšŒì°¨ ì œì¶œ ì‹œ ìƒì„¸ ë¶„ì„í‘œê°€ ê³µê°œë©ë‹ˆë‹¤.</p>`;
                }
            }
        }, 1500); 
    }

    function closeModal() {
        document.getElementById('resultModal').style.display = 'none';
        checkGlobalWait();
        if(serverRes && serverRes.try >= 3) location.reload();
    }

    function startWaitTimer(remainSec) {
        let sec = remainSec;
        const banner = document.getElementById('waitDisplay'), qBox = document.getElementById('questionsContainer'), sBtn = document.getElementById('submitBtn'), kBtn = document.getElementById('kakaoBtn');
        banner.style.display = 'block'; qBox.classList.add('is-waiting'); kBtn.style.display = 'none'; sBtn.style.display = 'block'; sBtn.disabled = true;
        if(waitInt) clearInterval(waitInt);
        waitInt = setInterval(() => {
            let m = Math.floor(sec/60), s = sec%60;
            sBtn.innerText = `ì¬ì œì¶œê¹Œì§€ ${m}:${s<10?'0'+s:s} ë‚¨ìŒ`;
            banner.innerText = `â³ ë‹¤ìŒ ì œì¶œ ëŒ€ê¸° ì¤‘: ${m}:${s<10?'0'+s:s}`;
            if(sec-- <= 0) {
                clearInterval(waitInt); banner.style.display = 'none'; qBox.classList.remove('is-waiting');
                sBtn.disabled = false; sBtn.innerText = "ì œì¶œ ë° ì„œë²„ ì±„ì ";
                localStorage.removeItem('wait_until');
            }
        }, 1000);
    }

    function drawChart() {
        const chartData = [['íšŒì°¨', 'ì˜¤ë‹µ ê°œìˆ˜']];
        serverRes.history.forEach((h, idx) => { chartData.push([ (idx+1) + "íšŒ", Number(h.wrongCount) ]); });
        const data = google.visualization.arrayToDataTable(chartData);
        new google.visualization.LineChart(document.getElementById('chart_div')).draw(data, {
            legend: 'none', colors: ['#ff7675'],
            vAxis: { direction: -1, gridlines: {count: 5}, minValue: 0 },
            chartArea: { width: '85%', height: '70%' },
            pointSize: 7
        });
    }
</script>
</body>
</html>
