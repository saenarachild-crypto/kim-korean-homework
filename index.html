// ğŸ›¡ï¸ [ì¶”ê°€] ì œì¶œ íšŸìˆ˜ ì €ì¥ ë° ë°˜í™˜ í•¨ìˆ˜
function saveAndGetTryCount(name, examId, academy, wrongs) {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  let sheet = ss.getSheetByName("Log"); // ì‹œíŠ¸ ì´ë¦„ì´ "Log"ì¸ì§€ í™•ì¸í•˜ì„¸ìš”!
  if (!sheet) sheet = ss.insertSheet("Log");
  
  // í˜„ì¬ ì‹œíŠ¸ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
  const data = sheet.getDataRange().getValues();
  let tryCount = 1;
  
  // ê¸°ì¡´ ì œì¶œ ê¸°ë¡ í™•ì¸í•˜ì—¬ íšŒì°¨ ê³„ì‚°
  for (let i = 1; i < data.length; i++) {
    if (data[i][1] === name && data[i][2] === examId) {
      tryCount++;
    }
  }
  
  // ìƒˆ ê¸°ë¡ ì €ì¥ (ì¼ì‹œ, ì´ë¦„, ì‹œí—˜ID, í•™ì›ëª…, í‹€ë¦° ê°œìˆ˜, í‹€ë¦° ë²ˆí˜¸)
  sheet.appendRow([new Date(), name, examId, academy, wrongs.length, wrongs.join(", ")]);
  
  return tryCount;
}

// ğŸ›¡ï¸ [ì¶”ê°€] ì„±ì  íˆìŠ¤í† ë¦¬ ì¶”ì¶œ í•¨ìˆ˜ (ê·¸ë˜í”„ìš©)
function getHistory(name, examId) {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const sheet = ss.getSheetByName("Log");
  if (!sheet) return [];
  
  const data = sheet.getDataRange().getValues();
  const history = [];
  
  for (let i = 1; i < data.length; i++) {
    if (data[i][1] === name && data[i][2] === examId) {
      history.push({ wrongCount: data[i][4] });
    }
  }
  return history;
}