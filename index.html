<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <title>1êµì‹œ ê¹€í˜„ì„ êµ­ì–´</title>
    
    <link rel="apple-touch-icon" href="https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpg">
    <link rel="icon" href="https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpg">

    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"></script>
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --p: #6c5ce7; --bg: #f8f9fc; --border: #e2e8f0; }
        body { background: var(--bg); font-family: 'Pretendard', sans-serif; margin: 0; padding: 20px; color: #2d3436; }
        .container { max-width: 650px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.03); }
        
        #introPage, #examPage { display: none; }
        .show { display: block !important; }
        .header-logo { text-align: center; margin-bottom: 25px; }
        .header-logo img { width: 120px; height: 120px; object-fit: contain; border-radius: 20px; }
        
        .selector-box { background: #eeebff; padding: 18px; border-radius: 20px; margin-bottom: 25px; }
        select { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #c3b9ff; font-weight: 700; color: var(--p); outline: none; }
        
        /* ğŸ“‹ ì…ë ¥ë€ ìŠ¤íƒ€ì¼ */
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        input[type="text"] { width: 100%; padding: 15px; border: 1px solid var(--border); border-radius: 12px; font-size: 1em; box-sizing: border-box; outline: none; font-family: inherit; }

        .q-card { border: 1px solid var(--border); border-radius: 20px; padding: 20px; margin-bottom: 20px; background: #fff; }
        .q-disabled { background: #f1f3f5; opacity: 0.5; pointer-events: none; border-style: dashed; }
        
        .ans-row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        input[type="radio"] { position: absolute; opacity: 0; }
        label { height: 48px; display: flex; align-items: center; justify-content: center; border: 1px solid var(--border); border-radius: 12px; cursor: pointer; font-weight: 700; background: #fff; }
        input[type="radio"]:checked + label { background: var(--p); color: white; border-color: var(--p); }

        .main-btn { width: 100%; padding: 22px; background: var(--p); color: white; border: none; border-radius: 20px; font-size: 1.1em; font-weight: 800; cursor: pointer; margin-top: 15px; }
        #kakaoBtn { background: #fee500; color: #3c1e1e; display: none; }
        
        #resultModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; overflow-y: auto; padding: 20px; box-sizing: border-box; }
        .modal-content { background: #fff; border-radius: 30px; padding: 30px; max-width: 550px; margin: 0 auto; }
        #chart_div { width: 100%; height: 250px; }
    </style>
</head>
<body>

<div class="container">
    <div id="introPage" class="show">
        <div class="header-logo"><img src="https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpg"></div>
        <div style="background:#fff9f0; padding:25px; border-radius:20px; border:2px dashed #ffcc80; margin:20px 0;">
            <h3 style="margin-top:0; color:#e67e22;">ğŸ“¢ í•„ìˆ˜ ê³µì§€</h3>
            <p id="mainNotice">ìˆ˜ì • ë‹µì•ˆì„ ê¼­ í•˜ì…”ì•¼ í•©ë‹ˆë‹¤.</p>
        </div>
        <button class="main-btn" onclick="startApp()">ê³¼ì œ ì‹œì‘í•˜ê¸°</button>
    </div>

    <div id="examPage">
        <div class="header-logo"><img src="https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpg"></div>
        <div class="selector-box"><select id="examSelect" onchange="loadExam()"></select></div>
        
        <div class="input-grid">
            <input type="text" id="academyName" placeholder="í•™ì›ëª…">
            <input type="text" id="stuName" placeholder="í•™ìƒ ì´ë¦„">
        </div>

        <div id="questionsContainer"></div>
        <button id="submitBtn" class="main-btn" onclick="processSubmit()">ì œì¶œ ë° ì„œë²„ ì±„ì </button>
        <button id="kakaoBtn" class="main-btn" onclick="shareAndUnlock()">ğŸŸ¡ ì¹´í†¡ ì „ì†¡ í›„ ê²°ê³¼ í™•ì¸</button>
    </div>
</div>

<div id="resultModal">
    <div class="modal-content">
        <h2 id="resTitle" style="color:var(--p); margin-top:0;">ğŸ“Š ì„±ì  ë¦¬í¬íŠ¸</h2>
        <div id="resSummary" style="font-weight:700; margin-bottom:20px;"></div>
        <div id="chart_div"></div>
        <div id="solArea"></div>
        <button class="main-btn" style="background:#eee; color:#333;" onclick="location.reload()">ë‹«ê¸°</button>
    </div>
</div>

<script>
    google.charts.load('current', {'packages':['corechart']});
    const KAKAO_KEY = "f81d5eae0eaaf6fa2d0bdccbe6916001";
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxcT0dziBtsHKDZEPwzyBySOkZjfl3_B7nSysFX7DlXyDKiAD03zLI3jXI8ZBNbA31C/exec";
    
    const TASKS = {
        "1ì›” 3íšŒì°¨ ë¬¸í•™": { id: "2601_03_LIT", allNums: Array.from({length: 31}, (_, i) => i + 1), activeNums: Array.from({length: 31}, (_, i) => i + 1), sol: "https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQC55ZuoL-2GSrdGKtWFXkzyARIkd0dBWnPkWxekrIjZznY?e=V4g4JG" },
        "1ì›” 3íšŒì°¨ ë…ì„œ": { id: "2601_03_READING", allNums: Array.from({length: 39}, (_, i) => i + 1), activeNums: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,21,22,23,24,25,26,27,28,29,30,37,38,39], sol: "https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQC55ZuoL-2GSrdGKtWFXkzyARIkd0dBWnPkWxekrIjZznY?e=V4g4JG" }
    };

    let serverRes = null;
    if (KAKAO_KEY) Kakao.init(KAKAO_KEY);

    window.onload = () => {
        const sel = document.getElementById("examSelect");
        Object.keys(TASKS).forEach(k => { let o = document.createElement("option"); o.value = k; o.innerText = k; sel.appendChild(o); });
        loadExam();
    };

    function startApp() { document.getElementById('introPage').classList.remove('show'); document.getElementById('examPage').classList.add('show'); }

    function loadExam() {
        const key = document.getElementById("examSelect").value;
        const cur = TASKS[key];
        let html = "";
        cur.allNums.forEach(n => {
            const active = cur.activeNums.includes(n);
            html += `<div class="q-card ${active ? '' : 'q-disabled'}"><span class="q-num">${n}ë²ˆ</span><div class="ans-row">${[1,2,3,4,5].map(v => `<input type="radio" name="q${n}" value="${v}" id="q${n}_${v}" ${active ? '' : 'disabled'}><label for="q${n}_${v}">${v}</label>`).join('')}</div></div>`;
        });
        document.getElementById('questionsContainer').innerHTML = html;
    }

    async function processSubmit() {
        const name = document.getElementById('stuName').value.trim();
        const academy = document.getElementById('academyName').value.trim();
        if(!name || !academy) return alert("í•™ì›ëª…ê³¼ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

        const key = document.getElementById("examSelect").value;
        const cur = TASKS[key];
        const answers = [];
        cur.activeNums.forEach(n => { const v = document.querySelector(`input[name="q${n}"]:checked`)?.value; answers.push(v ? Number(v) : 0); });
        
        const btn = document.getElementById('submitBtn');
        btn.disabled = true; btn.innerText = "ë¶„ì„ ì¤‘...";
        
        try {
            const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ examId: cur.id, examTitle: key, name: name, academy: academy, answers, displayNums: cur.activeNums }) });
            serverRes = await res.json();
            btn.style.display = 'none'; document.getElementById('kakaoBtn').style.display = 'block';
        } catch(e) { alert("ì—°ê²° ì˜¤ë¥˜"); btn.disabled = false; }
    }

    function shareAndUnlock() {
        const tryTxt = serverRes.try + "íšŒì°¨";
        Kakao.Share.sendDefault({
            objectType: 'feed',
            content: {
                title: `[ê³¼ì œ ì œì¶œ] ${document.getElementById("examSelect").value}`,
                description: `${document.getElementById('stuName').value} í•™ìƒ ì œì¶œ ì™„ë£Œ (${tryTxt})`,
                imageUrl: 'https://saenarachild-crypto.github.io/kim-korean-homework/logo.jpg',
                link: { mobileWebUrl: window.location.href, webUrl: window.location.href }
            }
        });
        document.getElementById('resultModal').style.display = 'block';
        document.getElementById('resSummary').innerText = `${serverRes.score}ì  (${tryTxt})`;
        
        const solArea = document.getElementById('solArea');
        if(serverRes.try >= 3) {
            solArea.innerHTML = `<p style="color:#e74c3c; font-weight:bold;">âŒ ì˜¤ë‹µ ë²ˆí˜¸: ${serverRes.wrongs}</p><a href="${TASKS[document.getElementById("examSelect").value].sol}" class="main-btn" target="_blank" style="display:block; text-decoration:none; text-align:center;">ìµœì¢… í•´ì„¤ì§€ ë³´ê¸°</a>`;
        } else {
            solArea.innerHTML = `<p style="color:var(--p); font-weight:bold;">ğŸ’¡ ì˜¤ë‹µ ê°œìˆ˜: ${serverRes.wrongCount}ê°œ</p><p style="font-size:0.9em; color:#666;">3íšŒì°¨ ì œì¶œ ì‹œ ì˜¤ë‹µ ë²ˆí˜¸ê°€ ê³µê°œë©ë‹ˆë‹¤.</p>`;
        }
        drawChart();
    }

    function drawChart() {
        const data = google.visualization.arrayToDataTable([['ë‚ ì§œ', 'ì ìˆ˜'], ...serverRes.history.map(h => [h.date, h.score])]);
        new google.visualization.LineChart(document.getElementById('chart_div')).draw(data, { legend: 'none', colors: ['#6c5ce7'], vAxis: {minValue: 0, maxValue: 100} });
    }
</script>
</body>
</html>
