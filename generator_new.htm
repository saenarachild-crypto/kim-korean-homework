<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>êµ­ì–´ ê³¼ì œ ìƒì„±ê¸° v62.3</title>
    <style>
        :root { --p: #6c5ce7; --bg: #f9f9fb; }
        body { font-family: 'Apple SD Gothic Neo', sans-serif; background: var(--bg); padding: 20px; color: #2d3436; }
        .box { max-width: 900px; margin: 0 auto; background: #fff; padding: 40px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        h2 { color: var(--p); border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 30px; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .full { grid-column: span 2; }
        label { font-weight: bold; font-size: 0.9rem; color: #636e72; }
        input, textarea { width: 100%; padding: 12px; margin-top: 8px; border: 1px solid #dfe6e9; border-radius: 10px; box-sizing: border-box; outline: none; }
        #genBtn { width: 100%; padding: 20px; background: var(--p); color: white; border: none; border-radius: 15px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 30px; }
        #output { width: 100%; height: 250px; margin-top: 20px; font-family: monospace; background: #2d3436; color: #a29bfe; padding: 15px; border-radius: 10px; font-size: 11px; border: 2px dashed #6c5ce7; cursor: pointer; white-space: pre-wrap; word-break: break-all; }
    </style>
</head>
<body>
<div class="box">
    <h2>ğŸ¯ êµ­ì–´ ê³¼ì œ ìƒì„±ê¸° v62.3 (ë™ê¸°í™” ë³´ê°•)</h2>
    <div style="background:#f0edff; padding:15px; border-radius:12px; font-size:0.85rem; color:var(--p); margin-bottom:25px;">
        âœ… <b>ë°ì´í„° ì¼ì¹˜ í™•ì¸</b>: ê³¼ì œëª…, ê³µì§€ì‚¬í•­, ë¬¸í•­ ë²”ìœ„ê°€ ìƒì„± ê²°ê³¼ì— ì¦‰ì‹œ ë°˜ì˜ë˜ë„ë¡ ë¡œì§ì„ ê³ ì •í–ˆìŠµë‹ˆë‹¤.
    </div>
    <div class="form-grid">
        <div class="full"><label>ê³¼ì œëª…</label><input type="text" id="weekTitle" value="ì£¼ê°„ê³¼ì œ 1ì›” 3íšŒì°¨ ë¬¸í•™"></div>
        <div class="full"><label>ì„ ìƒë‹˜ ê¹ƒí—ˆë¸Œ ì£¼ì†Œ</label><input type="text" id="adminBaseUrl" value="https://saenarachild-crypto.github.io/kim-korean-homework/stest23.html"></div>
        <div class="full"><label>êµ¬ê¸€ ì›¹ ì•± URL</label><input type="text" id="gasUrl" value="https://script.google.com/macros/s/AKfycbztPu2ZsmP7HOt93FGri3W86YV7i0U-71BbAl9cXclpxZJGTXcSE8ejOwuv8RTdE0bP/exec"></div>
        <div><label>ğŸ“… ì œì¶œ ì‹œì‘ì¼</label><input type="date" id="startDate" value="2026-01-21"></div>
        <div><label>â° ì œì¶œ ë§ˆê°ì¼</label><input type="date" id="endDate" value="2026-01-26"></div>
        <div class="full"><label>ê³µì§€ì‚¬í•­</label><textarea id="notice" rows="2">-ë¬¸í•™ì€ ëª¨ë“  ë¬¸í•­ì„ í’€ì–´ì„œ ì œì¶œí•˜ì„¸ìš”.
-1ì›” 26ì¼ ì›”ìš”ì¼ ì €ë… 11ì‹œê¹Œì§€ ë§ˆê°ì…ë‹ˆë‹¤.</textarea></div>
        <div class="full"><label>ğŸ”¥ í’€ì–´ì•¼ í•  ë¬¸í•­ (ì˜ˆ: 1-14, 21-24)</label><input type="text" id="activeRange" value="1-31"></div>
        <div><label>ğŸ”— ë¬¸ì œì§€ ë§í¬</label><input type="text" id="pdfLink" placeholder="https://..."></div>
        <div><label>ğŸ”— í•´ì„¤ì§€ ë§í¬</label><input type="text" id="ansLink" placeholder="https://..."></div>
        <div><label>ëŒ€ê¸° ì‹œê°„ (ë¶„)</label><input type="number" id="timeLimit" value="3"></div>
        <div><label>ìµœëŒ€ ë„ì „ íšŸìˆ˜</label><input type="number" id="maxTry" value="3"></div>
        <div class="full"><label>ì „ì²´ ì •ë‹µ (ìˆ«ìë§Œ ì—°ì† ì…ë ¥)</label><textarea id="answers" rows="2"></textarea></div>
        <button type="button" id="genBtn">ğŸš€ ì „ì²´ ë°ì´í„° ë™ê¸°í™” ì½”ë“œ ìƒì„±</button>
        <textarea id="output" readonly></textarea>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const btn = document.getElementById("genBtn");
    const output = document.getElementById("output");
    output.addEventListener("click", function() {
        if(!this.value) return;
        navigator.clipboard.writeText(this.value).then(() => { alert("âœ… ë°°í¬ìš© ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"); });
    });

    btn.addEventListener("click", function() {
        // [ìˆ˜ì •] ëª¨ë“  ì…ë ¥ê°’ì„ í´ë¦­ ì‹œì ì— ì‹¤ì‹œê°„ìœ¼ë¡œ ìˆ˜ì§‘
        const week = document.getElementById('weekTitle').value;
        const adminUrl = document.getElementById('adminBaseUrl').value.trim();
        const gasUrl = document.getElementById('gasUrl').value.trim();
        const startDay = document.getElementById('startDate').value;
        const endDay = document.getElementById('endDate').value;
        const noticeTxt = document.getElementById('notice').value.trim().replace(/\n/g, '<br>');
        const rawAns = document.getElementById('answers').value.replace(/[^1-5]/g, '');
        const rangeStr = document.getElementById('activeRange').value;
        const pdf = document.getElementById('pdfLink').value || "#";
        const ansL = document.getElementById('ansLink').value || "#";
        const tLimit = document.getElementById('timeLimit').value || 3;
        const mTry = document.getElementById('maxTry').value || 3;

        const activeNums = new Set();
        if(!rangeStr.trim()) { for(let i=1; i<=rawAns.length; i++) activeNums.add(i); }
        else {
            rangeStr.split(',').forEach(part => {
                const range = part.trim().split('-');
                if (range.length === 2) { for (let i = parseInt(range[0]); i <= parseInt(range[1]); i++) activeNums.add(i); }
                else { const num = parseInt(part.trim()); if(!isNaN(num)) activeNums.add(num); }
            });
        }
        const activeArr = Array.from(activeNums).sort((a,b)=>a-b);

        let c = '<!DOCTYPE html>\n<html lang="ko">\n<head>\n<meta charset="UTF-8">\n<meta name="viewport" content="width=device-width,initial-scale=1.0">\n<title>' + week + '</title>\n<script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"><\/script>\n';
        c += '<style>\n:root{--p:#6c5ce7;--bg:#f8f9fc}body{font-family:-apple-system,sans-serif;background:var(--bg);padding:15px;margin:0}.container{max-width:600px;margin:0 auto;background:#fff;padding:25px;border-radius:20px;box-shadow:0 10px 25px rgba(0,0,0,0.1)}.notice-box{background:#fff3e0;padding:15px;border-radius:12px;margin-bottom:20px;font-size:0.9rem;color:#5d4037;line-height:1.6}.q-card{background:#fff;border:1.5px solid #eee;border-radius:15px;padding:20px;margin-bottom:12px}.options{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;position:relative}.opt-input{position:absolute;width:0;height:0;opacity:0;pointer-events:none}.opt-label{height:45px;border:1.5px solid #eee;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:bold;cursor:pointer;transition:0.2s;position:relative;z-index:1}.opt-input:checked+.opt-label{background:var(--p);color:#fff;box-shadow:0 5px 12px rgba(108,92,231,0.3)}.opt-input:disabled+.opt-label{background:#eee;color:#bbb;cursor:not-allowed;border:none}input,select{padding:12px;border:1px solid #ddd;border-radius:10px;width:100%;box-sizing:border-box;outline:none}\n</style>\n</head><body><div id="overlay"></div><div class="container">';
        c += '<h2 style="text-align:center">' + week + '</h2>';
        c += '<div class="notice-box"><b>[ê³µì§€]</b> ' + noticeTxt + '<br>ğŸ“… ê¸°í•œ: ' + startDay + ' ~ ' + endDay + '</div>';
        c += '<div id="limitMsg" style="display:none;color:#d63031;font-weight:bold;text-align:center;margin-bottom:20px;padding:15px;background:#fab1a0;border-radius:12px"></div>';
        c += '<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:15px"><input type="text" id="cN" placeholder="í•™ì›ëª…"> <input type="text" id="sN" placeholder="í•™ìƒ ì´ë¦„" oninput="checkLimit()"></div>';
        c += '<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:15px"><select id="sD" onchange="checkLimit()"><option value="">ì œì¶œì¼ ì„ íƒ</option></select><a href="' + pdf + '" target="_blank" style="display:flex;align-items:center;justify-content:center;background:#eee;color:#333;text-decoration:none;border-radius:10px;font-weight:bold;font-size:0.8rem">ğŸ“„ ë¬¸ì œì§€</a></div><div id="qC"></div><button id="subBtn" onclick="submit()" style="width:100%;padding:20px;background:#ff6b6b;color:white;border:none;border-radius:15px;font-weight:bold;margin-top:20px;cursor:pointer;font-size:1.1rem">ğŸ“ ë‹µì•ˆ ì œì¶œí•˜ê¸°</button><button id="kakaoBtn" onclick="share()" style="display:none;width:100%;background:#fee500;color:#3c1e1e;border:none;padding:20px;border-radius:15px;font-weight:bold;margin-top:20px;cursor:pointer;font-size:1.1rem">ğŸŸ¡ ì¹´í†¡ìœ¼ë¡œ ì œì¶œ í™•ì¸</button><div id="resArea" style="display:none;margin-top:20px"></div></div>';
        
        c += '<script>\n';
        c += 'let w=0, att=0, isBlocked=false, resT="", isPerfect=false, wrongListStr="";\n';
        c += 'const masterAnswers = [0, ..."' + rawAns + '".split("").map(Number)];\n';
        c += 'const activeList = [' + activeArr.join(',') + '];\n';
        c += 'const totalQ = ' + rawAns.length + ';\n';
        c += 'const maxT=' + mTry + ', waitMin=' + tLimit + ';\n';
        c += 'const startDay="' + startDay + '", endDay="' + endDay + '";\n';
        c += 'const ansLink = "' + ansL + '", HW_ID = "HW_" + Date.now(), ADMIN_BASE = "' + adminUrl + '", GAS_URL = "' + gasUrl + '";\n';
        
        c += 'window.onload = function() {\n';
        c += '  const urlParams = new URLSearchParams(window.location.search);\n';
        c += '  if(urlParams.has("admin_view")){\n';
        c += '    const data = JSON.parse(decodeURIComponent(urlParams.get("admin_view")));\n';
        c += '    document.body.innerHTML = "<div class=\'container\' style=\'margin-top:50px; text-align:center; box-shadow: 0 0 100px rgba(0,0,0,0.2); border: 3px solid #6c5ce7;\'><h2>ğŸ“Š ì„±ì  í™•ì¸</h2><div class=\'notice-box\' style=\'text-align:left; font-size:1.1rem; line-height:2;\'><b>ğŸ‘¤ ì´ë¦„:</b> "+data.name+"<br><b>ğŸ« í•™ì›:</b> "+data.class+"<br><b>ğŸ”„ ë„ì „:</b> "+data.att+"íšŒì°¨<br><b>âŒ ì˜¤ë‹µ:</b> <span style=\'color:red\'>"+data.wrongCount+"ê°œ</span><br><b>ğŸ“ ë²ˆí˜¸:</b> "+(data.wrongList||"ì—†ìŒ")+"</div><button onclick=\'location.href=location.href.split(\\\"?\\\")[0]\' style=\'width:100%;padding:15px;background:#6c5ce7;color:white;border:none;border-radius:10px;font-weight:bold;cursor:pointer\'>ëŒì•„ê°€ê¸°</button></div>";\n';
        c += '    return;\n';
        c += '  }\n';
        c += '  initPage();\n';
        c += '};\n';
        
        c += 'try{if(!Kakao.isInitialized()){Kakao.init("f81d5eae0eaaf6fa2d0bdccbe6916001");}}catch(e){console.error(e);}\n';
        c += 'function initPage(){\n  const sel=document.getElementById("sD"); const start=new Date();\n  for(let i=0; i<7; i++){ let d=new Date(start.getTime() + i*24*60*60*1000); let s=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate(); let opt=document.createElement("option"); opt.value=s; opt.innerText=s; sel.appendChild(opt); }\n';
        c += '  let h=""; for(let n=1; n<=totalQ; n++){\n';
        c += '    const dis = activeList.includes(n) ? "" : "disabled";\n';
        c += '    h+="<div class=\'q-card\'><div style=\'font-weight:bold;margin-bottom:15px;font-size:1.1rem\'>"+n+"ë²ˆ</div><div class=\'options\'>";\n';
        c += '    for(let j=1;j<=5;j++){ h+="<input type=\'radio\' name=\'q"+n+"\' id=\'q"+n+"_"+j+"\' value=\'"+j+"\' class=\'opt-input\' "+dis+"><label for=\'q"+n+"_"+j+"\' class=\'opt-label\'>"+j+"</label>"; }\n';
        c += '    h+="</div></div>";\n  } document.getElementById("qC").innerHTML=h; checkDateLimit();\n}\n';
        c += 'function submit(){\n  if(isBlocked) return; const cN=document.getElementById("cN").value, sN=document.getElementById("sN").value.trim().replace(/\\s/g,""), sD=document.getElementById("sD").value; if(!cN||!sN||!sD){alert("ì •ë³´ ì…ë ¥!"); return;}\n';
        c += '  w=0; let wrongArray=[];\n';
        c += '  activeList.forEach(qNum => {\n';
        c += '    let selected = document.querySelector("input[name=\'q"+qNum+"\']:checked");\n';
        c += '    let userVal = selected ? parseInt(selected.value) : 0;\n';
        c += '    if(userVal !== masterAnswers[qNum]) { w++; wrongArray.push(qNum); }\n';
        c += '  });\n';
        c += '  isPerfect = (w === 0); wrongListStr = wrongArray.join(","); const key="att_"+sN+"_"+HW_ID; att=parseInt(localStorage.getItem(key)||0)+1; localStorage.setItem(key, att); if(isPerfect){ localStorage.setItem("perf_"+sN+"_"+HW_ID, "true"); }\n';
        c += '  resT="[" + "' + week + '" + "]\\n"+sN+"("+att+"íšŒì°¨) ì œì¶œ ì™„ë£Œ"; alert("ì¹´í†¡ ì „ì†¡ í›„ [ì™„ë£Œ] í´ë¦­!"); document.getElementById("subBtn").style.display="none"; document.getElementById("kakaoBtn").style.display="block";\n';
        c += '  fetch(GAS_URL, { method: "POST", mode: "no-cors", body: JSON.stringify({exam: "' + week + '", name: sN, class: cN, attempt: att, wrongCount: w, wrongList: wrongListStr}) });\n}\n';
        c += 'function checkDateLimit(){ const now = new Date(); now.setHours(0,0,0,0); const sDate = new Date(startDay); sDate.setHours(0,0,0,0); const eDate = new Date(endDay); eDate.setHours(23,59,59,999); const msg = document.getElementById("limitMsg"); const btn = document.getElementById("subBtn"); if(now < sDate){ isBlocked = true; btn.style.display="none"; msg.style.display="block"; msg.innerText="â³ ê¸°ê°„ ì•„ë‹˜."; } else if(now > eDate){ isBlocked = true; btn.style.display="none"; msg.style.display="block"; msg.innerText="ğŸš« ë§ˆê°ë¨."; } }\n';
        c += 'function checkLimit(){ if(isBlocked) return; const sN=document.getElementById("sN").value.trim().replace(/\\s/g,""), sD=document.getElementById("sD").value; if(sN.length < 2 || !sD){ document.getElementById("subBtn").style.display="block"; return; } const key="att_"+sN+"_"+HW_ID; att=parseInt(localStorage.getItem(key)||0); const pKey="perf_"+sN+"_"+HW_ID; if(localStorage.getItem(pKey)=="true"){ isBlocked=true; showFinalResult("ë°±ì !"); return; } if(maxT>0 && att>=maxT){ isBlocked=true; document.getElementById("subBtn").style.display="none"; document.getElementById("limitMsg").style.display="block"; document.getElementById("limitMsg").innerText="ğŸš« ê¸°íšŒ ì†Œì§„."; showFinalResult("ê¸°íšŒ ì†Œì§„"); } }\n';
        c += 'function done(){ document.getElementById("overlay").style.display="none"; document.getElementById("kakaoBtn").style.display="none"; if(isPerfect){ showFinalResult("ë°±ì !"); return; } if(att >= maxT){ showFinalResult("ê¸°íšŒ ì†Œì§„"); return; } alert("ğŸ“Š " + att + "íšŒì°¨: ì˜¤ë‹µ " + w + "ê°œ"); document.querySelectorAll(".opt-input").forEach(rb => { if(!rb.disabled) rb.checked = false; }); document.getElementById("subBtn").style.display="block"; }\n';
        c += 'function showFinalResult(msg){ const r=document.getElementById("resArea"); r.style.display="block"; r.innerHTML = "<div style=\'padding:25px;background:#eeebff;border-radius:15px;text-align:center\'><h3>ğŸ "+msg+"</h3><p>ì •ë‹µ í™•ì¸.</p>"; r.innerHTML += "<a href=\'" + ansLink + "\' target=\'_blank\' style=\'display:block;padding:15px;background:var(--p);color:white;text-decoration:none;border-radius:10px;font-weight:bold\'>ğŸ“˜ í•´ì„¤ì§€ ë³´ê¸°</a></div>"; document.getElementById("subBtn").style.display="none"; }\n';
        c += 'function share(){ const adminData = encodeURIComponent(JSON.stringify({name:document.getElementById("sN").value, class:document.getElementById("cN").value, att:att, wrongCount:w, wrongList:wrongListStr})); const fullAdminLink = ADMIN_BASE + "?admin_view=" + adminData; Kakao.Share.sendDefault({ objectType: "text", text: resT, link: { mobileWebUrl: fullAdminLink, webUrl: fullAdminLink } }); setTimeout(()=>{ const o=document.getElementById("overlay"); o.style.display="flex"; o.innerHTML="<div style=\'background:white;padding:30px;border-radius:20px;text-align:center\'><p style=\'font-weight:bold\'>ì¹´í†¡ì„ ì „ì†¡í•˜ì…¨ë‚˜ìš”?</p><button onclick=\'done()\' style=\'width:100%;padding:12px;background:#fee500;border:none;border-radius:10px;font-weight:bold;cursor:pointer\'>ë„¤</button></div>"; }, 1500); }\n';
        c += '<\/script></body></html>';
        
        document.getElementById('output').value = c;
    });
});
</script>
</body>
</html>