<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>ì£¼ê°„ ê³¼ì œ 2ì›” 4íšŒì°¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Pretendard', sans-serif; background: #f8fafc; -webkit-tap-highlight-color: transparent; overflow-x: hidden; }
        .bubble-input:checked + label { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); color: white; border-color: transparent; box-shadow: 0 4px 12px rgba(79,70,229,0.3); transform: translateY(-2px); }
        .glass-header { background: rgba(79, 70, 229, 0.98); backdrop-filter: blur(20px); }
        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 2000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .q-row { display: flex; align-items: center; gap: 1rem; background: white; padding: 1.25rem; border-radius: 1.5rem; border: 1px solid #f1f5f9; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        /* ë¬¸í•­ ë²ˆí˜¸ ìŠ¤íƒ€ì¼ ê°•í™”: ì„ íƒì§€(0.9rem)ì™€ í™•ì—°íˆ êµ¬ë¶„ë˜ë„ë¡ í¬ê¸°ì™€ ìƒ‰ìƒ ì¡°ì • */
        .q-num { width: 3.5rem; height: 3rem; background: #eef2ff; border-left: 5px solid #4f46e5; border-radius: 0.75rem 1.25rem 1.25rem 0.75rem; display: flex; align-items: center; justify-content: center; font-weight: 900; color: #4338ca; font-size: 1.2rem; flex-shrink: 0; box-shadow: inset 0 2px 4px rgba(0,0,0,0.03); }
        .choice-label { width: 100%; height: 2.75rem; display: flex; align-items: center; justify-content: center; border: 1.5px solid #f1f5f9; rounded-xl; font-weight: 700; background: #f8fafc; text-slate-400; transition: all 0.2s; cursor: pointer; font-size: 0.95rem; }
        input[type="text"] { font-size: 16px !important; } 
    </style>
</head>
<body>
    <div id="overlay"></div>
    <div id="app" class="max-w-md mx-auto min-h-screen bg-white shadow-2xl overflow-hidden flex flex-col relative">
        
        <!-- Intro View -->
        <div id="view-intro" class="flex-1 p-8 flex flex-col justify-center text-center space-y-8 animate-in fade-in duration-500">
            <div class="w-24 h-24 bg-indigo-600 rounded-[2.5rem] mx-auto flex items-center justify-center text-white text-4xl shadow-2xl">ğŸ›ï¸</div>
            <div class="space-y-2">
                <h1 class="text-2xl font-black text-slate-800 tracking-tight">ì£¼ê°„ ê³¼ì œ 2ì›” 4íšŒì°¨</h1>
                <p class="text-[10px] font-black text-indigo-500 uppercase tracking-widest">Digital Answer Sheet System</p>
            </div>
            <div class="bg-slate-50 p-6 rounded-[2rem] text-left border border-slate-100 space-y-4">
                <div class="flex items-center gap-2 text-indigo-600 font-black text-xs uppercase">
                    <span class="w-2 h-2 bg-indigo-600 rounded-full animate-pulse"></span>
                    Guide Line
                </div>
                <p class="text-sm leading-relaxed text-slate-600 font-bold">1. ì§€ë¬¸ì—ì„œ ì§ì ‘ ê·¼ê±°ë¥¼ ì°¾ëŠ” ì—°ìŠµì´ ì‹¤ë ¥ì„ ë§Œë“­ë‹ˆë‹¤.<br>2. í‹€ë¦° ë¬¸ì œëŠ” ë°˜ë“œì‹œ ë‹¤ì‹œ ì½ê³  ì‚¬ê³ ë¥¼ êµì •í•˜ì„¸ìš”.</p>
                <div class="pt-4 border-t border-slate-200 text-[10px] font-black text-slate-400 uppercase tracking-tight flex justify-between italic">
                    <span>2026-02-14</span>
                    <span>â–¶</span>
                    <span>2026-02-21</span>
                </div>
            </div>
            <div id="date-msg" class="hidden py-4 px-6 bg-rose-50 text-rose-600 rounded-2xl font-bold text-sm"></div>
            <button onclick="start()" class="w-full bg-indigo-600 text-white font-black py-5 rounded-2xl text-lg shadow-xl shadow-indigo-200 active:scale-95 transition-all">ì‹œìŠ¤í…œ ì ‘ì†í•˜ê¸°</button>
        </div>

        <!-- Exam View -->
        <div id="view-exam" class="hidden flex-1 pb-44">
            <header class="glass-header text-white p-5 sticky top-0 z-20 shadow-lg">
                <div class="flex justify-between items-center mb-4 px-1">
                    <h2 class="text-xs font-black truncate max-w-[180px]">2ì›” 4íšŒì°¨</h2>
                    <div id="timer" class="text-[9px] font-black bg-white/20 px-3 py-1.5 rounded-full border border-white/10 shrink-0">â± ì…ë ¥ ê°€ëŠ¥</div>
                </div>
                <!-- ì´ë¦„ì¹¸ ì˜ì—­ ë²—ì–´ë‚¨ ë°©ì§€: Grid 2ì—´ êµ¬ì„± -->
                <div class="grid grid-cols-2 gap-2">
                    <input type="text" id="u-academy" placeholder="í•™ì›ëª…" class="w-full bg-white/10 border border-white/20 p-3 rounded-xl text-xs placeholder:text-white/60 outline-none focus:bg-white/20 font-bold transition-all truncate">
                    <input type="text" id="u-name" placeholder="ì„±í•¨" class="w-full bg-white/10 border border-white/20 p-3 rounded-xl text-xs placeholder:text-white/60 outline-none focus:bg-white/20 font-bold transition-all truncate">
                </div>
            </header>

            <div class="p-5 space-y-6">
                
                
                <div id="pdf-area" class="flex justify-center">
                    <a id="pdf-link" href="https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQDJa2COYzRGRLBXhJ1eb0NDAVailpdzgEJ-ash6Ln46MyU?e=tF4AMy" target="_blank" class="text-[10px] font-black bg-indigo-50 text-indigo-600 px-6 py-2.5 rounded-full border border-indigo-100 flex items-center gap-2 shadow-sm">
                        <span>ğŸ“„</span> ë¬¸ì œì§€(PDF) ë³´ê¸°
                    </a>
                </div>

                <div id="sheet" class="space-y-3"></div>
            </div>

            <div class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white/95 backdrop-blur-xl p-5 border-t border-slate-100 flex flex-col gap-3 z-30 shadow-[0_-10px_30px_rgba(0,0,0,0.08)]">
                <button id="btn-submit" onclick="submit()" class="w-full bg-indigo-600 text-white font-black py-4 rounded-xl text-md shadow-lg shadow-indigo-100 active:scale-95 transition-all">ğŸ“ ë‹µì•ˆ ì œì¶œ</button>
                <button id="btn-kakao" onclick="share()" class="hidden w-full bg-[#FEE500] text-[#3c1e1e] font-black py-4 rounded-xl text-md shadow-lg shadow-yellow-100">ğŸŸ¡ ì¹´ì¹´ì˜¤í†¡ ê²°ê³¼ ì „ì†¡</button>
                <button id="btn-exp" class="py-3.5 rounded-xl font-black text-[10px] text-slate-400 border border-slate-100 bg-slate-50 cursor-not-allowed">ğŸ”’ ì œì¶œ í›„ í•´ì„¤ì§€ ê³µê°œ</button>
            </div>
        </div>

        <!-- Final View -->
        <div id="view-final" class="hidden flex-1 p-10 flex flex-col justify-center text-center space-y-6 animate-in zoom-in duration-500">
            <div class="text-7xl">ğŸ†</div>
            <div class="space-y-2">
                <h2 class="text-2xl font-black text-slate-800 tracking-tight">ëª¨ë“  ë„ì „ ì™„ë£Œ</h2>
                <p class="text-slate-400 font-bold text-sm leading-relaxed px-4">ì˜¤ëŠ˜ì˜ ë¶„ì„ì´ ë‚´ì¼ì˜ ì‹¤ë ¥ì´ ë©ë‹ˆë‹¤.<br>íšŒì°¨ë³„ ì˜¤ë‹µì„ ê¼¼ê¼¼íˆ ë³µê¸°í•˜ì„¸ìš”.</p>
            </div>
            <a href="https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQDJa2COYzRGRLBXhJ1eb0NDAVailpdzgEJ-ash6Ln46MyU?e=tF4AMy" target="_blank" class="w-full bg-indigo-600 text-white font-black py-5 rounded-xl shadow-2xl shadow-indigo-100">ğŸ“˜ ì „ì²´ í•´ì„¤ì§€ í™•ì¸</a>
        </div>
    </div>

    <script>
        const C = {
            hwId: "HW___2_4",
            title: "ì£¼ê°„ ê³¼ì œ 2ì›” 4íšŒì°¨",
            ansA: ["1","2","3","4"],
            ansB: [],
            activeA: [1,2,3,4],
            activeB: [],
            gas: "https://script.google.com/macros/s/AKfycbzkA0CC8GAhcdAP16fzq32ufyTIYolZ8TyeuSjW5FAsG0M3vPcYQOIaSKIOOYKYgtDc/exec",
            kakao: "f81d5eae0eaaf6fa2d0bdccbe6916001",
            admin: "",
            maxT: 3,
            wait: 3,
            start: "2026-02-14",
            end: "2026-02-21",
            exp: "https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQDJa2COYzRGRLBXhJ1eb0NDAVailpdzgEJ-ash6Ln46MyU?e=tF4AMy"
        };

        let type = 'A';
        let ans = {};
        let att = parseInt(localStorage.getItem('att_'+C.hwId) || '0');
        let lastT = parseInt(localStorage.getItem('time_'+C.hwId) || '0');
        let done = localStorage.getItem('done_'+C.hwId) === 'true';
        let lastResult = null;

        function start() {
            const now = new Date();
            const s = new Date(C.start); s.setHours(0,0,0,0);
            const e = new Date(C.end); e.setHours(23,59,59,999);
            const msg = document.getElementById('date-msg');
            
            if (now < s) { msg.innerText = "â³ ì•„ì§ ì œì¶œ ê¸°ê°„ì´ ì•„ë‹™ë‹ˆë‹¤."; msg.classList.remove('hidden'); return; }
            if (now > e) { msg.innerText = "ğŸš« ì œì¶œ ê¸°í•œì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤."; msg.classList.remove('hidden'); return; }
            if (done || (C.maxT > 0 && att >= C.maxT)) { showFinal(); return; }

            document.getElementById('view-intro').classList.add('hidden');
            document.getElementById('view-exam').classList.remove('hidden');
            render();
            checkTimer();
        }

        function setType(t) {
            type = t;
            render();
            document.getElementById('tab-a')?.classList.toggle('bg-white', t==='A');
            document.getElementById('tab-a')?.classList.toggle('text-indigo-600', t==='A');
            document.getElementById('tab-b')?.classList.toggle('bg-white', t==='B');
            document.getElementById('tab-b')?.classList.toggle('text-indigo-600', t==='B');
            document.getElementById('pdf-link').href = t==='A' ? "https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQDJa2COYzRGRLBXhJ1eb0NDAVailpdzgEJ-ash6Ln46MyU?e=tF4AMy" : "";
        }

        function render() {
            const sheet = document.getElementById('sheet');
            const list = type === 'A' ? C.activeA : C.activeB;
            sheet.innerHTML = '';
            list.forEach(no => {
                const row = document.createElement('div');
                row.className = 'q-row';
                row.innerHTML = `<div class="q-num">${no}</div>
                    <div class="flex-1 flex justify-between gap-2">
                        ${[1,2,3,4,5].map(v => `<div class="flex-1">
                            <input type="radio" name="q${no}" id="q${no}_${v}" value="${v}" class="hidden bubble-input" ${ans[type+'_'+no]==v?'checked':''} onchange="ans['${type}_${no}']=${v}">
                            <label for="q${no}_${v}" class="choice-label transition-all rounded-xl border-2 border-slate-50">${v}</label>
                        </div>`).join('')}
                    </div>`;
                sheet.appendChild(row);
            });
        }

        function submit() {
            const name = document.getElementById('u-name').value.trim();
            const academy = document.getElementById('u-academy').value.trim();
            if(!name || !academy) return alert('ì„±í•¨ê³¼ í•™ì›ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.');

            const list = type === 'A' ? C.activeA : C.activeB;
            const master = type === 'A' ? C.ansA : C.ansB;
            let wrongs = [];
            let currentAns = {};

            list.forEach(no => {
                const selected = ans[type+'_'+no] || 0;
                currentAns[no] = selected;
                if (selected.toString() !== master[no-1]) {
                    wrongs.push(no);
                }
            });

            const score = Math.round(((list.length - wrongs.length) / list.length) * 100);
            att++;
            lastT = Date.now();
            
            lastResult = {
                name, academy, score, attempt: att, 
                wrongList: wrongs.join(','), 
                timestamp: lastT
            };

            fetch(C.gas, {
                method: 'POST',
                mode: 'no-cors', 
                body: JSON.stringify({
                    action: 'submit_exam', 
                    exam_id: C.hwId, 
                    name, academy,
                    attempt: att, 
                    score,
                    wrongList: lastResult.wrongList
                })
            }).catch(e => console.log('Record queued:', e));

            localStorage.setItem('att_'+C.hwId, att);
            localStorage.setItem('time_'+C.hwId, lastT);

            document.getElementById('btn-submit').classList.add('hidden');
            document.getElementById('btn-kakao').classList.remove('hidden');
            alert("ë‹µì•ˆ ì œì¶œ ì™„ë£Œ! ì¹´ì¹´ì˜¤í†¡ ì „ì†¡ì„ ì§„í–‰í•´ì£¼ì„¸ìš”.");
        }

        function share() {
            if(!Kakao.isInitialized()) Kakao.init(C.kakao);
            const adminData = encodeURIComponent(JSON.stringify({
                name: lastResult.name, academy: lastResult.academy, 
                score: lastResult.score, att: lastResult.attempt, 
                wrongs: lastResult.wrongList
            }));
            const link = (C.admin || window.location.href.split('?')[0]) + "?admin_view=" + adminData;

            Kakao.Share.sendDefault({
                objectType: 'feed',
                content: {
                    title: C.title,
                    description: lastResult.name + " (" + lastResult.score + "ì  ì œì¶œ)",
                    imageUrl: 'https://mud-kage.kakao.com/dn/Q2iNx/btqgeRgV54P/VLdBs9cvyn8BJXB3o7N8UK/kakaolink40_original.png',
                    link: { mobileWebUrl: link, webUrl: link }
                },
                buttons: [{ title: 'ë¦¬í¬íŠ¸ í™•ì¸', link: { mobileWebUrl: link, webUrl: link } }]
            });

            document.getElementById('overlay').style.display = 'flex';
            document.getElementById('overlay').innerHTML = `<div class="bg-white p-8 rounded-[3rem] text-center space-y-6 mx-4 shadow-2xl animate-in zoom-in duration-300">
                <div class="text-5xl">ğŸ“±</div>
                <p class="font-black text-slate-800 leading-tight text-lg">ì¹´ì¹´ì˜¤í†¡ ë¦¬í¬íŠ¸ ì „ì†¡ì„<br>ë§ˆì¹˜ì…¨ë‚˜ìš”?</p>
                <button onclick="finishShare()" class="w-full bg-indigo-600 text-white font-black py-4.5 rounded-2xl shadow-xl shadow-indigo-100">ë„¤, ì™„ë£Œí–ˆìŠµë‹ˆë‹¤</button>
            </div>`;
        }

        function finishShare() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('btn-kakao').classList.add('hidden');
            document.getElementById('btn-submit').classList.remove('hidden');
            
            if(true && lastResult.score === 100) { 
                localStorage.setItem('done_'+C.hwId, 'true'); 
                showFinal(); return; 
            }
            if(C.maxT > 0 && att >= C.maxT) { showFinal(); return; }

            const wList = lastResult.wrongList || 'ì—†ìŒ';
            alert(`ğŸ“Š ${att}íšŒì°¨ ê²°ê³¼: ${lastResult.score}ì ${hintLogic}`);
            
            ans = {}; render(); checkTimer();
            const btnExp = document.getElementById('btn-exp');
            if(att >= 2 || lastResult.score === 100) {
                btnExp.className = 'w-full bg-emerald-600 text-white py-4.5 rounded-2xl font-black text-md shadow-xl shadow-emerald-100';
                btnExp.innerText = 'âœ… í•´ì„¤ì§€ ì—´ê¸°';
                btnExp.onclick = () => window.open(C.exp);
            }
        }

        function checkTimer() {
            if(!true) return;
            const diff = Date.now() - lastT;
            const wait = C.wait * 60 * 1000;
            const btn = document.getElementById('btn-submit');
            const timer = document.getElementById('timer');
            
            if(att > 0 && diff < wait) {
                btn.disabled = true; btn.classList.add('opacity-50');
                const itv = setInterval(() => {
                    const rem = Math.ceil((wait - (Date.now() - lastT)) / 1000);
                    if(rem <= 0) {
                        btn.disabled = false; btn.classList.remove('opacity-50');
                        timer.innerText = "â± ì…ë ¥ ê°€ëŠ¥"; clearInterval(itv);
                    } else {
                        const m = Math.floor(rem/60), s = rem%60;
                        timer.innerText = `â± ì¬ì‘ì‹œ ëŒ€ê¸°: ${m}:${s<10?'0'+s:s}`;
                    }
                }, 1000);
            }
        }

        function showFinal() {
            document.getElementById('view-intro').classList.add('hidden');
            document.getElementById('view-exam').classList.add('hidden');
            document.getElementById('view-final').classList.remove('hidden');
        }

        window.addEventListener('load', () => {
            const p = new URLSearchParams(window.location.search);
            if(p.has('admin_view')) {
                const d = JSON.parse(decodeURIComponent(p.get('admin_view')));
                document.body.innerHTML = `<div class="min-h-screen bg-slate-50 flex items-center justify-center p-6">
                    <div class="w-full max-w-sm bg-white p-8 rounded-[3.5rem] shadow-2xl border border-indigo-50 text-center space-y-6">
                        <div class="w-16 h-16 bg-indigo-50 rounded-[2rem] mx-auto flex items-center justify-center text-3xl">ğŸ“Š</div>
                        <h2 class="text-xl font-black text-indigo-900 tracking-tight">ì œì¶œ ë¦¬í¬íŠ¸ ë¦¬í¬íŠ¸</h2>
                        <div class="text-left space-y-3.5 bg-slate-50 p-7 rounded-[2.5rem] font-bold text-xs leading-relaxed border border-slate-100">
                            <p class="flex justify-between"><span>ğŸ‘¤ ì„±í•¨</span> <span class="text-slate-900 font-black">${d.name}</span></p>
                            <p class="flex justify-between"><span>ğŸ« í•™ì›</span> <span class="text-slate-900 font-black">${d.academy}</span></p>
                            <p class="flex justify-between"><span>ğŸ”„ íšŒì°¨</span> <span class="text-slate-900 font-black">${d.att}íšŒì°¨</span></p>
                            <div class="pt-3 border-t border-slate-200">
                                <p class="flex justify-between items-center"><span class="text-slate-400">ğŸ¯ ìµœì¢… ì ìˆ˜</span> <span class="text-indigo-600 text-xl font-black">${d.score}ì </span></p>
                            </div>
                            <p class="text-[9px] text-rose-500 font-black mt-2 bg-rose-50 p-3 rounded-xl border border-rose-100 leading-snug">âŒ ì˜¤ë‹µ ë²ˆí˜¸: ${d.wrongs || 'ì—†ìŒ'}</p>
                        </div>
                        <button onclick="location.href=location.href.split('?')[0]" class="w-full py-4.5 bg-indigo-600 text-white rounded-2xl font-black shadow-xl shadow-indigo-100">ì‹œìŠ¤í…œìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
                    </div>
                </div>`;
            }
        });
    </script>
</body>
</html>