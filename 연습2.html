<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>ìˆ˜ì—… í‰ê°€ ì—°ìŠµ2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Pretendard', sans-serif; background: #f8fafc; -webkit-tap-highlight-color: transparent; }
        .bubble-input:checked + label { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); color: white; border-color: transparent; box-shadow: 0 4px 15px rgba(79,70,229,0.4); transform: scale(1.05); }
        .glass-header { background: rgba(79, 70, 229, 0.95); backdrop-filter: blur(15px); }
        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 2000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
        .locked { background: #e2e8f0 !important; color: #94a3b8 !important; cursor: not-allowed !important; pointer-events: none; }
        .q-row { display: flex; align-items: center; gap: 1rem; background: white; padding: 1.25rem; border-radius: 1.5rem; border: 1px solid #f1f5f9; }
        .q-num { width: 3.5rem; height: 3rem; background: #f8fafc; border-left: 4px solid #4f46e5; border-radius: 0.5rem 1rem 1rem 0.5rem; display: flex; align-items: center; justify-content: center; font-weight: 900; color: #1e1b4b; }
    </style>
</head>
<body class="p-0 sm:p-4">
    <div id="overlay"></div>
    <div id="app" class="max-w-md mx-auto min-h-screen bg-white shadow-2xl sm:rounded-[3rem] overflow-hidden flex flex-col relative">
        
        <div id="view-intro" class="flex-1 p-10 flex flex-col justify-center text-center space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
            <div class="w-24 h-24 bg-indigo-600 rounded-3xl mx-auto flex items-center justify-center text-white text-4xl shadow-2xl">ğŸ›ï¸</div>
            <h1 class="text-2xl font-black text-slate-800 leading-tight">ìˆ˜ì—… í‰ê°€ ì—°ìŠµ2</h1>
            <div class="bg-slate-50 p-6 rounded-2xl text-left border border-slate-100">
                <p class="text-sm font-bold text-slate-500 mb-2">ğŸ“¢ ê³¼ì œ ì•ˆë‚´</p>
                <p class="text-sm leading-relaxed text-slate-700">1. ì§€ë¬¸ì—ì„œ ì§ì ‘ ê·¼ê±°ë¥¼ ì°¾ëŠ” ì—°ìŠµì´ ì‹¤ë ¥ì„ ë§Œë“­ë‹ˆë‹¤.<br>2. í‹€ë¦° ë¬¸ì œëŠ” ë°˜ë“œì‹œ ë‹¤ì‹œ ì½ê³  ì‚¬ê³ ë¥¼ êµì •í•˜ì„¸ìš”.</p>
                <div class="mt-4 pt-4 border-t border-slate-200 text-[11px] font-black text-indigo-600 uppercase tracking-widest">
                    PERIOD: 2026-02-14 ~ 2026-02-21
                </div>
            </div>
            <div id="date-msg" class="hidden py-4 px-6 bg-rose-50 text-rose-600 rounded-2xl font-bold text-sm"></div>
            <button id="btn-start" onclick="start()" class="w-full bg-indigo-600 text-white font-black py-6 rounded-2xl text-lg shadow-xl active:scale-95 transition-all">ê³¼ì œ ì‹œìŠ¤í…œ ì ‘ì†</button>
        </div>

        <div id="view-exam" class="hidden flex-1 pb-44">
            <header class="glass-header text-white p-6 sticky top-0 z-20 shadow-lg">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-black">ì—°ìŠµ2</h2>
                    <div id="timer" class="text-[10px] font-black bg-white/20 px-3 py-1 rounded-full">â± ì…ë ¥ ê°€ëŠ¥</div>
                </div>
                <div class="flex gap-2">
                    <input type="text" id="u-academy" placeholder="í•™ì›ëª…" class="flex-1 bg-white/10 border border-white/20 p-3 rounded-xl text-sm placeholder:text-white/50 outline-none focus:bg-white/20">
                    <input type="text" id="u-name" placeholder="ì„±í•¨" class="flex-1 bg-white/10 border border-white/20 p-3 rounded-xl text-sm placeholder:text-white/50 outline-none focus:bg-white/20">
                </div>
            </header>

            <div class="p-6 space-y-6">
                
                <div id="pdf-area" class="flex justify-center">
                    <a id="pdf-link" href="https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQDJa2COYzRGRLBXhJ1eb0NDAVailpdzgEJ-ash6Ln46MyU?e=aIOfpq" target="_blank" class="text-[11px] font-black bg-indigo-50 text-indigo-600 px-4 py-2 rounded-full border border-indigo-100">ğŸ“„ ë¬¸ì œì§€(PDF) ì—´ê¸°</a>
                </div>
                <div id="sheet" class="space-y-3"></div>
            </div>

            <div class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white/90 backdrop-blur-xl p-6 border-t flex flex-col gap-3 z-30">
                <button id="btn-submit" onclick="submit()" class="w-full bg-indigo-600 text-white font-black py-5 rounded-2xl text-lg shadow-xl">ğŸ“ ë‹µì•ˆ ì œì¶œ</button>
                <button id="btn-kakao" onclick="share()" class="hidden w-full bg-[#FEE500] text-[#3c1e1e] font-black py-5 rounded-2xl text-lg">ğŸŸ¡ ì¹´ì¹´ì˜¤í†¡ ê²°ê³¼ ì œì¶œ</button>
                <button id="btn-exp" class="locked py-4 rounded-2xl font-black text-xs text-slate-400">ğŸ”’ ì œì¶œ í›„ í•´ì„¤ì§€ ê³µê°œ</button>
            </div>
        </div>

        <div id="view-final" class="hidden flex-1 p-10 flex flex-col justify-center text-center space-y-6">
            <div class="text-6xl">ğŸ</div>
            <h2 class="text-2xl font-black">ëª¨ë“  ë„ì „ ì™„ë£Œ</h2>
            <p class="text-slate-500 font-bold text-sm">ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤. ì§€ë¬¸ì„ ë‹¤ì‹œ í•œ ë²ˆ<br>ë¶„ì„í•˜ë©° ì‹¤ë ¥ì„ ë‹¤ì§€ì„¸ìš”.</p>
            <a href="https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQDJa2COYzRGRLBXhJ1eb0NDAVailpdzgEJ-ash6Ln46MyU?e=aIOfpq" target="_blank" class="w-full bg-indigo-600 text-white font-black py-5 rounded-2xl">ğŸ“˜ ì „ì²´ í•´ì„¤ì§€ í™•ì¸</a>
        </div>
    </div>

    <script>
        const C = {
            hwId: "HW___2",
            title: "ìˆ˜ì—… í‰ê°€ ì—°ìŠµ2",
            hashA: "",
            hashB: "",
            activeA: [1,2,3],
            activeB: [],
            gas: "https://script.google.com/macros/s/AKfycbzkA0CC8GAhcdAP16fzq32ufyTIYolZ8TyeuSjW5FAsG0M3vPcYQOIaSKIOOYKYgtDc/exec",
            kakao: "f81d5eae0eaaf6fa2d0bdccbe6916001",
            admin: "",
            maxT: 3,
            wait: 3,
            start: "2026-02-14",
            end: "2026-02-21",
            exp: "https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQDJa2COYzRGRLBXhJ1eb0NDAVailpdzgEJ-ash6Ln46MyU?e=aIOfpq"
        };

        let type = 'A';
        let ans = {};
        let att = parseInt(localStorage.getItem('att_'+C.hwId) || '0');
        let lastT = parseInt(localStorage.getItem('time_'+C.hwId) || '0');
        let done = localStorage.getItem('done_'+C.hwId) === 'true';
        let res = null;

        function start() {
            const now = new Date();
            const s = new Date(C.start); s.setHours(0,0,0,0);
            const e = new Date(C.end); e.setHours(23,59,59,999);
            const msg = document.getElementById('date-msg');
            
            if (now < s) { msg.innerText = "â³ ì•„ì§ ì œì¶œ ê¸°ê°„ì´ ì•„ë‹™ë‹ˆë‹¤."; msg.classList.remove('hidden'); return; }
            if (now > e) { msg.innerText = "ğŸš« ì œì¶œ ê¸°í•œì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."; msg.classList.remove('hidden'); return; }
            
            if (done || (C.maxT > 0 && att >= C.maxT)) { showFinal(); return; }

            document.getElementById('view-intro').classList.add('hidden');
            document.getElementById('view-exam').classList.remove('hidden');
            render();
            checkTimer();
        }

        function setType(t) {
            type = t;
            render();
            document.getElementById('tab-a')?.classList.toggle('bg-white', t==='A');
            document.getElementById('tab-b')?.classList.toggle('bg-white', t==='B');
            document.getElementById('pdf-link').href = t==='A' ? "https://goe2427-my.sharepoint.com/:b:/g/personal/pure173_jeonghyeonh_goe_go_kr/IQDJa2COYzRGRLBXhJ1eb0NDAVailpdzgEJ-ash6Ln46MyU?e=aIOfpq" : "";
        }

        function render() {
            const sheet = document.getElementById('sheet');
            const list = type === 'A' ? C.activeA : C.activeB;
            sheet.innerHTML = '';
            list.forEach(no => {
                const row = document.createElement('div');
                row.className = 'q-row';
                row.innerHTML = `<div class="q-num">${no}</div>
                    <div class="flex-1 flex justify-between gap-2">
                        ${[1,2,3,4,5].map(v => `<div class="flex-1">
                            <input type="radio" name="q${no}" id="q${no}_${v}" value="${v}" class="hidden bubble-input" ${ans[type+'_'+no]==v?'checked':''} onchange="ans['${type}_${no}']=${v}">
                            <label for="q${no}_${v}" class="w-full h-12 flex items-center justify-center border-2 border-slate-100 rounded-xl font-black bg-slate-50">${v}</label>
                        </div>`).join('')}
                    </div>`;
                sheet.appendChild(row);
            });
        }

        async function submit() {
            const name = document.getElementById('u-name').value.trim();
            const academy = document.getElementById('u-academy').value.trim();
            if(!name || !academy) return alert('ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');

            const list = type === 'A' ? C.activeA : C.activeB;
            let current = {};
            list.forEach(no => current[no] = ans[type+'_'+no] || 0);

            try {
                const response = await fetch(C.gas, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'submit_exam', exam_id: C.hwId, name, academy,
                        attempt: att + 1, answers: current, hash: type==='A' ? C.hashA : C.hashB
                    })
                });
                const result = await response.json();
                if(!result.success) return alert(result.message);

                res = result;
                att = result.attempt;
                lastT = Date.now();
                localStorage.setItem('att_'+C.hwId, att);
                localStorage.setItem('time_'+C.hwId, lastT);

                alert("ì œì¶œ ì„±ê³µ! ì¹´í†¡ ê³µìœ  í›„ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.");
                document.getElementById('btn-submit').classList.add('hidden');
                document.getElementById('btn-kakao').classList.remove('hidden');
            } catch(e) { alert('í†µì‹  ì˜¤ë¥˜'); }
        }

        function share() {
            if(!Kakao.isInitialized()) Kakao.init(C.kakao);
            const adminData = encodeURIComponent(JSON.stringify({
                name: res.name, academy: res.academy, score: res.score, 
                att: res.attempt, wrongs: res.wrongList
            }));
            const link = (C.admin || window.location.href.split('?')[0]) + "?admin_view=" + adminData;

            Kakao.Share.sendDefault({
                objectType: 'feed',
                content: {
                    title: C.title,
                    description: res.name + " (" + res.score + "ì  ì œì¶œ)",
                    imageUrl: 'https://mud-kage.kakao.com/dn/Q2iNx/btqgeRgV54P/VLdBs9cvyn8BJXB3o7N8UK/kakaolink40_original.png',
                    link: { mobileWebUrl: link, webUrl: link }
                },
                buttons: [{ title: 'ë¦¬í¬íŠ¸ í™•ì¸', link: { mobileWebUrl: link, webUrl: link } }]
            });

            document.getElementById('overlay').style.display = 'flex';
            document.getElementById('overlay').innerHTML = `<div class="bg-white p-8 rounded-3xl text-center space-y-4 mx-4">
                <p class="font-black text-slate-800">ğŸ“± ì „ì†¡ì„ ì™„ë£Œí•˜ì…¨ë‚˜ìš”?</p>
                <button onclick="finishShare()" class="w-full bg-indigo-600 text-white font-black py-4 rounded-xl">ë„¤, ì™„ë£Œí–ˆìŠµë‹ˆë‹¤</button>
            </div>`;
        }

        function finishShare() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('btn-kakao').classList.add('hidden');
            document.getElementById('btn-submit').classList.remove('hidden');
            
            if(true && res.score === 100) { 
                localStorage.setItem('done_'+C.hwId, 'true'); 
                showFinal(); return; 
            }
            if(C.maxT > 0 && att >= C.maxT) { showFinal(); return; }

            const hintMsg = `ğŸ“Š ${att}íšŒì°¨ ê²°ê³¼: ${res.score}ì ${hintLogic}`;
            alert(hintMsg);
            
            // ì‹œíŠ¸ ë¦¬ì…‹ ë° íƒ€ì´ë¨¸ ê°€ë™
            ans = {}; render(); checkTimer();
            const btnExp = document.getElementById('btn-exp');
            if(att >= 2 || res.score === 100) {
                btnExp.className = 'w-full bg-emerald-600 text-white py-4 rounded-2xl font-black text-xs';
                btnExp.innerText = 'âœ… í•´ì„¤ì§€ ì—´ê¸°';
                btnExp.onclick = () => window.open(C.exp);
            }
        }

        function checkTimer() {
            if(!true) return;
            const diff = Date.now() - lastT;
            const wait = C.wait * 60 * 1000;
            const btn = document.getElementById('btn-submit');
            const timer = document.getElementById('timer');
            
            if(att > 0 && diff < wait) {
                btn.disabled = true; btn.classList.add('opacity-50');
                const itv = setInterval(() => {
                    const rem = Math.ceil((wait - (Date.now() - lastT)) / 1000);
                    if(rem <= 0) {
                        btn.disabled = false; btn.classList.remove('opacity-50');
                        timer.innerText = "â± ì…ë ¥ ê°€ëŠ¥"; clearInterval(itv);
                    } else {
                        const m = Math.floor(rem/60), s = rem%60;
                        timer.innerText = `â± ì¬ì‘ì‹œ ëŒ€ê¸°: ${m}:${s<10?'0'+s:s}`;
                    }
                }, 1000);
            }
        }

        function showFinal() {
            document.getElementById('view-intro').classList.add('hidden');
            document.getElementById('view-exam').classList.add('hidden');
            document.getElementById('view-final').classList.remove('hidden');
        }

        // Admin View Logic
        window.addEventListener('load', () => {
            const p = new URLSearchParams(window.location.search);
            if(p.has('admin_view')) {
                const d = JSON.parse(decodeURIComponent(p.get('admin_view')));
                document.body.innerHTML = `<div class="min-h-screen flex items-center justify-center p-6">
                    <div class="w-full max-w-sm bg-white p-8 rounded-[2.5rem] shadow-2xl border border-indigo-100 text-center space-y-6">
                        <div class="text-4xl">ğŸ“Š</div>
                        <h2 class="text-xl font-black text-indigo-900">ì œì¶œ ë¦¬í¬íŠ¸</h2>
                        <div class="text-left space-y-3 bg-slate-50 p-6 rounded-2xl font-bold text-sm">
                            <p>ğŸ‘¤ ì´ë¦„: ${d.name}</p>
                            <p>ğŸ« í•™ì›: ${d.academy}</p>
                            <p>ğŸ”„ íšŒì°¨: ${d.att}íšŒì°¨</p>
                            <p>ğŸ¯ ì ìˆ˜: <span class="text-indigo-600">${d.score}ì </span></p>
                            <p class="text-[10px] text-rose-500">âŒ ì˜¤ë‹µ: ${d.wrongs || 'ì—†ìŒ'}</p>
                        </div>
                        <button onclick="location.href=location.href.split('?')[0]" class="w-full py-4 bg-indigo-600 text-white rounded-xl font-bold">ëŒì•„ê°€ê¸°</button>
                    </div>
                </div>`;
            }
        });
    </script>
</body>
</html>